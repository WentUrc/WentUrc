var wv=Object.defineProperty;var Dv=(i,e,t)=>e in i?wv(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var We=(i,e,t)=>(Dv(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Ru(i){const e=Object.create(null);for(const t of i.split(","))e[t]=1;return t=>t in e}const je={},Xn=[],Us=()=>{},Pv=()=>!1,el=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),ku=i=>i.startsWith("onUpdate:"),ht=Object.assign,Cu=(i,e)=>{const t=i.indexOf(e);t>-1&&i.splice(t,1)},Ov=Object.prototype.hasOwnProperty,Ge=(i,e)=>Ov.call(i,e),_e=Array.isArray,Qn=i=>Lo(i)==="[object Map]",tl=i=>Lo(i)==="[object Set]",nf=i=>Lo(i)==="[object Date]",be=i=>typeof i=="function",ft=i=>typeof i=="string",ai=i=>typeof i=="symbol",Qe=i=>i!==null&&typeof i=="object",Jg=i=>(Qe(i)||be(i))&&be(i.then)&&be(i.catch),Zg=Object.prototype.toString,Lo=i=>Zg.call(i),Mv=i=>Lo(i).slice(8,-1),em=i=>Lo(i)==="[object Object]",wu=i=>ft(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,$r=Ru(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),sl=i=>{const e=Object.create(null);return t=>e[t]||(e[t]=i(t))},Fv=/-(\w)/g,Ps=sl(i=>i.replace(Fv,(e,t)=>t?t.toUpperCase():"")),Nv=/\B([A-Z])/g,Ji=sl(i=>i.replace(Nv,"-$1").toLowerCase()),il=sl(i=>i.charAt(0).toUpperCase()+i.slice(1)),Ll=sl(i=>i?`on${il(i)}`:""),Ki=(i,e)=>!Object.is(i,e),na=(i,...e)=>{for(let t=0;t<i.length;t++)i[t](...e)},tm=(i,e,t,s=!1)=>{Object.defineProperty(i,e,{configurable:!0,enumerable:!1,writable:s,value:t})},Lc=i=>{const e=parseFloat(i);return isNaN(e)?i:e},$v=i=>{const e=ft(i)?Number(i):NaN;return isNaN(e)?i:e};let rf;const nl=()=>rf||(rf=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Yt(i){if(_e(i)){const e={};for(let t=0;t<i.length;t++){const s=i[t],n=ft(s)?Hv(s):Yt(s);if(n)for(const r in n)e[r]=n[r]}return e}else if(ft(i)||Qe(i))return i}const Uv=/;(?![^(]*\))/g,Bv=/:([^]+)/,Gv=/\/\*[^]*?\*\//g;function Hv(i){const e={};return i.replace(Gv,"").split(Uv).forEach(t=>{if(t){const s=t.split(Bv);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function $e(i){let e="";if(ft(i))e=i;else if(_e(i))for(let t=0;t<i.length;t++){const s=$e(i[t]);s&&(e+=s+" ")}else if(Qe(i))for(const t in i)i[t]&&(e+=t+" ");return e.trim()}const Vv="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Kv=Ru(Vv);function sm(i){return!!i||i===""}function zv(i,e){if(i.length!==e.length)return!1;let t=!0;for(let s=0;t&&s<i.length;s++)t=rl(i[s],e[s]);return t}function rl(i,e){if(i===e)return!0;let t=nf(i),s=nf(e);if(t||s)return t&&s?i.getTime()===e.getTime():!1;if(t=ai(i),s=ai(e),t||s)return i===e;if(t=_e(i),s=_e(e),t||s)return t&&s?zv(i,e):!1;if(t=Qe(i),s=Qe(e),t||s){if(!t||!s)return!1;const n=Object.keys(i).length,r=Object.keys(e).length;if(n!==r)return!1;for(const o in i){const a=i.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!rl(i[o],e[o]))return!1}}return String(i)===String(e)}function im(i,e){return i.findIndex(t=>rl(t,e))}const nm=i=>!!(i&&i.__v_isRef===!0),Le=i=>ft(i)?i:i==null?"":_e(i)||Qe(i)&&(i.toString===Zg||!be(i.toString))?nm(i)?Le(i.value):JSON.stringify(i,rm,2):String(i),rm=(i,e)=>nm(e)?rm(i,e.value):Qn(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[s,n],r)=>(t[Il(s,r)+" =>"]=n,t),{})}:tl(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Il(t))}:ai(e)?Il(e):Qe(e)&&!_e(e)&&!em(e)?String(e):e,Il=(i,e="")=>{var t;return ai(i)?`Symbol(${(t=i.description)!=null?t:e})`:i};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let hs;class Wv{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=hs,!e&&hs&&(this.index=(hs.scopes||(hs.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=hs;try{return hs=this,e()}finally{hs=t}}}on(){hs=this}off(){hs=this.parent}stop(e){if(this._active){this._active=!1;let t,s;for(t=0,s=this.effects.length;t<s;t++)this.effects[t].stop();for(this.effects.length=0,t=0,s=this.cleanups.length;t<s;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.parent=void 0}}}function qv(){return hs}let Je;const Rl=new WeakSet;class om{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,hs&&hs.active&&hs.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Rl.has(this)&&(Rl.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||lm(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,of(this),cm(this);const e=Je,t=Bs;Je=this,Bs=!0;try{return this.fn()}finally{um(this),Je=e,Bs=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Ou(e);this.deps=this.depsTail=void 0,of(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Rl.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Ic(this)&&this.run()}get dirty(){return Ic(this)}}let am=0,Ur,Br;function lm(i,e=!1){if(i.flags|=8,e){i.next=Br,Br=i;return}i.next=Ur,Ur=i}function Du(){am++}function Pu(){if(--am>0)return;if(Br){let e=Br;for(Br=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let i;for(;Ur;){let e=Ur;for(Ur=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(s){i||(i=s)}e=t}}if(i)throw i}function cm(i){for(let e=i.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function um(i){let e,t=i.depsTail,s=t;for(;s;){const n=s.prevDep;s.version===-1?(s===t&&(t=n),Ou(s),Yv(s)):e=s,s.dep.activeLink=s.prevActiveLink,s.prevActiveLink=void 0,s=n}i.deps=e,i.depsTail=t}function Ic(i){for(let e=i.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(hm(e.dep.computed)||e.dep.version!==e.version))return!0;return!!i._dirty}function hm(i){if(i.flags&4&&!(i.flags&16)||(i.flags&=-17,i.globalVersion===io))return;i.globalVersion=io;const e=i.dep;if(i.flags|=2,e.version>0&&!i.isSSR&&i.deps&&!Ic(i)){i.flags&=-3;return}const t=Je,s=Bs;Je=i,Bs=!0;try{cm(i);const n=i.fn(i._value);(e.version===0||Ki(n,i._value))&&(i._value=n,e.version++)}catch(n){throw e.version++,n}finally{Je=t,Bs=s,um(i),i.flags&=-3}}function Ou(i,e=!1){const{dep:t,prevSub:s,nextSub:n}=i;if(s&&(s.nextSub=n,i.prevSub=void 0),n&&(n.prevSub=s,i.nextSub=void 0),t.subs===i&&(t.subs=s,!s&&t.computed)){t.computed.flags&=-5;for(let r=t.computed.deps;r;r=r.nextDep)Ou(r,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function Yv(i){const{prevDep:e,nextDep:t}=i;e&&(e.nextDep=t,i.prevDep=void 0),t&&(t.prevDep=e,i.nextDep=void 0)}let Bs=!0;const fm=[];function Zi(){fm.push(Bs),Bs=!1}function en(){const i=fm.pop();Bs=i===void 0?!0:i}function of(i){const{cleanup:e}=i;if(i.cleanup=void 0,e){const t=Je;Je=void 0;try{e()}finally{Je=t}}}let io=0;class jv{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Mu{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!Je||!Bs||Je===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Je)t=this.activeLink=new jv(Je,this),Je.deps?(t.prevDep=Je.depsTail,Je.depsTail.nextDep=t,Je.depsTail=t):Je.deps=Je.depsTail=t,dm(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const s=t.nextDep;s.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=s),t.prevDep=Je.depsTail,t.nextDep=void 0,Je.depsTail.nextDep=t,Je.depsTail=t,Je.deps===t&&(Je.deps=s)}return t}trigger(e){this.version++,io++,this.notify(e)}notify(e){Du();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Pu()}}}function dm(i){if(i.dep.sc++,i.sub.flags&4){const e=i.dep.computed;if(e&&!i.dep.subs){e.flags|=20;for(let s=e.deps;s;s=s.nextDep)dm(s)}const t=i.dep.subs;t!==i&&(i.prevSub=t,t&&(t.nextSub=i)),i.dep.subs=i}}const Rc=new WeakMap,_n=Symbol(""),kc=Symbol(""),no=Symbol("");function Ot(i,e,t){if(Bs&&Je){let s=Rc.get(i);s||Rc.set(i,s=new Map);let n=s.get(t);n||(s.set(t,n=new Mu),n.map=s,n.key=t),n.track()}}function xi(i,e,t,s,n,r){const o=Rc.get(i);if(!o){io++;return}const a=l=>{l&&l.trigger()};if(Du(),e==="clear")o.forEach(a);else{const l=_e(i),c=l&&wu(t);if(l&&t==="length"){const u=Number(s);o.forEach((h,f)=>{(f==="length"||f===no||!ai(f)&&f>=u)&&a(h)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(no)),e){case"add":l?c&&a(o.get("length")):(a(o.get(_n)),Qn(i)&&a(o.get(kc)));break;case"delete":l||(a(o.get(_n)),Qn(i)&&a(o.get(kc)));break;case"set":Qn(i)&&a(o.get(_n));break}}Pu()}function Nn(i){const e=Me(i);return e===i?e:(Ot(e,"iterate",no),Ds(i)?e:e.map(Mt))}function ol(i){return Ot(i=Me(i),"iterate",no),i}const Xv={__proto__:null,[Symbol.iterator](){return kl(this,Symbol.iterator,Mt)},concat(...i){return Nn(this).concat(...i.map(e=>_e(e)?Nn(e):e))},entries(){return kl(this,"entries",i=>(i[1]=Mt(i[1]),i))},every(i,e){return di(this,"every",i,e,void 0,arguments)},filter(i,e){return di(this,"filter",i,e,t=>t.map(Mt),arguments)},find(i,e){return di(this,"find",i,e,Mt,arguments)},findIndex(i,e){return di(this,"findIndex",i,e,void 0,arguments)},findLast(i,e){return di(this,"findLast",i,e,Mt,arguments)},findLastIndex(i,e){return di(this,"findLastIndex",i,e,void 0,arguments)},forEach(i,e){return di(this,"forEach",i,e,void 0,arguments)},includes(...i){return Cl(this,"includes",i)},indexOf(...i){return Cl(this,"indexOf",i)},join(i){return Nn(this).join(i)},lastIndexOf(...i){return Cl(this,"lastIndexOf",i)},map(i,e){return di(this,"map",i,e,void 0,arguments)},pop(){return Er(this,"pop")},push(...i){return Er(this,"push",i)},reduce(i,...e){return af(this,"reduce",i,e)},reduceRight(i,...e){return af(this,"reduceRight",i,e)},shift(){return Er(this,"shift")},some(i,e){return di(this,"some",i,e,void 0,arguments)},splice(...i){return Er(this,"splice",i)},toReversed(){return Nn(this).toReversed()},toSorted(i){return Nn(this).toSorted(i)},toSpliced(...i){return Nn(this).toSpliced(...i)},unshift(...i){return Er(this,"unshift",i)},values(){return kl(this,"values",Mt)}};function kl(i,e,t){const s=ol(i),n=s[e]();return s!==i&&!Ds(i)&&(n._next=n.next,n.next=()=>{const r=n._next();return r.value&&(r.value=t(r.value)),r}),n}const Qv=Array.prototype;function di(i,e,t,s,n,r){const o=ol(i),a=o!==i&&!Ds(i),l=o[e];if(l!==Qv[e]){const h=l.apply(i,r);return a?Mt(h):h}let c=t;o!==i&&(a?c=function(h,f){return t.call(this,Mt(h),f,i)}:t.length>2&&(c=function(h,f){return t.call(this,h,f,i)}));const u=l.call(o,c,s);return a&&n?n(u):u}function af(i,e,t,s){const n=ol(i);let r=t;return n!==i&&(Ds(i)?t.length>3&&(r=function(o,a,l){return t.call(this,o,a,l,i)}):r=function(o,a,l){return t.call(this,o,Mt(a),l,i)}),n[e](r,...s)}function Cl(i,e,t){const s=Me(i);Ot(s,"iterate",no);const n=s[e](...t);return(n===-1||n===!1)&&$u(t[0])?(t[0]=Me(t[0]),s[e](...t)):n}function Er(i,e,t=[]){Zi(),Du();const s=Me(i)[e].apply(i,t);return Pu(),en(),s}const Jv=Ru("__proto__,__v_isRef,__isVue"),gm=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(ai));function Zv(i){ai(i)||(i=String(i));const e=Me(this);return Ot(e,"has",i),e.hasOwnProperty(i)}class mm{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,s){if(t==="__v_skip")return e.__v_skip;const n=this._isReadonly,r=this._isShallow;if(t==="__v_isReactive")return!n;if(t==="__v_isReadonly")return n;if(t==="__v_isShallow")return r;if(t==="__v_raw")return s===(n?r?cT:Tm:r?vm:ym).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const o=_e(e);if(!n){let l;if(o&&(l=Xv[t]))return l;if(t==="hasOwnProperty")return Zv}const a=Reflect.get(e,t,Nt(e)?e:s);return(ai(t)?gm.has(t):Jv(t))||(n||Ot(e,"get",t),r)?a:Nt(a)?o&&wu(t)?a:a.value:Qe(a)?n?Em(a):al(a):a}}class pm extends mm{constructor(e=!1){super(!1,e)}set(e,t,s,n){let r=e[t];if(!this._isShallow){const l=Rn(r);if(!Ds(s)&&!Rn(s)&&(r=Me(r),s=Me(s)),!_e(e)&&Nt(r)&&!Nt(s))return l?!1:(r.value=s,!0)}const o=_e(e)&&wu(t)?Number(t)<e.length:Ge(e,t),a=Reflect.set(e,t,s,Nt(e)?e:n);return e===Me(n)&&(o?Ki(s,r)&&xi(e,"set",t,s):xi(e,"add",t,s)),a}deleteProperty(e,t){const s=Ge(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&s&&xi(e,"delete",t,void 0),n}has(e,t){const s=Reflect.has(e,t);return(!ai(t)||!gm.has(t))&&Ot(e,"has",t),s}ownKeys(e){return Ot(e,"iterate",_e(e)?"length":_n),Reflect.ownKeys(e)}}class eT extends mm{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const tT=new pm,sT=new eT,iT=new pm(!0);const Cc=i=>i,Fo=i=>Reflect.getPrototypeOf(i);function nT(i,e,t){return function(...s){const n=this.__v_raw,r=Me(n),o=Qn(r),a=i==="entries"||i===Symbol.iterator&&o,l=i==="keys"&&o,c=n[i](...s),u=t?Cc:e?wc:Mt;return!e&&Ot(r,"iterate",l?kc:_n),{next(){const{value:h,done:f}=c.next();return f?{value:h,done:f}:{value:a?[u(h[0]),u(h[1])]:u(h),done:f}},[Symbol.iterator](){return this}}}}function No(i){return function(...e){return i==="delete"?!1:i==="clear"?void 0:this}}function rT(i,e){const t={get(n){const r=this.__v_raw,o=Me(r),a=Me(n);i||(Ki(n,a)&&Ot(o,"get",n),Ot(o,"get",a));const{has:l}=Fo(o),c=e?Cc:i?wc:Mt;if(l.call(o,n))return c(r.get(n));if(l.call(o,a))return c(r.get(a));r!==o&&r.get(n)},get size(){const n=this.__v_raw;return!i&&Ot(Me(n),"iterate",_n),Reflect.get(n,"size",n)},has(n){const r=this.__v_raw,o=Me(r),a=Me(n);return i||(Ki(n,a)&&Ot(o,"has",n),Ot(o,"has",a)),n===a?r.has(n):r.has(n)||r.has(a)},forEach(n,r){const o=this,a=o.__v_raw,l=Me(a),c=e?Cc:i?wc:Mt;return!i&&Ot(l,"iterate",_n),a.forEach((u,h)=>n.call(r,c(u),c(h),o))}};return ht(t,i?{add:No("add"),set:No("set"),delete:No("delete"),clear:No("clear")}:{add(n){!e&&!Ds(n)&&!Rn(n)&&(n=Me(n));const r=Me(this);return Fo(r).has.call(r,n)||(r.add(n),xi(r,"add",n,n)),this},set(n,r){!e&&!Ds(r)&&!Rn(r)&&(r=Me(r));const o=Me(this),{has:a,get:l}=Fo(o);let c=a.call(o,n);c||(n=Me(n),c=a.call(o,n));const u=l.call(o,n);return o.set(n,r),c?Ki(r,u)&&xi(o,"set",n,r):xi(o,"add",n,r),this},delete(n){const r=Me(this),{has:o,get:a}=Fo(r);let l=o.call(r,n);l||(n=Me(n),l=o.call(r,n)),a&&a.call(r,n);const c=r.delete(n);return l&&xi(r,"delete",n,void 0),c},clear(){const n=Me(this),r=n.size!==0,o=n.clear();return r&&xi(n,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(n=>{t[n]=nT(n,i,e)}),t}function Fu(i,e){const t=rT(i,e);return(s,n,r)=>n==="__v_isReactive"?!i:n==="__v_isReadonly"?i:n==="__v_raw"?s:Reflect.get(Ge(t,n)&&n in s?t:s,n,r)}const oT={get:Fu(!1,!1)},aT={get:Fu(!1,!0)},lT={get:Fu(!0,!1)};const ym=new WeakMap,vm=new WeakMap,Tm=new WeakMap,cT=new WeakMap;function uT(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function hT(i){return i.__v_skip||!Object.isExtensible(i)?0:uT(Mv(i))}function al(i){return Rn(i)?i:Nu(i,!1,tT,oT,ym)}function _m(i){return Nu(i,!1,iT,aT,vm)}function Em(i){return Nu(i,!0,sT,lT,Tm)}function Nu(i,e,t,s,n){if(!Qe(i)||i.__v_raw&&!(e&&i.__v_isReactive))return i;const r=n.get(i);if(r)return r;const o=hT(i);if(o===0)return i;const a=new Proxy(i,o===2?s:t);return n.set(i,a),a}function Jn(i){return Rn(i)?Jn(i.__v_raw):!!(i&&i.__v_isReactive)}function Rn(i){return!!(i&&i.__v_isReadonly)}function Ds(i){return!!(i&&i.__v_isShallow)}function $u(i){return i?!!i.__v_raw:!1}function Me(i){const e=i&&i.__v_raw;return e?Me(e):i}function fT(i){return!Ge(i,"__v_skip")&&Object.isExtensible(i)&&tm(i,"__v_skip",!0),i}const Mt=i=>Qe(i)?al(i):i,wc=i=>Qe(i)?Em(i):i;function Nt(i){return i?i.__v_isRef===!0:!1}function ra(i){return Sm(i,!1)}function dT(i){return Sm(i,!0)}function Sm(i,e){return Nt(i)?i:new gT(i,e)}class gT{constructor(e,t){this.dep=new Mu,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Me(e),this._value=t?e:Mt(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,s=this.__v_isShallow||Ds(e)||Rn(e);e=s?e:Me(e),Ki(e,t)&&(this._rawValue=e,this._value=s?e:Mt(e),this.dep.trigger())}}function En(i){return Nt(i)?i.value:i}const mT={get:(i,e,t)=>e==="__v_raw"?i:En(Reflect.get(i,e,t)),set:(i,e,t,s)=>{const n=i[e];return Nt(n)&&!Nt(t)?(n.value=t,!0):Reflect.set(i,e,t,s)}};function xm(i){return Jn(i)?i:new Proxy(i,mT)}class pT{constructor(e,t,s){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Mu(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=io-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=s}notify(){if(this.flags|=16,!(this.flags&8)&&Je!==this)return lm(this,!0),!0}get value(){const e=this.dep.track();return hm(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function yT(i,e,t=!1){let s,n;return be(i)?s=i:(s=i.get,n=i.set),new pT(s,n,t)}const $o={},ba=new WeakMap;let un;function vT(i,e=!1,t=un){if(t){let s=ba.get(t);s||ba.set(t,s=[]),s.push(i)}}function TT(i,e,t=je){const{immediate:s,deep:n,once:r,scheduler:o,augmentJob:a,call:l}=t,c=E=>n?E:Ds(E)||n===!1||n===0?bi(E,1):bi(E);let u,h,f,d,g=!1,m=!1;if(Nt(i)?(h=()=>i.value,g=Ds(i)):Jn(i)?(h=()=>c(i),g=!0):_e(i)?(m=!0,g=i.some(E=>Jn(E)||Ds(E)),h=()=>i.map(E=>{if(Nt(E))return E.value;if(Jn(E))return c(E);if(be(E))return l?l(E,2):E()})):be(i)?e?h=l?()=>l(i,2):i:h=()=>{if(f){Zi();try{f()}finally{en()}}const E=un;un=u;try{return l?l(i,3,[d]):i(d)}finally{un=E}}:h=Us,e&&n){const E=h,S=n===!0?1/0:n;h=()=>bi(E(),S)}const p=qv(),y=()=>{u.stop(),p&&p.active&&Cu(p.effects,u)};if(r&&e){const E=e;e=(...S)=>{E(...S),y()}}let _=m?new Array(i.length).fill($o):$o;const T=E=>{if(!(!(u.flags&1)||!u.dirty&&!E))if(e){const S=u.run();if(n||g||(m?S.some((R,x)=>Ki(R,_[x])):Ki(S,_))){f&&f();const R=un;un=u;try{const x=[S,_===$o?void 0:m&&_[0]===$o?[]:_,d];l?l(e,3,x):e(...x),_=S}finally{un=R}}}else u.run()};return a&&a(T),u=new om(h),u.scheduler=o?()=>o(T,!1):T,d=E=>vT(E,!1,u),f=u.onStop=()=>{const E=ba.get(u);if(E){if(l)l(E,4);else for(const S of E)S();ba.delete(u)}},e?s?T(!0):_=u.run():o?o(T.bind(null,!0),!0):u.run(),y.pause=u.pause.bind(u),y.resume=u.resume.bind(u),y.stop=y,y}function bi(i,e=1/0,t){if(e<=0||!Qe(i)||i.__v_skip||(t=t||new Set,t.has(i)))return i;if(t.add(i),e--,Nt(i))bi(i.value,e,t);else if(_e(i))for(let s=0;s<i.length;s++)bi(i[s],e,t);else if(tl(i)||Qn(i))i.forEach(s=>{bi(s,e,t)});else if(em(i)){for(const s in i)bi(i[s],e,t);for(const s of Object.getOwnPropertySymbols(i))Object.prototype.propertyIsEnumerable.call(i,s)&&bi(i[s],e,t)}return i}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Io(i,e,t,s){try{return s?i(...s):i()}catch(n){ll(n,e,t)}}function Gs(i,e,t,s){if(be(i)){const n=Io(i,e,t,s);return n&&Jg(n)&&n.catch(r=>{ll(r,e,t)}),n}if(_e(i)){const n=[];for(let r=0;r<i.length;r++)n.push(Gs(i[r],e,t,s));return n}}function ll(i,e,t,s=!0){const n=e?e.vnode:null,{errorHandler:r,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||je;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const u=a.ec;if(u){for(let h=0;h<u.length;h++)if(u[h](i,l,c)===!1)return}a=a.parent}if(r){Zi(),Io(r,null,10,[i,l,c]),en();return}}_T(i,t,n,s,o)}function _T(i,e,t,s=!0,n=!1){if(n)throw i;console.error(i)}const Kt=[];let Qs=-1;const Zn=[];let Mi=null,Vn=0;const bm=Promise.resolve();let Aa=null;function Am(i){const e=Aa||bm;return i?e.then(this?i.bind(this):i):e}function ET(i){let e=Qs+1,t=Kt.length;for(;e<t;){const s=e+t>>>1,n=Kt[s],r=ro(n);r<i||r===i&&n.flags&2?e=s+1:t=s}return e}function Uu(i){if(!(i.flags&1)){const e=ro(i),t=Kt[Kt.length-1];!t||!(i.flags&2)&&e>=ro(t)?Kt.push(i):Kt.splice(ET(e),0,i),i.flags|=1,Lm()}}function Lm(){Aa||(Aa=bm.then(Rm))}function ST(i){_e(i)?Zn.push(...i):Mi&&i.id===-1?Mi.splice(Vn+1,0,i):i.flags&1||(Zn.push(i),i.flags|=1),Lm()}function lf(i,e,t=Qs+1){for(;t<Kt.length;t++){const s=Kt[t];if(s&&s.flags&2){if(i&&s.id!==i.uid)continue;Kt.splice(t,1),t--,s.flags&4&&(s.flags&=-2),s(),s.flags&4||(s.flags&=-2)}}}function Im(i){if(Zn.length){const e=[...new Set(Zn)].sort((t,s)=>ro(t)-ro(s));if(Zn.length=0,Mi){Mi.push(...e);return}for(Mi=e,Vn=0;Vn<Mi.length;Vn++){const t=Mi[Vn];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Mi=null,Vn=0}}const ro=i=>i.id==null?i.flags&2?-1:1/0:i.id;function Rm(i){const e=Us;try{for(Qs=0;Qs<Kt.length;Qs++){const t=Kt[Qs];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Io(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Qs<Kt.length;Qs++){const t=Kt[Qs];t&&(t.flags&=-2)}Qs=-1,Kt.length=0,Im(),Aa=null,(Kt.length||Zn.length)&&Rm()}}let is=null,km=null;function La(i){const e=is;return is=i,km=i&&i.type.__scopeId||null,e}function kn(i,e=is,t){if(!e||i._n)return i;const s=(...n)=>{s._d&&vf(-1);const r=La(e);let o;try{o=i(...n)}finally{La(r),s._d&&vf(1)}return o};return s._n=!0,s._c=!0,s._d=!0,s}function Cm(i,e){if(is===null)return i;const t=dl(is),s=i.dirs||(i.dirs=[]);for(let n=0;n<e.length;n++){let[r,o,a,l=je]=e[n];r&&(be(r)&&(r={mounted:r,updated:r}),r.deep&&bi(o),s.push({dir:r,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return i}function sn(i,e,t,s){const n=i.dirs,r=e&&e.dirs;for(let o=0;o<n.length;o++){const a=n[o];r&&(a.oldValue=r[o].value);let l=a.dir[s];l&&(Zi(),Gs(l,t,8,[i.el,a,i,e]),en())}}const xT=Symbol("_vte"),wm=i=>i.__isTeleport,Fi=Symbol("_leaveCb"),Uo=Symbol("_enterCb");function Dm(){const i={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Gu(()=>{i.isMounted=!0}),Hu(()=>{i.isUnmounting=!0}),i}const xs=[Function,Array],Pm={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:xs,onEnter:xs,onAfterEnter:xs,onEnterCancelled:xs,onBeforeLeave:xs,onLeave:xs,onAfterLeave:xs,onLeaveCancelled:xs,onBeforeAppear:xs,onAppear:xs,onAfterAppear:xs,onAppearCancelled:xs},Om=i=>{const e=i.subTree;return e.component?Om(e.component):e},bT={name:"BaseTransition",props:Pm,setup(i,{slots:e}){const t=lp(),s=Dm();return()=>{const n=e.default&&Bu(e.default(),!0);if(!n||!n.length)return;const r=Mm(n),o=Me(i),{mode:a}=o;if(s.isLeaving)return wl(r);const l=cf(r);if(!l)return wl(r);let c=oo(l,o,s,t,h=>c=h);l.type!==ts&&Cn(l,c);let u=t.subTree&&cf(t.subTree);if(u&&u.type!==ts&&!gn(l,u)&&Om(t).type!==ts){let h=oo(u,o,s,t);if(Cn(u,h),a==="out-in"&&l.type!==ts)return s.isLeaving=!0,h.afterLeave=()=>{s.isLeaving=!1,t.job.flags&8||t.update(),delete h.afterLeave,u=void 0},wl(r);a==="in-out"&&l.type!==ts?h.delayLeave=(f,d,g)=>{const m=Fm(s,u);m[String(u.key)]=u,f[Fi]=()=>{d(),f[Fi]=void 0,delete c.delayedLeave,u=void 0},c.delayedLeave=()=>{g(),delete c.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return r}}};function Mm(i){let e=i[0];if(i.length>1){for(const t of i)if(t.type!==ts){e=t;break}}return e}const AT=bT;function Fm(i,e){const{leavingVNodes:t}=i;let s=t.get(e.type);return s||(s=Object.create(null),t.set(e.type,s)),s}function oo(i,e,t,s,n){const{appear:r,mode:o,persisted:a=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:u,onEnterCancelled:h,onBeforeLeave:f,onLeave:d,onAfterLeave:g,onLeaveCancelled:m,onBeforeAppear:p,onAppear:y,onAfterAppear:_,onAppearCancelled:T}=e,E=String(i.key),S=Fm(t,i),R=(A,k)=>{A&&Gs(A,s,9,k)},x=(A,k)=>{const w=k[1];R(A,k),_e(A)?A.every(P=>P.length<=1)&&w():A.length<=1&&w()},L={mode:o,persisted:a,beforeEnter(A){let k=l;if(!t.isMounted)if(r)k=p||l;else return;A[Fi]&&A[Fi](!0);const w=S[E];w&&gn(i,w)&&w.el[Fi]&&w.el[Fi](),R(k,[A])},enter(A){let k=c,w=u,P=h;if(!t.isMounted)if(r)k=y||c,w=_||u,P=T||h;else return;let B=!1;const X=A[Uo]=q=>{B||(B=!0,q?R(P,[A]):R(w,[A]),L.delayedLeave&&L.delayedLeave(),A[Uo]=void 0)};k?x(k,[A,X]):X()},leave(A,k){const w=String(i.key);if(A[Uo]&&A[Uo](!0),t.isUnmounting)return k();R(f,[A]);let P=!1;const B=A[Fi]=X=>{P||(P=!0,k(),X?R(m,[A]):R(g,[A]),A[Fi]=void 0,S[w]===i&&delete S[w])};S[w]=i,d?x(d,[A,B]):B()},clone(A){const k=oo(A,e,t,s,n);return n&&n(k),k}};return L}function wl(i){if(cl(i))return i=qi(i),i.children=null,i}function cf(i){if(!cl(i))return wm(i.type)&&i.children?Mm(i.children):i;const{shapeFlag:e,children:t}=i;if(t){if(e&16)return t[0];if(e&32&&be(t.default))return t.default()}}function Cn(i,e){i.shapeFlag&6&&i.component?(i.transition=e,Cn(i.component.subTree,e)):i.shapeFlag&128?(i.ssContent.transition=e.clone(i.ssContent),i.ssFallback.transition=e.clone(i.ssFallback)):i.transition=e}function Bu(i,e=!1,t){let s=[],n=0;for(let r=0;r<i.length;r++){let o=i[r];const a=t==null?o.key:String(t)+String(o.key!=null?o.key:r);o.type===et?(o.patchFlag&128&&n++,s=s.concat(Bu(o.children,e,a))):(e||o.type!==ts)&&s.push(a!=null?qi(o,{key:a}):o)}if(n>1)for(let r=0;r<s.length;r++)s[r].patchFlag=-2;return s}/*! #__NO_SIDE_EFFECTS__ */function Nm(i,e){return be(i)?(()=>ht({name:i.name},e,{setup:i}))():i}function $m(i){i.ids=[i.ids[0]+i.ids[2]+++"-",0,0]}function Ia(i,e,t,s,n=!1){if(_e(i)){i.forEach((g,m)=>Ia(g,e&&(_e(e)?e[m]:e),t,s,n));return}if(Gr(s)&&!n){s.shapeFlag&512&&s.type.__asyncResolved&&s.component.subTree.component&&Ia(i,e,t,s.component.subTree);return}const r=s.shapeFlag&4?dl(s.component):s.el,o=n?null:r,{i:a,r:l}=i,c=e&&e.r,u=a.refs===je?a.refs={}:a.refs,h=a.setupState,f=Me(h),d=h===je?()=>!1:g=>Ge(f,g);if(c!=null&&c!==l&&(ft(c)?(u[c]=null,d(c)&&(h[c]=null)):Nt(c)&&(c.value=null)),be(l))Io(l,a,12,[o,u]);else{const g=ft(l),m=Nt(l);if(g||m){const p=()=>{if(i.f){const y=g?d(l)?h[l]:u[l]:l.value;n?_e(y)&&Cu(y,r):_e(y)?y.includes(r)||y.push(r):g?(u[l]=[r],d(l)&&(h[l]=u[l])):(l.value=[r],i.k&&(u[i.k]=l.value))}else g?(u[l]=o,d(l)&&(h[l]=o)):m&&(l.value=o,i.k&&(u[i.k]=o))};o?(p.id=-1,us(p,t)):p()}}}nl().requestIdleCallback;nl().cancelIdleCallback;const Gr=i=>!!i.type.__asyncLoader,cl=i=>i.type.__isKeepAlive;function LT(i,e){Um(i,"a",e)}function IT(i,e){Um(i,"da",e)}function Um(i,e,t=Rt){const s=i.__wdc||(i.__wdc=()=>{let n=t;for(;n;){if(n.isDeactivated)return;n=n.parent}return i()});if(ul(e,s,t),t){let n=t.parent;for(;n&&n.parent;)cl(n.parent.vnode)&&RT(s,e,t,n),n=n.parent}}function RT(i,e,t,s){const n=ul(e,i,s,!0);Gm(()=>{Cu(s[e],n)},t)}function ul(i,e,t=Rt,s=!1){if(t){const n=t[i]||(t[i]=[]),r=e.__weh||(e.__weh=(...o)=>{Zi();const a=ko(t),l=Gs(e,t,i,o);return a(),en(),l});return s?n.unshift(r):n.push(r),r}}const Ri=i=>(e,t=Rt)=>{(!lo||i==="sp")&&ul(i,(...s)=>e(...s),t)},kT=Ri("bm"),Gu=Ri("m"),CT=Ri("bu"),Bm=Ri("u"),Hu=Ri("bum"),Gm=Ri("um"),wT=Ri("sp"),DT=Ri("rtg"),PT=Ri("rtc");function OT(i,e=Rt){ul("ec",i,e)}const Hm="components";function It(i,e){return FT(Hm,i,!0,e)||i}const MT=Symbol.for("v-ndc");function FT(i,e,t=!0,s=!1){const n=is||Rt;if(n){const r=n.type;if(i===Hm){const a=x_(r,!1);if(a&&(a===e||a===Ps(e)||a===il(Ps(e))))return r}const o=uf(n[i]||r[i],e)||uf(n.appContext[i],e);return!o&&s?r:o}}function uf(i,e){return i&&(i[e]||i[Ps(e)]||i[il(Ps(e))])}function vs(i,e,t,s){let n;const r=t&&t[s],o=_e(i);if(o||ft(i)){const a=o&&Jn(i);let l=!1;a&&(l=!Ds(i),i=ol(i)),n=new Array(i.length);for(let c=0,u=i.length;c<u;c++)n[c]=e(l?Mt(i[c]):i[c],c,void 0,r&&r[c])}else if(typeof i=="number"){n=new Array(i);for(let a=0;a<i;a++)n[a]=e(a+1,a,void 0,r&&r[a])}else if(Qe(i))if(i[Symbol.iterator])n=Array.from(i,(a,l)=>e(a,l,void 0,r&&r[l]));else{const a=Object.keys(i);n=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const u=a[l];n[l]=e(i[u],u,l,r&&r[l])}}else n=[];return t&&(t[s]=n),n}const Dc=i=>i?cp(i)?dl(i):Dc(i.parent):null,Hr=ht(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>Dc(i.parent),$root:i=>Dc(i.root),$host:i=>i.ce,$emit:i=>i.emit,$options:i=>Vu(i),$forceUpdate:i=>i.f||(i.f=()=>{Uu(i.update)}),$nextTick:i=>i.n||(i.n=Am.bind(i.proxy)),$watch:i=>i_.bind(i)}),Dl=(i,e)=>i!==je&&!i.__isScriptSetup&&Ge(i,e),NT={get({_:i},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:s,data:n,props:r,accessCache:o,type:a,appContext:l}=i;let c;if(e[0]!=="$"){const d=o[e];if(d!==void 0)switch(d){case 1:return s[e];case 2:return n[e];case 4:return t[e];case 3:return r[e]}else{if(Dl(s,e))return o[e]=1,s[e];if(n!==je&&Ge(n,e))return o[e]=2,n[e];if((c=i.propsOptions[0])&&Ge(c,e))return o[e]=3,r[e];if(t!==je&&Ge(t,e))return o[e]=4,t[e];Pc&&(o[e]=0)}}const u=Hr[e];let h,f;if(u)return e==="$attrs"&&Ot(i.attrs,"get",""),u(i);if((h=a.__cssModules)&&(h=h[e]))return h;if(t!==je&&Ge(t,e))return o[e]=4,t[e];if(f=l.config.globalProperties,Ge(f,e))return f[e]},set({_:i},e,t){const{data:s,setupState:n,ctx:r}=i;return Dl(n,e)?(n[e]=t,!0):s!==je&&Ge(s,e)?(s[e]=t,!0):Ge(i.props,e)||e[0]==="$"&&e.slice(1)in i?!1:(r[e]=t,!0)},has({_:{data:i,setupState:e,accessCache:t,ctx:s,appContext:n,propsOptions:r}},o){let a;return!!t[o]||i!==je&&Ge(i,o)||Dl(e,o)||(a=r[0])&&Ge(a,o)||Ge(s,o)||Ge(Hr,o)||Ge(n.config.globalProperties,o)},defineProperty(i,e,t){return t.get!=null?i._.accessCache[e]=0:Ge(t,"value")&&this.set(i,e,t.value,null),Reflect.defineProperty(i,e,t)}};function hf(i){return _e(i)?i.reduce((e,t)=>(e[t]=null,e),{}):i}let Pc=!0;function $T(i){const e=Vu(i),t=i.proxy,s=i.ctx;Pc=!1,e.beforeCreate&&ff(e.beforeCreate,i,"bc");const{data:n,computed:r,methods:o,watch:a,provide:l,inject:c,created:u,beforeMount:h,mounted:f,beforeUpdate:d,updated:g,activated:m,deactivated:p,beforeDestroy:y,beforeUnmount:_,destroyed:T,unmounted:E,render:S,renderTracked:R,renderTriggered:x,errorCaptured:L,serverPrefetch:A,expose:k,inheritAttrs:w,components:P,directives:B,filters:X}=e;if(c&&UT(c,s,null),o)for(const H in o){const K=o[H];be(K)&&(s[H]=K.bind(t))}if(n){const H=n.call(t,t);Qe(H)&&(i.data=al(H))}if(Pc=!0,r)for(const H in r){const K=r[H],ae=be(K)?K.bind(t,t):be(K.get)?K.get.bind(t,t):Us,fe=!be(K)&&be(K.set)?K.set.bind(t):Us,z=zt({get:ae,set:fe});Object.defineProperty(s,H,{enumerable:!0,configurable:!0,get:()=>z.value,set:Y=>z.value=Y})}if(a)for(const H in a)Vm(a[H],s,t,H);if(l){const H=be(l)?l.call(t):l;Reflect.ownKeys(H).forEach(K=>{oa(K,H[K])})}u&&ff(u,i,"c");function G(H,K){_e(K)?K.forEach(ae=>H(ae.bind(t))):K&&H(K.bind(t))}if(G(kT,h),G(Gu,f),G(CT,d),G(Bm,g),G(LT,m),G(IT,p),G(OT,L),G(PT,R),G(DT,x),G(Hu,_),G(Gm,E),G(wT,A),_e(k))if(k.length){const H=i.exposed||(i.exposed={});k.forEach(K=>{Object.defineProperty(H,K,{get:()=>t[K],set:ae=>t[K]=ae})})}else i.exposed||(i.exposed={});S&&i.render===Us&&(i.render=S),w!=null&&(i.inheritAttrs=w),P&&(i.components=P),B&&(i.directives=B),A&&$m(i)}function UT(i,e,t=Us){_e(i)&&(i=Oc(i));for(const s in i){const n=i[s];let r;Qe(n)?"default"in n?r=Ai(n.from||s,n.default,!0):r=Ai(n.from||s):r=Ai(n),Nt(r)?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>r.value,set:o=>r.value=o}):e[s]=r}}function ff(i,e,t){Gs(_e(i)?i.map(s=>s.bind(e.proxy)):i.bind(e.proxy),e,t)}function Vm(i,e,t,s){let n=s.includes(".")?ip(t,s):()=>t[s];if(ft(i)){const r=e[i];be(r)&&Vr(n,r)}else if(be(i))Vr(n,i.bind(t));else if(Qe(i))if(_e(i))i.forEach(r=>Vm(r,e,t,s));else{const r=be(i.handler)?i.handler.bind(t):e[i.handler];be(r)&&Vr(n,r,i)}}function Vu(i){const e=i.type,{mixins:t,extends:s}=e,{mixins:n,optionsCache:r,config:{optionMergeStrategies:o}}=i.appContext,a=r.get(e);let l;return a?l=a:!n.length&&!t&&!s?l=e:(l={},n.length&&n.forEach(c=>Ra(l,c,o,!0)),Ra(l,e,o)),Qe(e)&&r.set(e,l),l}function Ra(i,e,t,s=!1){const{mixins:n,extends:r}=e;r&&Ra(i,r,t,!0),n&&n.forEach(o=>Ra(i,o,t,!0));for(const o in e)if(!(s&&o==="expose")){const a=BT[o]||t&&t[o];i[o]=a?a(i[o],e[o]):e[o]}return i}const BT={data:df,props:gf,emits:gf,methods:Pr,computed:Pr,beforeCreate:Ht,created:Ht,beforeMount:Ht,mounted:Ht,beforeUpdate:Ht,updated:Ht,beforeDestroy:Ht,beforeUnmount:Ht,destroyed:Ht,unmounted:Ht,activated:Ht,deactivated:Ht,errorCaptured:Ht,serverPrefetch:Ht,components:Pr,directives:Pr,watch:HT,provide:df,inject:GT};function df(i,e){return e?i?function(){return ht(be(i)?i.call(this,this):i,be(e)?e.call(this,this):e)}:e:i}function GT(i,e){return Pr(Oc(i),Oc(e))}function Oc(i){if(_e(i)){const e={};for(let t=0;t<i.length;t++)e[i[t]]=i[t];return e}return i}function Ht(i,e){return i?[...new Set([].concat(i,e))]:e}function Pr(i,e){return i?ht(Object.create(null),i,e):e}function gf(i,e){return i?_e(i)&&_e(e)?[...new Set([...i,...e])]:ht(Object.create(null),hf(i),hf(e??{})):e}function HT(i,e){if(!i)return e;if(!e)return i;const t=ht(Object.create(null),i);for(const s in e)t[s]=Ht(i[s],e[s]);return t}function Km(){return{app:null,config:{isNativeTag:Pv,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let VT=0;function KT(i,e){return function(s,n=null){be(s)||(s=ht({},s)),n!=null&&!Qe(n)&&(n=null);const r=Km(),o=new WeakSet,a=[];let l=!1;const c=r.app={_uid:VT++,_component:s,_props:n,_container:null,_context:r,_instance:null,version:A_,get config(){return r.config},set config(u){},use(u,...h){return o.has(u)||(u&&be(u.install)?(o.add(u),u.install(c,...h)):be(u)&&(o.add(u),u(c,...h))),c},mixin(u){return r.mixins.includes(u)||r.mixins.push(u),c},component(u,h){return h?(r.components[u]=h,c):r.components[u]},directive(u,h){return h?(r.directives[u]=h,c):r.directives[u]},mount(u,h,f){if(!l){const d=c._ceVNode||Oe(s,n);return d.appContext=r,f===!0?f="svg":f===!1&&(f=void 0),h&&e?e(d,u):i(d,u,f),l=!0,c._container=u,u.__vue_app__=c,dl(d.component)}},onUnmount(u){a.push(u)},unmount(){l&&(Gs(a,c._instance,16),i(null,c._container),delete c._container.__vue_app__)},provide(u,h){return r.provides[u]=h,c},runWithContext(u){const h=er;er=c;try{return u()}finally{er=h}}};return c}}let er=null;function oa(i,e){if(Rt){let t=Rt.provides;const s=Rt.parent&&Rt.parent.provides;s===t&&(t=Rt.provides=Object.create(s)),t[i]=e}}function Ai(i,e,t=!1){const s=Rt||is;if(s||er){const n=er?er._context.provides:s?s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:void 0;if(n&&i in n)return n[i];if(arguments.length>1)return t&&be(e)?e.call(s&&s.proxy):e}}const zm={},Wm=()=>Object.create(zm),qm=i=>Object.getPrototypeOf(i)===zm;function zT(i,e,t,s=!1){const n={},r=Wm();i.propsDefaults=Object.create(null),Ym(i,e,n,r);for(const o in i.propsOptions[0])o in n||(n[o]=void 0);t?i.props=s?n:_m(n):i.type.props?i.props=n:i.props=r,i.attrs=r}function WT(i,e,t,s){const{props:n,attrs:r,vnode:{patchFlag:o}}=i,a=Me(n),[l]=i.propsOptions;let c=!1;if((s||o>0)&&!(o&16)){if(o&8){const u=i.vnode.dynamicProps;for(let h=0;h<u.length;h++){let f=u[h];if(hl(i.emitsOptions,f))continue;const d=e[f];if(l)if(Ge(r,f))d!==r[f]&&(r[f]=d,c=!0);else{const g=Ps(f);n[g]=Mc(l,a,g,d,i,!1)}else d!==r[f]&&(r[f]=d,c=!0)}}}else{Ym(i,e,n,r)&&(c=!0);let u;for(const h in a)(!e||!Ge(e,h)&&((u=Ji(h))===h||!Ge(e,u)))&&(l?t&&(t[h]!==void 0||t[u]!==void 0)&&(n[h]=Mc(l,a,h,void 0,i,!0)):delete n[h]);if(r!==a)for(const h in r)(!e||!Ge(e,h))&&(delete r[h],c=!0)}c&&xi(i.attrs,"set","")}function Ym(i,e,t,s){const[n,r]=i.propsOptions;let o=!1,a;if(e)for(let l in e){if($r(l))continue;const c=e[l];let u;n&&Ge(n,u=Ps(l))?!r||!r.includes(u)?t[u]=c:(a||(a={}))[u]=c:hl(i.emitsOptions,l)||(!(l in s)||c!==s[l])&&(s[l]=c,o=!0)}if(r){const l=Me(t),c=a||je;for(let u=0;u<r.length;u++){const h=r[u];t[h]=Mc(n,l,h,c[h],i,!Ge(c,h))}}return o}function Mc(i,e,t,s,n,r){const o=i[t];if(o!=null){const a=Ge(o,"default");if(a&&s===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&be(l)){const{propsDefaults:c}=n;if(t in c)s=c[t];else{const u=ko(n);s=c[t]=l.call(null,e),u()}}else s=l;n.ce&&n.ce._setProp(t,s)}o[0]&&(r&&!a?s=!1:o[1]&&(s===""||s===Ji(t))&&(s=!0))}return s}const qT=new WeakMap;function jm(i,e,t=!1){const s=t?qT:e.propsCache,n=s.get(i);if(n)return n;const r=i.props,o={},a=[];let l=!1;if(!be(i)){const u=h=>{l=!0;const[f,d]=jm(h,e,!0);ht(o,f),d&&a.push(...d)};!t&&e.mixins.length&&e.mixins.forEach(u),i.extends&&u(i.extends),i.mixins&&i.mixins.forEach(u)}if(!r&&!l)return Qe(i)&&s.set(i,Xn),Xn;if(_e(r))for(let u=0;u<r.length;u++){const h=Ps(r[u]);mf(h)&&(o[h]=je)}else if(r)for(const u in r){const h=Ps(u);if(mf(h)){const f=r[u],d=o[h]=_e(f)||be(f)?{type:f}:ht({},f),g=d.type;let m=!1,p=!0;if(_e(g))for(let y=0;y<g.length;++y){const _=g[y],T=be(_)&&_.name;if(T==="Boolean"){m=!0;break}else T==="String"&&(p=!1)}else m=be(g)&&g.name==="Boolean";d[0]=m,d[1]=p,(m||Ge(d,"default"))&&a.push(h)}}const c=[o,a];return Qe(i)&&s.set(i,c),c}function mf(i){return i[0]!=="$"&&!$r(i)}const Xm=i=>i[0]==="_"||i==="$stable",Ku=i=>_e(i)?i.map(ei):[ei(i)],YT=(i,e,t)=>{if(e._n)return e;const s=kn((...n)=>Ku(e(...n)),t);return s._c=!1,s},Qm=(i,e,t)=>{const s=i._ctx;for(const n in i){if(Xm(n))continue;const r=i[n];if(be(r))e[n]=YT(n,r,s);else if(r!=null){const o=Ku(r);e[n]=()=>o}}},Jm=(i,e)=>{const t=Ku(e);i.slots.default=()=>t},Zm=(i,e,t)=>{for(const s in e)(t||s!=="_")&&(i[s]=e[s])},jT=(i,e,t)=>{const s=i.slots=Wm();if(i.vnode.shapeFlag&32){const n=e._;n?(Zm(s,e,t),t&&tm(s,"_",n,!0)):Qm(e,s)}else e&&Jm(i,e)},XT=(i,e,t)=>{const{vnode:s,slots:n}=i;let r=!0,o=je;if(s.shapeFlag&32){const a=e._;a?t&&a===1?r=!1:Zm(n,e,t):(r=!e.$stable,Qm(e,n)),o=e}else e&&(Jm(i,e),o={default:1});if(r)for(const a in n)!Xm(a)&&o[a]==null&&delete n[a]},us=u_;function QT(i){return JT(i)}function JT(i,e){const t=nl();t.__VUE__=!0;const{insert:s,remove:n,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:u,parentNode:h,nextSibling:f,setScopeId:d=Us,insertStaticContent:g}=i,m=(I,C,F,$=null,N=null,W=null,se=void 0,Q=null,J=!!C.dynamicChildren)=>{if(I===C)return;I&&!gn(I,C)&&($=U(I),Y(I,N,W,!0),I=null),C.patchFlag===-2&&(J=!1,C.dynamicChildren=null);const{type:j,ref:ye,shapeFlag:ie}=C;switch(j){case fl:p(I,C,F,$);break;case ts:y(I,C,F,$);break;case aa:I==null&&_(C,F,$,se);break;case et:P(I,C,F,$,N,W,se,Q,J);break;default:ie&1?S(I,C,F,$,N,W,se,Q,J):ie&6?B(I,C,F,$,N,W,se,Q,J):(ie&64||ie&128)&&j.process(I,C,F,$,N,W,se,Q,J,le)}ye!=null&&N&&Ia(ye,I&&I.ref,W,C||I,!C)},p=(I,C,F,$)=>{if(I==null)s(C.el=a(C.children),F,$);else{const N=C.el=I.el;C.children!==I.children&&c(N,C.children)}},y=(I,C,F,$)=>{I==null?s(C.el=l(C.children||""),F,$):C.el=I.el},_=(I,C,F,$)=>{[I.el,I.anchor]=g(I.children,C,F,$,I.el,I.anchor)},T=({el:I,anchor:C},F,$)=>{let N;for(;I&&I!==C;)N=f(I),s(I,F,$),I=N;s(C,F,$)},E=({el:I,anchor:C})=>{let F;for(;I&&I!==C;)F=f(I),n(I),I=F;n(C)},S=(I,C,F,$,N,W,se,Q,J)=>{C.type==="svg"?se="svg":C.type==="math"&&(se="mathml"),I==null?R(C,F,$,N,W,se,Q,J):A(I,C,N,W,se,Q,J)},R=(I,C,F,$,N,W,se,Q)=>{let J,j;const{props:ye,shapeFlag:ie,transition:he,dirs:pe}=I;if(J=I.el=o(I.type,W,ye&&ye.is,ye),ie&8?u(J,I.children):ie&16&&L(I.children,J,null,$,N,Pl(I,W),se,Q),pe&&sn(I,null,$,"created"),x(J,I,I.scopeId,se,$),ye){for(const Ne in ye)Ne!=="value"&&!$r(Ne)&&r(J,Ne,null,ye[Ne],W,$);"value"in ye&&r(J,"value",null,ye.value,W),(j=ye.onVnodeBeforeMount)&&Ws(j,$,I)}pe&&sn(I,null,$,"beforeMount");const Ie=ZT(N,he);Ie&&he.beforeEnter(J),s(J,C,F),((j=ye&&ye.onVnodeMounted)||Ie||pe)&&us(()=>{j&&Ws(j,$,I),Ie&&he.enter(J),pe&&sn(I,null,$,"mounted")},N)},x=(I,C,F,$,N)=>{if(F&&d(I,F),$)for(let W=0;W<$.length;W++)d(I,$[W]);if(N){let W=N.subTree;if(C===W||rp(W.type)&&(W.ssContent===C||W.ssFallback===C)){const se=N.vnode;x(I,se,se.scopeId,se.slotScopeIds,N.parent)}}},L=(I,C,F,$,N,W,se,Q,J=0)=>{for(let j=J;j<I.length;j++){const ye=I[j]=Q?Ni(I[j]):ei(I[j]);m(null,ye,C,F,$,N,W,se,Q)}},A=(I,C,F,$,N,W,se)=>{const Q=C.el=I.el;let{patchFlag:J,dynamicChildren:j,dirs:ye}=C;J|=I.patchFlag&16;const ie=I.props||je,he=C.props||je;let pe;if(F&&nn(F,!1),(pe=he.onVnodeBeforeUpdate)&&Ws(pe,F,C,I),ye&&sn(C,I,F,"beforeUpdate"),F&&nn(F,!0),(ie.innerHTML&&he.innerHTML==null||ie.textContent&&he.textContent==null)&&u(Q,""),j?k(I.dynamicChildren,j,Q,F,$,Pl(C,N),W):se||K(I,C,Q,null,F,$,Pl(C,N),W,!1),J>0){if(J&16)w(Q,ie,he,F,N);else if(J&2&&ie.class!==he.class&&r(Q,"class",null,he.class,N),J&4&&r(Q,"style",ie.style,he.style,N),J&8){const Ie=C.dynamicProps;for(let Ne=0;Ne<Ie.length;Ne++){const we=Ie[Ne],dt=ie[we],Ze=he[we];(Ze!==dt||we==="value")&&r(Q,we,dt,Ze,N,F)}}J&1&&I.children!==C.children&&u(Q,C.children)}else!se&&j==null&&w(Q,ie,he,F,N);((pe=he.onVnodeUpdated)||ye)&&us(()=>{pe&&Ws(pe,F,C,I),ye&&sn(C,I,F,"updated")},$)},k=(I,C,F,$,N,W,se)=>{for(let Q=0;Q<C.length;Q++){const J=I[Q],j=C[Q],ye=J.el&&(J.type===et||!gn(J,j)||J.shapeFlag&70)?h(J.el):F;m(J,j,ye,null,$,N,W,se,!0)}},w=(I,C,F,$,N)=>{if(C!==F){if(C!==je)for(const W in C)!$r(W)&&!(W in F)&&r(I,W,C[W],null,N,$);for(const W in F){if($r(W))continue;const se=F[W],Q=C[W];se!==Q&&W!=="value"&&r(I,W,Q,se,N,$)}"value"in F&&r(I,"value",C.value,F.value,N)}},P=(I,C,F,$,N,W,se,Q,J)=>{const j=C.el=I?I.el:a(""),ye=C.anchor=I?I.anchor:a("");let{patchFlag:ie,dynamicChildren:he,slotScopeIds:pe}=C;pe&&(Q=Q?Q.concat(pe):pe),I==null?(s(j,F,$),s(ye,F,$),L(C.children||[],F,ye,N,W,se,Q,J)):ie>0&&ie&64&&he&&I.dynamicChildren?(k(I.dynamicChildren,he,F,N,W,se,Q),(C.key!=null||N&&C===N.subTree)&&ep(I,C,!0)):K(I,C,F,ye,N,W,se,Q,J)},B=(I,C,F,$,N,W,se,Q,J)=>{C.slotScopeIds=Q,I==null?C.shapeFlag&512?N.ctx.activate(C,F,$,se,J):X(C,F,$,N,W,se,J):q(I,C,J)},X=(I,C,F,$,N,W,se)=>{const Q=I.component=v_(I,$,N);if(cl(I)&&(Q.ctx.renderer=le),T_(Q,!1,se),Q.asyncDep){if(N&&N.registerDep(Q,G,se),!I.el){const J=Q.subTree=Oe(ts);y(null,J,C,F)}}else G(Q,I,C,F,N,W,se)},q=(I,C,F)=>{const $=C.component=I.component;if(l_(I,C,F))if($.asyncDep&&!$.asyncResolved){H($,C,F);return}else $.next=C,$.update();else C.el=I.el,$.vnode=C},G=(I,C,F,$,N,W,se)=>{const Q=()=>{if(I.isMounted){let{next:ie,bu:he,u:pe,parent:Ie,vnode:Ne}=I;{const _t=tp(I);if(_t){ie&&(ie.el=Ne.el,H(I,ie,se)),_t.asyncDep.then(()=>{I.isUnmounted||Q()});return}}let we=ie,dt;nn(I,!1),ie?(ie.el=Ne.el,H(I,ie,se)):ie=Ne,he&&na(he),(dt=ie.props&&ie.props.onVnodeBeforeUpdate)&&Ws(dt,Ie,ie,Ne),nn(I,!0);const Ze=Ol(I),Ct=I.subTree;I.subTree=Ze,m(Ct,Ze,h(Ct.el),U(Ct),I,N,W),ie.el=Ze.el,we===null&&c_(I,Ze.el),pe&&us(pe,N),(dt=ie.props&&ie.props.onVnodeUpdated)&&us(()=>Ws(dt,Ie,ie,Ne),N)}else{let ie;const{el:he,props:pe}=C,{bm:Ie,m:Ne,parent:we,root:dt,type:Ze}=I,Ct=Gr(C);if(nn(I,!1),Ie&&na(Ie),!Ct&&(ie=pe&&pe.onVnodeBeforeMount)&&Ws(ie,we,C),nn(I,!0),he&&Pe){const _t=()=>{I.subTree=Ol(I),Pe(he,I.subTree,I,N,null)};Ct&&Ze.__asyncHydrate?Ze.__asyncHydrate(he,I,_t):_t()}else{dt.ce&&dt.ce._injectChildStyle(Ze);const _t=I.subTree=Ol(I);m(null,_t,F,$,I,N,W),C.el=_t.el}if(Ne&&us(Ne,N),!Ct&&(ie=pe&&pe.onVnodeMounted)){const _t=C;us(()=>Ws(ie,we,_t),N)}(C.shapeFlag&256||we&&Gr(we.vnode)&&we.vnode.shapeFlag&256)&&I.a&&us(I.a,N),I.isMounted=!0,C=F=$=null}};I.scope.on();const J=I.effect=new om(Q);I.scope.off();const j=I.update=J.run.bind(J),ye=I.job=J.runIfDirty.bind(J);ye.i=I,ye.id=I.uid,J.scheduler=()=>Uu(ye),nn(I,!0),j()},H=(I,C,F)=>{C.component=I;const $=I.vnode.props;I.vnode=C,I.next=null,WT(I,C.props,$,F),XT(I,C.children,F),Zi(),lf(I),en()},K=(I,C,F,$,N,W,se,Q,J=!1)=>{const j=I&&I.children,ye=I?I.shapeFlag:0,ie=C.children,{patchFlag:he,shapeFlag:pe}=C;if(he>0){if(he&128){fe(j,ie,F,$,N,W,se,Q,J);return}else if(he&256){ae(j,ie,F,$,N,W,se,Q,J);return}}pe&8?(ye&16&&Te(j,N,W),ie!==j&&u(F,ie)):ye&16?pe&16?fe(j,ie,F,$,N,W,se,Q,J):Te(j,N,W,!0):(ye&8&&u(F,""),pe&16&&L(ie,F,$,N,W,se,Q,J))},ae=(I,C,F,$,N,W,se,Q,J)=>{I=I||Xn,C=C||Xn;const j=I.length,ye=C.length,ie=Math.min(j,ye);let he;for(he=0;he<ie;he++){const pe=C[he]=J?Ni(C[he]):ei(C[he]);m(I[he],pe,F,null,N,W,se,Q,J)}j>ye?Te(I,N,W,!0,!1,ie):L(C,F,$,N,W,se,Q,J,ie)},fe=(I,C,F,$,N,W,se,Q,J)=>{let j=0;const ye=C.length;let ie=I.length-1,he=ye-1;for(;j<=ie&&j<=he;){const pe=I[j],Ie=C[j]=J?Ni(C[j]):ei(C[j]);if(gn(pe,Ie))m(pe,Ie,F,null,N,W,se,Q,J);else break;j++}for(;j<=ie&&j<=he;){const pe=I[ie],Ie=C[he]=J?Ni(C[he]):ei(C[he]);if(gn(pe,Ie))m(pe,Ie,F,null,N,W,se,Q,J);else break;ie--,he--}if(j>ie){if(j<=he){const pe=he+1,Ie=pe<ye?C[pe].el:$;for(;j<=he;)m(null,C[j]=J?Ni(C[j]):ei(C[j]),F,Ie,N,W,se,Q,J),j++}}else if(j>he)for(;j<=ie;)Y(I[j],N,W,!0),j++;else{const pe=j,Ie=j,Ne=new Map;for(j=Ie;j<=he;j++){const At=C[j]=J?Ni(C[j]):ei(C[j]);At.key!=null&&Ne.set(At.key,j)}let we,dt=0;const Ze=he-Ie+1;let Ct=!1,_t=0;const Ut=new Array(Ze);for(j=0;j<Ze;j++)Ut[j]=0;for(j=pe;j<=ie;j++){const At=I[j];if(dt>=Ze){Y(At,N,W,!0);continue}let Qt;if(At.key!=null)Qt=Ne.get(At.key);else for(we=Ie;we<=he;we++)if(Ut[we-Ie]===0&&gn(At,C[we])){Qt=we;break}Qt===void 0?Y(At,N,W,!0):(Ut[Qt-Ie]=j+1,Qt>=_t?_t=Qt:Ct=!0,m(At,C[Qt],F,null,N,W,se,Q,J),dt++)}const hi=Ct?e_(Ut):Xn;for(we=hi.length-1,j=Ze-1;j>=0;j--){const At=Ie+j,Qt=C[At],Do=At+1<ye?C[At+1].el:$;Ut[j]===0?m(null,Qt,F,Do,N,W,se,Q,J):Ct&&(we<0||j!==hi[we]?z(Qt,F,Do,2):we--)}}},z=(I,C,F,$,N=null)=>{const{el:W,type:se,transition:Q,children:J,shapeFlag:j}=I;if(j&6){z(I.component.subTree,C,F,$);return}if(j&128){I.suspense.move(C,F,$);return}if(j&64){se.move(I,C,F,le);return}if(se===et){s(W,C,F);for(let ie=0;ie<J.length;ie++)z(J[ie],C,F,$);s(I.anchor,C,F);return}if(se===aa){T(I,C,F);return}if($!==2&&j&1&&Q)if($===0)Q.beforeEnter(W),s(W,C,F),us(()=>Q.enter(W),N);else{const{leave:ie,delayLeave:he,afterLeave:pe}=Q,Ie=()=>s(W,C,F),Ne=()=>{ie(W,()=>{Ie(),pe&&pe()})};he?he(W,Ie,Ne):Ne()}else s(W,C,F)},Y=(I,C,F,$=!1,N=!1)=>{const{type:W,props:se,ref:Q,children:J,dynamicChildren:j,shapeFlag:ye,patchFlag:ie,dirs:he,cacheIndex:pe}=I;if(ie===-2&&(N=!1),Q!=null&&Ia(Q,null,F,I,!0),pe!=null&&(C.renderCache[pe]=void 0),ye&256){C.ctx.deactivate(I);return}const Ie=ye&1&&he,Ne=!Gr(I);let we;if(Ne&&(we=se&&se.onVnodeBeforeUnmount)&&Ws(we,C,I),ye&6)re(I.component,F,$);else{if(ye&128){I.suspense.unmount(F,$);return}Ie&&sn(I,null,C,"beforeUnmount"),ye&64?I.type.remove(I,C,F,le,$):j&&!j.hasOnce&&(W!==et||ie>0&&ie&64)?Te(j,C,F,!1,!0):(W===et&&ie&384||!N&&ye&16)&&Te(J,C,F),$&&ue(I)}(Ne&&(we=se&&se.onVnodeUnmounted)||Ie)&&us(()=>{we&&Ws(we,C,I),Ie&&sn(I,null,C,"unmounted")},F)},ue=I=>{const{type:C,el:F,anchor:$,transition:N}=I;if(C===et){Ee(F,$);return}if(C===aa){E(I);return}const W=()=>{n(F),N&&!N.persisted&&N.afterLeave&&N.afterLeave()};if(I.shapeFlag&1&&N&&!N.persisted){const{leave:se,delayLeave:Q}=N,J=()=>se(F,W);Q?Q(I.el,W,J):J()}else W()},Ee=(I,C)=>{let F;for(;I!==C;)F=f(I),n(I),I=F;n(C)},re=(I,C,F)=>{const{bum:$,scope:N,job:W,subTree:se,um:Q,m:J,a:j}=I;pf(J),pf(j),$&&na($),N.stop(),W&&(W.flags|=8,Y(se,I,C,F)),Q&&us(Q,C),us(()=>{I.isUnmounted=!0},C),C&&C.pendingBranch&&!C.isUnmounted&&I.asyncDep&&!I.asyncResolved&&I.suspenseId===C.pendingId&&(C.deps--,C.deps===0&&C.resolve())},Te=(I,C,F,$=!1,N=!1,W=0)=>{for(let se=W;se<I.length;se++)Y(I[se],C,F,$,N)},U=I=>{if(I.shapeFlag&6)return U(I.component.subTree);if(I.shapeFlag&128)return I.suspense.next();const C=f(I.anchor||I.el),F=C&&C[xT];return F?f(F):C};let te=!1;const Z=(I,C,F)=>{I==null?C._vnode&&Y(C._vnode,null,null,!0):m(C._vnode||null,I,C,null,null,null,F),C._vnode=I,te||(te=!0,lf(),Im(),te=!1)},le={p:m,um:Y,m:z,r:ue,mt:X,mc:L,pc:K,pbc:k,n:U,o:i};let Ae,Pe;return e&&([Ae,Pe]=e(le)),{render:Z,hydrate:Ae,createApp:KT(Z,Ae)}}function Pl({type:i,props:e},t){return t==="svg"&&i==="foreignObject"||t==="mathml"&&i==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function nn({effect:i,job:e},t){t?(i.flags|=32,e.flags|=4):(i.flags&=-33,e.flags&=-5)}function ZT(i,e){return(!i||i&&!i.pendingBranch)&&e&&!e.persisted}function ep(i,e,t=!1){const s=i.children,n=e.children;if(_e(s)&&_e(n))for(let r=0;r<s.length;r++){const o=s[r];let a=n[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=n[r]=Ni(n[r]),a.el=o.el),!t&&a.patchFlag!==-2&&ep(o,a)),a.type===fl&&(a.el=o.el)}}function e_(i){const e=i.slice(),t=[0];let s,n,r,o,a;const l=i.length;for(s=0;s<l;s++){const c=i[s];if(c!==0){if(n=t[t.length-1],i[n]<c){e[s]=n,t.push(s);continue}for(r=0,o=t.length-1;r<o;)a=r+o>>1,i[t[a]]<c?r=a+1:o=a;c<i[t[r]]&&(r>0&&(e[s]=t[r-1]),t[r]=s)}}for(r=t.length,o=t[r-1];r-- >0;)t[r]=o,o=e[o];return t}function tp(i){const e=i.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:tp(e)}function pf(i){if(i)for(let e=0;e<i.length;e++)i[e].flags|=8}const t_=Symbol.for("v-scx"),s_=()=>Ai(t_);function Vr(i,e,t){return sp(i,e,t)}function sp(i,e,t=je){const{immediate:s,deep:n,flush:r,once:o}=t,a=ht({},t),l=e&&s||!e&&r!=="post";let c;if(lo){if(r==="sync"){const d=s_();c=d.__watcherHandles||(d.__watcherHandles=[])}else if(!l){const d=()=>{};return d.stop=Us,d.resume=Us,d.pause=Us,d}}const u=Rt;a.call=(d,g,m)=>Gs(d,u,g,m);let h=!1;r==="post"?a.scheduler=d=>{us(d,u&&u.suspense)}:r!=="sync"&&(h=!0,a.scheduler=(d,g)=>{g?d():Uu(d)}),a.augmentJob=d=>{e&&(d.flags|=4),h&&(d.flags|=2,u&&(d.id=u.uid,d.i=u))};const f=TT(i,e,a);return lo&&(c?c.push(f):l&&f()),f}function i_(i,e,t){const s=this.proxy,n=ft(i)?i.includes(".")?ip(s,i):()=>s[i]:i.bind(s,s);let r;be(e)?r=e:(r=e.handler,t=e);const o=ko(this),a=sp(n,r.bind(s),t);return o(),a}function ip(i,e){const t=e.split(".");return()=>{let s=i;for(let n=0;n<t.length&&s;n++)s=s[t[n]];return s}}const n_=(i,e)=>e==="modelValue"||e==="model-value"?i.modelModifiers:i[`${e}Modifiers`]||i[`${Ps(e)}Modifiers`]||i[`${Ji(e)}Modifiers`];function r_(i,e,...t){if(i.isUnmounted)return;const s=i.vnode.props||je;let n=t;const r=e.startsWith("update:"),o=r&&n_(s,e.slice(7));o&&(o.trim&&(n=t.map(u=>ft(u)?u.trim():u)),o.number&&(n=t.map(Lc)));let a,l=s[a=Ll(e)]||s[a=Ll(Ps(e))];!l&&r&&(l=s[a=Ll(Ji(e))]),l&&Gs(l,i,6,n);const c=s[a+"Once"];if(c){if(!i.emitted)i.emitted={};else if(i.emitted[a])return;i.emitted[a]=!0,Gs(c,i,6,n)}}function np(i,e,t=!1){const s=e.emitsCache,n=s.get(i);if(n!==void 0)return n;const r=i.emits;let o={},a=!1;if(!be(i)){const l=c=>{const u=np(c,e,!0);u&&(a=!0,ht(o,u))};!t&&e.mixins.length&&e.mixins.forEach(l),i.extends&&l(i.extends),i.mixins&&i.mixins.forEach(l)}return!r&&!a?(Qe(i)&&s.set(i,null),null):(_e(r)?r.forEach(l=>o[l]=null):ht(o,r),Qe(i)&&s.set(i,o),o)}function hl(i,e){return!i||!el(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ge(i,e[0].toLowerCase()+e.slice(1))||Ge(i,Ji(e))||Ge(i,e))}function Ol(i){const{type:e,vnode:t,proxy:s,withProxy:n,propsOptions:[r],slots:o,attrs:a,emit:l,render:c,renderCache:u,props:h,data:f,setupState:d,ctx:g,inheritAttrs:m}=i,p=La(i);let y,_;try{if(t.shapeFlag&4){const E=n||s,S=E;y=ei(c.call(S,E,u,h,d,f,g)),_=a}else{const E=e;y=ei(E.length>1?E(h,{attrs:a,slots:o,emit:l}):E(h,null)),_=e.props?a:o_(a)}}catch(E){Kr.length=0,ll(E,i,1),y=Oe(ts)}let T=y;if(_&&m!==!1){const E=Object.keys(_),{shapeFlag:S}=T;E.length&&S&7&&(r&&E.some(ku)&&(_=a_(_,r)),T=qi(T,_,!1,!0))}return t.dirs&&(T=qi(T,null,!1,!0),T.dirs=T.dirs?T.dirs.concat(t.dirs):t.dirs),t.transition&&Cn(T,t.transition),y=T,La(p),y}const o_=i=>{let e;for(const t in i)(t==="class"||t==="style"||el(t))&&((e||(e={}))[t]=i[t]);return e},a_=(i,e)=>{const t={};for(const s in i)(!ku(s)||!(s.slice(9)in e))&&(t[s]=i[s]);return t};function l_(i,e,t){const{props:s,children:n,component:r}=i,{props:o,children:a,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return s?yf(s,o,c):!!o;if(l&8){const u=e.dynamicProps;for(let h=0;h<u.length;h++){const f=u[h];if(o[f]!==s[f]&&!hl(c,f))return!0}}}else return(n||a)&&(!a||!a.$stable)?!0:s===o?!1:s?o?yf(s,o,c):!0:!!o;return!1}function yf(i,e,t){const s=Object.keys(e);if(s.length!==Object.keys(i).length)return!0;for(let n=0;n<s.length;n++){const r=s[n];if(e[r]!==i[r]&&!hl(t,r))return!0}return!1}function c_({vnode:i,parent:e},t){for(;e;){const s=e.subTree;if(s.suspense&&s.suspense.activeBranch===i&&(s.el=i.el),s===i)(i=e.vnode).el=t,e=e.parent;else break}}const rp=i=>i.__isSuspense;function u_(i,e){e&&e.pendingBranch?_e(i)?e.effects.push(...i):e.effects.push(i):ST(i)}const et=Symbol.for("v-fgt"),fl=Symbol.for("v-txt"),ts=Symbol.for("v-cmt"),aa=Symbol.for("v-stc"),Kr=[];let ms=null;function ne(i=!1){Kr.push(ms=i?null:[])}function h_(){Kr.pop(),ms=Kr[Kr.length-1]||null}let ao=1;function vf(i,e=!1){ao+=i,i<0&&ms&&e&&(ms.hasOnce=!0)}function op(i){return i.dynamicChildren=ao>0?ms||Xn:null,h_(),ao>0&&ms&&ms.push(i),i}function ce(i,e,t,s,n,r){return op(b(i,e,t,s,n,r,!0))}function Ro(i,e,t,s,n){return op(Oe(i,e,t,s,n,!0))}function ka(i){return i?i.__v_isVNode===!0:!1}function gn(i,e){return i.type===e.type&&i.key===e.key}const ap=({key:i})=>i??null,la=({ref:i,ref_key:e,ref_for:t})=>(typeof i=="number"&&(i=""+i),i!=null?ft(i)||Nt(i)||be(i)?{i:is,r:i,k:e,f:!!t}:i:null);function b(i,e=null,t=null,s=0,n=null,r=i===et?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:i,props:e,key:e&&ap(e),ref:e&&la(e),scopeId:km,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:s,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:is};return a?(zu(l,t),r&128&&i.normalize(l)):t&&(l.shapeFlag|=ft(t)?8:16),ao>0&&!o&&ms&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&ms.push(l),l}const Oe=f_;function f_(i,e=null,t=null,s=0,n=null,r=!1){if((!i||i===MT)&&(i=ts),ka(i)){const a=qi(i,e,!0);return t&&zu(a,t),ao>0&&!r&&ms&&(a.shapeFlag&6?ms[ms.indexOf(i)]=a:ms.push(a)),a.patchFlag=-2,a}if(b_(i)&&(i=i.__vccOpts),e){e=d_(e);let{class:a,style:l}=e;a&&!ft(a)&&(e.class=$e(a)),Qe(l)&&($u(l)&&!_e(l)&&(l=ht({},l)),e.style=Yt(l))}const o=ft(i)?1:rp(i)?128:wm(i)?64:Qe(i)?4:be(i)?2:0;return b(i,e,t,s,n,o,r,!0)}function d_(i){return i?$u(i)||qm(i)?ht({},i):i:null}function qi(i,e,t=!1,s=!1){const{props:n,ref:r,patchFlag:o,children:a,transition:l}=i,c=e?m_(n||{},e):n,u={__v_isVNode:!0,__v_skip:!0,type:i.type,props:c,key:c&&ap(c),ref:e&&e.ref?t&&r?_e(r)?r.concat(la(e)):[r,la(e)]:la(e):r,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:a,target:i.target,targetStart:i.targetStart,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:e&&i.type!==et?o===-1?16:o|16:o,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:l,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&qi(i.ssContent),ssFallback:i.ssFallback&&qi(i.ssFallback),el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce};return l&&s&&Cn(u,l.clone(u)),u}function ss(i=" ",e=0){return Oe(fl,null,i,e)}function g_(i,e){const t=Oe(aa,null,i);return t.staticCount=e,t}function yt(i="",e=!1){return e?(ne(),Ro(ts,null,i)):Oe(ts,null,i)}function ei(i){return i==null||typeof i=="boolean"?Oe(ts):_e(i)?Oe(et,null,i.slice()):ka(i)?Ni(i):Oe(fl,null,String(i))}function Ni(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:qi(i)}function zu(i,e){let t=0;const{shapeFlag:s}=i;if(e==null)e=null;else if(_e(e))t=16;else if(typeof e=="object")if(s&65){const n=e.default;n&&(n._c&&(n._d=!1),zu(i,n()),n._c&&(n._d=!0));return}else{t=32;const n=e._;!n&&!qm(e)?e._ctx=is:n===3&&is&&(is.slots._===1?e._=1:(e._=2,i.patchFlag|=1024))}else be(e)?(e={default:e,_ctx:is},t=32):(e=String(e),s&64?(t=16,e=[ss(e)]):t=8);i.children=e,i.shapeFlag|=t}function m_(...i){const e={};for(let t=0;t<i.length;t++){const s=i[t];for(const n in s)if(n==="class")e.class!==s.class&&(e.class=$e([e.class,s.class]));else if(n==="style")e.style=Yt([e.style,s.style]);else if(el(n)){const r=e[n],o=s[n];o&&r!==o&&!(_e(r)&&r.includes(o))&&(e[n]=r?[].concat(r,o):o)}else n!==""&&(e[n]=s[n])}return e}function Ws(i,e,t,s=null){Gs(i,e,7,[t,s])}const p_=Km();let y_=0;function v_(i,e,t){const s=i.type,n=(e?e.appContext:i.appContext)||p_,r={uid:y_++,vnode:i,type:s,parent:e,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Wv(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(n.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:jm(s,n),emitsOptions:np(s,n),emit:null,emitted:null,propsDefaults:je,inheritAttrs:s.inheritAttrs,ctx:je,data:je,props:je,attrs:je,slots:je,refs:je,setupState:je,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=r_.bind(null,r),i.ce&&i.ce(r),r}let Rt=null;const lp=()=>Rt||is;let Ca,Fc;{const i=nl(),e=(t,s)=>{let n;return(n=i[t])||(n=i[t]=[]),n.push(s),r=>{n.length>1?n.forEach(o=>o(r)):n[0](r)}};Ca=e("__VUE_INSTANCE_SETTERS__",t=>Rt=t),Fc=e("__VUE_SSR_SETTERS__",t=>lo=t)}const ko=i=>{const e=Rt;return Ca(i),i.scope.on(),()=>{i.scope.off(),Ca(e)}},Tf=()=>{Rt&&Rt.scope.off(),Ca(null)};function cp(i){return i.vnode.shapeFlag&4}let lo=!1;function T_(i,e=!1,t=!1){e&&Fc(e);const{props:s,children:n}=i.vnode,r=cp(i);zT(i,s,r,e),jT(i,n,t);const o=r?__(i,e):void 0;return e&&Fc(!1),o}function __(i,e){const t=i.type;i.accessCache=Object.create(null),i.proxy=new Proxy(i.ctx,NT);const{setup:s}=t;if(s){Zi();const n=i.setupContext=s.length>1?S_(i):null,r=ko(i),o=Io(s,i,0,[i.props,n]),a=Jg(o);if(en(),r(),(a||i.sp)&&!Gr(i)&&$m(i),a){if(o.then(Tf,Tf),e)return o.then(l=>{_f(i,l,e)}).catch(l=>{ll(l,i,0)});i.asyncDep=o}else _f(i,o,e)}else up(i,e)}function _f(i,e,t){be(e)?i.type.__ssrInlineRender?i.ssrRender=e:i.render=e:Qe(e)&&(i.setupState=xm(e)),up(i,t)}let Ef;function up(i,e,t){const s=i.type;if(!i.render){if(!e&&Ef&&!s.render){const n=s.template||Vu(i).template;if(n){const{isCustomElement:r,compilerOptions:o}=i.appContext.config,{delimiters:a,compilerOptions:l}=s,c=ht(ht({isCustomElement:r,delimiters:a},o),l);s.render=Ef(n,c)}}i.render=s.render||Us}{const n=ko(i);Zi();try{$T(i)}finally{en(),n()}}}const E_={get(i,e){return Ot(i,"get",""),i[e]}};function S_(i){const e=t=>{i.exposed=t||{}};return{attrs:new Proxy(i.attrs,E_),slots:i.slots,emit:i.emit,expose:e}}function dl(i){return i.exposed?i.exposeProxy||(i.exposeProxy=new Proxy(xm(fT(i.exposed)),{get(e,t){if(t in e)return e[t];if(t in Hr)return Hr[t](i)},has(e,t){return t in e||t in Hr}})):i.proxy}function x_(i,e=!0){return be(i)?i.displayName||i.name:i.name||e&&i.__name}function b_(i){return be(i)&&"__vccOpts"in i}const zt=(i,e)=>yT(i,e,lo);function Wu(i,e,t){const s=arguments.length;return s===2?Qe(e)&&!_e(e)?ka(e)?Oe(i,null,[e]):Oe(i,e):Oe(i,null,e):(s>3?t=Array.prototype.slice.call(arguments,2):s===3&&ka(t)&&(t=[t]),Oe(i,e,t))}const A_="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Nc;const Sf=typeof window<"u"&&window.trustedTypes;if(Sf)try{Nc=Sf.createPolicy("vue",{createHTML:i=>i})}catch{}const hp=Nc?i=>Nc.createHTML(i):i=>i,L_="http://www.w3.org/2000/svg",I_="http://www.w3.org/1998/Math/MathML",yi=typeof document<"u"?document:null,xf=yi&&yi.createElement("template"),R_={insert:(i,e,t)=>{e.insertBefore(i,t||null)},remove:i=>{const e=i.parentNode;e&&e.removeChild(i)},createElement:(i,e,t,s)=>{const n=e==="svg"?yi.createElementNS(L_,i):e==="mathml"?yi.createElementNS(I_,i):t?yi.createElement(i,{is:t}):yi.createElement(i);return i==="select"&&s&&s.multiple!=null&&n.setAttribute("multiple",s.multiple),n},createText:i=>yi.createTextNode(i),createComment:i=>yi.createComment(i),setText:(i,e)=>{i.nodeValue=e},setElementText:(i,e)=>{i.textContent=e},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>yi.querySelector(i),setScopeId(i,e){i.setAttribute(e,"")},insertStaticContent(i,e,t,s,n,r){const o=t?t.previousSibling:e.lastChild;if(n&&(n===r||n.nextSibling))for(;e.insertBefore(n.cloneNode(!0),t),!(n===r||!(n=n.nextSibling)););else{xf.innerHTML=hp(s==="svg"?`<svg>${i}</svg>`:s==="mathml"?`<math>${i}</math>`:i);const a=xf.content;if(s==="svg"||s==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},ki="transition",Sr="animation",lr=Symbol("_vtc"),fp={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},dp=ht({},Pm,fp),k_=i=>(i.displayName="Transition",i.props=dp,i),wa=k_((i,{slots:e})=>Wu(AT,gp(i),e)),rn=(i,e=[])=>{_e(i)?i.forEach(t=>t(...e)):i&&i(...e)},bf=i=>i?_e(i)?i.some(e=>e.length>1):i.length>1:!1;function gp(i){const e={};for(const P in i)P in fp||(e[P]=i[P]);if(i.css===!1)return e;const{name:t="v",type:s,duration:n,enterFromClass:r=`${t}-enter-from`,enterActiveClass:o=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=r,appearActiveClass:c=o,appearToClass:u=a,leaveFromClass:h=`${t}-leave-from`,leaveActiveClass:f=`${t}-leave-active`,leaveToClass:d=`${t}-leave-to`}=i,g=C_(n),m=g&&g[0],p=g&&g[1],{onBeforeEnter:y,onEnter:_,onEnterCancelled:T,onLeave:E,onLeaveCancelled:S,onBeforeAppear:R=y,onAppear:x=_,onAppearCancelled:L=T}=e,A=(P,B,X,q)=>{P._enterCancelled=q,Oi(P,B?u:a),Oi(P,B?c:o),X&&X()},k=(P,B)=>{P._isLeaving=!1,Oi(P,h),Oi(P,d),Oi(P,f),B&&B()},w=P=>(B,X)=>{const q=P?x:_,G=()=>A(B,P,X);rn(q,[B,G]),Af(()=>{Oi(B,P?l:r),js(B,P?u:a),bf(q)||Lf(B,s,m,G)})};return ht(e,{onBeforeEnter(P){rn(y,[P]),js(P,r),js(P,o)},onBeforeAppear(P){rn(R,[P]),js(P,l),js(P,c)},onEnter:w(!1),onAppear:w(!0),onLeave(P,B){P._isLeaving=!0;const X=()=>k(P,B);js(P,h),P._enterCancelled?(js(P,f),$c()):($c(),js(P,f)),Af(()=>{P._isLeaving&&(Oi(P,h),js(P,d),bf(E)||Lf(P,s,p,X))}),rn(E,[P,X])},onEnterCancelled(P){A(P,!1,void 0,!0),rn(T,[P])},onAppearCancelled(P){A(P,!0,void 0,!0),rn(L,[P])},onLeaveCancelled(P){k(P),rn(S,[P])}})}function C_(i){if(i==null)return null;if(Qe(i))return[Ml(i.enter),Ml(i.leave)];{const e=Ml(i);return[e,e]}}function Ml(i){return $v(i)}function js(i,e){e.split(/\s+/).forEach(t=>t&&i.classList.add(t)),(i[lr]||(i[lr]=new Set)).add(e)}function Oi(i,e){e.split(/\s+/).forEach(s=>s&&i.classList.remove(s));const t=i[lr];t&&(t.delete(e),t.size||(i[lr]=void 0))}function Af(i){requestAnimationFrame(()=>{requestAnimationFrame(i)})}let w_=0;function Lf(i,e,t,s){const n=i._endId=++w_,r=()=>{n===i._endId&&s()};if(t!=null)return setTimeout(r,t);const{type:o,timeout:a,propCount:l}=mp(i,e);if(!o)return s();const c=o+"end";let u=0;const h=()=>{i.removeEventListener(c,f),r()},f=d=>{d.target===i&&++u>=l&&h()};setTimeout(()=>{u<l&&h()},a+1),i.addEventListener(c,f)}function mp(i,e){const t=window.getComputedStyle(i),s=g=>(t[g]||"").split(", "),n=s(`${ki}Delay`),r=s(`${ki}Duration`),o=If(n,r),a=s(`${Sr}Delay`),l=s(`${Sr}Duration`),c=If(a,l);let u=null,h=0,f=0;e===ki?o>0&&(u=ki,h=o,f=r.length):e===Sr?c>0&&(u=Sr,h=c,f=l.length):(h=Math.max(o,c),u=h>0?o>c?ki:Sr:null,f=u?u===ki?r.length:l.length:0);const d=u===ki&&/\b(transform|all)(,|$)/.test(s(`${ki}Property`).toString());return{type:u,timeout:h,propCount:f,hasTransform:d}}function If(i,e){for(;i.length<e.length;)i=i.concat(i);return Math.max(...e.map((t,s)=>Rf(t)+Rf(i[s])))}function Rf(i){return i==="auto"?0:Number(i.slice(0,-1).replace(",","."))*1e3}function $c(){return document.body.offsetHeight}function D_(i,e,t){const s=i[lr];s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?i.removeAttribute("class"):t?i.setAttribute("class",e):i.className=e}const kf=Symbol("_vod"),P_=Symbol("_vsh"),O_=Symbol(""),M_=/(^|;)\s*display\s*:/;function F_(i,e,t){const s=i.style,n=ft(t);let r=!1;if(t&&!n){if(e)if(ft(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&ca(s,a,"")}else for(const o in e)t[o]==null&&ca(s,o,"");for(const o in t)o==="display"&&(r=!0),ca(s,o,t[o])}else if(n){if(e!==t){const o=s[O_];o&&(t+=";"+o),s.cssText=t,r=M_.test(t)}}else e&&i.removeAttribute("style");kf in i&&(i[kf]=r?s.display:"",i[P_]&&(s.display="none"))}const Cf=/\s*!important$/;function ca(i,e,t){if(_e(t))t.forEach(s=>ca(i,e,s));else if(t==null&&(t=""),e.startsWith("--"))i.setProperty(e,t);else{const s=N_(i,e);Cf.test(t)?i.setProperty(Ji(s),t.replace(Cf,""),"important"):i[s]=t}}const wf=["Webkit","Moz","ms"],Fl={};function N_(i,e){const t=Fl[e];if(t)return t;let s=Ps(e);if(s!=="filter"&&s in i)return Fl[e]=s;s=il(s);for(let n=0;n<wf.length;n++){const r=wf[n]+s;if(r in i)return Fl[e]=r}return e}const Df="http://www.w3.org/1999/xlink";function Pf(i,e,t,s,n,r=Kv(e)){s&&e.startsWith("xlink:")?t==null?i.removeAttributeNS(Df,e.slice(6,e.length)):i.setAttributeNS(Df,e,t):t==null||r&&!sm(t)?i.removeAttribute(e):i.setAttribute(e,r?"":ai(t)?String(t):t)}function Of(i,e,t,s,n){if(e==="innerHTML"||e==="textContent"){t!=null&&(i[e]=e==="innerHTML"?hp(t):t);return}const r=i.tagName;if(e==="value"&&r!=="PROGRESS"&&!r.includes("-")){const a=r==="OPTION"?i.getAttribute("value")||"":i.value,l=t==null?i.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in i))&&(i.value=l),t==null&&i.removeAttribute(e),i._value=t;return}let o=!1;if(t===""||t==null){const a=typeof i[e];a==="boolean"?t=sm(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{i[e]=t}catch{}o&&i.removeAttribute(n||e)}function mn(i,e,t,s){i.addEventListener(e,t,s)}function $_(i,e,t,s){i.removeEventListener(e,t,s)}const Mf=Symbol("_vei");function U_(i,e,t,s,n=null){const r=i[Mf]||(i[Mf]={}),o=r[e];if(s&&o)o.value=s;else{const[a,l]=B_(e);if(s){const c=r[e]=V_(s,n);mn(i,a,c,l)}else o&&($_(i,a,o,l),r[e]=void 0)}}const Ff=/(?:Once|Passive|Capture)$/;function B_(i){let e;if(Ff.test(i)){e={};let s;for(;s=i.match(Ff);)i=i.slice(0,i.length-s[0].length),e[s[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):Ji(i.slice(2)),e]}let Nl=0;const G_=Promise.resolve(),H_=()=>Nl||(G_.then(()=>Nl=0),Nl=Date.now());function V_(i,e){const t=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=t.attached)return;Gs(K_(s,t.value),e,5,[s])};return t.value=i,t.attached=H_(),t}function K_(i,e){if(_e(e)){const t=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{t.call(i),i._stopped=!0},e.map(s=>n=>!n._stopped&&s&&s(n))}else return e}const Nf=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,z_=(i,e,t,s,n,r)=>{const o=n==="svg";e==="class"?D_(i,s,o):e==="style"?F_(i,t,s):el(e)?ku(e)||U_(i,e,t,s,r):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):W_(i,e,s,o))?(Of(i,e,s),!i.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Pf(i,e,s,o,r,e!=="value")):i._isVueCE&&(/[A-Z]/.test(e)||!ft(s))?Of(i,Ps(e),s,r,e):(e==="true-value"?i._trueValue=s:e==="false-value"&&(i._falseValue=s),Pf(i,e,s,o))};function W_(i,e,t,s){if(s)return!!(e==="innerHTML"||e==="textContent"||e in i&&Nf(e)&&be(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&i.tagName==="INPUT"||e==="type"&&i.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const n=i.tagName;if(n==="IMG"||n==="VIDEO"||n==="CANVAS"||n==="SOURCE")return!1}return Nf(e)&&ft(t)?!1:e in i}const pp=new WeakMap,yp=new WeakMap,Da=Symbol("_moveCb"),$f=Symbol("_enterCb"),q_=i=>(delete i.props.mode,i),Y_=q_({name:"TransitionGroup",props:ht({},dp,{tag:String,moveClass:String}),setup(i,{slots:e}){const t=lp(),s=Dm();let n,r;return Bm(()=>{if(!n.length)return;const o=i.moveClass||`${i.name||"v"}-move`;if(!Z_(n[0].el,t.vnode.el,o))return;n.forEach(X_),n.forEach(Q_);const a=n.filter(J_);$c(),a.forEach(l=>{const c=l.el,u=c.style;js(c,o),u.transform=u.webkitTransform=u.transitionDuration="";const h=c[Da]=f=>{f&&f.target!==c||(!f||/transform$/.test(f.propertyName))&&(c.removeEventListener("transitionend",h),c[Da]=null,Oi(c,o))};c.addEventListener("transitionend",h)})}),()=>{const o=Me(i),a=gp(o);let l=o.tag||et;if(n=[],r)for(let c=0;c<r.length;c++){const u=r[c];u.el&&u.el instanceof Element&&(n.push(u),Cn(u,oo(u,a,s,t)),pp.set(u,u.el.getBoundingClientRect()))}r=e.default?Bu(e.default()):[];for(let c=0;c<r.length;c++){const u=r[c];u.key!=null&&Cn(u,oo(u,a,s,t))}return Oe(l,null,r)}}}),j_=Y_;function X_(i){const e=i.el;e[Da]&&e[Da](),e[$f]&&e[$f]()}function Q_(i){yp.set(i,i.el.getBoundingClientRect())}function J_(i){const e=pp.get(i),t=yp.get(i),s=e.left-t.left,n=e.top-t.top;if(s||n){const r=i.el.style;return r.transform=r.webkitTransform=`translate(${s}px,${n}px)`,r.transitionDuration="0s",i}}function Z_(i,e,t){const s=i.cloneNode(),n=i[lr];n&&n.forEach(a=>{a.split(/\s+/).forEach(l=>l&&s.classList.remove(l))}),t.split(/\s+/).forEach(a=>a&&s.classList.add(a)),s.style.display="none";const r=e.nodeType===1?e:e.parentNode;r.appendChild(s);const{hasTransform:o}=mp(s);return r.removeChild(s),o}const Pa=i=>{const e=i.props["onUpdate:modelValue"]||!1;return _e(e)?t=>na(e,t):e};function eE(i){i.target.composing=!0}function Uf(i){const e=i.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const tr=Symbol("_assign"),tE={created(i,{modifiers:{lazy:e,trim:t,number:s}},n){i[tr]=Pa(n);const r=s||n.props&&n.props.type==="number";mn(i,e?"change":"input",o=>{if(o.target.composing)return;let a=i.value;t&&(a=a.trim()),r&&(a=Lc(a)),i[tr](a)}),t&&mn(i,"change",()=>{i.value=i.value.trim()}),e||(mn(i,"compositionstart",eE),mn(i,"compositionend",Uf),mn(i,"change",Uf))},mounted(i,{value:e}){i.value=e??""},beforeUpdate(i,{value:e,oldValue:t,modifiers:{lazy:s,trim:n,number:r}},o){if(i[tr]=Pa(o),i.composing)return;const a=(r||i.type==="number")&&!/^0\d/.test(i.value)?Lc(i.value):i.value,l=e??"";a!==l&&(document.activeElement===i&&i.type!=="range"&&(s&&e===t||n&&i.value.trim()===l)||(i.value=l))}},sE={deep:!0,created(i,e,t){i[tr]=Pa(t),mn(i,"change",()=>{const s=i._modelValue,n=iE(i),r=i.checked,o=i[tr];if(_e(s)){const a=im(s,n),l=a!==-1;if(r&&!l)o(s.concat(n));else if(!r&&l){const c=[...s];c.splice(a,1),o(c)}}else if(tl(s)){const a=new Set(s);r?a.add(n):a.delete(n),o(a)}else o(vp(i,r))})},mounted:Bf,beforeUpdate(i,e,t){i[tr]=Pa(t),Bf(i,e,t)}};function Bf(i,{value:e,oldValue:t},s){i._modelValue=e;let n;if(_e(e))n=im(e,s.props.value)>-1;else if(tl(e))n=e.has(s.props.value);else{if(e===t)return;n=rl(e,vp(i,!0))}i.checked!==n&&(i.checked=n)}function iE(i){return"_value"in i?i._value:i.value}function vp(i,e){const t=e?"_trueValue":"_falseValue";return t in i?i[t]:e}const nE=["ctrl","shift","alt","meta"],rE={stop:i=>i.stopPropagation(),prevent:i=>i.preventDefault(),self:i=>i.target!==i.currentTarget,ctrl:i=>!i.ctrlKey,shift:i=>!i.shiftKey,alt:i=>!i.altKey,meta:i=>!i.metaKey,left:i=>"button"in i&&i.button!==0,middle:i=>"button"in i&&i.button!==1,right:i=>"button"in i&&i.button!==2,exact:(i,e)=>nE.some(t=>i[`${t}Key`]&&!e.includes(t))},vn=(i,e)=>{const t=i._withMods||(i._withMods={}),s=e.join(".");return t[s]||(t[s]=(n,...r)=>{for(let o=0;o<e.length;o++){const a=rE[e[o]];if(a&&a(n,e))return}return i(n,...r)})},oE={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},aE=(i,e)=>{const t=i._withKeys||(i._withKeys={}),s=e.join(".");return t[s]||(t[s]=n=>{if(!("key"in n))return;const r=Ji(n.key);if(e.some(o=>o===r||oE[o]===r))return i(n)})},lE=ht({patchProp:z_},R_);let Gf;function cE(){return Gf||(Gf=QT(lE))}const uE=(...i)=>{const e=cE().createApp(...i),{mount:t}=e;return e.mount=s=>{const n=fE(s);if(!n)return;const r=e._component;!be(r)&&!r.render&&!r.template&&(r.template=n.innerHTML),n.nodeType===1&&(n.textContent="");const o=t(n,!1,hE(n));return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),o},e};function hE(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function fE(i){return ft(i)?document.querySelector(i):i}class dE{constructor(){this.events={},this.componentEvents=new Map,this.debug=!1}emit(e,...t){this.debug&&console.log(`[EventBus] : ${e}`,t),this.events[e]&&this.events[e].forEach(s=>{try{s(...t)}catch(n){console.error(`[EventBus] : ${e}`,n)}})}on(e,t){return this.events[e]||(this.events[e]=[]),this.debug&&console.log(`[EventBus] : ${e}`),this.events[e].push(t),()=>this.off(e,t)}off(e,t){this.events[e]&&(t?(this.events[e]=this.events[e].filter(s=>s!==t),this.debug&&console.log(`[EventBus] : ${e}`)):(delete this.events[e],this.debug&&console.log(`[EventBus] : ${e}`)))}register(e,t,s){this.componentEvents.has(e)||(this.componentEvents.set(e,[]),this.debug&&console.log(`[EventBus] : ${e}`));const n=this.on(t,s);return this.componentEvents.get(e).push(n),n}unregisterComponent(e){this.componentEvents.has(e)&&(this.componentEvents.get(e).forEach(s=>s()),this.componentEvents.delete(e),this.debug&&console.log(`[EventBus] : ${e}`))}setDebug(e){this.debug=e}}const Ue=new dE,gE=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"})),zr={topRight:[],topLeft:[],bottomRight:[],bottomLeft:[],top:[],bottom:[]},$l={},Tp={duration:4500,position:"bottomLeft",closable:!0,showIcon:!0,className:"",onClose:null,onClick:null,offset:16,zIndex:9999,maxCount:5,animationDuration:300},Uc={info:{icon:"fa-info-circle",color:"var(--icon-primary, #1e90ff)"},success:{icon:"fa-check-circle",color:"var(--icon-accent, #38d9a9)"},warning:{icon:"fa-exclamation-circle",color:"var(--icon-accent, #f1b944)"},error:{icon:"fa-times-circle",color:"var(--icon-accent, #ff6b6b)"},achievement:{icon:"fa-trophy",color:"var(--icon-accent, gold)"}},mE=i=>{if($l[i])return $l[i];const e=document.createElement("div");switch(e.className=`notification-container notification-${i}`,e.style.position="fixed",e.style.zIndex=Tp.zIndex,e.style.pointerEvents="none",i){case"topRight":e.style.top="20px",e.style.right="20px";break;case"topLeft":e.style.top="20px",e.style.left="20px";break;case"bottomRight":e.style.bottom="20px",e.style.right="20px";break;case"bottomLeft":e.style.bottom="20px",e.style.left="20px";break;case"top":e.style.top="20px",e.style.left="50%",e.style.transform="translateX(-50%)";break;case"bottom":e.style.bottom="20px",e.style.left="50%",e.style.transform="translateX(-50%)";break}return document.body.appendChild(e),$l[i]=e,e},pE=i=>{const e=document.createElement("div");e.className=`notification notification-${i.type} ${i.className||""}`,e.style.pointerEvents="auto",e.style.opacity="0",e.style.transform=i.position.includes("top")?"translateY(-20px)":"translateY(20px)",e.style.transition=`opacity ${i.animationDuration}ms ease, transform ${i.animationDuration}ms ease`,e.style.marginBottom=`${i.offset}px`,e.style.borderRadius="12px",e.style.padding="12px 16px",e.style.display="flex",e.style.alignItems="center",e.style.width="300px",e.style.maxWidth="100%",e.style.boxSizing="border-box";const t=`
    ${i.showIcon?`
      <div class="notification-icon" style="margin-right: 12px; color: ${Uc[i.type].color};">
        <i class="fas ${Uc[i.type].icon}" style="font-size: 18px;"></i>
      </div>
    `:""}
    <div class="notification-content" style="flex: 1; min-width: 0;">
      ${i.title?`<div class="notification-title">${i.title}</div>`:""}
      <div class="notification-message">${i.message}</div>
    </div>
    ${i.closable?`
      <div class="notification-close" style="margin-left: 12px; cursor: pointer; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;">
        <i class="fas fa-times"></i>
      </div>
    `:""}
  `;if(e.innerHTML=t,i.onClick&&(e.style.cursor="pointer",e.addEventListener("click",s=>{s.target.classList.contains("notification-close")||s.target.closest(".notification-close")||i.onClick(s)})),i.closable){const s=e.querySelector(".notification-close");s&&(s.addEventListener("click",()=>{Wn(e,i)}),s.addEventListener("mouseover",function(){this.style.color="var(--icon-primary, #1e90ff)",this.style.transform="scale(1.2)"}),s.addEventListener("mouseout",function(){this.style.color="var(--text-color, #999)",this.style.transform="scale(1)"}))}return e},Wn=(i,e)=>{i.style.opacity="0",i.style.transform=e.position.includes("top")?"translateY(-20px)":"translateY(20px)",setTimeout(()=>{if(i.parentNode){i.parentNode.removeChild(i);const t=zr[e.position],s=t.findIndex(n=>n.element===i);s!==-1&&t.splice(s,1),typeof e.onClose=="function"&&e.onClose(),Ue.emit("notification:closed",{id:e.id,type:e.type})}},e.animationDuration)},Bc=i=>{const e={...Tp,...i,id:Date.now()},t=mE(e.position),s=pE(e);t.appendChild(s);const n=zr[e.position];if(n.length>=e.maxCount){const o=n[0];Wn(o.element,o.options)}n.push({element:s,options:e}),setTimeout(()=>{s.style.opacity="1",s.style.transform="translateY(0)"},10);let r=null;return e.duration>0&&(r=setTimeout(()=>{Wn(s,e)},e.duration),s.addEventListener("mouseenter",()=>{clearTimeout(r)}),s.addEventListener("mouseleave",()=>{r=setTimeout(()=>{Wn(s,e)},e.duration)})),Ue.emit("notification:shown",{id:e.id,type:e.type}),{close:()=>{clearTimeout(r),Wn(s,e)},element:s}},yE=i=>{const e=t=>{const s=zr[t];s.forEach(({element:n,options:r})=>{Wn(n,r)}),s.length=0};i?zr[i]&&e(i):Object.keys(zr).forEach(e)},ns={};Object.keys(Uc).forEach(i=>{ns[i]=(e,t={})=>Bc(typeof e=="string"?{...t,message:e,type:i}:{...e,type:i})});ns.clearAll=yE;const Ul=new Set;ns.achievement=(i,e,t={})=>{const s=t.achievementId||e;if(Ul.has(s))return{close:()=>{}};Ul.add(s),setTimeout(()=>{Ul.delete(s)},5e3);const n={title:i,message:e,type:"achievement",duration:6e3,position:"bottomLeft",className:"notification-achievement",muteSound:!0,...t};if(n.muteSound===!1){const r=new Audio("/sounds/achievement.mp3");r.volume=.5,r.play().catch(o=>{})}return Bc(n)};ns.desktop=async(i,e={})=>{if(!("Notification"in window))return null;if(Notification.permission!=="granted")try{if(await Notification.requestPermission()!=="granted")return null}catch{return null}try{const t=new Notification(i,{icon:"/favicon.webp",badge:"/favicon.webp",...e});return e.onClick&&(t.onclick=e.onClick),e.onClose&&(t.onclose=e.onClose),t}catch{return null}};ns.configPresets={copySuccess:(i="")=>ns.success(i,{duration:2e3,position:"bottomLeft",className:"notification-copy"}),loadError:(i="")=>ns.error(i,{duration:5e3,position:"bottomLeft"}),saveSuccess:(i="")=>ns.success(i,{position:"bottomLeft"})};const vE=()=>{const i=document.createElement("style");i.textContent=`
    @keyframes notification-shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }
    
    .notification-error:hover {
      animation: notification-shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    
    .notification {
      background: linear-gradient(var(--card-bg, rgba(255, 255, 255, 0.95)), var(--card-bg, rgba(255, 255, 255, 0.95))) padding-box,
                 linear-gradient(to right, var(--border-gradient, #cfefff, #d6f3ff, #bfe4ff, #e0f7ff)) border-box !important;
      box-shadow: 0 5px 15px var(--card-shadow, rgba(0, 0, 0, 0.15)) !important;
      border: 3px solid transparent !important;
      border-radius: 12px !important;
      transform: translateX(-20px) !important;
      transition: all 0.3s ease !important;
    }
    
    .notification[style*="opacity: 1"] {
      transform: translateX(0) !important;
    }
    
    .notification-success {
      background: linear-gradient(var(--card-bg, rgba(255, 255, 255, 0.95)), var(--card-bg, rgba(255, 255, 255, 0.95))) padding-box,
                 linear-gradient(45deg, var(--icon-accent, #38d9a9), var(--icon-primary, #1e90ff)) border-box !important;
    }
    
    .notification-error {
      background: linear-gradient(var(--card-bg, rgba(255, 255, 255, 0.95)), var(--card-bg, rgba(255, 255, 255, 0.95))) padding-box,
                 linear-gradient(45deg, var(--icon-accent, #ff6b6b), var(--icon-primary, #1e90ff)) border-box !important;
    }
    
    .notification-achievement {
      background: linear-gradient(var(--card-bg, rgba(255, 255, 255, 0.95)), var(--card-bg, rgba(255, 255, 255, 0.95))) padding-box,
                 linear-gradient(45deg, gold, var(--icon-accent, #ff6b6b), var(--icon-primary, #1e90ff)) border-box !important;
      box-shadow: 0 5px 15px var(--card-shadow, rgba(255, 215, 0, 0.3)) !important;
    }
    
    .notification-copy {
      transform: translateY(0) !important;
    }
    
    .notification-container.notification-bottomLeft {
      bottom: 100px !important;
      left: 20px !important;
    }
    
    .notification-container.notification-bottomRight {
      bottom: 100px !important; 
    }
    
    .notification-title {
      color: var(--icon-primary, #1e90ff) !important;
      font-weight: 600;
      margin-bottom: 4px !important;
    }
    
    .notification-message {
      color: var(--text-color, #666) !important;
    }
    
    .notification-close:hover {
      color: var(--icon-accent, #ff6b6b) !important;
    }
    
    @media (max-width: 768px) {
      .notification {
        width: 250px !important;
      }
      
      .notification-top, 
      .notification-bottom {
        width: 80% !important;
        max-width: 300px;
      }
      
      .notification-container.notification-bottomLeft {
        bottom: 80px !important;
        left: 10px !important;
      }
    }
  `,document.head.appendChild(i)};typeof window<"u"&&window.addEventListener("DOMContentLoaded",vE);const oe=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},TE=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=_E},_E=Number.MAX_SAFE_INTEGER||9007199254740991;let me=function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i}({}),M=function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i}({}),v=function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i}({});var ke={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},de={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class $n{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class EE{constructor(e,t,s,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new $n(e),this.fast_=new $n(t),this.defaultTTFB_=n,this.ttfb_=new $n(e)}update(e,t){const{slow_:s,fast_:n,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new $n(e,s.getEstimate(),s.getTotalWeight())),n.halfLife!==t&&(this.fast_=new $n(t,n.getEstimate(),n.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new $n(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,n=e/1e3,r=s/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function SE(i,e,t){return(e=bE(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ze(){return ze=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},ze.apply(null,arguments)}function Hf(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,s)}return t}function Ke(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Hf(Object(t),!0).forEach(function(s){SE(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Hf(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function xE(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function bE(i){var e=xE(i,"string");return typeof e=="symbol"?e:e+""}class Vs{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=$i,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const $i=function(){},AE={trace:$i,debug:$i,log:$i,warn:$i,info:$i,error:$i};function Gc(){return ze({},AE)}function LE(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):$i}function Vf(i,e,t){return e[i]?e[i].bind(e):LE(i,t)}const Hc=Gc();function IE(i,e,t){const s=Gc();if(typeof console=="object"&&i===!0||typeof i=="object"){const n=["debug","log","info","warn","error"];n.forEach(r=>{s[r]=Vf(r,i,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.8`)}catch{return Gc()}n.forEach(r=>{Hc[r]=Vf(r,i)})}else ze(Hc,s);return s}const Fe=Hc;function Yi(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function RE(i){return typeof self<"u"&&i===self.ManagedMediaSource}function _p(i,e){const t=Object.keys(i),s=Object.keys(e),n=t.length,r=s.length;return!n||!r||n===r&&!t.some(o=>s.indexOf(o)===-1)}function Ts(i,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(i);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const t=i.length;let s,n,r,o="",a=0;for(;a<t;){if(s=i[a++],s===0&&e)return o;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(s);break;case 12:case 13:n=i[a++],o+=String.fromCharCode((s&31)<<6|n&63);break;case 14:n=i[a++],r=i[a++],o+=String.fromCharCode((s&15)<<12|(n&63)<<6|(r&63)<<0);break}}return o}const vi={hexDump:function(i){let e="";for(let t=0;t<i.length;t++){let s=i[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}};function Ep(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function kE(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Bl={exports:{}},Kf;function CE(){return Kf||(Kf=1,function(i,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");return h.path=a.normalizePath(h.path),a.buildURLFromParts(h)}var f=a.parseURL(c);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return u.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):c;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");if(!d.netLoc&&d.path&&d.path[0]!=="/"){var g=n.exec(d.path);d.netLoc=g[1],d.path=g[2]}d.netLoc&&!d.path&&(d.path="/");var m={scheme:d.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(m.netLoc=d.netLoc,f.path[0]!=="/"))if(!f.path)m.path=d.path,f.params||(m.params=d.params,f.query||(m.query=d.query));else{var p=d.path,y=p.substring(0,p.lastIndexOf("/")+1)+f.path;m.path=a.normalizePath(y)}return m.path===null&&(m.path=u.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(m)},parseURL:function(l){var c=s.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(r,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};i.exports=a})()}(Bl)),Bl.exports}var qu=CE();class Yu{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Xe={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Sp{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,DE(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let n;s.length===1?n=(t==null?void 0:t.byteRangeEndOffset)||0:n=parseInt(s[1]),this._byteRange=[n,parseInt(s[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Xe.AUDIO]:null,[Xe.VIDEO]:null,[Xe.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Yu),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=qu.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Xe.AUDIO]=null,e[Xe.VIDEO]=null,e[Xe.AUDIOVIDEO]=null}}function pt(i){return i.sn!=="initSegment"}class Gl extends Sp{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(oe(e)&&oe(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const s=Object.keys(this.levelkeys);if(s.length===1){const n=this._decryptdata=this.levelkeys[s[0]]||null;if(n)return n.getDecryptData(this.sn)}}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=oe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),n=s.length;if(n>1||n===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!oe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return pt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,n,r,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:s,startDTS:n,endDTS:r,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,s),l.startDTS=Math.min(l.startDTS,n),l.endDTS=Math.max(l.endDTS,r)}}class wE extends Sp{constructor(e,t,s,n,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function xp(i,e){const t=Object.getPrototypeOf(i);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||xp(t,e)}}function DE(i,e){const t=xp(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const zf=Math.pow(2,32)-1,PE=[].push,bp={video:1,audio:2,id3:3,text:4};function vt(i){return String.fromCharCode.apply(null,i)}function Ap(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function Se(i,e){const t=Lp(i,e);return t<0?4294967296+t:t}function Wf(i,e){let t=Se(i,e);return t*=Math.pow(2,32),t+=Se(i,e+4),t}function Lp(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function OE(i){const e=i.byteLength;for(let t=0;t<e;){const s=Se(i,t);if(s>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=s>1?t+s:e}return!1}function Re(i,e){const t=[];if(!e.length)return t;const s=i.byteLength;for(let n=0;n<s;){const r=Se(i,n),o=vt(i.subarray(n+4,n+8)),a=r>1?n+r:s;if(o===e[0])if(e.length===1)t.push(i.subarray(n+8,a));else{const l=Re(i.subarray(n+8,a),e.slice(1));l.length&&PE.apply(t,l)}n=a}return t}function ME(i){const e=[],t=i[0];let s=8;const n=Se(i,s);s+=4;let r=0,o=0;t===0?(r=Se(i,s),o=Se(i,s+4),s+=8):(r=Wf(i,s),o=Wf(i,s+8),s+=16),s+=2;let a=i.length+o;const l=Ap(i,s);s+=2;for(let c=0;c<l;c++){let u=s;const h=Se(i,u);u+=4;const f=h&2147483647;if((h&2147483648)>>>31===1)return Fe.warn("SIDX has hierarchical references (not supported)"),null;const g=Se(i,u);u+=4,e.push({referenceSize:f,subsegmentDuration:g,info:{duration:g/n,start:a,end:a+f-1}}),a+=f,u+=4,s=u}return{earliestPresentationTime:r,timescale:n,version:t,referencesCount:l,references:e}}function Ip(i){const e=[],t=Re(i,["moov","trak"]);for(let n=0;n<t.length;n++){const r=t[n],o=Re(r,["tkhd"])[0];if(o){let a=o[0];const l=Se(o,a===0?12:20),c=Re(r,["mdia","mdhd"])[0];if(c){a=c[0];const u=Se(c,a===0?12:20),h=Re(r,["mdia","hdlr"])[0];if(h){const f=vt(h.subarray(8,12)),d={soun:Xe.AUDIO,vide:Xe.VIDEO}[f],g=Re(r,["mdia","minf","stbl","stsd"])[0],m=FE(g);d?(e[l]={timescale:u,type:d,stsd:m},e[d]=Ke({timescale:u,id:l},m)):e[l]={timescale:u,type:f,stsd:m}}}}}return Re(i,["moov","mvex","trex"]).forEach(n=>{const r=Se(n,4),o=e[r];o&&(o.default={duration:Se(n,12),flags:Se(n,20)})}),e}function FE(i){const e=i.subarray(8),t=e.subarray(8+78),s=vt(e.subarray(4,8));let n=s,r;const o=s==="enca"||s==="encv";if(o){const c=Re(e,[s])[0].subarray(s==="enca"?28:78);Re(c,["sinf"]).forEach(h=>{const f=Re(h,["schm"])[0];if(f){const d=vt(f.subarray(4,8));if(d==="cbcs"||d==="cenc"){const g=Re(h,["frma"])[0];g&&(n=vt(g))}}})}const a=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const l=Re(t,["avcC"])[0];l&&l.length>3&&(n+="."+Go(l[1])+Go(l[2])+Go(l[3]),r=Bo(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=Re(e,[s])[0],c=Re(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(c[u++]!==3)break;u=Hl(c,u),u+=2;const h=c[u++];if(h&128&&(u+=2),h&64&&(u+=c[u++]),c[u++]!==4)break;u=Hl(c,u);const f=c[u++];if(f===64)n+="."+Go(f);else break;if(u+=12,c[u++]!==5)break;u=Hl(c,u);const d=c[u++];let g=(d&248)>>3;g===31&&(g+=1+((d&7)<<3)+((c[u]&224)>>5)),n+="."+g}break}case"hvc1":case"hev1":{const l=Re(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],h=c&31,f=Se(l,2),d=(c&32)>>5?"H":"L",g=l[12],m=l.subarray(6,12);n+="."+u+h,n+="."+NE(f).toString(16).toUpperCase(),n+="."+d+g;let p="";for(let y=m.length;y--;){const _=m[y];(_||p)&&(p="."+_.toString(16).toUpperCase()+p)}n+=p}r=Bo(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=Bo(n,t)||n;break}case"vp09":{const l=Re(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],u=l[5],h=l[6]>>4&15;n+="."+Js(c)+"."+Js(u)+"."+Js(h)}break}case"av01":{const l=Re(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,u=l[1]&31,h=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,d=(l[2]&32)>>5,g=c===2&&f?d?12:10:f?10:8,m=(l[2]&16)>>4,p=(l[2]&8)>>3,y=(l[2]&4)>>2,_=l[2]&3,T=1,E=1,S=1,R=0;n+="."+c+"."+Js(u)+h+"."+Js(g)+"."+m+"."+p+y+_+"."+Js(T)+"."+Js(E)+"."+Js(S)+"."+R,r=Bo("dav1",t)}break}}return{codec:n,encrypted:o,supplemental:r}}function Bo(i,e){const t=Re(e,["dvvC"]),s=t.length?t[0]:Re(e,["dvcC"])[0];if(s){const n=s[2]>>1&127,r=s[2]<<5&32|s[3]>>3&31;return i+"."+Js(n)+"."+Js(r)}}function NE(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<32-1-t;return e>>>0}function Hl(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function Go(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function Js(i){return(i<10?"0":"")+i}function $E(i,e){if(!i||!e)return i;const t=e.keyId;return t&&e.isCommonEncryption&&Re(i,["moov","trak"]).forEach(n=>{const o=Re(n,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=Re(o,["enca"]);const l=a.length>0;l||(a=Re(o,["encv"])),a.forEach(c=>{const u=l?c.subarray(28):c.subarray(78);Re(u,["sinf"]).forEach(f=>{const d=Rp(f);if(d){const g=d.subarray(8,24);g.some(m=>m!==0)||(Fe.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${vi.hexDump(g)} -> ${vi.hexDump(t)}`),d.set(t,8))}})})}),i}function Rp(i){const e=Re(i,["schm"])[0];if(e){const t=vt(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Re(i,["schi","tenc"])[0]}return null}function UE(i,e,t){const s={},n=Re(i,["moof","traf"]);for(let r=0;r<n.length;r++){const o=n[r],a=Re(o,["tfhd"])[0],l=Se(a,4),c=e[l];if(!c)continue;const u=s[l]||(s[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type}),h=Re(o,["tfdt"])[0];if(h){const T=h[0];let E=Se(h,4);T===1&&(E===zf?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(E*=zf+1,E+=Se(h,8))),oe(E)&&(!oe(u.start)||E<u.start)&&(u.start=E)}const f=c.default,d=Se(a,0)|(f==null?void 0:f.flags);let g=(f==null?void 0:f.duration)||0;d&8&&(d&2?g=Se(a,12):g=Se(a,8));const m=Re(o,["trun"]);let p=u.start||0,y=0,_=g;for(let T=0;T<m.length;T++){const E=m[T],S=Se(E,4),R=u.sampleCount;u.sampleCount+=S;const x=E[3]&1,L=E[3]&4,A=E[2]&1,k=E[2]&2,w=E[2]&4,P=E[2]&8;let B=8,X=S;for(x&&(B+=4),L&&S&&(!(E[B+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=R),B+=4,A?(_=Se(E,B),B+=4):_=g,k&&(B+=4),P&&(B+=4),p+=_,y+=_,X--);X--;)A?(_=Se(E,B),B+=4):_=g,k&&(B+=4),w&&(E[B+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(X+1),u.keyFrameStart=p),B+=4),P&&(B+=4),p+=_,y+=_;!y&&g&&(y+=g*S)}u.duration+=y}if(!Object.keys(s).some(r=>s[r].duration)){let r=1/0,o=0;const a=Re(i,["sidx"]);for(let l=0;l<a.length;l++){const c=ME(a[l]);if(c!=null&&c.references){r=Math.min(r,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((h,f)=>h+f.info.duration||0,0);o=Math.max(o,u+c.earliestPresentationTime/c.timescale)}}o&&oe(o)&&Object.keys(s).forEach(l=>{s[l].duration||(s[l].duration=o*s[l].timescale-s[l].start)})}return s}function BE(i){const e={valid:null,remainder:null},t=Re(i,["moof"]);if(t.length<2)return e.remainder=i,e;const s=t[t.length-1];return e.valid=i.slice(0,s.byteOffset-8),e.remainder=i.slice(s.byteOffset-8),e}function Os(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function qf(i,e){const t=[],s=e.samples,n=e.timescale,r=e.id;let o=!1;return Re(s,["moof"]).map(l=>{const c=l.byteOffset-8;Re(l,["traf"]).map(h=>{const f=Re(h,["tfdt"]).map(d=>{const g=d[0];let m=Se(d,4);return g===1&&(m*=Math.pow(2,32),m+=Se(d,8)),m/n})[0];return f!==void 0&&(i=f),Re(h,["tfhd"]).map(d=>{const g=Se(d,4),m=Se(d,0)&16777215,p=(m&1)!==0,y=(m&2)!==0,_=(m&8)!==0;let T=0;const E=(m&16)!==0;let S=0;const R=(m&32)!==0;let x=8;g===r&&(p&&(x+=8),y&&(x+=4),_&&(T=Se(d,x),x+=4),E&&(S=Se(d,x),x+=4),R&&(x+=4),e.type==="video"&&(o=gl(e.codec)),Re(h,["trun"]).map(L=>{const A=L[0],k=Se(L,0)&16777215,w=(k&1)!==0;let P=0;const B=(k&4)!==0,X=(k&256)!==0;let q=0;const G=(k&512)!==0;let H=0;const K=(k&1024)!==0,ae=(k&2048)!==0;let fe=0;const z=Se(L,4);let Y=8;w&&(P=Se(L,Y),Y+=4),B&&(Y+=4);let ue=P+c;for(let Ee=0;Ee<z;Ee++){if(X?(q=Se(L,Y),Y+=4):q=T,G?(H=Se(L,Y),Y+=4):H=S,K&&(Y+=4),ae&&(A===0?fe=Se(L,Y):fe=Lp(L,Y),Y+=4),e.type===Xe.VIDEO){let re=0;for(;re<H;){const Te=Se(s,ue);if(ue+=4,GE(o,s[ue])){const U=s.subarray(ue,ue+Te);ju(U,o?2:1,i+fe/n,t)}ue+=Te,re+=Te+4}}i+=q/n}}))})})}),t}function gl(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function GE(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function ju(i,e,t,s){const n=kp(i);let r=0;r+=e;let o=0,a=0,l=0;for(;r<n.length;){o=0;do{if(r>=n.length)break;l=n[r++],o+=l}while(l===255);a=0;do{if(r>=n.length)break;l=n[r++],a+=l}while(l===255);const c=n.length-r;let u=r;if(a<c)r+=a;else if(a>c){Fe.error(`Malformed SEI payload. ${a} is too small, only ${c} bytes left to parse.`);break}if(o===4){if(n[u++]===181){const f=Ap(n,u);if(u+=2,f===49){const d=Se(n,u);if(u+=4,d===1195456820){const g=n[u++];if(g===3){const m=n[u++],p=31&m,y=64&m,_=y?2+p*3:0,T=new Uint8Array(_);if(y){T[0]=m;for(let E=1;E<_;E++)T[E]=n[u++]}s.push({type:g,payloadType:o,pts:t,bytes:T})}}}}}else if(o===5&&a>16){const h=[];for(let g=0;g<16;g++){const m=n[u++].toString(16);h.push(m.length==1?"0"+m:m),(g===3||g===5||g===7||g===9)&&h.push("-")}const f=a-16,d=new Uint8Array(f);for(let g=0;g<f;g++)d[g]=n[u++];s.push({payloadType:o,pts:t,uuid:h.join(""),userData:Ts(d),userDataBytes:d})}}}function kp(i){const e=i.byteLength,t=[];let s=1;for(;s<e-2;)i[s]===0&&i[s+1]===0&&i[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return i;const n=e-t.length,r=new Uint8Array(n);let o=0;for(s=0;s<n;o++,s++)o===t[0]&&(o++,t.shift()),r[s]=i[o];return r}function HE(i){const e=i[0];let t="",s="",n=0,r=0,o=0,a=0,l=0,c=0;if(e===0){for(;vt(i.subarray(c,c+1))!=="\0";)t+=vt(i.subarray(c,c+1)),c+=1;for(t+=vt(i.subarray(c,c+1)),c+=1;vt(i.subarray(c,c+1))!=="\0";)s+=vt(i.subarray(c,c+1)),c+=1;s+=vt(i.subarray(c,c+1)),c+=1,n=Se(i,12),r=Se(i,16),a=Se(i,20),l=Se(i,24),c=28}else if(e===1){c+=4,n=Se(i,c),c+=4;const h=Se(i,c);c+=4;const f=Se(i,c);for(c+=4,o=2**32*h+f,TE(o)||(o=Number.MAX_SAFE_INTEGER,Fe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=Se(i,c),c+=4,l=Se(i,c),c+=4;vt(i.subarray(c,c+1))!=="\0";)t+=vt(i.subarray(c,c+1)),c+=1;for(t+=vt(i.subarray(c,c+1)),c+=1;vt(i.subarray(c,c+1))!=="\0";)s+=vt(i.subarray(c,c+1)),c+=1;s+=vt(i.subarray(c,c+1)),c+=1}const u=i.subarray(c,i.byteLength);return{schemeIdUri:t,value:s,timeScale:n,presentationTime:o,presentationTimeDelta:r,eventDuration:a,id:l,payload:u}}function VE(i,...e){const t=e.length;let s=8,n=t;for(;n--;)s+=e[n].byteLength;const r=new Uint8Array(s);for(r[0]=s>>24&255,r[1]=s>>16&255,r[2]=s>>8&255,r[3]=s&255,r.set(i,4),n=0,s=8;n<t;n++)r.set(e[n],s),s+=e[n].byteLength;return r}function KE(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let s,n;s=0,n=new Uint8Array;let r;s>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),VE([112,115,115,104],new Uint8Array([s,0,0,0]),i,r,n,o,t||new Uint8Array)}const Cp=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),cr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Xu(i,e){const t=cr[e];return!!t&&!!t[i.slice(0,4)]}function Vc(i,e,t=!0){return!i.split(",").some(s=>!Qu(s,e,t))}function Qu(i,e,t=!0){var s;const n=Yi(t);return(s=n==null?void 0:n.isTypeSupported(co(i,e)))!=null?s:!1}function co(i,e){return`${e}/mp4;codecs=${i}`}function Yf(i){if(i){const e=i.substring(0,4);return cr.video[e]}return 2}function Oa(i){const e=Cp();return i.split(",").reduce((t,s)=>{const r=e&&gl(s)?9:cr.video[s];return r?(r*2+t)/(t?3:2):(cr.audio[s]+t)/(t?2:1)},0)}const Vl={};function zE(i,e=!0){if(Vl[i])return Vl[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let n=0;n<t.length;n++){var s;if(Qu(t[n],"audio",e))return Vl[i]=t[n],t[n];if(t[n]==="mp3"&&(s=Yi(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return i}const WE=/flac|opus|mp4a\.40\.34/i;function Ma(i,e=!0){return i.replace(WE,t=>zE(t.toLowerCase(),e))}function qE(i,e){const t=[];if(i){const s=i.split(",");for(let n=0;n<s.length;n++)Xu(s[n],"video")||t.push(s[n])}return e&&t.push(e),t.join(",")}function ua(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(jf(i,"audio")||jf(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let s=t.length;s--;)if(t[s].substring(0,4)===i.substring(0,4))return t[s]}return t[0]}}return e||i}function jf(i,e){return Xu(i,e)&&Qu(i,e)}function YE(i){const e=i.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function jE(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return i}function Xf(i){const e=Yi(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Kc(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const wp={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Dp(i,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:i}}function XE(i,e,t,s,n,r){const o=i.videoCodec,a=i.audioCodec?i.audioGroups:null,l=r==null?void 0:r.audioCodec,c=r==null?void 0:r.channels,u=c?parseInt(c):l?1/0:2;let h=null;if(a!=null&&a.length)try{a.length===1&&a[0]?h=e.groups[a[0]].channels:h=a.reduce((f,d)=>{if(d){const g=e.groups[d];if(!g)throw new Error(`Audio track group ${d} not found`);Object.keys(g.channels).forEach(m=>{f[m]=(f[m]||0)+g.channels[m]})}return f},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(f=>gl(f))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(s,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(n,8e6))||!!h&&oe(u)&&Object.keys(h).some(f=>parseInt(f)>u)}function Pp(i,e,t,s={}){const n=i.videoCodec;if(!n&&!i.audioCodec||!t)return Promise.resolve(wp);const r=[],o=QE(i),a=o.length,l=JE(i,e,a>0),c=l.length;for(let u=a||1*c||1;u--;){const h={type:"media-source"};if(a&&(h.video=o[u%a]),c){h.audio=l[u%c];const f=h.audio.bitrate;h.video&&f&&(h.video.bitrate-=f)}r.push(h)}if(n){const u=navigator.userAgent;if(n.split(",").some(h=>gl(h))&&Cp())return Promise.resolve(Dp(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),r))}return Promise.all(r.map(u=>{const h=eS(u);return s[h]||(s[h]=t.decodingInfo(u))})).then(u=>({supported:!u.some(h=>!h.supported),configurations:r,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:r,decodingInfoResults:[],error:u}))}function QE(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),s=Op(i),n=i.width||640,r=i.height||480,o=i.frameRate||30,a=i.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:co(jE(l),"video"),width:n,height:r,bitrate:s,framerate:o};return a!=="sdr"&&(c.transferFunction=a),c}):[]}function JE(i,e,t){var s;const n=(s=i.audioCodec)==null?void 0:s.split(","),r=Op(i);return n&&i.audioGroups?i.audioGroups.reduce((o,a)=>{var l;const c=a?(l=e.groups[a])==null?void 0:l.tracks:null;return c?c.reduce((u,h)=>{if(h.groupId===a){const f=parseFloat(h.channels||"");n.forEach(d=>{const g={contentType:co(d,"audio"),bitrate:t?ZE(d,r):r};f&&(g.channels=""+f),u.push(g)})}return u},o):o},[]):[]}function ZE(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Op(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function eS(i){let e="";const{audio:t,video:s}=i;if(s){const n=Kc(s.contentType);e+=`${n}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const n=Kc(t.contentType);e+=`${s?"_":""}${n}_c${t.channels}`}return e}const zc=["NONE","TYPE-0","TYPE-1",null];function tS(i){return zc.indexOf(i)>-1}const Fa=["SDR","PQ","HLG"];function sS(i){return!!i&&Fa.indexOf(i)>-1}var ha={No:"",Yes:"YES",v2:"v2"};function Qf(i){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=i,n=s<e/2;return e&&n?t?ha.v2:ha.Yes:ha.No}class Jf{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class uo{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Zf(this._audioGroups,e)}hasSubtitleGroup(e){return Zf(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Zf(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function iS(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function nS(i,e){let t=!1,s=[];if(i&&(t=i!=="SDR",s=[i]),e){s=e.allowedVideoRanges||Fa.slice(0);const n=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:n&&iS(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const rS=i=>{const e=new WeakSet;return(t,s)=>{if(i&&(s=i(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},tt=(i,e)=>JSON.stringify(i,rS(e));function oS(i,e,t,s,n){const r=Object.keys(i),o=s==null?void 0:s.channels,a=s==null?void 0:s.audioCodec,l=n==null?void 0:n.videoCodec,c=o&&parseInt(o)===2;let u=!1,h=!1,f=1/0,d=1/0,g=1/0,m=1/0,p=0,y=[];const{preferHDR:_,allowedVideoRanges:T}=nS(e,n);for(let L=r.length;L--;){const A=i[r[L]];u||(u=A.channels[2]>0),f=Math.min(f,A.minHeight),d=Math.min(d,A.minFramerate),g=Math.min(g,A.minBitrate),T.filter(w=>A.videoRanges[w]>0).length>0&&(h=!0)}f=oe(f)?f:0,d=oe(d)?d:0;const E=Math.max(1080,f),S=Math.max(30,d);g=oe(g)?g:t,t=Math.max(g,t),h||(e=void 0);const R=r.length>1;return{codecSet:r.reduce((L,A)=>{const k=i[A];if(A===L)return L;if(y=h?T.filter(w=>k.videoRanges[w]>0):[],R){if(k.minBitrate>t)return qs(A,`min bitrate of ${k.minBitrate} > current estimate of ${t}`),L;if(!k.hasDefaultAudio)return qs(A,"no renditions with default or auto-select sound found"),L;if(a&&A.indexOf(a.substring(0,4))%5!==0)return qs(A,`audio codec preference "${a}" not found`),L;if(o&&!c){if(!k.channels[o])return qs(A,`no renditions with ${o} channel sound found (channels options: ${Object.keys(k.channels)})`),L}else if((!a||c)&&u&&k.channels[2]===0)return qs(A,"no renditions with stereo sound found"),L;if(k.minHeight>E)return qs(A,`min resolution of ${k.minHeight} > maximum of ${E}`),L;if(k.minFramerate>S)return qs(A,`min framerate of ${k.minFramerate} > maximum of ${S}`),L;if(!y.some(w=>k.videoRanges[w]>0))return qs(A,`no variants with VIDEO-RANGE of ${tt(y)} found`),L;if(l&&A.indexOf(l.substring(0,4))%5!==0)return qs(A,`video codec preference "${l}" not found`),L;if(k.maxScore<p)return qs(A,`max score of ${k.maxScore} < selected max of ${p}`),L}return L&&(Oa(A)>=Oa(L)||k.fragmentError>i[L].fragmentError)?L:(m=k.minIndex,p=k.maxScore,A)},void 0),videoRanges:y,preferHDR:_,minFramerate:d,minBitrate:g,minIndex:m}}function qs(i,e){Fe.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function Mp(i){return i.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const n=t.channels||"2";return s.channels[n]=(s.channels[n]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function aS(i,e,t,s){return i.slice(t,s+1).reduce((n,r,o)=>{if(!r.codecSet)return n;const a=r.audioGroups;let l=n[r.codecSet];l||(n[r.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,r.bitrate);const c=Math.min(r.height,r.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,r.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,r.score),l.fragmentError+=r.fragmentError,l.videoRanges[r.videoRange]=(l.videoRanges[r.videoRange]||0)+1,a&&a.forEach(u=>{if(!u)return;const h=e.groups[u];h&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?h.hasDefault:h.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(h.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+h.channels[f]}))}),n},{})}function ed(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:r}=i;return{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:r}}function ii(i,e,t){if("attrs"in i){const s=e.indexOf(i);if(s!==-1)return s}for(let s=0;s<e.length;s++){const n=e[s];if(Sn(i,n,t))return s}return-1}function Sn(i,e,t){const{groupId:s,name:n,lang:r,assocLang:o,default:a}=i,l=i.forced;return(s===void 0||e.groupId===s)&&(n===void 0||e.name===n)&&(r===void 0||lS(r,e.lang))&&(r===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in i)||cS(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function lS(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function cS(i,e=""){const t=i.split(","),s=e.split(",");return t.length===s.length&&!t.some(n=>s.indexOf(n)===-1)}function hn(i,e){const{audioCodec:t,channels:s}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function uS(i,e,t,s,n){const r=e[s],a=e.reduce((f,d,g)=>{const m=d.uri;return(f[m]||(f[m]=[])).push(g),f},{})[r.uri];a.length>1&&(s=Math.max.apply(Math,a));const l=r.videoRange,c=r.frameRate,u=r.codecSet.substring(0,4),h=td(e,s,f=>{if(f.videoRange!==l||f.frameRate!==c||f.codecSet.substring(0,4)!==u)return!1;const d=f.audioGroups,g=t.filter(m=>!d||d.indexOf(m.groupId)!==-1);return ii(i,g,n)>-1});return h>-1?h:td(e,s,f=>{const d=f.audioGroups,g=t.filter(m=>!d||d.indexOf(m.groupId)!==-1);return ii(i,g,n)>-1})}function td(i,e,t){for(let s=e;s>-1;s--)if(t(i[s]))return s;for(let s=e+1;s<i.length;s++)if(t(i[s]))return s;return-1}function Na(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class hS extends Vs{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:n,partCurrent:r,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!n||!l)return;const c=performance.now(),u=r?r.stats:n.stats,h=r?r.duration:n.duration,f=c-u.loading.start,d=o.minAutoLevel,g=n.level,m=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||g<=d){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const p=m>-1&&m!==g,y=!!t||p;if(!y&&(l.paused||!l.playbackRate||!l.readyState))return;const _=o.mainForwardBufferInfo;if(!y&&_===null)return;const T=this.bwEstimator.getEstimateTTFB(),E=Math.abs(l.playbackRate);if(f<=Math.max(T,1e3*(h/(E*2))))return;const S=_?_.len/E:0,R=u.loading.first?u.loading.first-u.loading.start:-1,x=u.loaded&&R>-1,L=this.getBwEstimate(),A=o.levels,k=A[g],w=Math.max(u.loaded,Math.round(h*(n.bitrate||k.averageBitrate)/8));let P=x?f-R:f;P<1&&x&&(P=Math.min(f,u.loaded*8/L));const B=x?u.loaded*1e3/P:0,X=T/1e3,q=B?(w-u.loaded)/B:w*8/L+X;if(q<=S)return;const G=B?B*8:L,H=((s=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,K=this.hls.config.abrBandWidthUpFactor;let ae=Number.POSITIVE_INFINITY,fe;for(fe=g-1;fe>d;fe--){const Ee=A[fe].maxBitrate,re=!A[fe].details||H;if(ae=this.getTimeToLoadFrag(X,G,h*Ee,re),ae<Math.min(S,h+X))break}if(ae>=q||ae>h*10)return;x?this.bwEstimator.sample(f-Math.min(T,R),u.loaded):this.bwEstimator.sampleTTFB(f);const z=A[fe].maxBitrate;this.getBwEstimate()*K>z&&this.resetEstimator(z);const Y=this.findBestLevel(z,d,fe,0,S,1,1);Y>-1&&(fe=Y),this.warn(`Fragment ${n.sn}${r?" part "+r.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${S.toFixed(3)} s
      Estimated load time for current fragment: ${q.toFixed(3)} s
      Estimated load time for down switch fragment: ${ae.toFixed(3)} s
      TTFB estimate: ${R|0} ms
      Current BW estimate: ${oe(L)?L|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${fe} @ ${z|0} bps`),o.nextLoadLevel=o.nextAutoLevel=fe,this.clearTimer();const ue=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===fe&&fe>0){const Ee=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${fe>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${Ee.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,fe>d){let re=this.findBestLevel(this.hls.levels[d].bitrate,d,fe,0,Ee,1,1);re===-1&&(re=d),this.hls.nextLoadLevel=this.hls.nextAutoLevel=re,this.resetEstimator(this.hls.levels[re].bitrate)}}};p||q>ae*2?ue():this.timer=self.setInterval(ue,ae*1e3),o.trigger(v.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new EE(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(v.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var n;this.fragCurrent=s,this.partCurrent=(n=t.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case M.BUFFER_ADD_CODEC_ERROR:case M.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case M.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:n,partCurrent:r}=this;if(s&&n&&s.sn===n.sn&&s.level===n.level){const o=performance.now(),a=r?r.stats:s.stats,l=o-a.loading.start,c=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&c>-1){const h=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(h,c),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,s,n){const r=e+s/t,o=n?e+this.lastLevelLoadSec:0;return r+o}onLevelLoaded(e,t){const s=this.hls.config,{loading:n}=t.stats,r=n.end-n.first;oe(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const n=s?s.stats:t.stats;if(t.type===de.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=s?s.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+n.loaded,l=(o.loaded?o.loaded.duration:0)+r;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const r={stats:n,frag:t,part:s,id:t.type};this.onFragBuffered(v.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:n}=t,r=n!=null&&n.stats.loaded?n.stats:s.stats;if(r.aborted||this.ignoreFragment(s))return;const o=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==de.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,n,1,1);if(r>-1)return r;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=s&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,r)&&o[e].loadError<=o[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:n,config:r,minAutoLevel:o}=s,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=r.abrBandWidthFactor,h=r.abrBandWidthUpFactor;if(c){const p=this.findBestLevel(l,o,n,c,0,u,h);if(p>=0)return this.rebufferNotice=-1,p}let f=a?Math.min(a,r.maxStarvationDelay):r.maxStarvationDelay;if(!c){const p=this.bitrateTestDelay;p&&(f=(a?Math.min(a,r.maxLoadingDelay):r.maxLoadingDelay)-p,this.info(`bitrate test took ${Math.round(1e3*p)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),u=h=1)}const d=this.findBestLevel(l,o,n,c,f,u,h);if(this.rebufferNotice!==d&&(this.rebufferNotice=d,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${d}`)),d>-1)return d;const g=s.levels[o],m=s.loadLevelObj;return m&&(g==null?void 0:g.bitrate)<m.bitrate?o:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,n,r,o,a){var l;const c=n+r,u=this.lastLoadedFragLevel,h=u===-1?this.hls.firstLevel:u,{fragCurrent:f,partCurrent:d}=this,{levels:g,allAudioTracks:m,loadLevel:p,config:y}=this.hls;if(g.length===1)return 0;const _=g[h],T=!!((l=this.hls.latestLevelDetails)!=null&&l.live),E=p===-1||u===-1;let S,R="SDR",x=(_==null?void 0:_.frameRate)||0;const{audioPreference:L,videoPreference:A}=y,k=this.audioTracksByGroup||(this.audioTracksByGroup=Mp(m));let w=-1;if(E){if(this.firstSelection!==-1)return this.firstSelection;const G=this.codecTiers||(this.codecTiers=aS(g,k,t,s)),H=oS(G,R,e,L,A),{codecSet:K,videoRanges:ae,minFramerate:fe,minBitrate:z,minIndex:Y,preferHDR:ue}=H;w=Y,S=K,R=ue?ae[ae.length-1]:ae[0],x=fe,e=Math.max(e,z),this.log(`picked start tier ${tt(H)}`)}else S=_==null?void 0:_.codecSet,R=_==null?void 0:_.videoRange;const P=d?d.duration:f?f.duration:0,B=this.bwEstimator.getEstimateTTFB()/1e3,X=[];for(let G=s;G>=t;G--){var q;const H=g[G],K=G>h;if(!H)continue;if(y.useMediaCapabilities&&!H.supportedResult&&!H.supportedPromise){const re=navigator.mediaCapabilities;typeof(re==null?void 0:re.decodingInfo)=="function"&&XE(H,k,R,x,e,L)?(H.supportedPromise=Pp(H,k,re,this.supportedCache),H.supportedPromise.then(Te=>{if(!this.hls)return;H.supportedResult=Te;const U=this.hls.levels,te=U.indexOf(H);Te.error?this.warn(`MediaCapabilities decodingInfo error: "${Te.error}" for level ${te} ${tt(Te)}`):Te.supported?Te.decodingInfoResults.some(Z=>Z.smooth===!1||Z.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${te} not smooth or powerEfficient: ${tt(Te)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${te} ${tt(Te)}`),te>-1&&U.length>1&&(this.log(`Removing unsupported level ${te}`),this.hls.removeLevel(te),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):H.supportedResult=wp}if((S&&H.codecSet!==S||R&&H.videoRange!==R||K&&x>H.frameRate||!K&&x>0&&x<H.frameRate||(q=H.supportedResult)!=null&&(q=q.decodingInfoResults)!=null&&q.some(re=>re.smooth===!1))&&(!E||G!==w)){X.push(G);continue}const ae=H.details,fe=(d?ae==null?void 0:ae.partTarget:ae==null?void 0:ae.averagetargetduration)||P;let z;K?z=a*e:z=o*e;const Y=P&&n>=P*2&&r===0?H.averageBitrate:H.maxBitrate,ue=this.getTimeToLoadFrag(B,z,Y*fe,ae===void 0);if(z>=Y&&(G===u||H.loadError===0&&H.fragmentError===0)&&(ue<=B||!oe(ue)||T&&!this.bitrateTestDelay||ue<c)){const re=this.forcedAutoLevel;return G!==p&&(re===-1||re!==p)&&(X.length&&this.trace(`Skipped level(s) ${X.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${g[X[0]].codecs}" ${g[X[0]].videoRange}; not compatible with "${S}" ${R}`),this.info(`switch candidate:${h}->${G} adjustedbw(${Math.round(z)})-bitrate=${Math.round(z-Y)} ttfb:${B.toFixed(1)} avgDuration:${fe.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${ue.toFixed(1)} firstSelection:${E} codecSet:${H.codecSet} videoRange:${H.videoRange} hls.loadLevel:${p}`)),E&&(this.firstSelection=G),G}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const Fp={search:function(i,e){let t=0,s=i.length-1,n=null,r=null;for(;t<=s;){n=(t+s)/2|0,r=i[n];const o=e(r);if(o>0)t=n+1;else if(o<0)s=n-1;else return r}return null}};function fS(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!oe(e))return null;const s=i[0].programDateTime;if(e<(s||0))return null;const n=i[i.length-1].endProgramDateTime;if(e>=(n||0))return null;for(let r=0;r<i.length;++r){const o=i[r];if(gS(e,t,o))return o}return null}function wn(i,e,t=0,s=0,n=.005){let r=null;if(i){r=e[1+i.sn-e[0].sn]||null;const a=i.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),r&&i.level!==r.level&&r.end<=i.end&&(r=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!i||i.level===r.level)&&sd(t,s,r)===0||dS(r,i,Math.min(n,s))))return r;const o=Fp.search(e,sd.bind(null,t,s));return o&&(o!==i||!r)?o:r}function dS(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((n,r)=>(r[0]==="INF"&&(n+=parseFloat(r[1])),n),t);return i.start<=s}return!1}function sd(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=i?1:t.start-s>i&&t.start?-1:0}function gS(i,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>i}function Np(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let s=i.fragments;const{fragmentHint:n}=i;n&&(s=s.concat(n));let r;return Fp.search(s,o=>o.cc<e?1:o.cc>e?-1:(r=o,o.end<=t?1:o.start>t?-1:0)),r||null}return null}function $a(i){switch(i.details){case M.FRAG_LOAD_TIMEOUT:case M.KEY_LOAD_TIMEOUT:case M.LEVEL_LOAD_TIMEOUT:case M.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function id(i,e){const t=$a(e);return i.default[`${t?"timeout":"error"}Retry`]}function Ju(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function nd(i){return Ke(Ke({},i),{errorRetry:null,timeoutRetry:null})}function Ua(i,e,t,s){if(!i)return!1;const n=s==null?void 0:s.code,r=e<i.maxNumRetry&&(mS(n)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,s,r):r}function mS(i){return i===0&&navigator.onLine===!1||!!i&&(i<400||i>499)}var Dt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},$s={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class pS extends Vs{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(v.ERROR,this.onError,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(v.ERROR,this.onError,this),e.off(v.ERROR,this.onErrorOut,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===de.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const n=this.hls,r=t.context;switch(t.details){case M.FRAG_LOAD_ERROR:case M.FRAG_LOAD_TIMEOUT:case M.KEY_LOAD_ERROR:case M.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case M.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=ho();return}case M.FRAG_GAP:case M.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Dt.SendAlternateToPenaltyBox;return}case M.LEVEL_EMPTY_ERROR:case M.LEVEL_PARSING_ERROR:{var o;const l=t.parent===de.MAIN?t.level:n.loadLevel;t.details===M.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case M.LEVEL_LOAD_ERROR:case M.LEVEL_LOAD_TIMEOUT:typeof(r==null?void 0:r.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case M.AUDIO_TRACK_LOAD_ERROR:case M.AUDIO_TRACK_LOAD_TIMEOUT:case M.SUBTITLE_LOAD_ERROR:case M.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const l=n.loadLevelObj;if(l&&(r.type===ke.AUDIO_TRACK&&l.hasAudioGroup(r.groupId)||r.type===ke.SUBTITLE_TRACK&&l.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=Dt.SendAlternateToPenaltyBox,t.errorAction.flags=$s.MoveAllAlternatesMatchingHost;return}}return;case M.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const l=n.loadLevelObj,c=l==null?void 0:l.attrs["HDCP-LEVEL"];c?t.errorAction={action:Dt.SendAlternateToPenaltyBox,flags:$s.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}:this.keySystemError(t)}return;case M.BUFFER_ADD_CODEC_ERROR:case M.REMUX_ALLOC_ERROR:case M.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:n.loadLevel)}return;case M.INTERNAL_EXCEPTION:case M.BUFFER_APPENDING_ERROR:case M.BUFFER_FULL_ERROR:case M.LEVEL_SWITCH_ERROR:case M.BUFFER_STALLED_ERROR:case M.BUFFER_SEEK_OVER_HOLE:case M.BUFFER_NUDGE_ON_STALL:t.errorAction=ho();return}t.type===me.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,n=id(s.config.playlistLoadPolicy,e),r=this.playlistError++;if(Ua(n,r,$a(e),e.response))return{action:Dt.RetryRequest,flags:$s.None,retryConfig:n,retryCount:r};const a=this.getLevelSwitchAction(e,t);return n&&(a.retryConfig=n,a.retryCount=r),a}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),n=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:o}=t.config,a=id(e.details.startsWith("key")?o:r,e),l=t.levels.reduce((u,h)=>u+h.fragmentError,0);if(n&&(e.details!==M.FRAG_GAP&&n.fragmentError++,Ua(a,l,$a(e),e.response)))return{action:Dt.RetryRequest,flags:$s.None,retryConfig:a,retryCount:l};const c=this.getLevelSwitchAction(e,s);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const n=this.hls.levels[t];if(n){var r,o;const c=e.details;n.loadError++,c===M.BUFFER_APPEND_ERROR&&n.fragmentError++;let u=-1;const{levels:h,loadLevel:f,minAutoLevel:d,maxAutoLevel:g}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const m=(r=e.frag)==null?void 0:r.type,y=(m===de.AUDIO&&c===M.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===M.BUFFER_ADD_CODEC_ERROR||c===M.BUFFER_APPEND_ERROR))&&h.some(({audioCodec:R})=>n.audioCodec!==R),T=e.sourceBufferName==="video"&&(c===M.BUFFER_ADD_CODEC_ERROR||c===M.BUFFER_APPEND_ERROR)&&h.some(({codecSet:R,audioCodec:x})=>n.codecSet!==R&&n.audioCodec===x),{type:E,groupId:S}=(o=e.context)!=null?o:{};for(let R=h.length;R--;){const x=(R+f)%h.length;if(x!==f&&x>=d&&x<=g&&h[x].loadError===0){var a,l;const L=h[x];if(c===M.FRAG_GAP&&m===de.MAIN&&e.frag){const A=h[x].details;if(A){const k=wn(e.frag,A.fragments,e.frag.start);if(k!=null&&k.gap)continue}}else{if(E===ke.AUDIO_TRACK&&L.hasAudioGroup(S)||E===ke.SUBTITLE_TRACK&&L.hasSubtitleGroup(S))continue;if(m===de.AUDIO&&(a=n.audioGroups)!=null&&a.some(A=>L.hasAudioGroup(A))||m===de.SUBTITLE&&(l=n.subtitleGroups)!=null&&l.some(A=>L.hasSubtitleGroup(A))||y&&n.audioCodec===L.audioCodec||!y&&n.audioCodec!==L.audioCodec||T&&n.codecSet===L.codecSet)continue}u=x;break}}if(u>-1&&s.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:Dt.SendAlternateToPenaltyBox,flags:$s.None,nextAutoLevel:u}}return{action:Dt.SendAlternateToPenaltyBox,flags:$s.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case Dt.DoNothing:break;case Dt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==M.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:n,hdcpLevel:r,nextAutoLevel:o}=s;switch(n){case $s.None:this.switchLevel(e,o);break;case $s.MoveAllAlternatesMatchingHDCP:r&&(t.maxHdcpLevel=zc[zc.indexOf(r)-1],s.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}s.resolved||this.switchLevel(e,o)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===M.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=Kc(e.mimeType),n=this.hls.levels;for(let r=n.length;r--;)n[r][`${e.sourceBufferName}Codec`]===s&&this.hls.removeLevel(r)}}}function ho(i){const e={action:Dt.DoNothing,flags:$s.None};return i&&(e.resolved=!0),e}var Tt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class yS{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.BUFFER_APPENDED,this.onBufferAppended,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.BUFFER_APPENDED,this.onBufferAppended,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let n=s.length;n--;){const r=s[n];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:n}=this,r=Object.keys(n);for(let o=r.length;o--;){const a=n[r[o]];if((a==null?void 0:a.body.type)===t&&(!s||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,s,n,r){this.timeRanges&&(this.timeRanges[e]=t);const o=(n==null?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||r)){l.body.type===s&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(u=>{const h=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return h&&this.removeFragment(l.body),h})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,n=Un(s),r=this.fragments[n];if(!r||r.buffered&&s.gap)return;const o=!s.relurl;Object.keys(t).forEach(a=>{const l=s.elementaryStreams[a];if(!l)return;const c=t[a],u=o||l.partial===!0;r.range[a]=this.getBufferedTimes(s,e.part,u,c)}),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,(r.body.endList=s.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),Ho(r)||this.removeParts(s.sn-1,s.type)):this.removeFragment(r.body)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=rd(s,n=>n.fragment.sn>=e))}fragBuffered(e,t){const s=Un(e);let n=this.fragments[s];!n&&t&&(n=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}getBufferedTimes(e,t,s,n){const r={time:[],partial:s},o=e.start,a=e.end,l=e.minEndPTS||a,c=e.maxStartPTS||o;for(let u=0;u<n.length;u++){const h=n.start(u)-this.bufferPadding,f=n.end(u)+this.bufferPadding;if(c>=h&&l<=f){r.time.push({startPTS:Math.max(o,n.start(u)),endPTS:Math.min(a,n.end(u))});break}else if(o<f&&a>h){const d=Math.max(o,n.start(u)),g=Math.min(a,n.end(u));g>d&&(r.partial=!0,r.time.push({startPTS:d,endPTS:g}))}else if(a<=h)break}return r}getPartialFragment(e){let t=null,s,n,r,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&Ho(u)&&(n=u.body.start-a,r=u.body.end+a,e>=n&&e<=r&&(s=Math.min(e-n,r-e),o<=s&&(t=u.body,o=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Ho(t))}getState(e){const t=Un(e),s=this.fragments[t];return s?s.buffered?Ho(s)?Tt.PARTIAL:Tt.OK:Tt.APPENDING:Tt.NOT_LOADED}isTimeBuffered(e,t,s){let n,r;for(let o=0;o<s.length;o++){if(n=s.start(o)-this.bufferPadding,r=s.end(o)+this.bufferPadding,e>=n&&t<=r)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,n=t.part?null:t,r=Un(s);this.fragments[r]={body:s,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:n,timeRanges:r,type:o}=t;if(s.sn==="initSegment")return;const a=s.type;if(n){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(n)}this.timeRanges=r;const l=r[o];this.detectEvictedFragments(o,l,a,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Un(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let n=s.length;n--;){const r=t[s[n]];if((r==null?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,n,r){n&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==s||n&&!l.gap||l.start<t&&l.end>e&&(a.buffered||r)&&this.removeFragment(l)})}removeFragment(e){const t=Un(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const n=e.sn;this.activePartLists[e.type]=rd(s,r=>r.fragment.sn!==n)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function Ho(i){var e,t,s;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(s=i.range.audiovideo)!=null&&s.partial)}function Un(i){return`${i.type}_${i.level}_${i.sn}`}function rd(i,e){return i.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var ji={cbc:0,ctr:1};class vS{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case ji.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ji.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function TS(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class _S{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let n=0;n<4;n++)s[n]=t.getUint32(n*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,n=s[0],r=s[1],o=s[2],a=s[3],l=this.invSubMix,c=l[0],u=l[1],h=l[2],f=l[3],d=new Uint32Array(256);let g=0,m=0,p=0;for(p=0;p<256;p++)p<128?d[p]=p<<1:d[p]=p<<1^283;for(p=0;p<256;p++){let y=m^m<<1^m<<2^m<<3^m<<4;y=y>>>8^y&255^99,e[g]=y,t[y]=g;const _=d[g],T=d[_],E=d[T];let S=d[y]*257^y*16843008;n[g]=S<<24|S>>>8,r[g]=S<<16|S>>>16,o[g]=S<<8|S>>>24,a[g]=S,S=E*16843009^T*65537^_*257^g*16843008,c[y]=S<<24|S>>>8,u[y]=S<<16|S>>>16,h[y]=S<<8|S>>>24,f[y]=S,g?(g=_^d[d[d[E^_]]],m^=d[d[m]]):g=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,n=0;for(;n<t.length&&s;)s=t[n]===this.key[n],n++;if(s)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const o=this.ksRows=(r+6+1)*4;let a,l;const c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),h=this.sBox,f=this.rcon,d=this.invSubMix,g=d[0],m=d[1],p=d[2],y=d[3];let _,T;for(a=0;a<o;a++){if(a<r){_=c[a]=t[a];continue}T=_,a%r===0?(T=T<<8|T>>>24,T=h[T>>>24]<<24|h[T>>>16&255]<<16|h[T>>>8&255]<<8|h[T&255],T^=f[a/r|0]<<24):r>6&&a%r===4&&(T=h[T>>>24]<<24|h[T>>>16&255]<<16|h[T>>>8&255]<<8|h[T&255]),c[a]=_=(c[a-r]^T)>>>0}for(l=0;l<o;l++)a=o-l,l&3?T=c[a]:T=c[a-4],l<4||a<=4?u[l]=T:u[l]=g[h[T>>>24]]^m[h[T>>>16&255]]^p[h[T>>>8&255]]^y[h[T&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const n=this.keySize+6,r=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],u=a[2],h=a[3],f=this.uint8ArrayToUint32Array_(s);let d=f[0],g=f[1],m=f[2],p=f[3];const y=new Int32Array(e),_=new Int32Array(y.length);let T,E,S,R,x,L,A,k,w,P,B,X,q,G;const H=this.networkToHostOrderSwap;for(;t<y.length;){for(w=H(y[t]),P=H(y[t+1]),B=H(y[t+2]),X=H(y[t+3]),x=w^r[0],L=X^r[1],A=B^r[2],k=P^r[3],q=4,G=1;G<n;G++)T=l[x>>>24]^c[L>>16&255]^u[A>>8&255]^h[k&255]^r[q],E=l[L>>>24]^c[A>>16&255]^u[k>>8&255]^h[x&255]^r[q+1],S=l[A>>>24]^c[k>>16&255]^u[x>>8&255]^h[L&255]^r[q+2],R=l[k>>>24]^c[x>>16&255]^u[L>>8&255]^h[A&255]^r[q+3],x=T,L=E,A=S,k=R,q=q+4;T=o[x>>>24]<<24^o[L>>16&255]<<16^o[A>>8&255]<<8^o[k&255]^r[q],E=o[L>>>24]<<24^o[A>>16&255]<<16^o[k>>8&255]<<8^o[x&255]^r[q+1],S=o[A>>>24]<<24^o[k>>16&255]<<16^o[x>>8&255]<<8^o[L&255]^r[q+2],R=o[k>>>24]<<24^o[x>>16&255]<<16^o[L>>8&255]<<8^o[A&255]^r[q+3],_[t]=H(T^d),_[t+1]=H(R^g),_[t+2]=H(S^m),_[t+3]=H(E^p),d=w,g=P,m=B,p=X,t=t+4}return _.buffer}}class ES{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=SS(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function SS(i){switch(i){case ji.cbc:return"AES-CBC";case ji.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const xS=16;class Zu{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?TS(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,n){return this.useSoftware?new Promise((r,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,s,n);const l=this.flush();l?r(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,n)}softwareDecrypt(e,t,s,n){const{currentIV:r,currentResult:o,remainderData:a}=this;if(n!==ji.cbc||t.byteLength!==16)return Fe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Os(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;r&&(s=r);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new _S),c.expandKey(t);const u=o;return this.currentResult=c.decrypt(l.buffer,0,s),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,s,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,n));this.key=t,this.fastAesKey=new ES(this.subtle,t,n)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new vS(this.subtle,new Uint8Array(s),n).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(Fe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,n)))}onWebCryptoError(e,t,s,n){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,n);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%xS;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(Fe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const od=Math.pow(2,17);class bS{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new Ti({type:me.NETWORK_ERROR,details:M.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,r=n.fLoader,o=n.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l(ld(e));return}else e.gap=!1;const c=this.loader=r?new r(n):new o(n),u=ad(e);e.loader=c;const h=nd(n.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:od};e.stats=c.stats;const d={onSuccess:(g,m,p,y)=>{this.resetLoader(e,c);let _=g.data;p.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(_.slice(0,16)),_=_.slice(16)),a({frag:e,part:null,payload:_,networkDetails:y})},onError:(g,m,p,y)=>{this.resetLoader(e,c),l(new Ti({type:me.NETWORK_ERROR,details:M.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ke({url:s,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:p,stats:y}))},onAbort:(g,m,p)=>{this.resetLoader(e,c),l(new Ti({type:me.NETWORK_ERROR,details:M.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:p,stats:g}))},onTimeout:(g,m,p)=>{this.resetLoader(e,c),l(new Ti({type:me.NETWORK_ERROR,details:M.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:p,stats:g}))}};t&&(d.onProgress=(g,m,p,y)=>t({frag:e,part:null,payload:p,networkDetails:y})),c.load(u,f,d)})}loadPart(e,t,s){this.abort();const n=this.config,r=n.fLoader,o=n.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(ld(e,t));return}const c=this.loader=r?new r(n):new o(n),u=ad(e,t);e.loader=c;const h=nd(n.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:od};t.stats=c.stats,c.load(u,f,{onSuccess:(d,g,m,p)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const y={frag:e,part:t,payload:d.data,networkDetails:p};s(y),a(y)},onError:(d,g,m,p)=>{this.resetLoader(e,c),l(new Ti({type:me.NETWORK_ERROR,details:M.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ke({url:u.url,data:void 0},d),error:new Error(`HTTP Error ${d.code} ${d.text}`),networkDetails:m,stats:p}))},onAbort:(d,g,m)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new Ti({type:me.NETWORK_ERROR,details:M.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:m,stats:d}))},onTimeout:(d,g,m)=>{this.resetLoader(e,c),l(new Ti({type:me.NETWORK_ERROR,details:M.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:m,stats:d}))}})})}updateStatsFromPart(e,t){const s=e.stats,n=t.stats,r=n.total;if(s.loaded+=n.loaded,r){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(s.loaded/r),l),h=(l-c)*Math.round(s.loaded/c);s.total=s.loaded+h}else s.total=Math.max(s.loaded,s.total);const o=s.loading,a=n.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function ad(i,e=null){const t=e||i,s={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(oe(n)&&oe(r)){var o;let a=n,l=r;if(i.sn==="initSegment"&&AS((o=i.decryptdata)==null?void 0:o.method)){const c=r-n;c%16&&(l=r+(16-c%16)),n!==0&&(s.resetIV=!0,a=n-16)}s.rangeStart=a,s.rangeEnd=l}return s}function ld(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),s={type:me.MEDIA_ERROR,details:M.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(s.part=e),(e||i).stats.aborted=!0,new Ti(s)}function AS(i){return i==="AES-128"||i==="AES-256"}class Ti extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class $p extends Vs{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class eh{constructor(e,t,s,n=0,r=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Vo(),this.buffering={audio:Vo(),video:Vo(),audiovideo:Vo()},this.level=e,this.sn=t,this.id=s,this.size=n,this.part=r,this.partial=o}}function Vo(){return{start:0,executeStart:0,executeEnd:0,end:0}}const cd={length:0,start:()=>0,end:()=>0};class xe{static isBuffered(e,t){if(e){const s=xe.getBuffered(e);for(let n=s.length;n--;)if(t>=s.start(n)&&t<=s.end(n))return!0}return!1}static bufferedRanges(e){if(e){const t=xe.getBuffered(e);return xe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const n=xe.bufferedRanges(e);if(n.length)return xe.bufferedInfo(n,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((u,h)=>u.start-h.start||h.end-u.end);let n=-1,r=[];if(s)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(n=u);const h=r.length;if(h){const f=r[h-1].end;e[u].start-f<s?e[u].end>f&&(r[h-1].end=e[u].end):r.push(e[u])}else r.push(e[u])}else r=e;let o=0,a,l=t,c=t;for(let u=0;u<r.length;u++){const h=r[u].start,f=r[u].end;if(n===-1&&t>=h&&t<=f&&(n=u),t+s>=h&&t<f)l=h,c=f,o=c-t;else if(t+s<h){a=h;break}}return{len:o,start:l||0,end:c||0,nextStart:a,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||cd}catch(t){return Fe.log("failed to get media.buffered",t),cd}}}const Up=/\{\$([a-zA-Z0-9-_]+)\}/g;function ud(i){return Up.test(i)}function Wc(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(Up,s=>{const n=s.substring(2,s.length-1),r=t==null?void 0:t[n];return r===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),s):r})}return e}function hd(i,e,t){let s=i.variableList;s||(i.variableList=s={});let n,r;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(n))r=o.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${t}"`)}catch(o){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else n=e.NAME,r=e.VALUE;n in s?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):s[n]=r||""}function LS(i,e,t){const s=e.IMPORT;if(t&&s in t){let n=i.variableList;n||(i.variableList=n={}),n[s]=t[s]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const IS=/^(\d+)x(\d+)$/,fd=/(.+?)=(".*?"|.*?)(?:,|$)/g;class nt{constructor(e,t){typeof e=="string"&&(e=nt.parseAttrList(e,t)),ze(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)s[n]=parseInt(t.slice(n*2,n*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((n,r)=>(n[r.toLowerCase()]=!0,n),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=IS.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const n={},r='"';for(fd.lastIndex=0;(s=fd.exec(e))!==null;){const o=s[1].trim();let a=s[2];const l=a.indexOf(r)===0&&a.lastIndexOf(r)===a.length-1;let c=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))a=Wc(t,a);else if(!c&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Fe.warn(`${e}: attribute ${o} is missing quotes`)}n[o]=a}return n}}const RS="com.apple.hls.interstitial";function kS(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function CS(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class Bp{constructor(e,t,s=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(n=t==null?void 0:t.tagOrder)!=null?n:s,t){const r=t.attr;for(const o in r)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==r[o]){Fe.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=ze(new nt({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);oe(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Fe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(oe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===RS}get isValid(){return!!this.id&&!this._badValueForSameId&&oe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const wS=10;class DS{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?oe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||wS}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function sr(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function th(i){switch(i){case"AES-128":case"AES-256":return ji.cbc;case"AES-256-CTR":return ji.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function sh(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function qc(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function PS(i){const e=qc(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function OS(i){const e=function(s,n,r){const o=s[n];s[n]=s[r],s[r]=o};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function MS(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),n=s[s.length-1].split(",");if(n.length===2){const r=n[0]==="base64",o=n[1];r?(s.splice(-1,1),t=sh(o)):t=PS(o)}}return t}const Ba=typeof self<"u"?self:void 0;var lt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},es={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function fa(i){switch(i){case es.FAIRPLAY:return lt.FAIRPLAY;case es.PLAYREADY:return lt.PLAYREADY;case es.WIDEVINE:return lt.WIDEVINE;case es.CLEARKEY:return lt.CLEARKEY}}function Kl(i){switch(i){case lt.FAIRPLAY:return es.FAIRPLAY;case lt.PLAYREADY:return es.PLAYREADY;case lt.WIDEVINE:return es.WIDEVINE;case lt.CLEARKEY:return es.CLEARKEY}}function Or(i){const{drmSystems:e,widevineLicenseUrl:t}=i,s=e?[lt.FAIRPLAY,lt.WIDEVINE,lt.PLAYREADY,lt.CLEARKEY].filter(n=>!!e[n]):[];return!s[lt.WIDEVINE]&&t&&s.push(lt.WIDEVINE),s}const Gp=function(i){return Ba!=null&&(i=Ba.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function FS(i,e,t,s){let n;switch(i){case lt.FAIRPLAY:n=["cenc","sinf"];break;case lt.WIDEVINE:case lt.PLAYREADY:n=["cenc"];break;case lt.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return NS(n,e,t,s)}function NS(i,e,t,s){return[{initDataTypes:i,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function $S(i){var e;return i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function US(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=sh(a).subarray(0,16);return OS(l),l}}return null}let Ko={};class ml{static clearKeyUriToKeyIdMap(){Ko={}}constructor(e,t,s,n=[1],r=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=n,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!sr(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(Ep(o)))}matches(e){var t,s;return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&e.keyFormatVersions.join(",")===this.keyFormatVersions.join(",")&&((t=e.iv)==null?void 0:t.join(","))===((s=this.iv)==null?void 0:s.join(","))}isSupported(){if(this.method){if(sr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case es.FAIRPLAY:case es.WIDEVINE:case es.PLAYREADY:case es.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(sr(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Fe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const s=BS(e);return new ml(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.pssh&&this.keyId)return this;const t=MS(this.uri);if(t)switch(this.keyFormat){case es.WIDEVINE:if(this.pssh=t,!this.keyId&&t.length>=22){const s=t.length-22;this.keyId=t.subarray(s,s+16)}break;case es.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=KE(s,null,t),this.keyId=US(t);break}default:{let s=t.subarray(0,16);if(s.length!==16){const n=new Uint8Array(16);n.set(s,16-s.length),s=n}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s=Ko[this.uri];if(!s){const n=Object.keys(Ko).length%Number.MAX_SAFE_INTEGER;s=new Uint8Array(16),new DataView(s.buffer,12,4).setUint32(0,n),Ko[this.uri]=s}this.keyId=s}return this}}function BS(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const dd=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,gd=/#EXT-X-MEDIA:(.*)/g,GS=/^#EXT(?:INF|-X-TARGETDURATION):/m,zl=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),HS=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class ni{static findGroup(e,t){for(let s=0;s<e.length;s++){const n=e[s];if(n.id===t)return n}}static resolve(e,t){return qu.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return GS.test(e)}static parseMasterPlaylist(e,t){const s=ud(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},r=[];dd.lastIndex=0;let o;for(;(o=dd.exec(e))!=null;)if(o[1]){var a;const c=new nt(o[1],n),u=Wc(n,o[2]),h={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:ni.resolve(u,t)},f=c.decimalResolution("RESOLUTION");f&&(h.width=f.width,h.height=f.height),yd(c.CODECS,h);const d=c["SUPPLEMENTAL-CODECS"];d&&(h.supplemental={},yd(d,h.supplemental)),(a=h.unknownCodecs)!=null&&a.length||r.push(h),n.levels.push(h)}else if(o[3]){const c=o[3],u=o[4];switch(c){case"SESSION-DATA":{const h=new nt(u,n),f=h["DATA-ID"];f&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[f]=h);break}case"SESSION-KEY":{const h=md(u,t,n);h.encrypted&&h.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(h)):Fe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const h=new nt(u,n);hd(n,h,t)}break}case"CONTENT-STEERING":{const h=new nt(u,n);n.contentSteering={uri:ni.resolve(h["SERVER-URI"],t),pathwayId:h["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=pd(u);break}}}const l=r.length>0&&r.length<n.levels.length;return n.levels=l?r:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,s){let n;const r={},o=s.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(gd.lastIndex=0;(n=gd.exec(e))!==null;){const c=new nt(n[1],s),u=c.TYPE;if(u){const h=a[u],f=r[u]||[];r[u]=f;const d=c.LANGUAGE,g=c["ASSOC-LANGUAGE"],m=c.CHANNELS,p=c.CHARACTERISTICS,y=c["INSTREAM-ID"],_={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||d||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:d,url:c.URI?ni.resolve(c.URI,t):""};if(g&&(_.assocLang=g),m&&(_.channels=m),p&&(_.characteristics=p),y&&(_.instreamId=y),h!=null&&h.length){const T=ni.findGroup(h,_.groupId)||h[0];vd(_,T,"audioCodec"),vd(_,T,"textCodec")}f.push(_)}}return r}static parseLevelPlaylist(e,t,s,n,r,o){var a;const l={url:t},c=new DS(t),u=c.fragments,h=[];let f=null,d=0,g=0,m=0,p=0,y=0,_=null,T=new Gl(n,l),E,S,R,x=-1,L=!1,A=null,k;if(zl.lastIndex=0,c.m3u8=e,c.hasVariableRefs=ud(e),((a=zl.exec(e))==null?void 0:a[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(E=zl.exec(e))!==null;){L&&(L=!1,T=new Gl(n,l),T.playlistOffset=m,T.setStart(m),T.sn=d,T.cc=p,y&&(T.bitrate=y),T.level=s,f&&(T.initSegment=f,f.rawProgramDateTime&&(T.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),A&&(T.setByteRange(A),A=null)));const X=E[1];if(X){T.duration=parseFloat(X);const q=(" "+E[2]).slice(1);T.title=q||null,T.tagList.push(q?["INF",X,q]:["INF",X])}else if(E[3]){if(oe(T.duration)){T.playlistOffset=m,T.setStart(m),R&&_d(T,R,c),T.sn=d,T.level=s,T.cc=p,u.push(T);const q=(" "+E[3]).slice(1);T.relurl=Wc(c,q),Yc(T,_,h),_=T,m+=T.duration,d++,g=0,L=!0}}else{if(E=E[0].match(HS),!E){Fe.warn("No matches on slow regex match for level playlist!");continue}for(S=1;S<E.length&&E[S]===void 0;S++);const q=(" "+E[S]).slice(1),G=(" "+E[S+1]).slice(1),H=E[S+2]?(" "+E[S+2]).slice(1):null;switch(q){case"BYTERANGE":_?T.setByteRange(G,_):T.setByteRange(G);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=G,T.tagList.push(["PROGRAM-DATE-TIME",G]),x===-1&&(x=u.length);break;case"PLAYLIST-TYPE":c.type&&gi(c,q,E),c.type=G.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?gi(c,q,E):u.length>0&&Ed(c,q,E),d=c.startSN=parseInt(G);break;case"SKIP":{c.skippedSegments&&gi(c,q,E);const K=new nt(G,c),ae=K.decimalInteger("SKIPPED-SEGMENTS");if(oe(ae)){c.skippedSegments+=ae;for(let z=ae;z--;)u.push(null);d+=ae}const fe=K.enumeratedString("RECENTLY-REMOVED-DATERANGES");fe&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(fe.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&gi(c,q,E),c.targetduration=Math.max(parseInt(G),1);break;case"VERSION":c.version!==null&&gi(c,q,E),c.version=parseInt(G);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||gi(c,q,E),c.live=!1;break;case"#":(G||H)&&T.tagList.push(H?[G,H]:[G]);break;case"DISCONTINUITY":p++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([q]);break;case"BITRATE":T.tagList.push([q,G]),y=parseInt(G)*1e3,oe(y)?T.bitrate=y:y=0;break;case"DATERANGE":{const K=new nt(G,c),ae=new Bp(K,c.dateRanges[K.ID],c.dateRangeTagCount);c.dateRangeTagCount++,ae.isValid||c.skippedSegments?c.dateRanges[ae.id]=ae:Fe.warn(`Ignoring invalid DATERANGE tag: "${G}"`),T.tagList.push(["EXT-X-DATERANGE",G]);break}case"DEFINE":{{const K=new nt(G,c);"IMPORT"in K?LS(c,K,o):hd(c,K,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?gi(c,q,E):u.length>0&&Ed(c,q,E),c.startCC=p=parseInt(G);break;case"KEY":{const K=md(G,t,c);if(K.isSupported()){if(K.method==="NONE"){R=void 0;break}R||(R={});const ae=R[K.keyFormat];ae!=null&&ae.matches(K)||(ae&&(R=ze({},R)),R[K.keyFormat]=K)}else Fe.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${G}"`);break}case"START":c.startTimeOffset=pd(G);break;case"MAP":{const K=new nt(G,c);if(T.duration){const ae=new Gl(n,l);Td(ae,K,s,R),f=ae,T.initSegment=f,f.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=f.rawProgramDateTime)}else{const ae=T.byteRangeEndOffset;if(ae){const fe=T.byteRangeStartOffset;A=`${ae-fe}@${fe}`}else A=null;Td(T,K,s,R),f=T,L=!0}f.cc=p;break}case"SERVER-CONTROL":{k&&gi(c,q,E),k=new nt(G),c.canBlockReload=k.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=k.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&k.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=k.optionalFloat("PART-HOLD-BACK",0),c.holdBack=k.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&gi(c,q,E);const K=new nt(G);c.partTarget=K.decimalFloatingPoint("PART-TARGET");break}case"PART":{let K=c.partList;K||(K=c.partList=[]);const ae=g>0?K[K.length-1]:void 0,fe=g++,z=new nt(G,c),Y=new wE(z,T,l,fe,ae);K.push(Y),T.duration+=Y.duration;break}case"PRELOAD-HINT":{const K=new nt(G,c);c.preloadHint=K;break}case"RENDITION-REPORT":{const K=new nt(G,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(K);break}default:Fe.warn(`line parsed but not handled: ${E}`);break}}}_&&!_.relurl?(u.pop(),m-=_.duration,c.partList&&(c.fragmentHint=_)):c.partList&&(Yc(T,_,h),T.cc=p,c.fragmentHint=T,R&&_d(T,R,c)),c.targetduration||(c.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const w=u.length,P=u[0],B=u[w-1];if(m+=c.skippedSegments*c.targetduration,m>0&&w&&B){c.averagetargetduration=m/w;const X=B.sn;c.endSN=X!=="initSegment"?X:0,c.live||(B.endList=!0),x>0&&(KS(u,x),P&&h.unshift(P))}return c.fragmentHint&&(m+=c.fragmentHint.duration),c.totalduration=m,h.length&&c.dateRangeTagCount&&P&&Hp(h,c),c.endCC=p,c}}function Hp(i,e){const t=i.length;if(!t)return;const s=i[t-1],n=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let o=r.length;o--;){const a=e.dateRanges[r[o]],l=a.startDate.getTime();a.tagAnchor=s.ref;for(let c=t;c--;){const u=VS(e,l,i,c,n);if(u!==-1){a.tagAnchor=e.fragments[u].ref;break}}}}function VS(i,e,t,s,n){const r=t[s];if(r){const a=r.programDateTime;if(e>=a||s===0){var o;const l=(((o=t[s+1])==null?void 0:o.start)||n)-r.start;if(e<=a+l*1e3){const c=t[s].sn-i.startSN,u=i.fragments;if(u.length>t.length){const f=(t[s+1]||u[u.length-1]).sn-i.startSN;for(let d=f;d>c;d--){const g=u[d].programDateTime;if(e>=g&&e<g+u[d].duration*1e3)return d}}return c}}}return-1}function md(i,e,t){var s,n;const r=new nt(i,t),o=(s=r.METHOD)!=null?s:"",a=r.URI,l=r.hexadecimalInteger("IV"),c=r.KEYFORMATVERSIONS,u=(n=r.KEYFORMAT)!=null?n:"identity";a&&r.IV&&!l&&Fe.error(`Invalid IV: ${r.IV}`);const h=a?ni.resolve(a,e):"",f=(c||"1").split("/").map(Number).filter(Number.isFinite);return new ml(o,h,u,f,l,r.KEYID)}function pd(i){const t=new nt(i).decimalFloatingPoint("TIME-OFFSET");return oe(t)?t:null}function yd(i,e){let t=(i||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const n=t.filter(r=>Xu(r,s));n.length&&(e[`${s}Codec`]=n.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>n.indexOf(r)===-1))}),e.unknownCodecs=t}function vd(i,e,t){const s=e[t];s&&(i[t]=s)}function KS(i,e){let t=i[e];for(let s=e;s--;){const n=i[s];if(!n)return;n.programDateTime=t.programDateTime-n.duration*1e3,t=n}}function Yc(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function Td(i,e,t,s){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",s&&(i.levelkeys=s),i.initSegment=null}function _d(i,e,t){i.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&s.push(i)}function gi(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Ed(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Wl(i,e){const t=e.startPTS;if(oe(t)){let s=0,n;e.sn>i.sn?(s=t-i.start,n=i):(s=i.start-t,n=e),n.duration!==s&&n.setDuration(s)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function Vp(i,e,t,s,n,r){s-t<=0&&(Fe.warn("Fragment should have a positive duration",e),s=t+e.duration,r=n+e.duration);let a=t,l=s;const c=e.startPTS,u=e.endPTS;if(oe(c)){const p=Math.abs(c-t);oe(e.deltaPTS)?e.deltaPTS=Math.max(p,e.deltaPTS):e.deltaPTS=p,a=Math.max(t,c),t=Math.min(t,c),n=Math.min(n,e.startDTS),l=Math.min(s,u),s=Math.max(s,u),r=Math.max(r,e.endDTS)}const h=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=a,e.startDTS=n,e.endPTS=s,e.minEndPTS=l,e.endDTS=r;const f=e.sn;if(!i||f<i.startSN||f>i.endSN)return 0;let d;const g=f-i.startSN,m=i.fragments;for(m[g]=e,d=g;d>0;d--)Wl(m[d],m[d-1]);for(d=g;d<m.length-1;d++)Wl(m[d],m[d+1]);return i.fragmentHint&&Wl(m[m.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,h}function zS(i,e){if(i===e)return;let t=null;const s=i.fragments;for(let c=s.length-1;c>=0;c--){const u=s[c].initSegment;if(u){t=u;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let n;YS(i,e,(c,u,h,f)=>{if((!e.startCC||e.skippedSegments)&&u.cc!==c.cc){const d=c.cc-u.cc;for(let g=h;g<f.length;g++)f[g].cc+=d;e.endCC=f[f.length-1].cc}oe(c.startPTS)&&oe(c.endPTS)&&(u.setStart(u.startPTS=c.startPTS),u.startDTS=c.startDTS,u.maxStartPTS=c.maxStartPTS,u.endPTS=c.endPTS,u.endDTS=c.endDTS,u.minEndPTS=c.minEndPTS,u.setDuration(c.endPTS-c.startPTS),u.duration&&(n=u),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(u.elementaryStreams=c.elementaryStreams),u.loader=c.loader,c.hasStats&&(u.stats=c.stats),c.initSegment&&(u.initSegment=c.initSegment,t=c.initSegment)});const r=e.fragments,o=e.fragmentHint?r.concat(e.fragmentHint):r;if(t&&o.forEach(c=>{var u;c&&(!c.initSegment||c.initSegment.relurl===((u=t)==null?void 0:u.relurl))&&(c.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=r.some(c=>!c),e.deltaUpdateFailed){Fe.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)r.shift();e.startSN=r[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=WS(i.dateRanges,e));const c=i.fragments.filter(u=>u.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let u=1;u<o.length;u++)o[u].programDateTime===null&&Yc(o[u],o[u-1],c);Hp(c,e)}e.endCC=r[r.length-1].cc}if(!e.startCC){var a;const c=Wp(i,e.startSN-1);e.startCC=(a=c==null?void 0:c.cc)!=null?a:r[0].cc}qS(i.partList,e.partList,(c,u)=>{u.elementaryStreams=c.elementaryStreams,u.stats=c.stats}),n?Vp(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):Kp(i,e),r.length&&(e.totalduration=e.edge-r[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const l=e.advancedDateTime;if(e.advanced&&l){const c=e.edge;e.driftStart||(e.driftStartTime=l,e.driftStart=c),e.driftEndTime=l,e.driftEnd=c}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function WS(i,e){const{dateRanges:t,recentlyRemovedDateranges:s}=e,n=ze({},i);s&&s.forEach(a=>{delete n[a]});const o=Object.keys(n).length;return o&&Object.keys(t).forEach(a=>{const l=n[a],c=new Bp(t[a].attr,l);c.isValid?(n[a]=c,l||(c.tagOrder+=o)):Fe.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${tt(t[a].attr)}"`)}),n}function qS(i,e,t){if(i&&e){let s=0;for(let n=0,r=i.length;n<=r;n++){const o=i[n],a=e[n+s];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):s--}}}function YS(i,e,t){const s=e.skippedSegments,n=Math.max(i.startSN,e.startSN)-e.startSN,r=(i.fragmentHint?1:0)+(s?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,o=e.startSN-i.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let c=n;c<=r;c++){const u=l[o+c];let h=a[c];if(s&&!h&&u&&(h=e.fragments[c]=u),u&&h){if(t(u,h,c,a),u.url&&u.url!==h.url){e.playlistParsingError=Sd(`media sequence mismatch ${h.sn}:`,i,e,u,h);return}else if(u.cc!==h.cc){e.playlistParsingError=Sd(`discontinuity sequence mismatch (${u.cc}!=${h.cc})`,i,e,u,h);return}}}}function Sd(i,e,t,s,n){return new Error(`${i} ${n.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Kp(i,e,t=!0){const s=e.startSN+e.skippedSegments-i.startSN,n=i.fragments,r=s>=0;let o=0;if(r&&s<n.length)o=n[s].start;else if(r&&e.startSN===i.endSN+1)o=i.fragmentEnd;else if(r&&t)o=i.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=i.fragmentStart;else return;jc(e,o)}function jc(i,e){if(e){const t=i.fragments;for(let s=i.skippedSegments;s<t.length;s++)t[s].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function zp(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const s=i.fragments,n=4;if(s.length&&t*n>e){const r=s[s.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function Wp(i,e,t){if(!i)return null;let s=i.fragments[e-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===e)?s:e<i.startSN&&t&&t.sn===e?t:null}function xd(i,e,t){return i?qp(i.partList,e,t):null}function qp(i,e,t){if(i)for(let s=i.length;s--;){const n=i[s];if(n.index===t&&n.fragment.sn===e)return n}return null}function Yp(i){i.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(n=>{n.level=t,n.initSegment&&(n.initSegment.level=t)})})}function Wr(i,e){for(let s=0,n=i.length;s<n;s++){var t;if(((t=i[s])==null?void 0:t.cc)===e)return i[s]}return null}function jS(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function bd(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function jp(i,e){const t=e.fragments;for(let s=0,n=t.length;s<n;s++)bd(t[s],i);e.fragmentHint&&bd(e.fragmentHint,i),e.alignedSliding=!0}function XS(i,e){i&&(Xp(e,i),e.alignedSliding||Ga(e,i),!e.alignedSliding&&!e.skippedSegments&&Kp(i,e,!1))}function Xp(i,e){if(!jS(e,i))return;const t=Math.min(e.endCC,i.endCC),s=Wr(e.fragments,t),n=Wr(i.fragments,t);if(!s||!n)return;Fe.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=s.start-n.start;jp(r,i)}function Ga(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,s=e.fragments;if(!t.length||!s.length)return;let n,r;const o=Math.min(e.endCC,i.endCC);e.startCC<o&&i.startCC<o&&(n=Wr(s,o),r=Wr(t,o)),(!n||!r)&&(n=s[Math.floor(s.length/2)],r=Wr(t,n.cc)||t[Math.floor(t.length/2)]);const a=n.programDateTime,l=r.programDateTime;if(!a||!l)return;const c=(l-a)/1e3-(r.start-n.start);jp(c,i)}const QS={toString:function(i){let e="";const t=i.length;for(let s=0;s<t;s++)e+=`[${i.start(s).toFixed(3)}-${i.end(s).toFixed(3)}]`;return e}},V={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class ih extends $p{constructor(e,t,s,n,r){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=V.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:c,state:u}=this,h=l?l.currentTime:0,f=xe.bufferInfo(c||l,h,o.maxBufferHole),d=!f.len;if(this.log(`Media seeking to ${oe(h)?h.toFixed(3):h}, state: ${u}, ${d?"out of":"in"} buffer`),this.state===V.ENDED)this.resetLoadingState();else if(a){const g=o.maxFragLookUpTolerance,m=a.start-g,p=a.start+a.duration+g;if(d||p<f.start||m>f.end){const y=h>p;(h<m||y)&&(y&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(h,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(h>g&&(this.lastCurrentTime=h),!this.loadingParts){const m=Math.max(f.end,h),p=this.shouldLoadParts(this.getLevelDetails(),m);p&&(this.log(`LL-Part loading ON after seeking to ${h.toFixed(2)} with buffer @${m.toFixed(2)}`),this.loadingParts=p)}}this.hls.hasEnoughToStart||(this.log(`Setting ${d?"startPosition":"nextLoadPosition"} to ${h} for seek without enough to start`),this.nextLoadPosition=h,d&&(this.startPosition=h)),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new bS(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Zu(e.config)}registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===V.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=V.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,n=this.config.timelineOffset||0;if(s<=n)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=xe.bufferedInfo(r,e.start,0));const o=e.nextStart;if(o&&o>n&&o<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return xe.isBuffered(this.media,u.start+u.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),s.addEventListener("seeking",this.onMediaSeeking),s.addEventListener("ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===V.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),n.removeEventListener("seeking",this.onMediaSeeking),n.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=V.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const n=r=>{const o=r.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(o,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,s,n).then(r=>{if(!r)return;const o=this.state,a=r.frag;if(this.fragContextChanged(a)){(o===V.FRAG_LOADING||!this.fragCurrent&&o===V.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=V.IDLE);return}"payload"in r&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(v.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===V.STOPPED||this.state===V.ERROR||(this.warn(`Frag error: ${(r==null?void 0:r.message)||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===Tt.APPENDING){const r=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,r),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===Tt.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:s};this.hls.trigger(v.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const n=s==null?void 0:s.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:n}=this,{frag:r,payload:o}=s,a=r.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&sr(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,th(a.method)).catch(c=>{throw n.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:r}),c}).then(c=>{const u=self.performance.now();return n.trigger(v.FRAG_DECRYPTED,{frag:r,payload:c,stats:{tstart:l,tdecrypt:u}}),s.payload=c,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===V.STOPPED||this.state===V.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==V.STOPPED&&(this.state=V.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?QS.toString(xe.getBuffered(s)):"(detached)"})`),pt(e)){var n;if(e.type!==de.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=V.IDLE;return}}const r=(n=this.levels)==null?void 0:n[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=V.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:n,partsLoaded:r}=e,o=!r||r.length===0||r.some(l=>!l),a=new eh(s.level,s.sn,s.stats.chunkCount+1,0,n?n.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,n){var r;this.fragCurrent=e;const o=t==null?void 0:t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;e.encrypted&&!((r=e.decryptdata)!=null&&r.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=V.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(v.KEY_LOADED,f),this.state===V.KEY_LOADING&&(this.state=V.IDLE),f}),this.hls.trigger(v.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(pt(e)&&(!l||e.sn!==l.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=f)}if(s=Math.max(e.start,s||0),this.loadingParts&&pt(e)){const f=o.partList;if(f&&n){s>e.end&&o.fragmentHint&&(e=o.fragmentHint);const d=this.getNextPart(f,e,s);if(d>-1){const g=f[d];e=this.fragCurrent=g.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${g.index} (${d}/${f.length-1}) of ${this.fragInfo(e,!1,g)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=V.FRAG_LOADING;let m;return a?m=a.then(p=>!p||this.fragContextChanged(p.frag)?null:this.doFragPartsLoad(e,g,t,n)).catch(p=>this.handleFragLoadError(p)):m=this.doFragPartsLoad(e,g,t,n).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(v.FRAG_LOADING,{frag:e,part:g,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):m}else if(!e.url||this.loadedEndOfParts(f,s))return Promise.resolve(null)}}if(pt(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=o.partList)==null?void 0:c.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${o?"["+o.startSN+"-"+o.endSN+"]":""}, target: ${parseFloat(s.toFixed(3))}`),oe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=V.FRAG_LOADING;const u=this.config.progressive;let h;return u&&a?h=a.then(f=>!f||this.fragContextChanged(f==null?void 0:f.frag)?null:this.fragmentLoader.load(e,n)).catch(f=>this.handleFragLoadError(f)):h=Promise.all([this.fragmentLoader.load(e,u?n:void 0),a]).then(([f])=>(!u&&f&&n&&n(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(v.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(e,t,s,n){return new Promise((r,o)=>{var a;const l=[],c=(a=s.details)==null?void 0:a.partList,u=h=>{this.fragmentLoader.loadPart(e,h,n).then(f=>{l[h.index]=f;const d=f.part;this.hls.trigger(v.FRAG_LOADED,f);const g=xd(s.details,e.sn,h.index+1)||qp(c,e.sn,h.index+1);if(g)u(g);else return r({frag:e,part:d,partsLoaded:l})}).catch(o)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===M.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(v.ERROR,t)}else this.hls.trigger(v.ERROR,{type:me.OTHER_ERROR,details:M.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==V.PARSING){!this.fragCurrent&&this.state!==V.STOPPED&&this.state!==V.ERROR&&(this.state=V.IDLE);return}const{frag:s,part:n,level:r}=t,o=self.performance.now();s.stats.parsing.end=o,n&&(n.stats.parsing.end=o);const a=this.getLevelDetails(),c=a&&s.sn>a.endSN||this.shouldLoadParts(a,s.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(s,n,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var s;const r=e.partList[0],o=r.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=o){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:n,sn:r,part:o}=e;if(!(t!=null&&t[n]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const a=t[n],l=a.details,c=o>-1?xd(l,r,o):null,u=c?c.fragment:Wp(l,r,s);return u?(s&&s!==u&&(u.stats=s.stats),{frag:u,part:c,level:a}):null}bufferFragmentData(e,t,s,n,r){var o;if(!e||this.state!==V.PARSING)return;const{data1:a,data2:l}=e;let c=a;if(a&&l&&(c=Os(a,l)),!((o=c)!=null&&o.length))return;const u=this.initPTS[t.cc],h=u?-u.baseTime/u.timescale:void 0,f={type:e.type,frag:t,part:s,chunkMeta:n,offset:h,parent:t.type,data:c};if(this.hls.trigger(v.BUFFER_APPENDING,f),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!xe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,n=xe.bufferInfo(t,s,0),r=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),a=Math.max(Math.min(e.start-o,n.end-o),s+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var s;const n=this.getLoadPosition();if(!oe(n))return null;const o=this.lastCurrentTime>n||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,o)}getFwdBufferInfoAtPos(e,t,s,n){const r=xe.bufferInfo(e,t,n);if(r.len===0&&r.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,s);if(o&&(r.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(r.nextStart,o.end)-t,n);return xe.bufferInfo(e,t,a)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,n=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-t*3,s.maxMaxBufferLength/2,n);return r>=n?(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=de.MAIN){var s;const n=(s=this.fragmentTracker)==null?void 0:s.getAppendedFrag(e,t);return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const s=t.fragments,n=s.length;if(!n)return null;const{config:r}=this,o=s[0].start,a=r.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const h=r.initialLiveManifestSize;if(n<h)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${h})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var c;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const f=this.hls.startPosition,d=this.hls.liveSyncPosition,g=l?(f!==-1&&f>=o?f:d)||l.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${d} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=o&&(l=s[0]);if(!l){const h=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,h,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const h=l.sn-t.startSN;u=this.filterReplacedPrimary(s[h+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===Tt.OK||s===Tt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,n,r){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&s.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,n,0);if(a!==null&&s.len+a.len>=r){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(Ad(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Ad(this.config)&&e.type!==de.SUBTITLE){const s=this.hls.interstitialsManager,n=s==null?void 0:s.bufferingItem;if(n){const o=n.event;if(o){if(o.appendInPlace||Math.abs(e.start-n.start)>1||n.start===0)return null}else if(e.end<=n.start&&(t==null?void 0:t.live)===!1||e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}const r=s==null?void 0:s.playerQueue;if(r)for(let o=r.length;o--;){const a=r[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let n=-1,r=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(o=o&&!c.independent,n>-1&&s<c.start)break;const u=c.loaded;u?n=-1:(r||(c.independent||o)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${c.start}`),n=a),r=u}return n}loadedEndOfParts(e,t){let s;for(let n=e.length;n--;){if(s=e[n],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let n=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),n=fS(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const o=t[r-e.startSN];s.cc===o.cc&&(n=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=Np(e,s.cc,s.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(n=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,s){const{config:n}=this;let{fragPrevious:r}=this,{fragments:o,endSN:a}=s;const{fragmentHint:l}=s,{maxFragLookUpTolerance:c}=n,u=s.partList,h=!!(this.loadingParts&&u!=null&&u.length&&l);h&&l&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let f;if(e<t){var d;const m=e<this.lastCurrentTime||e>t-c||(d=this.media)!=null&&d.paused||!this.startFragRequested?0:c;f=wn(r,o,e,m)}else f=o[o.length-1];if(f){const g=f.sn-s.startSN,m=this.fragmentTracker.getState(f);if((m===Tt.OK||m===Tt.PARTIAL&&f.gap)&&(r=f),r&&f.sn===r.sn&&(!h||u[0].fragment.sn>f.sn||!s.live&&!h)&&r&&f.level===r.level){const y=o[g+1];f.sn<a&&this.fragmentTracker.getState(y)!==Tt.OK?f=y:f=null}}return f}alignPlaylists(e,t,s){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,o=!t,a=e.alignedSliding&&oe(r);if(o||!a&&!r){XS(s,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),l}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const n=this.timelineOffset;if(s===-1){const r=this.startTimeOffset!==null,o=r?this.startTimeOffset:e.startTimeOffset;o!==null&&oe(o)?(s=t+o,o<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${o} found in ${r?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+n}this.nextLoadPosition=s+n}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&pt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==V.FRAG_LOADING_WAITING_RETRY)&&(this.state=V.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const g=this.getCurrentContext(t.chunkMeta);g&&(t.frag=g.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var n;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(n=this.fragCurrent)==null?void 0:n.url}`);return}const r=t.details===M.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(s,!0);const o=t.errorAction,{action:a,flags:l,retryCount:c=0,retryConfig:u}=o||{},h=!!o&&!!u,f=h&&a===Dt.RetryRequest,d=h&&!o.resolved&&l===$s.MoveAllAlternatesMatchingHost;if(!f&&d&&pt(s)&&!s.endList)this.resetFragmentErrors(e),this.treatAsGap(s),o.resolved=!0;else if((f||d)&&c<u.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const g=Ju(u,c);this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${c+1}/${u.maxNumRetry} in ${g}ms`),o.resolved=!0,this.retryDate=self.performance.now()+g,this.state=V.FRAG_LOADING_WAITING_RETRY}else if(u&&o)if(this.resetFragmentErrors(e),c<u.maxNumRetry)!r&&a!==Dt.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else a===Dt.SendAlternateToPenaltyBox?this.state=V.WAITING_LEVEL:this.state=V.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===V.PARSING||this.state===V.PARSED){const t=e.frag,s=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,s),r=n&&n.len>.5;r&&this.reduceMaxBufferLength(n.len,(t==null?void 0:t.duration)||10);const o=!r;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===de.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==V.STOPPED&&(this.state=V.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const n=xe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,s),this.state===V.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==V.STOPPED&&(this.state=V.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,n){const r=s.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const h=u.endPTS-u.startPTS;if(h<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${h})`),l||!1;const f=n?0:Vp(r,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS);return this.hls.trigger(v.LEVEL_PTS_UPDATED,{details:r,level:s,drift:f,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var a;if(s.fragmentError===0&&this.treatAsGap(e,s),((a=this.transmuxer)==null?void 0:a.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=V.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(v.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===de.MAIN?"level":"track"}fragInfo(e,t=!0,s){var n,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((n=t&&!s?e.startPTS:(s||e).start)!=null?n:NaN).toFixed(3)}-${((r=t&&!s?e.endPTS:(s||e).end)!=null?r:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Ad(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class Qp{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=JS(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function JS(i,e){const t=new Uint8Array(e);let s=0;for(let n=0;n<i.length;n++){const r=i[n];t.set(r,s),s+=r.length}return t}var ql={exports:{}},Ld;function ZS(){return Ld||(Ld=1,function(i){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function r(l,c,u,h,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new n(u,h||l,f),g=t?t+c:c;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],d]:l._events[g].push(d):(l._events[g]=d,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new s:delete l._events[c]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,h;if(this._eventsCount===0)return c;for(h in u=this._events)e.call(u,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,d=h.length,g=new Array(d);f<d;f++)g[f]=h[f].fn;return g},a.prototype.listenerCount=function(c){var u=t?t+c:c,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(c,u,h,f,d,g){var m=t?t+c:c;if(!this._events[m])return!1;var p=this._events[m],y=arguments.length,_,T;if(p.fn){switch(p.once&&this.removeListener(c,p.fn,void 0,!0),y){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,u),!0;case 3:return p.fn.call(p.context,u,h),!0;case 4:return p.fn.call(p.context,u,h,f),!0;case 5:return p.fn.call(p.context,u,h,f,d),!0;case 6:return p.fn.call(p.context,u,h,f,d,g),!0}for(T=1,_=new Array(y-1);T<y;T++)_[T-1]=arguments[T];p.fn.apply(p.context,_)}else{var E=p.length,S;for(T=0;T<E;T++)switch(p[T].once&&this.removeListener(c,p[T].fn,void 0,!0),y){case 1:p[T].fn.call(p[T].context);break;case 2:p[T].fn.call(p[T].context,u);break;case 3:p[T].fn.call(p[T].context,u,h);break;case 4:p[T].fn.call(p[T].context,u,h,f);break;default:if(!_)for(S=1,_=new Array(y-1);S<y;S++)_[S-1]=arguments[S];p[T].fn.apply(p[T].context,_)}}return!0},a.prototype.on=function(c,u,h){return r(this,c,u,h,!1)},a.prototype.once=function(c,u,h){return r(this,c,u,h,!0)},a.prototype.removeListener=function(c,u,h,f){var d=t?t+c:c;if(!this._events[d])return this;if(!u)return o(this,d),this;var g=this._events[d];if(g.fn)g.fn===u&&(!f||g.once)&&(!h||g.context===h)&&o(this,d);else{for(var m=0,p=[],y=g.length;m<y;m++)(g[m].fn!==u||f&&!g[m].once||h&&g[m].context!==h)&&p.push(g[m]);p.length?this._events[d]=p.length===1?p[0]:p:o(this,d)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,i.exports=a}(ql)),ql.exports}var ex=ZS(),nh=kE(ex);const fo="1.6.8",ur={};function tx(){return typeof __HLS_WORKER_BUNDLE__=="function"}function sx(){const i=ur[fo];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n={worker:new self.Worker(t),objectURL:t,clientCount:1};return ur[fo]=n,n}function ix(i){const e=ur[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,n={worker:new self.Worker(t),scriptURL:t,clientCount:1};return ur[i]=n,n}function nx(i){const e=ur[i||fo];if(e&&e.clientCount--===1){const{worker:s,objectURL:n}=e;delete ur[i||fo],n&&self.URL.revokeObjectURL(n),s.terminate()}}function Jp(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function rh(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function pl(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function go(i,e){const t=e;let s=0;for(;rh(i,e);){s+=10;const n=pl(i,e+6);s+=n,Jp(i,e+10)&&(s+=10),e+=s}if(s>0)return i.subarray(t,t+s)}function rx(i,e,t,s){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],o=r>>2&15;if(o>12){const d=new Error(`invalid ADTS sampling index:${o}`);i.emit(v.ERROR,v.ERROR,{type:me.MEDIA_ERROR,details:M.FRAG_PARSING_ERROR,fatal:!0,error:d,reason:d.message});return}const a=(r>>6&3)+1,l=e[t+3]>>6&3|(r&1)<<2,c="mp4a.40."+a,u=n[o];let h=o;(a===5||a===29)&&(h-=3);const f=[a<<3|(h&14)>>1,(h&1)<<7|l<<3];return Fe.log(`manifest codec:${s}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${a} sampling index:${o})`),{config:f,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:s}}function Zp(i,e){return i[e]===255&&(i[e+1]&246)===240}function e0(i,e){return i[e+1]&1?7:9}function oh(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function ox(i,e){return e+5<i.length}function Ha(i,e){return e+1<i.length&&Zp(i,e)}function ax(i,e){return ox(i,e)&&Zp(i,e)&&oh(i,e)<=i.length-e}function lx(i,e){if(Ha(i,e)){const t=e0(i,e);if(e+t>=i.length)return!1;const s=oh(i,e);if(s<=t)return!1;const n=e+s;return n===i.length||Ha(i,n)}return!1}function t0(i,e,t,s,n){if(!i.samplerate){const r=rx(e,t,s,n);if(!r)return;ze(i,r)}}function s0(i){return 1024*9e4/i}function cx(i,e){const t=e0(i,e);if(e+t<=i.length){const s=oh(i,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function i0(i,e,t,s,n){const r=s0(i.samplerate),o=s+n*r,a=cx(e,t);let l;if(a){const{frameLength:h,headerLength:f}=a,d=f+h,g=Math.max(0,t+d-e.length);g?(l=new Uint8Array(d-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+d);const m={unit:l,pts:o};return g||i.samples.push(m),{sample:m,length:d,missing:g}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}function ux(i,e){return rh(i,e)&&pl(i,e+6)+10<=i.length-e}function hx(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function Yl(i,e=0,t=1/0){return fx(i,e,t,Uint8Array)}function fx(i,e,t,s){const n=dx(i);let r=1;"BYTES_PER_ELEMENT"in s&&(r=s.BYTES_PER_ELEMENT);const o=gx(i)?i.byteOffset:0,a=(o+i.byteLength)/r,l=(o+e)/r,c=Math.floor(Math.max(0,Math.min(l,a))),u=Math.floor(Math.min(c+Math.max(t,0),a));return new s(n,c,u-c)}function dx(i){return i instanceof ArrayBuffer?i:i.buffer}function gx(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function mx(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=i.data.subarray(1).indexOf(0);if(s===-1)return;const n=Ts(Yl(i.data,1,s)),r=i.data[2+s],o=i.data.subarray(3+s).indexOf(0);if(o===-1)return;const a=Ts(Yl(i.data,3+s,o));let l;return n==="-->"?l=Ts(Yl(i.data,4+s+o)):l=hx(i.data.subarray(4+s+o)),e.mimeType=n,e.pictureType=r,e.description=a,e.data=l,e}function px(i){if(i.size<2)return;const e=Ts(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function yx(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const s=Ts(i.data.subarray(t),!0);t+=s.length+1;const n=Ts(i.data.subarray(t));return{key:i.type,info:s,data:n}}const e=Ts(i.data.subarray(1));return{key:i.type,info:"",data:e}}function vx(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const s=Ts(i.data.subarray(t),!0);t+=s.length+1;const n=Ts(i.data.subarray(t));return{key:i.type,info:s,data:n}}const e=Ts(i.data);return{key:i.type,info:"",data:e}}function Tx(i){return i.type==="PRIV"?px(i):i.type[0]==="W"?vx(i):i.type==="APIC"?mx(i):yx(i)}function _x(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=pl(i,4),s=10;return{type:e,size:t,data:i.subarray(s,s+t)}}const zo=10,Ex=10;function n0(i){let e=0;const t=[];for(;rh(i,e);){const s=pl(i,e+6);i[e+5]>>6&1&&(e+=zo),e+=zo;const n=e+s;for(;e+Ex<n;){const r=_x(i.subarray(e)),o=Tx(r);o&&t.push(o),e+=r.size+zo}Jp(i,e)&&(e+=zo)}return t}function r0(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function Sx(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function ah(i){const e=n0(i);for(let t=0;t<e.length;t++){const s=e[t];if(r0(s))return Sx(s)}}let ds=function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i}({});function ti(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class lh{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Os(this.cachedData,e),this.cachedData=null);let s=go(e,0),n=s?s.length:0,r;const o=this._audioTrack,a=this._id3Track,l=s?ah(s):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&oe(l))&&(this.basePTS=xx(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ds.audioId3,duration:Number.POSITIVE_INFINITY});n<c;){if(this.canParse(e,n)){const u=this.appendFrame(o,e,n);u?(this.frameIndex++,this.lastPTS=u.sample.pts,n+=u.length,r=n):n=c}else ux(e,n)?(s=go(e,n),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ds.audioId3,duration:Number.POSITIVE_INFINITY}),n+=s.length,r=n):n++;if(n===c&&r!==c){const u=e.slice(r);this.cachedData?this.cachedData=Os(this.cachedData,u):this.cachedData=u}}return{audioTrack:o,videoTrack:ti(),id3Track:a,textTrack:ti()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:ti(),id3Track:this._id3Track,textTrack:ti()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const xx=(i,e,t)=>{if(oe(i))return i*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let Wo=null;const bx=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ax=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Lx=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Ix=[0,1,1,4];function o0(i,e,t,s,n){if(t+24>e.length)return;const r=a0(e,t);if(r&&t+r.frameLength<=e.length){const o=r.samplesPerFrame*9e4/r.sampleRate,a=s+n*o,l={unit:e.subarray(t,t+r.frameLength),pts:a,dts:a};return i.config=[],i.channelCount=r.channelCount,i.samplerate=r.sampleRate,i.samples.push(l),{sample:l,length:r.frameLength,missing:0}}}function a0(i,e){const t=i[e+1]>>3&3,s=i[e+1]>>1&3,n=i[e+2]>>4&15,r=i[e+2]>>2&3;if(t!==1&&n!==0&&n!==15&&r!==3){const o=i[e+2]>>1&1,a=i[e+3]>>6,l=t===3?3-s:s===3?3:4,c=bx[l*14+n-1]*1e3,h=Ax[(t===3?0:t===2?1:2)*3+r],f=a===3?1:2,d=Lx[t][s],g=Ix[s],m=d*8*g,p=Math.floor(d*c/h+o)*g;if(Wo===null){const T=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Wo=T?parseInt(T[1]):0}return!!Wo&&Wo<=87&&s===2&&c>=224e3&&a===0&&(i[e+3]=i[e+3]|128),{sampleRate:h,channelCount:f,frameLength:p,samplesPerFrame:m}}}function ch(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function l0(i,e){return e+1<i.length&&ch(i,e)}function Rx(i,e){return ch(i,e)&&4<=i.length-e}function c0(i,e){if(e+1<i.length&&ch(i,e)){const s=a0(i,e);let n=4;s!=null&&s.frameLength&&(n=s.frameLength);const r=e+n;return r===i.length||l0(i,r)}return!1}class kx extends lh{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=go(e,0);let n=(s==null?void 0:s.length)||0;if(c0(e,n))return!1;for(let r=e.length;n<r;n++)if(lx(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return ax(e,t)}appendFrame(e,t,s){t0(e,this.observer,t,s,e.manifestCodec);const n=i0(e,t,s,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const u0=(i,e)=>{let t=0,s=5;e+=s;const n=new Uint32Array(1),r=new Uint32Array(1),o=new Uint8Array(1);for(;s>0;){o[0]=i[e];const a=Math.min(s,8),l=8-a;r[0]=4278190080>>>24+l<<l,n[0]=(o[0]&r[0])>>l,t=t?t<<a|n[0]:n[0],e+=1,s-=a}return t};class Cx extends lh{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const n=h0(e,t,s,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const t=go(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&ah(t)!==void 0&&u0(e,s)<16}}function h0(i,e,t,s,n){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const a=[48e3,44100,32e3][r],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+r]*2;if(t+u>e.length)return-1;const h=e[t+6]>>5;let f=0;h===2?f+=2:(h&1&&h!==1&&(f+=2),h&4&&(f+=2));const d=(e[t+6]<<8|e[t+7])>>12-f&1,m=[2,1,2,3,3,4,4,5][h]+d,p=e[t+5]>>3,y=e[t+5]&7,_=new Uint8Array([r<<6|p<<1|y>>2,(y&3)<<6|h<<3|d<<2|l>>4,l<<4&224]),T=1536/a*9e4,E=s+n*T,S=e.subarray(t,t+u);return i.config=_,i.channelCount=m,i.samplerate=a,i.samples.push({unit:S,pts:E}),u}class wx extends lh{resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=go(e,0);let s=(t==null?void 0:t.length)||0;if(t&&e[s]===11&&e[s+1]===119&&ah(t)!==void 0&&u0(e,s)<=16)return!1;for(let n=e.length;s<n;s++)if(c0(e,s))return Fe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Rx(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return o0(e,t,s,this.basePTS,this.frameIndex)}}const Dx=/\/emsg[-/]ID3/i;class Px{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,n){const r=this.videoTrack=ti("video",1),o=this.audioTrack=ti("audio",1),a=this.txtTrack=ti("text",1);if(this.id3Track=ti("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=Ip(e);if(l.video){const{id:c,timescale:u,codec:h,supplemental:f}=l.video;r.id=c,r.timescale=a.timescale=u,r.codec=h,r.supplemental=f}if(l.audio){const{id:c,timescale:u,codec:h}=l.audio;o.id=c,o.timescale=u,o.codec=h}a.id=bp.text,r.sampleDuration=0,r.duration=o.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return OE(e)}demux(e,t){this.timeOffset=t;let s=e;const n=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Os(this.remainderData,e));const a=BE(s);this.remainderData=a.remainder,n.samples=a.valid||new Uint8Array}else n.samples=s;const o=this.extractID3Track(n,t);return r.samples=qf(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return s.samples=qf(e,t),{videoTrack:t,audioTrack:ti(),id3Track:n,textTrack:ti()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const n=Re(e.samples,["emsg"]);n&&n.forEach(r=>{const o=HE(r);if(Dx.test(o.schemeIdUri)){const a=Id(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;s.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:ds.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=Id(o,t);s.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:ds.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Id(i,e){return oe(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class Ox{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new Zu(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ji.cbc)}decryptAacSample(e,t,s){const n=e[t].unit;if(n.length<=16)return;const r=n.subarray(16,n.length-n.length%16),o=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);n.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)})}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)s.set(e.subarray(r,r+16),n);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)e.set(s.subarray(n,n+16),r);return e}decryptAvcSample(e,t,s,n,r){const o=kp(r.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{r.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,n)})}decryptAvcSamples(e,t,s,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){n();return}const r=e[t].units;for(;!(s>=r.length);s++){const o=r[s];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,s,n,o),!this.decrypter.isSync()))return}}}}class f0{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,n;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const r=s.units;n=r[r.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,n=s.length;if(n){const r=s[n-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const n=t.byteLength;let r=e.naluState||0;const o=r,a=[];let l=0,c,u,h,f=-1,d=0;for(r===-1&&(f=0,d=this.getNALuType(t,0),r=0,l=1);l<n;){if(c=t[l++],!r){r=c?0:1;continue}if(r===1){r=c?0:2;continue}if(!c)r=3;else if(c===1){if(u=l-r-1,f>=0){const g={data:t.subarray(f,u),type:d};a.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(o&&l<=4-o&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-o)),u>0&&(g.data=Os(g.data,t.subarray(0,u)),g.state=0))}l<n?(h=this.getNALuType(t,l),f=l,d=h,r=0):r=-1}else r=0}if(f>=0&&r>=0){const g={data:t.subarray(f,n),type:d,state:r};a.push(g)}if(a.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=Os(g.data,t))}return e.naluState=r,a}}class qr{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");n.set(e.subarray(s,s+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&Fe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Mx extends f0{parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let o=this.VideoSample,a,l=!1;s.data=null,o&&r.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(c=>{var u,h;switch(c.type){case 1:{let m=!1;a=!0;const p=c.data;if(l&&p.length>4){const y=this.readSliceType(p);(y===2||y===4||y===7||y===9)&&(m=!0)}if(m){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.frame=!0,o.key=m;break}case 5:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,ju(c.data,1,s.pts,t.samples);break}case 7:{var d,g;a=!0,l=!0;const m=c.data,p=this.readSPS(m);if(!e.sps||e.width!==p.width||e.height!==p.height||((d=e.pixelRatio)==null?void 0:d[0])!==p.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==p.pixelRatio[1]){e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[m];const y=m.subarray(1,4);let _="avc1.";for(let T=0;T<3;T++){let E=y[T].toString(16);E.length<2&&(E="0"+E),_+=E}e.codec=_}break}case 8:a=!0,e.pps=[c.data];break;case 9:a=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(c)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new qr(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,n=8,r;for(let o=0;o<e;o++)n!==0&&(r=t.readEG(),n=(s+r+256)%256),s=n===0?s:n}readSPS(e){const t=new qr(e);let s=0,n=0,r=0,o=0,a,l,c;const u=t.readUByte.bind(t),h=t.readBits.bind(t),f=t.readUEG.bind(t),d=t.readBoolean.bind(t),g=t.skipBits.bind(t),m=t.skipEG.bind(t),p=t.skipUEG.bind(t),y=this.skipScalingList.bind(this);u();const _=u();if(h(5),g(3),u(),p(),_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128){const L=f();if(L===3&&g(1),p(),p(),g(1),d())for(l=L!==3?8:12,c=0;c<l;c++)d()&&(c<6?y(16,t):y(64,t))}p();const T=f();if(T===0)f();else if(T===1)for(g(1),m(),m(),a=f(),c=0;c<a;c++)m();p(),g(1);const E=f(),S=f(),R=h(1);R===0&&g(1),g(1),d()&&(s=f(),n=f(),r=f(),o=f());let x=[1,1];if(d()&&d())switch(u()){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:{x=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((E+1)*16-s*2-n*2),height:(2-R)*(S+1)*16-(R?2:4)*(r+o),pixelRatio:x}}}class Fx extends f0{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let o=this.VideoSample,a,l=!1;s.data=null,o&&r.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(c=>{var u,h;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,ju(c.data,2,s.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ze(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const d=this.readSPS(c.data);e.width=d.width,e.height=d.height,e.pixelRatio=d.pixelRatio,e.codec=d.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in d.params)e.params[g]=d.params[g]}this.pushParameterSet(e.sps,c.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const d=this.readPPS(c.data);for(const g in d)e.params[g]=d[g]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:a=!1;break}o&&a&&o.units.push(c)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let n=0;n<e.byteLength;n++)n>=2&&e[n]===3&&e[n-1]===0&&e[n-2]===0||(t[s]=e[n],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new qr(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),n=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:n}}readSPS(e){const t=new qr(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const n=t.readBits(2),r=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),h=t.readUByte(),f=t.readUByte(),d=t.readUByte(),g=t.readUByte(),m=t.readUByte(),p=t.readUByte(),y=t.readUByte(),_=[],T=[];for(let $=0;$<s;$++)_.push(t.readBoolean()),T.push(t.readBoolean());if(s>0)for(let $=s;$<8;$++)t.readBits(2);for(let $=0;$<s;$++)_[$]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),T[$]&&t.readUByte();t.readUEG();const E=t.readUEG();E==3&&t.skipBits(1);const S=t.readUEG(),R=t.readUEG(),x=t.readBoolean();let L=0,A=0,k=0,w=0;x&&(L+=t.readUEG(),A+=t.readUEG(),k+=t.readUEG(),w+=t.readUEG());const P=t.readUEG(),B=t.readUEG(),X=t.readUEG(),q=t.readBoolean();for(let $=q?0:s;$<=s;$++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let N=0;N<4;N++)for(let W=0;W<(N===3?2:6);W++)if(!t.readBoolean())t.readUEG();else{const Q=Math.min(64,1<<4+(N<<1));N>1&&t.readEG();for(let J=0;J<Q;J++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const K=t.readUEG();let ae=0;for(let $=0;$<K;$++){let N=!1;if($!==0&&(N=t.readBoolean()),N){$===K&&t.readUEG(),t.readBoolean(),t.readUEG();let W=0;for(let se=0;se<=ae;se++){const Q=t.readBoolean();let J=!1;Q||(J=t.readBoolean()),(Q||J)&&W++}ae=W}else{const W=t.readUEG(),se=t.readUEG();ae=W+se;for(let Q=0;Q<W;Q++)t.readUEG(),t.readBoolean();for(let Q=0;Q<se;Q++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const $=t.readUEG();for(let N=0;N<$;N++){for(let W=0;W<X+4;W++)t.readBits(1);t.readBits(1)}}let z=0,Y=1,ue=1,Ee=!0,re=1,Te=0;t.readBoolean(),t.readBoolean();let U=!1;if(t.readBoolean()){if(t.readBoolean()){const j=t.readUByte(),ye=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ie=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];j>0&&j<16?(Y=ye[j-1],ue=ie[j-1]):j===255&&(Y=t.readBits(16),ue=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),U=t.readBoolean(),U&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(re=t.readBits(32),Te=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const ie=t.readBoolean(),he=t.readBoolean();let pe=!1;(ie||he)&&(pe=t.readBoolean(),pe&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),pe&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Ie=0;Ie<=s;Ie++){Ee=t.readBoolean();const Ne=Ee||t.readBoolean();let we=!1;Ne?t.readEG():we=t.readBoolean();const dt=we?1:t.readUEG()+1;if(ie)for(let Ze=0;Ze<dt;Ze++)t.readUEG(),t.readUEG(),pe&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(he)for(let Ze=0;Ze<dt;Ze++)t.readUEG(),t.readUEG(),pe&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),z=t.readUEG())}let Z=S,le=R;if(x){let $=1,N=1;E===1?$=N=2:E==2&&($=2),Z=S-$*A-$*L,le=R-N*w-N*k}const Ae=n?["A","B","C"][n]:"",Pe=a<<24|l<<16|c<<8|u;let I=0;for(let $=0;$<32;$++)I=(I|(Pe>>$&1)<<31-$)>>>0;let C=I.toString(16);return o===1&&C==="2"&&(C="6"),{codecString:`hvc1.${Ae}${o}.${C}.${r?"H":"L"}${y}.B0`,params:{general_tier_flag:r,general_profile_idc:o,general_profile_space:n,general_profile_compatibility_flags:[a,l,c,u],general_constraint_indicator_flags:[h,f,d,g,m,p],general_level_idc:y,bit_depth:P+8,bit_depth_luma_minus8:P,bit_depth_chroma_minus8:B,min_spatial_segmentation_idc:z,chroma_format_idc:E,frame_rate:{fixed:Ee,fps:Te/re}},width:Z,height:le,pixelRatio:[Y,ue]}}readPPS(e){const t=new qr(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),r=t.readBoolean();let o=1;return r&&n?o=0:r?o=3:n&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const St=188;class Ui{constructor(e,t,s,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=n,this.videoParser=null}static probe(e,t){const s=Ui.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(St*5,t-St)+1,n=0;for(;n<s;){let r=!1,o=-1,a=0;for(let l=n;l<t;l+=St)if(e[l]===71&&(t-l===St||e[l+St]===71)){if(a++,o===-1&&(o=l,o!==0&&(s=Math.min(o+St*99,e.length-St)+1)),r||(r=Xc(e,l)===0),r&&a>1&&(o===0&&a>2||l+St>s))return o}else{if(a)return-1;break}n++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:bp[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Ui.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=Ui.createTrack("audio",n),this._id3Track=Ui.createTrack("id3"),this._txtTrack=Ui.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,n=!1){s||(this.sampleAes=null);let r;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=o.pid,h=o.pesData,f=a.pid,d=l.pid,g=a.pesData,m=l.pesData,p=null,y=this.pmtParsed,_=this._pmtId,T=e.length;if(this.remainderData&&(e=Os(this.remainderData,e),T=e.length,this.remainderData=null),T<St&&!n)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const E=Math.max(0,Ui.syncOffset(e));T-=(T-E)%St,T<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,T,e.buffer.byteLength-T));let S=0;for(let x=E;x<T;x+=St)if(e[x]===71){const L=!!(e[x+1]&64),A=Xc(e,x),k=(e[x+3]&48)>>4;let w;if(k>1){if(w=x+5+e[x+4],w===x+St)continue}else w=x+4;switch(A){case u:L&&(h&&(r=Bn(h,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,c,r,!1)),h={data:[],size:0}),h&&(h.data.push(e.subarray(w,x+St)),h.size+=x+St-w);break;case f:if(L){if(g&&(r=Bn(g,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,r);break;case"mp3":this.parseMPEGPES(a,r);break;case"ac3":this.parseAC3PES(a,r);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(w,x+St)),g.size+=x+St-w);break;case d:L&&(m&&(r=Bn(m,this.logger))&&this.parseID3PES(l,r),m={data:[],size:0}),m&&(m.data.push(e.subarray(w,x+St)),m.size+=x+St-w);break;case 0:L&&(w+=e[w]+1),_=this._pmtId=Nx(e,w);break;case _:{L&&(w+=e[w]+1);const P=$x(e,w,this.typeSupported,s,this.observer,this.logger);u=P.videoPid,u>0&&(o.pid=u,o.segmentCodec=P.segmentVideoCodec),f=P.audioPid,f>0&&(a.pid=f,a.segmentCodec=P.segmentAudioCodec),d=P.id3Pid,d>0&&(l.pid=d),p!==null&&!y&&(this.logger.warn(`MPEG-TS PMT found at ${x} after unknown PID '${p}'. Backtracking to sync byte @${E} to parse all TS packets.`),p=null,x=E-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:p=A;break}}else S++;S>0&&Qc(this.observer,new Error(`Found ${S} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=h,a.pesData=g,l.pesData=m;const R={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return n&&this.extractRemainingSamples(R),R}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:n,textTrack:r}=e,o=s.pesData,a=t.pesData,l=n.pesData;let c;if(o&&(c=Bn(o,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,r,c,!0),s.pesData=null)):s.pesData=o,a&&(c=Bn(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(c=Bn(l,this.logger))?(this.parseID3PES(n,c),n.pesData=null):n.pesData=l}demuxSampleAes(e,t,s){const n=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new Ox(this.observer,this.config,t);return this.decrypt(n,r)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new Mx:e==="hevc"&&(this.videoParser=new Fx))}decrypt(e,t){return new Promise(s=>{const{audioTrack:n,videoTrack:r}=e;n.samples&&n.segmentCodec==="aac"?t.decryptAacSamples(n.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{s(e)}):s(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const n=this.aacOverFlow;let r=t.data;if(n){this.aacOverFlow=null;const h=n.missing,f=n.sample.unit.byteLength;if(h===-1)r=Os(n.sample.unit,r);else{const d=f-h;n.sample.unit.set(r.subarray(0,h),d),e.samples.push(n.sample),s=n.missing}}let o,a;for(o=s,a=r.length;o<a-1&&!Ha(r,o);o++);if(o!==s){let h;const f=o<a-1;if(f?h=`AAC PES did not start with ADTS header,offset:${o}`:h="No ADTS header found in AAC PES",Qc(this.observer,new Error(h),f,this.logger),!f)return}t0(e,this.observer,r,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(n){const h=s0(e.samplerate);l=n.sample.pts+h}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;o<a;)if(u=i0(e,r,o,l,c),o+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;o<a-1&&!Ha(r,o);o++);}parseMPEGPES(e,t){const s=t.data,n=s.length;let r=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<n;)if(l0(s,o)){const l=o0(e,s,o,a,r);if(l)o+=l.length,r++;else break}else o++}parseAC3PES(e,t){{const s=t.data,n=t.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=s.length;let o=0,a=0,l;for(;a<r&&(l=h0(e,s,a,n,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=ze({},t,{type:this._videoTrack?ds.emsg:ds.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function Xc(i,e){return((i[e+1]&31)<<8)+i[e+2]}function Nx(i,e){return(i[e+10]&31)<<8|i[e+11]}function $x(i,e,t,s,n,r){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(i[e+1]&15)<<8|i[e+2],l=e+3+a-4,c=(i[e+10]&15)<<8|i[e+11];for(e+=12+c;e<l;){const u=Xc(i,e),h=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!s){jl("ADTS AAC",r);break}case 15:o.audioPid===-1&&(o.audioPid=u);break;case 21:o.id3Pid===-1&&(o.id3Pid=u);break;case 219:if(!s){jl("H.264",r);break}case 27:o.videoPid===-1&&(o.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="mp3");break;case 193:if(!s){jl("AC-3",r);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&h>0){let f=e+5,d=h;for(;d>2;){switch(i[f]){case 106:t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=u,o.segmentAudioCodec="ac3");break}const m=i[f+1]+2;f+=m,d-=m}}break;case 194:case 135:return Qc(n,new Error("Unsupported EC-3 in M2TS found"),void 0,r),o;case 36:o.videoPid===-1&&(o.videoPid=u,o.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=h+5}return o}function Qc(i,e,t,s){s.warn(`parsing error: ${e.message}`),i.emit(v.ERROR,v.ERROR,{type:me.MEDIA_ERROR,details:M.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function jl(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function Bn(i,e){let t=0,s,n,r,o,a;const l=i.data;if(!i||i.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Os(l[0],l[1]),l.splice(1,1);if(s=l[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(n=(s[4]<<8)+s[5],n&&n>i.size-6)return null;const u=s[7];u&192&&(o=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,u&64?(a=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),r=s[8];let h=r+9;if(i.size<=h)return null;i.size-=h;const f=new Uint8Array(i.size);for(let d=0,g=l.length;d<g;d++){s=l[d];let m=s.byteLength;if(h)if(h>m){h-=m;continue}else s=s.subarray(h),m-=h,h=0;f.set(s,t),t+=m}return n&&(n-=r+3),{data:f,pts:o,dts:a,len:n}}return null}class Ux{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Ci=Math.pow(2,32)-1;class O{static init(){O.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in O.types)O.types.hasOwnProperty(e)&&(O.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);O.HDLR_TYPES={video:t,audio:s};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);O.STTS=O.STSC=O.STCO=r,O.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),O.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),O.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),O.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);O.FTYP=O.box(O.types.ftyp,o,l,o,a),O.DINF=O.box(O.types.dinf,O.box(O.types.dref,n))}static box(e,...t){let s=8,n=t.length;const r=n;for(;n--;)s+=t[n].byteLength;const o=new Uint8Array(s);for(o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=s&255,o.set(e,4),n=0,s=8;n<r;n++)o.set(t[n],s),s+=t[n].byteLength;return o}static hdlr(e){return O.box(O.types.hdlr,O.HDLR_TYPES[e])}static mdat(e){return O.box(O.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Ci+1)),n=Math.floor(t%(Ci+1));return O.box(O.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return O.box(O.types.mdia,O.mdhd(e.timescale||0,e.duration||0),O.hdlr(e.type),O.minf(e))}static mfhd(e){return O.box(O.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?O.box(O.types.minf,O.box(O.types.smhd,O.SMHD),O.DINF,O.stbl(e)):O.box(O.types.minf,O.box(O.types.vmhd,O.VMHD),O.DINF,O.stbl(e))}static moof(e,t,s){return O.box(O.types.moof,O.mfhd(e),O.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=O.trak(e[t]);return O.box.apply(null,[O.types.moov,O.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(O.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=O.trex(e[t]);return O.box.apply(null,[O.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Ci+1)),n=Math.floor(t%(Ci+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return O.box(O.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let n,r;for(n=0;n<t.length;n++)r=t[n].flags,s[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return O.box(O.types.sdtp,s)}static stbl(e){return O.box(O.types.stbl,O.stsd(e),O.box(O.types.stts,O.STTS),O.box(O.types.stsc,O.STSC),O.box(O.types.stsz,O.STSZ),O.box(O.types.stco,O.STCO))}static avc1(e){let t=[],s=[],n,r,o;for(n=0;n<e.sps.length;n++)r=e.sps[n],o=r.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)r=e.pps[n],o=r.byteLength,s.push(o>>>8&255),s.push(o&255),s=s.concat(Array.prototype.slice.call(r));const a=O.box(O.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),l=e.width,c=e.height,u=e.pixelRatio[0],h=e.pixelRatio[1];return O.box(O.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,O.box(O.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),O.box(O.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,h>>24,h>>16&255,h>>8&255,h&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return O.box(O.types.mp4a,O.audioStsd(e),O.box(O.types.esds,O.esds(e)))}static mp3(e){return O.box(O.types[".mp3"],O.audioStsd(e))}static ac3(e){return O.box(O.types["ac-3"],O.audioStsd(e),O.box(O.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return O.box(O.types.stsd,O.STSD,O.mp4a(e));if(t==="ac3"&&e.config)return O.box(O.types.stsd,O.STSD,O.ac3(e));if(t==="mp3"&&e.codec==="mp3")return O.box(O.types.stsd,O.STSD,O.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return O.box(O.types.stsd,O.STSD,O.avc1(e));if(t==="hevc"&&e.vps)return O.box(O.types.stsd,O.STSD,O.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),n=e.width||0,r=e.height||0,o=Math.floor(s/(Ci+1)),a=Math.floor(s%(Ci+1));return O.box(O.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const s=O.sdtp(e),n=e.id,r=Math.floor(t/(Ci+1)),o=Math.floor(t%(Ci+1));return O.box(O.types.traf,O.box(O.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),O.box(O.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,o>>24,o>>16&255,o>>8&255,o&255])),O.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,O.box(O.types.trak,O.tkhd(e),O.mdia(e))}static trex(e){const t=e.id;return O.box(O.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],n=s.length,r=12+16*n,o=new Uint8Array(r);let a,l,c,u,h,f;for(t+=8+r,o.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<n;a++)l=s[a],c=l.duration,u=l.size,h=l.flags,f=l.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return O.box(O.types.trun,o)}static initSegment(e){O.types||O.init();const t=O.moov(e);return Os(O.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],n=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),n-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let o=r.length;for(let g=0;g<s.length;g+=1){o+=3;for(let m=0;m<s[g].length;m+=1)o+=2+s[g][m].length}const a=new Uint8Array(o);a.set(r,0),o=r.length;const l=s.length-1;for(let g=0;g<s.length;g+=1){a.set(new Uint8Array([32+g|(g===l?128:0),0,s[g].length]),o),o+=3;for(let m=0;m<s[g].length;m+=1)a.set(new Uint8Array([s[g][m].length>>8,s[g][m].length&255]),o),o+=2,a.set(s[g][m],o),o+=s[g][m].length}const c=O.box(O.types.hvcC,a),u=e.width,h=e.height,f=e.pixelRatio[0],d=e.pixelRatio[1];return O.box(O.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,O.box(O.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),O.box(O.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,d>>24,d>>16&255,d>>8&255,d&255])))}}O.types=void 0;O.HDLR_TYPES=void 0;O.STTS=void 0;O.STSC=void 0;O.STCO=void 0;O.STSZ=void 0;O.VMHD=void 0;O.SMHD=void 0;O.STSD=void 0;O.FTYP=void 0;O.DINF=void 0;const d0=9e4;function uh(i,e,t=1,s=!1){const n=i*e*t;return s?Math.round(n):n}function Bx(i,e,t=1,s=!1){return uh(i,e,1/t,s)}function xr(i,e=!1){return uh(i,1e3,1/d0,e)}function Gx(i,e=1){return uh(i,d0,1/e)}const Hx=10*1e3,Vx=1024,Kx=1152,zx=1536;let Gn=null,Xl=null;function Rd(i,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class da extends Vs{constructor(e,t,s,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,Gn===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Gn=o?parseInt(o[1]):0}if(Xl===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);Xl=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,n=e.reduce((r,o)=>{let a=o.pts,l=a-r;return l<-4294967296&&(t=!0,a=Ls(a,s),l=a-r),l>0?r:a},s);return t&&this.debug("PTS rollover detected"),n}remux(e,t,s,n,r,o,a,l){let c,u,h,f,d,g,m=r,p=r;const y=e.pid>-1,_=t.pid>-1,T=t.samples.length,E=e.samples.length>0,S=a&&T>0||T>1;if((!y||E)&&(!_||S)||this.ISGenerated||a){if(this.ISGenerated){var x,L,A,k;const X=this.videoTrackConfig;(X&&(t.width!==X.width||t.height!==X.height||((x=t.pixelRatio)==null?void 0:x[0])!==((L=X.pixelRatio)==null?void 0:L[0])||((A=t.pixelRatio)==null?void 0:A[1])!==((k=X.pixelRatio)==null?void 0:k[1]))||!X&&S||this.nextAudioTs===null&&E)&&this.resetInitSegment()}this.ISGenerated||(h=this.generateIS(e,t,r,o));const w=this.isVideoContiguous;let P=-1,B;if(S&&(P=Wx(t.samples),!w&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,P>0){this.warn(`Dropped ${P} out of ${T} video samples due to a missing keyframe`);const X=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(P),t.dropped+=P,p+=(t.samples[0].pts-X)/t.inputTimeScale,B=p}else P===-1&&(this.warn(`No keyframe found out of ${T} video samples`),g=!1);if(this.ISGenerated){if(E&&S){const X=this.getVideoStartPts(t.samples),G=(Ls(e.samples[0].pts,X)-X)/t.inputTimeScale;m+=Math.max(0,G),p+=Math.max(0,-G)}if(E){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),h=this.generateIS(e,t,r,o)),u=this.remuxAudio(e,m,this.isAudioContiguous,o,_||S||l===de.AUDIO?p:void 0),S){const X=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),h=this.generateIS(e,t,r,o)),c=this.remuxVideo(t,p,w,X)}}else S&&(c=this.remuxVideo(t,p,w,0));c&&(c.firstKeyFrame=P,c.independent=P!==-1,c.firstKeyFramePTS=B)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(d=g0(s,r,this._initPTS,this._initDTS)),n.samples.length&&(f=m0(n,r,this._initPTS))),{audio:u,video:c,initSegment:h,independent:g,text:f,id3:d}}generateIS(e,t,s,n){const r=e.samples,o=t.samples,a=this.typeSupported,l={},c=this._initPTS;let u=!c||n,h="audio/mp4",f,d,g,m=-1;if(u&&(f=d=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(h="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:h,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):O.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(m=e.id,g=e.inputTimeScale,!c||g!==c.timescale?f=d=r[0].pts-Math.round(g*s):u=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:O.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(m=t.id,g=t.inputTimeScale,!c||g!==c.timescale){const p=this.getVideoStartPts(o),y=Math.round(g*s);d=Math.min(d,Ls(o[0].dts,p)-y),f=Math.min(f,p-y)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(c&&this.warn(`Timestamps at playlist time: ${n?"":"~"}${s} ${f/g} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${f/g} (${f}/${g}) trackId: ${m}`),this._initPTS={baseTime:f,timescale:g,trackId:m},this._initDTS={baseTime:d,timescale:g,trackId:m}):f=g=void 0,{tracks:l,initPTS:f,timescale:g,trackId:m}}remuxVideo(e,t,s,n){const r=e.inputTimeScale,o=e.samples,a=[],l=o.length,c=this._initPTS,u=c.baseTime*r/c.timescale;let h=this.nextVideoTs,f=8,d=this.videoSampleDuration,g,m,p=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,_=!1;if(!s||h===null){const z=u+t*r,Y=o[0].pts-Ls(o[0].dts,o[0].pts);Gn&&h!==null&&Math.abs(z-Y-(h+u))<15e3?s=!0:h=z-Y-u}const T=h+u;for(let z=0;z<l;z++){const Y=o[z];Y.pts=Ls(Y.pts,T),Y.dts=Ls(Y.dts,T),Y.dts<o[z>0?z-1:z].dts&&(_=!0)}_&&o.sort(function(z,Y){const ue=z.dts-Y.dts,Ee=z.pts-Y.pts;return ue||Ee}),g=o[0].dts,m=o[o.length-1].dts;const E=m-g,S=E?Math.round(E/(l-1)):d||e.inputTimeScale/30;if(s){const z=g-T,Y=z>S,ue=z<-1;if((Y||ue)&&(Y?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${xr(z,!0)} ms (${z}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${xr(-z,!0)} ms (${z}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ue||T>=o[0].pts||Gn)){g=T;const Ee=o[0].pts-z;if(Y)o[0].dts=g,o[0].pts=Ee;else{let re=!0;for(let Te=0;Te<o.length&&!(o[Te].dts>Ee&&re);Te++){const U=o[Te].pts;if(o[Te].dts-=z,o[Te].pts-=z,Te<o.length-1){const te=o[Te+1].pts,Z=o[Te].pts,le=te<=Z,Ae=te<=U;re=le==Ae}}}this.log(`Video: Initial PTS/DTS adjusted: ${xr(Ee,!0)}/${xr(g,!0)}, delta: ${xr(z,!0)} ms`)}}g=Math.max(0,g);let R=0,x=0,L=g;for(let z=0;z<l;z++){const Y=o[z],ue=Y.units,Ee=ue.length;let re=0;for(let Te=0;Te<Ee;Te++)re+=ue[Te].data.length;x+=re,R+=Ee,Y.length=re,Y.dts<L?(Y.dts=L,L+=S/4|0||1):L=Y.dts,p=Math.min(Y.pts,p),y=Math.max(Y.pts,y)}m=o[l-1].dts;const A=x+4*R+8;let k;try{k=new Uint8Array(A)}catch(z){this.observer.emit(v.ERROR,v.ERROR,{type:me.MUX_ERROR,details:M.REMUX_ALLOC_ERROR,fatal:!1,error:z,bytes:A,reason:`fail allocating video mdat ${A}`});return}const w=new DataView(k.buffer);w.setUint32(0,A),k.set(O.types.mdat,4);let P=!1,B=Number.POSITIVE_INFINITY,X=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,G=Number.NEGATIVE_INFINITY;for(let z=0;z<l;z++){const Y=o[z],ue=Y.units;let Ee=0;for(let U=0,te=ue.length;U<te;U++){const Z=ue[U],le=Z.data,Ae=Z.data.byteLength;w.setUint32(f,Ae),f+=4,k.set(le,f),f+=Ae,Ee+=4+Ae}let re;if(z<l-1)d=o[z+1].dts-Y.dts,re=o[z+1].pts-Y.pts;else{const U=this.config,te=z>0?Y.dts-o[z-1].dts:S;if(re=z>0?Y.pts-o[z-1].pts:S,U.stretchShortVideoTrack&&this.nextAudioTs!==null){const Z=Math.floor(U.maxBufferHole*r),le=(n?p+n*r:this.nextAudioTs+u)-Y.pts;le>Z?(d=le-te,d<0?d=te:P=!0,this.log(`It is approximately ${le/90} ms to the next segment; using duration ${d/90} ms for the last video frame.`)):d=te}else d=te}const Te=Math.round(Y.pts-Y.dts);B=Math.min(B,d),q=Math.max(q,d),X=Math.min(X,re),G=Math.max(G,re),a.push(Rd(Y.key,d,Ee,Te))}if(a.length){if(Gn){if(Gn<70){const z=a[0].flags;z.dependsOn=2,z.isNonSync=0}}else if(Xl&&G-X<q-B&&S/q<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let z=g;for(let Y=0,ue=a.length;Y<ue;Y++){const Ee=z+a[Y].duration,re=z+a[Y].cts;if(Y<ue-1){const Te=Ee+a[Y+1].cts;a[Y].duration=Te-re}else a[Y].duration=Y?a[Y-1].duration:S;a[Y].cts=0,z=Ee}}}d=P||!d?S:d;const H=m+d;this.nextVideoTs=h=H-u,this.videoSampleDuration=d,this.isVideoContiguous=!0;const K=O.moof(e.sequenceNumber++,g,ze(e,{samples:a})),ae="video",fe={data1:K,data2:k,startPTS:(p-u)/r,endPTS:(y+d-u)/r,startDTS:(g-u)/r,endDTS:h/r,type:ae,hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,fe}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return Kx;case"ac3":return zx;default:return Vx}}remuxAudio(e,t,s,n,r){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,c=this.getSamplesPerFrame(e),u=c*l,h=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,d=[],g=r!==void 0;let m=e.samples,p=f?0:8,y=this.nextAudioTs||-1;const _=h.baseTime*o/h.timescale,T=_+t*o;if(this.isAudioContiguous=s=s||m.length&&y>0&&(n&&Math.abs(T-(y+_))<9e3||Math.abs(Ls(m[0].pts,T)-(y+_))<20*u),m.forEach(function(G){G.pts=Ls(G.pts,T)}),!s||y<0){if(m=m.filter(G=>G.pts>=0),!m.length)return;r===0?y=0:n&&!g?y=Math.max(0,T-_):y=m[0].pts-_}if(e.segmentCodec==="aac"){const G=this.config.maxAudioFramesDrift;for(let H=0,K=y+_;H<m.length;H++){const ae=m[H],fe=ae.pts,z=fe-K,Y=Math.abs(1e3*z/o);if(z<=-G*u&&g)H===0&&(this.warn(`Audio frame @ ${(fe/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*z/o)} ms.`),this.nextAudioTs=y=fe-_,K=fe);else if(z>=G*u&&Y<Hx&&g){let ue=Math.round(z/u);for(K=fe-ue*u;K<0&&ue&&u;)ue--,K+=u;H===0&&(this.nextAudioTs=y=K-_),this.warn(`Injecting ${ue} audio frames @ ${((K-_)/o).toFixed(3)}s due to ${Math.round(1e3*z/o)} ms gap.`);for(let Ee=0;Ee<ue;Ee++){let re=Ux.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);re||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),re=ae.unit.subarray()),m.splice(H,0,{unit:re,pts:K}),K+=u,H++}}ae.pts=K,K+=u}}let E=null,S=null,R,x=0,L=m.length;for(;L--;)x+=m[L].unit.byteLength;for(let G=0,H=m.length;G<H;G++){const K=m[G],ae=K.unit;let fe=K.pts;if(S!==null){const Y=d[G-1];Y.duration=Math.round((fe-S)/l)}else if(s&&e.segmentCodec==="aac"&&(fe=y+_),E=fe,x>0){x+=p;try{R=new Uint8Array(x)}catch(Y){this.observer.emit(v.ERROR,v.ERROR,{type:me.MUX_ERROR,details:M.REMUX_ALLOC_ERROR,fatal:!1,error:Y,bytes:x,reason:`fail allocating audio mdat ${x}`});return}f||(new DataView(R.buffer).setUint32(0,x),R.set(O.types.mdat,4))}else return;R.set(ae,p);const z=ae.byteLength;p+=z,d.push(Rd(!0,c,z,0)),S=fe}const A=d.length;if(!A)return;const k=d[d.length-1];y=S-_,this.nextAudioTs=y+l*k.duration;const w=f?new Uint8Array(0):O.moof(e.sequenceNumber++,E/l,ze({},e,{samples:d}));e.samples=[];const P=(E-_)/o,B=y/o,q={data1:w,data2:R,startPTS:P,endPTS:B,startDTS:P,endDTS:B,type:"audio",hasAudio:!0,hasVideo:!1,nb:A};return this.isAudioContiguous=!0,q}}function Ls(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function Wx(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function g0(i,e,t,s){const n=i.samples.length;if(!n)return;const r=i.inputTimeScale;for(let a=0;a<n;a++){const l=i.samples[a];l.pts=Ls(l.pts-t.baseTime*r/t.timescale,e*r)/r,l.dts=Ls(l.dts-s.baseTime*r/s.timescale,e*r)/r}const o=i.samples;return i.samples=[],{samples:o}}function m0(i,e,t){const s=i.samples.length;if(!s)return;const n=i.inputTimeScale;for(let o=0;o<s;o++){const a=i.samples[o];a.pts=Ls(a.pts-t.baseTime*n/t.timescale,e*n)/n}i.samples.sort((o,a)=>o.pts-a.pts);const r=i.samples;return i.samples=[],{samples:r}}class qx extends Vs{constructor(e,t,s,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,n){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment($E(e,n)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const n=this.initData=Ip(e);n.audio&&(t=kd(n.audio,Xe.AUDIO,this)),n.video&&(s=kd(n.video,Xe.VIDEO,this));const r={};n.audio&&n.video?r.audiovideo={container:"video/mp4",codec:t+","+s,supplemental:n.video.supplemental,initSegment:e,id:"main"}:n.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:n.video?r.video={container:"video/mp4",codec:s,supplemental:n.video.supplemental,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(e,t,s,n,r,o){var a,l;let{initPTS:c,lastEndTime:u}=this;const h={audio:void 0,video:void 0,text:n,id3:s,initSegment:void 0};oe(u)||(u=this.lastEndTime=r||0);const f=t.samples;if(!(f!=null&&f.length))return h;const d={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((a=g)!=null&&a.length||(this.generateInitSegment(f),g=this.initData),!((l=g)!=null&&l.length))return this.warn("Failed to generate initSegment."),h;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);const m=UE(f,g,this),p=g.audio?m[g.audio.id]:null,y=g.video?m[g.video.id]:null,_=qo(y,1/0),T=qo(p,1/0),E=qo(y,0,!0),S=qo(p,0,!0);let R=r,x=0;const L=p&&(!y||!c&&T<_||c&&c.trackId===g.audio.id),A=L?p:y;if(A){const H=A.timescale,K=A.start-r*H,ae=L?g.audio.id:g.video.id;R=A.start/H,x=L?S-T:E-_,(o||!c)&&(Yx(c,R,r,x)||H!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${r} ${K/H} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${R-r} (${K}/${H}) trackId: ${ae}`),c=null,d.initPTS=K,d.timescale=H,d.trackId=ae)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);c?(d.initPTS=c.baseTime,d.timescale=c.timescale,d.trackId=c.trackId):((!d.timescale||d.trackId===void 0||d.initPTS===void 0)&&(this.warn("Could not set initPTS"),d.initPTS=R,d.timescale=1,d.trackId=-1),this.initPTS=c={baseTime:d.initPTS,timescale:d.timescale,trackId:d.trackId});const k=e?R-c.baseTime/c.timescale:u,w=k+x;x>0?this.lastEndTime=w:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const P=!!g.audio,B=!!g.video;let X="";P&&(X+="audio"),B&&(X+="video");const q={data1:f,startPTS:k,startDTS:k,endPTS:w,endDTS:w,type:X,hasAudio:P,hasVideo:B,nb:1,dropped:0};h.audio=P&&!B?q:void 0,h.video=B?q:void 0;const G=y==null?void 0:y.sampleCount;if(G){const H=y.keyFrameIndex,K=H!==-1;q.nb=G,q.dropped=H===0||this.isVideoContiguous?0:K?H:G,q.independent=K,q.firstKeyFrame=H,K&&y.keyFrameStart&&(q.firstKeyFramePTS=(y.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(h.independent=K),this.isVideoContiguous||(this.isVideoContiguous=K),q.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${H}/${G} dropped: ${q.dropped} start: ${q.firstKeyFramePTS||"NA"}`)}return h.initSegment=d,h.id3=g0(s,r,c,c),n.samples.length&&(h.text=m0(n,r,c)),h}}function qo(i,e,t=!1){return(i==null?void 0:i.start)!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function Yx(i,e,t,s){if(i===null)return!0;const n=Math.max(s,1),r=e-i.baseTime/i.timescale;return Math.abs(r-t)>n}function kd(i,e,t){const s=i==null?void 0:i.codec;return s&&s.length>4?s:e===Xe.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?Ma(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let _i;try{_i=self.performance.now.bind(self.performance)}catch{_i=Date.now}const ga=[{demux:Px,remux:qx},{demux:Ui,remux:da},{demux:kx,remux:da},{demux:wx,remux:da}];ga.splice(2,0,{demux:Cx,remux:da});class Cd{constructor(e,t,s,n,r,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,n){const r=s.transmuxing;r.executeStart=_i();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;n&&(this.currentTransmuxState=n);const{contiguous:c,discontinuity:u,trackSwitch:h,accurateTimeOffset:f,timeOffset:d,initSegmentChange:g}=n||a,{audioCodec:m,videoCodec:p,defaultInitPts:y,duration:_,initSegmentData:T}=l,E=jx(o,t);if(E&&sr(E.method)){const L=this.getDecrypter(),A=th(E.method);if(L.isSync()){let k=L.softwareDecrypt(o,E.key.buffer,E.iv.buffer,A);if(s.part>-1){const P=L.flush();k=P&&P.buffer}if(!k)return r.executeEnd=_i(),Ql(s);o=new Uint8Array(k)}else return this.asyncResult=!0,this.decryptionPromise=L.webCryptoDecrypt(o,E.key.buffer,E.iv.buffer,A).then(k=>{const w=this.push(k,null,s);return this.decryptionPromise=null,w}),this.decryptionPromise}const S=this.needsProbing(u,h);if(S){const L=this.configureTransmuxer(o);if(L)return this.logger.warn(`[transmuxer] ${L.message}`),this.observer.emit(v.ERROR,v.ERROR,{type:me.MEDIA_ERROR,details:M.FRAG_PARSING_ERROR,fatal:!1,error:L,reason:L.message}),r.executeEnd=_i(),Ql(s)}(u||h||g||S)&&this.resetInitSegment(T,m,p,_,t),(u||g||S)&&this.resetInitialTimestamp(y),c||this.resetContiguity();const R=this.transmux(o,E,d,f,s);this.asyncResult=mo(R);const x=this.currentTransmuxState;return x.contiguous=!0,x.discontinuity=!1,x.trackSwitch=!1,r.executeEnd=_i(),R}flush(e){const t=e.transmuxing;t.executeStart=_i();const{decrypter:s,currentTransmuxState:n,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const o=[],{timeOffset:a}=n;if(s){const h=s.flush();h&&o.push(this.push(h.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=_i();const h=[Ql(e)];return this.asyncResult?Promise.resolve(h):h}const u=l.flush(a);return mo(u)?(this.asyncResult=!0,u.then(h=>(this.flushRemux(o,h,e),o))):(this.flushRemux(o,u,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,s){const{audioTrack:n,videoTrack:r,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===de.MAIN?"level":"track"} ${s.level}`);const u=this.remuxer.remux(n,r,o,a,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:s}),s.transmuxing.executeEnd=_i()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,n,r){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,s,n),a.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,n,r){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,s,n,r):o=this.transmuxUnencrypted(e,s,n,r),o}transmuxUnencrypted(e,t,s,n){const{audioTrack:r,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,o,a,l,t,s,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,s,n,r){return this.demuxer.demuxSampleAes(e,t,s).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,s,n,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:n}=this;let r;for(let h=0,f=ga.length;h<f;h++){var o;if((o=ga[h].demux)!=null&&o.probe(e,this.logger)){r=ga[h];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,c=r.remux,u=r.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(s,t,n,this.logger)),(!a||!(a instanceof u))&&(this.demuxer=new u(s,t,n,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Zu(this.config)),e}}function jx(i,e){let t=null;return i.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Ql=i=>({remuxResult:{},chunkMeta:i});function mo(i){return"then"in i&&i.then instanceof Function}class Xx{constructor(e,t,s,n,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=n,this.defaultInitPts=r||null}}class Qx{constructor(e,t,s,n,r,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=n,this.timeOffset=r,this.initSegmentChange=o}}let wd=0;class p0{constructor(e,t,s,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=wd++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(!(!u||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var h;const f=(h=this.workerContext)==null?void 0:h.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(v.ERROR,{type:me.OTHER_ERROR,details:M.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=n;const o=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===v.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new nh,this.observer.on(v.FRAG_DECRYPTED,o),this.observer.on(v.ERROR,o);const a=Xf(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(r.workerPath||tx()){try{r.workerPath?(l.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=ix(r.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=sx());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:tt(r)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new Cd(this.observer,a,r,"",t,e.logger)}return}}this.transmuxer=new Cd(this.observer,a,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=wd++;const t=this.hls.config,s=Xf(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:tt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),nx(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,n,r,o,a,l,c,u){var h,f;c.transmuxing.start=self.performance.now();const{instanceNo:d,transmuxer:g}=this,m=o?o.start:r.start,p=r.decryptdata,y=this.frag,_=!(y&&r.cc===y.cc),T=!(y&&c.level===y.level),E=y?c.sn-y.sn:-1,S=this.part?c.part-this.part.index:-1,R=E===0&&c.id>1&&c.id===(y==null?void 0:y.stats.chunkCount),x=!T&&(E===1||E===0&&(S===1||R&&S<=0)),L=self.performance.now();(T||E||r.stats.parsing.start===0)&&(r.stats.parsing.start=L),o&&(S||!x)&&(o.stats.parsing.start=L);const A=!(y&&((h=r.initSegment)==null?void 0:h.url)===((f=y.initSegment)==null?void 0:f.url)),k=new Qx(_,x,l,T,m,A);if(!x||_||A){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===de.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${_}
        trackSwitch: ${T}
        contiguous: ${x}
        accurateTimeOffset: ${l}
        timeOffset: ${m}
        initSegmentChange: ${A}`);const w=new Xx(s,n,t,a,u);this.configureTransmuxer(w)}if(this.frag=r,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:d,cmd:"demux",data:e,decryptdata:p,chunkMeta:c,state:k},e instanceof ArrayBuffer?[e]:[]);else if(g){const w=g.push(e,p,c,k);mo(w)?w.then(P=>{this.handleTransmuxComplete(P)}).catch(P=>{this.transmuxerError(P,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(w)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const n=s.flush(e);mo(n)?n.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Dd=100;class Jx extends ih{constructor(e,t,s){super(e,t,s,"audio-stream-controller",de.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(v.BUFFER_RESET,this.onBufferReset,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(v.BUFFER_RESET,this.onBufferReset,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:r,trackId:o}){if(s===de.MAIN){const a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:n,timescale:r,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${n/r} (${n}/${r}) trackId: ${o}`),this.mainAnchor=t,this.state===V.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==a)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===V.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const n=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&(n==null?void 0:n.cc)===t.cc)return;const r=(n||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=Np(o,r,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===V.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=V.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(Dd),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=V.IDLE):this.state=V.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case V.IDLE:this.doTickIdle();break;case V.WAITING_TRACK:{const{levels:t,trackId:s}=this,n=t==null?void 0:t[s],r=n==null?void 0:n.details;if(r&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(r))break;this.state=V.WAITING_INIT_PTS}break}case V.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),s=this.retryDate;if(!s||t>=s||(e=this.media)!=null&&e.seeking){const{levels:n,trackId:r}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((n==null?void 0:n[r])||null),this.state=V.IDLE}break}case V.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:s,part:n,cache:r,complete:o}=t,a=this.mainAnchor;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.state=V.FRAG_LOADING;const l=r.flush().buffer,c={frag:s,part:n,payload:l,networkDetails:null};this._handleFragmentLoadProgress(c),o&&super._handleFragmentLoadComplete(c)}else a&&a.cc!==t.frag.cc&&this.syncWithAnchor(a,t.frag)}else this.state=V.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:n,trackId:r}=this,o=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(s!=null&&s[r]))return;const a=s[r],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=V.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,Xe.AUDIO,de.AUDIO));const u=this.getFwdBufferInfo(c,de.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(v.BUFFER_EOS,{type:"audio"}),this.state=V.ENDED;return}const h=u.len,f=t.maxBufferLength,d=l.fragments,g=d[0].start,m=this.getLoadPosition(),p=this.flushing?m:u.end;if(this.switchingTrack&&n){const T=m;l.PTSKnown&&T<g&&(u.end>g||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=g+.05)}if(h>=f&&!this.switchingTrack&&p<d[d.length-1].start)return;let y=this.getNextFragment(p,l);if(y&&this.isLoopLoading(y,p)&&(y=this.getNextFragmentLoopLoading(y,l,u,de.MAIN,f)),!y){this.bufferFlushed=!0;return}let _=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&_&&pt(y)&&!y.endList&&(!l.live||!this.loadingParts&&p<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(_)===Tt.OK&&(this.mainFragLoading=_=null),_&&pt(_))){if(y.start>_.end){const E=this.fragmentTracker.getFragAtPos(p,de.MAIN);E&&E.end>_.end&&(_=E,this.mainFragLoading={frag:E,targetBufferTime:null})}if(y.start>_.end)return}this.loadFragment(y,a,p)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new uo(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==V.STOPPED&&(this.setInterval(Dd),this.state=V.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(v.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:n}=this,{details:r,id:o,groupId:a,track:l}=t;if(!n){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const c=this.mainDetails;if(!c||r.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==V.STOPPED&&(this.state=V.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const u=n[o];let h=0;if(r.live||(s=u.details)!=null&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(u.details){var f;h=this.alignPlaylists(r,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}r.alignedSliding||(Xp(r,c),r.alignedSliding||Ga(r,c),h=r.fragmentStart)}u.details=r,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,h),this.hls.trigger(v.AUDIO_TRACK_UPDATED,{details:r,id:o,groupId:t.groupId}),this.state===V.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=V.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const c=l[a];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const h=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new p0(this.hls,de.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const d=this.initPTS[s.cc],g=(t=s.initSegment)==null?void 0:t.data;if(d!==void 0){const p=n?n.index:-1,y=p!==-1,_=new eh(s.level,s.sn,s.stats.chunkCount,r.byteLength,p,y);f.push(r,g,h,"",s,n,u.totalduration,!1,_,d)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:m}=this.waitingData=this.waitingData||{frag:s,part:n,cache:new Qp,complete:!1};m.push(new Uint8Array(r)),this.state!==V.STOPPED&&(this.state=V.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===de.MAIN&&pt(t.frag)&&(this.mainFragLoading=t,this.state===V.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:n}=t;if(s.type!==de.AUDIO){!this.audioOnly&&s.type===de.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(pt(s)){this.fragPrevious=s;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(v.AUDIO_TRACK_SWITCHED,Ke({},r)))}this.fragBufferedComplete(s,n),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=V.ERROR;return}switch(t.details){case M.FRAG_GAP:case M.FRAG_PARSING_ERROR:case M.FRAG_DECRYPT_ERROR:case M.FRAG_LOAD_ERROR:case M.FRAG_LOAD_TIMEOUT:case M.KEY_LOAD_ERROR:case M.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(de.AUDIO,t);break;case M.AUDIO_TRACK_LOAD_ERROR:case M.AUDIO_TRACK_LOAD_TIMEOUT:case M.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===V.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===ke.AUDIO_TRACK&&(this.state=V.IDLE);break;case M.BUFFER_ADD_CODEC_ERROR:case M.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case M.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case M.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Xe.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Xe.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===V.ENDED&&(this.state=V.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,de.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:n}=this,{remuxResult:r,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:u}=a,{details:h}=u,{audio:f,text:d,id3:g,initSegment:m}=r;if(this.fragContextChanged(l)||!h){this.fragmentTracker.removeFragment(l);return}if(this.state=V.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){const p=l.initSegment||l;this._bufferInitSegment(u,m.tracks,p,o),n.trigger(v.FRAG_PARSING_INIT_SEGMENT,{frag:p,id:s,tracks:m.tracks})}if(f){const{startPTS:p,endPTS:y,startDTS:_,endDTS:T}=f;c&&(c.elementaryStreams[Xe.AUDIO]={startPTS:p,endPTS:y,startDTS:_,endDTS:T}),l.setElementaryStreamInfo(Xe.AUDIO,p,y,_,T),this.bufferFragmentData(f,l,c,o)}if(g!=null&&(t=g.samples)!=null&&t.length){const p=ze({id:s,frag:l,details:h},g);n.trigger(v.FRAG_PARSING_METADATA,p)}if(d){const p=ze({id:s,frag:l,details:h},d);n.trigger(v.FRAG_PARSING_USERDATA,p)}}_bufferInitSegment(e,t,s,n){if(this.state!==V.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=de.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${o}/${r.codec}]`),o&&o.split(",").length===1&&(r.levelCodec=o),this.hls.trigger(v.BUFFER_CODECS,t);const a=r.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:s,part:null,chunkMeta:n,parent:s.type,data:a};this.hls.trigger(v.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);if(this.switchingTrack||n===Tt.NOT_LOADED||n===Tt.PARTIAL){var r;if(!pt(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=V.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&Ga(t.details,o)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:n,characteristics:r,audioCodec:o,channels:a}=this.bufferedTrack;Sn({name:t,lang:s,assocLang:n,characteristics:r,audioCodec:o,channels:a},e,hn)||(Na(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(v.AUDIO_TRACK_SWITCHED,Ke({},e))}}class hh extends Vs{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const n=t==null?void 0:t.renditionReports;if(n){let r=-1;for(let o=0;o<n.length;o++){const a=n[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=a.URI||""}if(l===e){r=o;break}else l===e.substring(0,l.length)&&(r=o)}if(r!==-1){const o=n[r],a=parseInt(o["LAST-MSN"])||t.lastPartSn;let l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=s&&Qf(s);return new Jf(a,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:n,stats:r}=t,o=self.performance.now(),a=r.loading.first?Math.max(0,o-r.loading.first):0;n.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==n.appliedTimelineOffset){const u=Math.max(l||0,0);n.appliedTimelineOffset=u,n.fragments.forEach(h=>{h.setStart(h.playlistOffset+u)})}if(n.live||s!=null&&s.live){const u="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(s),s&&n.fragments.length>0){zS(s,n);const _=n.playlistParsingError;if(_){this.warn(_);const T=this.hls;if(!T.config.ignorePlaylistParsingErrors){var c;const{networkDetails:E}=t;T.trigger(v.ERROR,{type:me.NETWORK_ERROR,details:M.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:_,reason:_.message,level:t.level||void 0,parent:(c=n.fragments[0])==null?void 0:c.type,networkDetails:E,stats:r});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=r.loading.start);const h=this.hls.mainForwardBufferInfo,f=h?h.end-h.len:0,d=(n.edge-f)*1e3,g=zp(n,d);if(n.requestScheduled+g<o?n.requestScheduled=o:n.requestScheduled+=g,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let m,p,y;if(n.canBlockReload&&n.endSN&&n.advanced){const _=this.hls.config.lowLatencyMode,T=n.lastPartSn,E=n.endSN,S=n.lastPartIndex,R=S!==-1,x=T===E;R?x?(p=E+1,y=_?0:S):(p=T,y=_?S+1:n.maxPartIndex):p=E+1;const L=n.age,A=L+n.ageHeader;let k=Math.min(A-n.partTarget,n.targetduration*1.5);if(k>0){if(A>n.targetduration*3)this.log(`Playlist last advanced ${L.toFixed(2)}s ago. Omitting segment and part directives.`),p=void 0,y=void 0;else if(s!=null&&s.tuneInGoal&&A-n.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${k} with playlist age: ${n.age}`),k=0;else{const w=Math.floor(k/n.targetduration);if(p+=w,y!==void 0){const P=Math.round(k%n.targetduration/n.partTarget);y+=P}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${L.toFixed(2)}s goal: ${k} skip sn ${w} to part ${y}`)}n.tuneInGoal=k}if(m=this.getDeliveryDirectives(n,t.deliveryDirectives,p,y),_||!x){n.requestScheduled=o,this.loadingPlaylist(u,m);return}}else(n.canBlockReload||n.canSkipUntil)&&(m=this.getDeliveryDirectives(n,t.deliveryDirectives,p,y));m&&p!==void 0&&n.canBlockReload&&(n.requestScheduled=r.loading.first+Math.max(g-a*2,g/2)),this.scheduleLoading(u,m,n)}else this.clearTimer()}scheduleLoading(e,t,s){const n=s||e.details;if(!n){this.loadingPlaylist(e,t);return}const r=self.performance.now(),o=n.requestScheduled;if(r>=o){this.loadingPlaylist(e,t);return}const a=o-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,s,n){let r=Qf(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,n=t.part,r=ha.No),new Jf(s,n,r)}checkRetry(e){const t=e.details,s=$a(e),n=e.errorAction,{action:r,retryCount:o=0,retryConfig:a}=n||{},l=!!n&&!!a&&(r===Dt.RetryRequest||!n.resolved&&r===Dt.SendAlternateToPenaltyBox);if(l){var c;if(o>=a.maxNumRetry)return!1;if(s&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=Ju(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,n.resolved=!0}return l}}function y0(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!po(i[t].attrs,e[t].attrs))return!1;return!0}function po(i,e,t){const s=i["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>i[n]!==e[n])}function Jc(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class Zx extends hh{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(v.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,o=this.tracksInGroup[s];if(!o||o.groupId!==n){this.warn(`Audio track with id:${s} and group:${n} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${s} "${o.name}" lang:${o.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||(n==null?void 0:n.length)!==(s==null?void 0:s.length)||s!=null&&s.some(a=>(n==null?void 0:n.indexOf(a))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!s||s.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,d)=>{f.id=d});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!r&&l){const f=ii(l,a,hn);if(f>-1)r=a[f];else{const d=ii(l,this.tracks);r=this.tracks[d]}}let c=this.findTrackId(r);c===-1&&r&&(c=this.findTrackId(null));const u={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${s==null?void 0:s.join(",")}`),this.hls.trigger(v.AUDIO_TRACKS_UPDATED,u);const h=this.trackId;if(c!==-1&&h===-1)this.setAudioTrack(c);else if(a.length&&h===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===ke.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const n=this.currentTrack;if(n&&Sn(e,n,hn))return n;const r=ii(e,this.tracksInGroup,hn);if(r>-1){const o=this.tracksInGroup[r];return this.setAudioTrack(r),o}else if(n){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=uS(e,t.levels,s,o,hn);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=ii(e,s);if(o>-1)return s[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e],r=n.details&&!n.details.live;if(e===this.trackId&&n===s&&r||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(v.AUDIO_TRACK_SWITCHING,Ke({},n)),r))return;const o=this.switchParams(n.url,s==null?void 0:s.details,n.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(!(this.selectDefaultTrack&&!n.default)&&(!e||Sn(e,n,hn)))return s}if(e){const{name:s,lang:n,assocLang:r,characteristics:o,audioCodec:a,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(Sn({name:s,lang:n,assocLang:r,characteristics:o,audioCodec:a,channels:l},u,hn))return c}for(let c=0;c<t.length;c++){const u=t[c];if(po(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(po(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Na(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(v.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}}class eb{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const n=this.queues[t];n.push(e),n.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(r){var s;if(n.onError(r),this.queues===null||this.tracks===null)return;const o=(s=this.tracks[e])==null?void 0:s.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],n=s==null?void 0:s.buffer;return n?`SourceBuffer${n.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const Pd=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,v0="HlsJsTrackRemovedError";class tb extends Error{constructor(e){super(e),this.name=v0}}class sb extends Vs{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:n,mediaSource:r}=this;s&&this.log("Media source opened"),!(!n||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(v.MEDIA_ATTACHED,{media:n,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:n}=this;s!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=RE(Yi(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.BUFFER_RESET,this.onBufferReset,this),e.on(v.BUFFER_APPENDING,this.onBufferAppending,this),e.on(v.BUFFER_CODECS,this.onBufferCodecs,this),e.on(v.BUFFER_EOS,this.onBufferEos,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.FRAG_PARSED,this.onFragParsed,this),e.on(v.FRAG_CHANGED,this.onFragChanged,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.BUFFER_RESET,this.onBufferReset,this),e.off(v.BUFFER_APPENDING,this.onBufferAppending,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.BUFFER_EOS,this.onBufferEos,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.FRAG_PARSED,this.onFragParsed,this),e.off(v.FRAG_CHANGED,this.onFragChanged,this),e.off(v.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const o=this.isQueued();(r||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?ze(s,n.tracks):this.sourceBuffers.forEach(r=>{const[o]=r;o&&(s[o]=ze({},this.tracks[o]),this.removeBuffer(o)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const n=Yi(this.appendSource);if(n){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(o),r)this._objectUrl=s.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{s.removeAttribute("src");const l=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||l&&o instanceof l,Od(s),ib(s,a),s.load()}catch{s.src=a}else s.src=a}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,n=t.tracks,r=n?Object.keys(n):null,o=r?r.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&r&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${tt(s,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${tt(n,(l,c)=>l==="initSegment"?void 0:c)}}`),!_p(n,s)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,u=Math.max(l,(c==null?void 0:c.fragments[0].start)||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(s)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(v.MEDIA_DETACHING,{}),this.onMediaAttaching(v.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,r.forEach(l=>{const c=l,u=n[c];if(u){const h=u.buffer;if(h){const f=this.fragmentTracker,d=u.id;if(f.hasFragments(d)||f.hasParts(d)){const p=xe.getBuffered(h);f.detectEvictedFragments(c,p,d,null,!0)}const g=Jl(c),m=[c,h];this.sourceBuffers[g]=m,h.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:r,_objectUrl:o}=this;if(r){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=r.readyState==="open";try{const l=r.sourceBuffers;for(let c=l.length;c--;)a&&l[c].abort(),r.removeSourceBuffer(l[c]);a&&r.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),s||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(n.removeAttribute("src"),this.appendSource&&Od(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(v.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Jl(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new eb(this.tracks)}onBufferCodecs(e,t){const s=this.tracks,n=Object.keys(t);this.log(`BUFFER_CODECS: "${n}" (current SB count ${this.sourceBufferCount})`);const r="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),o=!r&&this.sourceBufferCount&&this.media&&n.some(a=>!s[a]);if(r||o){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${n}" SourceBuffers`);return}n.forEach(a=>{var l,c;const u=t[a],{id:h,codec:f,levelCodec:d,container:g,metadata:m,supplemental:p}=u;let y=s[a];const _=(l=this.transferData)==null||(l=l.tracks)==null?void 0:l[a],T=_!=null&&_.buffer?_:y,E=(T==null?void 0:T.pendingCodec)||(T==null?void 0:T.codec),S=T==null?void 0:T.levelCodec;y||(y=s[a]={buffer:void 0,listeners:[],codec:f,supplemental:p,container:g,levelCodec:d,metadata:m,id:h});const R=ua(E,S),x=R==null?void 0:R.replace(Pd,"$1");let L=ua(f,d);const A=(c=L)==null?void 0:c.replace(Pd,"$1");L&&R&&x!==A&&(a.slice(0,5)==="audio"&&(L=Ma(L,this.appendSource)),this.log(`switching codec ${E} to ${L}`),L!==(y.pendingCodec||y.codec)&&(y.pendingCodec=L),y.container=g,this.appendChangeType(a,g,L))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const n=`${t};codecs=${s}`,r={label:`change-type=${n}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),a.changeType(n),o.codec=s,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,n=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,de.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>n||l!=null&&l.buffer&&xe.isBuffered(l.buffer,n)||((a=this.fragmentTracker.getAppendedFrag(n,de.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:n,type:r,parent:o,frag:a,part:l,chunkMeta:c,offset:u}=t,h=c.buffering[r],{sn:f,cc:d}=a,g=self.performance.now();h.start=g;const m=a.stats.buffering,p=l?l.stats.buffering:null;m.start===0&&(m.start=g),p&&p.start===0&&(p.start=g);const y=s.audio;let _=!1;r==="audio"&&(y==null?void 0:y.container)==="audio/mpeg"&&(_=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const T=s.video,E=T==null?void 0:T.buffer;if(E&&f!=="initSegment"){const x=l||a,L=this.blockedAudioAppend;if(r==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(T.ending||T.ended)){const k=x.start+x.duration*.05,w=E.buffered,P=this.currentOp("video");!w.length&&!P?this.blockAudio(x):!P&&!xe.isBuffered(E,k)&&this.lastVideoAppendEnd<k&&this.blockAudio(x)}else if(r==="video"){const A=x.end;if(L){const k=L.frag.start;(A>k||A<this.lastVideoAppendEnd||xe.isBuffered(E,k))&&this.unblockAudio()}this.lastVideoAppendEnd=A}}const S=(l||a).start,R={label:`append-${r}`,execute:()=>{var x;h.executeStart=self.performance.now();const L=(x=this.tracks[r])==null?void 0:x.buffer;L&&(_?this.updateTimestampOffset(L,S,.1,r,f,d):u!==void 0&&oe(u)&&this.updateTimestampOffset(L,u,1e-6,r,f,d)),this.appendExecutor(n,r)},onStart:()=>{},onComplete:()=>{const x=self.performance.now();h.executeEnd=h.end=x,m.first===0&&(m.first=x),p&&p.first===0&&(p.first=x);const L={};this.sourceBuffers.forEach(([A,k])=>{A&&(L[A]=xe.getBuffered(k))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(v.BUFFER_APPENDED,{type:r,frag:a,part:l,chunkMeta:c,parent:a.type,timeRanges:L})},onError:x=>{var L;const A={type:me.MEDIA_ERROR,parent:a.type,details:M.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:a,part:l,chunkMeta:c,error:x,err:x,fatal:!1},k=(L=this.media)==null?void 0:L.error;if(x.code===DOMException.QUOTA_EXCEEDED_ERR||x.name=="QuotaExceededError"||"quota"in x)A.details=M.BUFFER_FULL_ERROR;else if(x.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!k)A.errorAction=ho(!0);else if(x.name===v0&&this.sourceBufferCount===0)A.errorAction=ho(!0);else{const w=++this.appendErrors[r];this.warn(`Failed ${w}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${k||"no media error"})`),(w>=this.hls.config.appendErrorMaxRetry||k)&&(A.fatal=!0)}this.hls.trigger(v.ERROR,A)}};this.append(R,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(v.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:s,startOffset:n,endOffset:r}=t;s?this.append(this.getFlushOp(s,n,r),s):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,n,r),o)})}onFragParsed(e,t){const{frag:s,part:n}=t,r=[],o=n?n.elementaryStreams:s.elementaryStreams;o[Xe.AUDIOVIDEO]?r.push("audiovideo"):(o[Xe.AUDIO]&&r.push("audio"),o[Xe.VIDEO]&&r.push("video"));const a=()=>{const l=self.performance.now();s.stats.buffering.end=l,n&&(n.stats.buffering.end=l);const c=n?n.stats:s.stats;this.hls.trigger(v.FRAG_BUFFERED,{frag:s,part:n,stats:c,id:s.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(a,r).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const n=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(v.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(v.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===M.BUFFER_APPEND_ERROR&&t.frag){var s;const n=(s=t.errorAction)==null?void 0:s.nextAutoLevel;oe(n)&&n!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const n=e.config,r=s.currentTime,o=t.levelTargetDuration,a=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(oe(a)&&a>=0){const c=Math.max(a,o),u=Math.floor(r/o)*o-c;this.flushBackBuffer(r,o,u)}const l=n.frontBufferFlushThreshold;if(oe(l)&&l>0){const c=Math.max(n.maxBufferLength,l),u=Math.max(c,o),h=Math.floor(r/o)*o+u;this.flushFrontBuffer(r,o,h)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([n,r])=>{if(r){const a=xe.getBuffered(r);if(a.length>0&&s>a.start(0)){var o;this.hls.trigger(v.BACK_BUFFER_REACHED,{bufferEnd:s});const l=this.tracks[n];if((o=this.details)!=null&&o.live)this.hls.trigger(v.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(l!=null&&l.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(v.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:n})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([n,r])=>{if(r){const o=xe.getBuffered(r),a=o.length;if(a<2)return;const l=o.start(a-1),c=o.end(a-1);if(s>l||e>=l&&e<=c)return;this.hls.trigger(v.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||(s==null?void 0:s.readyState)!=="open")return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),u=Math.max(c,n);return{duration:1/0,start:c,end:u}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return oe(r)?{duration:r}:null;const o=this.media.duration,a=oe(s.duration)?s.duration:0;return n>a&&n>o||!oe(o)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:s}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==e&&(oe(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${s}.`),n.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${tt(s)}`),this.tracksReady){var n;const r=(n=this.transferData)==null?void 0:n.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const n=this.tracks[t];e[t]={buffer:s,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(v.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const o=r,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),c=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(o)?" Queued":""} ${tt(a)}`);try{const u=s.addSourceBuffer(c),h=Jl(o),f=[o,u];t[h]=f,a.buffer=u}catch(u){var n;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(o),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[o],this.hls.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:o,mimeType:c,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let n=e.codec;s&&(t==="video"||t==="audiovideo")&&Vc(s,"video")&&(n=qE(n,s));const r=ua(n,e.levelCodec);return r?t.slice(0,5)==="audio"?Ma(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(v.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s==null?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${n}`,t),this.hls.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const r=this.currentOp(e);r&&r.onError(n)}updateTimestampOffset(e,t,s,n,r,o){const a=t-e.timestampOffset;Math.abs(a)>=s&&(this.log(`Updating ${n} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:n,mediaSource:r}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!n||!r||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=oe(n.duration)?n.duration:1/0,c=oe(r.duration)?r.duration:1/0,u=Math.max(0,t),h=Math.min(s,l,c);h>u&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${u},${h}] from the ${e} SourceBuffer`),a.remove(u,h)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],n=s==null?void 0:s.buffer;if(!n)throw new tb(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,n=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(o=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const n=(s=this.tracks[t])==null?void 0:s.buffer;!n||n.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const n=this.tracks[e];if(!n)return;const r=n.buffer;if(!r)return;const o=s.bind(this,e);n.listeners.push({event:t,listener:o}),r.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(n=>{s.removeEventListener(n.event,n.listener)}),t.listeners.length=0)}}function Od(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function ib(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function Jl(i){return i==="audio"?1:0}class fh{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(v.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.BUFFER_CODECS,this.onBufferCodecs,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(v.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&oe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((n,r)=>this.isLevelAllowed(n)&&r<=e);return this.clientRect=null,fh.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const n=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let r=e.length-1;const o=Math.max(t,s);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&n(l,e[a+1])){r=a;break}}return r}}const nb={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Zt=nb,rb={HLS:"h"},ob=rb;class li{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof li?s:new li(s))),this.value=e,this.params=t}}const ab="Dict";function lb(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function cb(i,e,t,s){return new Error(`failed to ${i} "${lb(e)}" as ${t}`,{cause:s})}function ci(i,e,t){return cb("serialize",i,e,t)}class T0{constructor(e){this.description=e}}const Md="Bare Item",ub="Boolean";function hb(i){if(typeof i!="boolean")throw ci(i,ub);return i?"?1":"?0"}function fb(i){return btoa(String.fromCharCode(...i))}const db="Byte Sequence";function gb(i){if(ArrayBuffer.isView(i)===!1)throw ci(i,db);return`:${fb(i)}:`}const mb="Integer";function pb(i){return i<-999999999999999||999999999999999<i}function _0(i){if(pb(i))throw ci(i,mb);return i.toString()}function yb(i){return`@${_0(i.getTime()/1e3)}`}function E0(i,e){if(i<0)return-E0(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const n=Math.floor(i*t);return(n%2===0?n:n+1)/t}else return Math.round(i*t)/t}const vb="Decimal";function Tb(i){const e=E0(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw ci(i,vb);const t=e.toString();return t.includes(".")?t:`${t}.0`}const _b="String",Eb=/[\x00-\x1f\x7f]+/;function Sb(i){if(Eb.test(i))throw ci(i,_b);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function xb(i){return i.description||i.toString().slice(7,-1)}const bb="Token";function Fd(i){const e=xb(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw ci(e,bb);return e}function Zc(i){switch(typeof i){case"number":if(!oe(i))throw ci(i,Md);return Number.isInteger(i)?_0(i):Tb(i);case"string":return Sb(i);case"symbol":return Fd(i);case"boolean":return hb(i);case"object":if(i instanceof Date)return yb(i);if(i instanceof Uint8Array)return gb(i);if(i instanceof T0)return Fd(i);default:throw ci(i,Md)}}const Ab="Key";function eu(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw ci(i,Ab);return i}function dh(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${eu(e)}`:`;${eu(e)}=${Zc(t)}`).join("")}function S0(i){return i instanceof li?`${Zc(i.value)}${dh(i.params)}`:Zc(i)}function Lb(i){return`(${i.value.map(S0).join(" ")})${dh(i.params)}`}function Ib(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw ci(i,ab);const t=i instanceof Map?i.entries():Object.entries(i),s=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([n,r])=>{r instanceof li||(r=new li(r));let o=eu(n);return r.value===!0?o+=dh(r.params):(o+="=",Array.isArray(r.value)?o+=Lb(r):o+=S0(r)),o}).join(`,${s}`)}function x0(i,e){return Ib(i,e)}const Ys="CMCD-Object",at="CMCD-Request",on="CMCD-Session",wi="CMCD-Status",Rb={br:Ys,ab:Ys,d:Ys,ot:Ys,tb:Ys,tpb:Ys,lb:Ys,tab:Ys,lab:Ys,url:Ys,pb:at,bl:at,tbl:at,dl:at,ltc:at,mtp:at,nor:at,nrr:at,rc:at,sn:at,sta:at,su:at,ttfb:at,ttfbb:at,ttlb:at,cmsdd:at,cmsds:at,smrt:at,df:at,cs:at,ts:at,cid:on,pr:on,sf:on,sid:on,st:on,v:on,msd:on,bs:wi,bsd:wi,cdn:wi,rtp:wi,bg:wi,pt:wi,ec:wi,e:wi},kb={REQUEST:at};function Cb(i){return Object.keys(i).reduce((e,t)=>{var s;return(s=i[t])===null||s===void 0||s.forEach(n=>e[n]=t),e},{})}function wb(i,e){const t={};if(!i)return t;const s=Object.keys(i),n=e?Cb(e):{};return s.reduce((r,o)=>{var a;const l=Rb[o]||n[o]||kb.REQUEST,c=(a=r[l])!==null&&a!==void 0?a:r[l]={};return c[o]=i[o],r},t)}function Db(i){return["ot","sf","st","e","sta"].includes(i)}function Pb(i){return typeof i=="number"?oe(i):i!=null&&i!==""&&i!==!1}const b0="event";function Ob(i,e){const t=new URL(i),s=new URL(e);if(t.origin!==s.origin)return i;const n=t.pathname.split("/").slice(1),r=s.pathname.split("/").slice(1,-1);for(;n[0]===r[0];)n.shift(),r.shift();for(;r.length;)r.shift(),n.unshift("..");return n.join("/")+t.search+t.hash}const ma=i=>Math.round(i),tu=(i,e)=>Array.isArray(i)?i.map(t=>tu(t,e)):i instanceof li&&typeof i.value=="string"?new li(tu(i.value,e),i.params):(e.baseUrl&&(i=Ob(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),Yo=i=>ma(i/100)*100,Mb=(i,e)=>{let t=i;return e.version>=2&&(i instanceof li&&typeof i.value=="string"?t=new li([i]):typeof i=="string"&&(t=[i])),tu(t,e)},Fb={br:ma,d:ma,bl:Yo,dl:Yo,mtp:Yo,nor:Mb,rtp:Yo,tb:ma},A0="request",L0="response",gh=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Nb=["e"],$b=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function yl(i){return $b.test(i)}function Ub(i){return gh.includes(i)||Nb.includes(i)||yl(i)}const I0=["d","dl","nor","ot","rtp","su"];function Bb(i){return gh.includes(i)||I0.includes(i)||yl(i)}const Gb=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function Hb(i){return gh.includes(i)||I0.includes(i)||Gb.includes(i)||yl(i)}const Vb=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Kb(i){return Vb.includes(i)||yl(i)}const zb={[L0]:Hb,[b0]:Ub,[A0]:Bb};function R0(i,e={}){const t={};if(i==null||typeof i!="object")return t;const s=e.version||i.v||1,n=e.reportingMode||A0,r=s===1?Kb:zb[n];let o=Object.keys(i).filter(r);const a=e.filter;typeof a=="function"&&(o=o.filter(a));const l=n===L0||n===b0;l&&!o.includes("ts")&&o.push("ts"),s>1&&!o.includes("v")&&o.push("v");const c=ze({},Fb,e.formatters),u={version:s,reportingMode:n,baseUrl:e.baseUrl};return o.sort().forEach(h=>{let f=i[h];const d=c[h];if(typeof d=="function"&&(f=d(f,u)),h==="v"){if(s===1)return;f=s}h=="pr"&&f===1||(l&&h==="ts"&&!oe(f)&&(f=Date.now()),Pb(f)&&(Db(h)&&typeof f=="string"&&(f=new T0(f)),t[h]=f))}),t}function Wb(i,e={}){const t={};if(!i)return t;const s=R0(i,e),n=wb(s,e==null?void 0:e.customHeaderMap);return Object.entries(n).reduce((r,[o,a])=>{const l=x0(a,{whitespace:!1});return l&&(r[o]=l),r},t)}function qb(i,e,t){return ze(i,Wb(e,t))}const Yb="CMCD";function jb(i,e={}){return i?x0(R0(i,e),{whitespace:!1}):""}function Xb(i,e={}){if(!i)return"";const t=jb(i,e);return encodeURIComponent(t)}function Qb(i,e={}){if(!i)return"";const t=Xb(i,e);return`${Yb}=${t}`}const Nd=/CMCD=[^&#]+/;function Jb(i,e,t){const s=Qb(e,t);if(!s)return i;if(Nd.test(i))return i.replace(Nd,s);const n=i.includes("?")?"&":"?";return`${i}${n}${s}`}class Zb{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:Zt.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=n=>{try{const{frag:r,part:o}=n,a=this.hls.levels[r.level],l=this.getObjectType(r),c={d:(o||r).duration*1e3,ot:l};(l===Zt.VIDEO||l===Zt.AUDIO||l==Zt.MUXED)&&(c.br=a.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=o?this.getNextPart(o):this.getNextFrag(r);u!=null&&u.url&&u.url!==r.url&&(c.nor=u.url),this.apply(n,c)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHED,this.onMediaDetached,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHED,this.onMediaDetached,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,n;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(n=t.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:ob.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ze(t,this.createData());const s=t.ot===Zt.INIT||t.ot===Zt.VIDEO||t.ot===Zt.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((o,a)=>(n.includes(a)&&(o[a]=t[a]),o),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),qb(e.headers,t,r)):e.url=Jb(e.url,t,r)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const n=e.sn-s.startSN;return s.fragments[n+1]}}getNextPart(e){var t;const{index:s,fragment:n}=e,r=(t=this.hls.levels[n.level])==null||(t=t.details)==null?void 0:t.partList;if(r){const{sn:o}=n;for(let a=r.length-1;a>=0;a--){const l=r[a];if(l.index===s&&l.fragment.sn===o)return r[a+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Zt.TIMED_TEXT;if(e.sn==="initSegment")return Zt.INIT;if(t==="audio")return Zt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Zt.VIDEO:Zt.MUXED}getTopBandwidth(e){let t=0,s;const n=this.hls;if(e===Zt.AUDIO)s=n.audioTracks;else{const r=n.maxAutoLevel,o=r>-1?r+1:n.levels.length;s=n.levels.slice(0,o)}return s.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===Zt.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:xe.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,o,a){t(r),this.loader.load(r,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,o,a){t(r),this.loader.load(r,o,a)}}}}const eA=3e5;class tA extends Vs{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if((s==null?void 0:s.action)===Dt.SendAlternateToPenaltyBox&&s.flags===$s.MoveAllAlternatesMatchingHost){const n=this.levels;let r=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:c}=t.context;a&&n?o=this.getPathwayForGroupId(a,c,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!r&&n&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),s.resolved=this.pathwayId!==o),t.details===M.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${n&&n.length} priorities: ${tt(r)} penalized: ${tt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,n=performance.now();Object.keys(s).forEach(r=>{n-s[r]>eA&&delete s[r]});for(let r=0;r<e.length;r++){const o=e[r];if(o in s)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,Yp(t),this.hls.trigger(v.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,s){const n=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<n.length;r++)if(t===ke.AUDIO_TRACK&&n[r].hasAudioGroup(e)||t===ke.SUBTITLE_TRACK&&n[r].hasSubtitleGroup(e))return n[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},n={};e.forEach(r=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=r;if(t.some(u=>u.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(u=>{const h=new nt(u.attrs);h["PATHWAY-ID"]=o;const f=h.AUDIO&&`${h.AUDIO}_clone_${o}`,d=h.SUBTITLES&&`${h.SUBTITLES}_clone_${o}`;f&&(s[h.AUDIO]=f,h.AUDIO=f),d&&(n[h.SUBTITLES]=d,h.SUBTITLES=d);const g=k0(u.uri,h["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),m=new uo({attrs:h,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:g,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let p=1;p<u.audioGroups.length;p++)m.addGroupId("audio",`${u.audioGroups[p]}_clone_${o}`);if(u.subtitleGroups)for(let p=1;p<u.subtitleGroups.length;p++)m.addGroupId("text",`${u.subtitleGroups[p]}_clone_${o}`);return m});t.push(...c),$d(this.audioTracks,s,l,o),$d(this.subtitleTracks,n,l,o)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+u)}const r={responseType:"json",url:n.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,h,f,d)=>{this.log(`Loaded steering manifest: "${n}"`);const g=u.data;if((g==null?void 0:g.VERSION)!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":p,"PATHWAY-PRIORITY":y}=g;if(m)try{this.uri=new self.URL(m,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`);return}this.scheduleRefresh(this.uri||f.url),p&&this.clonePathways(p);const _={steeringManifest:g,url:n.toString()};this.hls.trigger(v.STEERING_MANIFEST_LOADED,_),y&&this.updatePathwayPriority(y)},onError:(u,h,f,d)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${h.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${h.url} no longer available`);return}let g=this.timeToLoad*1e3;if(u.code===429){const m=this.loader;if(typeof(m==null?void 0:m.getResponseHeader)=="function"){const p=m.getResponseHeader("Retry-After");p&&(g=parseFloat(p)*1e3)}this.log(`Steering manifest ${h.url} rate limited`);return}this.scheduleRefresh(this.uri||h.url,g)},onTimeout:(u,h,f)=>{this.log(`Timeout loading steering manifest (${h.url})`),this.scheduleRefresh(this.uri||h.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(r,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const n=(s=this.hls)==null?void 0:s.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function $d(i,e,t,s){i&&Object.keys(e).forEach(n=>{const r=i.filter(o=>o.groupId===n).map(o=>{const a=ze({},o);return a.details=void 0,a.attrs=new nt(a.attrs),a.url=a.attrs.URI=k0(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[n],a.attrs["PATHWAY-ID"]=s,a});i.push(...r)})}function k0(i,e,t,s){const{HOST:n,PARAMS:r,[t]:o}=s;let a;e&&(a=o==null?void 0:o[e],a&&(i=a));const l=new self.URL(i);return n&&!a&&(l.host=n),r&&Object.keys(r).sort().forEach(c=>{c&&l.searchParams.set(c,r[c])}),l.href}function ps(i,e,t){Is(i,e,t),i.addEventListener(e,t)}function Is(i,e,t){i.removeEventListener(e,t)}class ir extends Vs{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=ir.CDMCleanupPromise?[ir.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:s,initData:n}=t,r=`"${t.type}" event: init data type: "${s}"`;if(this.debug(r),n!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=Or(this.config));const a=o.map(Kl).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=fa(o);if(s!=="sinf"||a!==lt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${a}`);return}let l;try{const d=vt(new Uint8Array(n)),g=sh(JSON.parse(d).sinf),m=Rp(g);if(!m)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(m.subarray(8,24))}catch(d){this.warn(`${r} Failed to parse sinf: ${d}`);return}const c=vi.hexDump(l),{keyIdToKeySessionPromise:u,mediaKeySessions:h}=this;let f=u[c];for(let d=0;d<h.length;d++){const g=h[d],m=g.decryptdata;if(!m.keyId)continue;const p=vi.hexDump(m.keyId);if(c===p||m.uri.replace(/-/g,"").indexOf(c)!==-1){if(f=u[p],!f)continue;if(m.pssh)break;delete u[p],m.pssh=new Uint8Array(n),m.keyId=l,f=u[c]=f.then(()=>this.generateRequestWithPreferredKeySession(g,s,n,"encrypted-event-key-match")),f.catch(y=>this.handleError(y));break}}f||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${h.length}.`))})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onWaitingForKey=null}registerListeners(){this.hls.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(v.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(v.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(v.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(v.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,n=t[e];if(n)return n.licenseUrl;if(e===lt.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(o,a,l)=>!!o&&l.indexOf(o)===a,n=t.map(o=>o.audioCodec).filter(s),r=t.map(o=>o.videoCodec).filter(s);return n.length+r.length===0&&r.push("avc1.42e01e"),new Promise((o,a)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,n,r).then(h=>o({keySystem:u,mediaKeys:h})).catch(h=>{c.length?l(c):h instanceof bs?a(h):a(new bs({type:me.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_NO_ACCESS,error:h,fatal:!0},h.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${s}`;return Gp===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return s(e,t)}getMediaKeysPromise(e,t,s){const n=FS(e,t,s,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e];let o=r==null?void 0:r.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${tt(n)}`),o=this.requestMediaKeySystemAccess(e,n);const a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),o.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const c=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),a.mediaKeys=l.createMediaKeys().then(u=>(this.log(`Media-keys created for "${e}"`),a.hasMediaKeys=!0,c.then(h=>h?this.setMediaKeysServerCertificate(u,e,h):u))),a.mediaKeys.catch(u=>{this.error(`Failed to create media-keys for "${e}"}: ${u}`)}),a.mediaKeys})}return o.then(()=>r.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${vi.hexDump(e.keyId||[])}`);const n=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),n=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return vi.hexDump(e.keyId)}updateKeySession(e,t){var s;const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyID ${vi.hexDump(((s=e.decryptdata)==null?void 0:s.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Kl(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>this.getKeySystemSelectionPromise(e).then(({keySystem:n})=>{const r=Kl(n);r?t(r):s(new Error(`Unable to find format for key-system "${n}"`))}).catch(s))}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Or(this.config),s=e.map(fa).filter(n=>!!n&&t.indexOf(n)!==-1);return this.selectKeySystem(s)}loadKey(e){const t=e.keyInfo.decryptdata,s=this.getKeyIdString(t),n=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);let r=this.keyIdToKeySessionPromise[s];return r||(r=this.getKeySystemForKeyPromise(t).then(({keySystem:a,mediaKeys:l})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(a,l).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:a,mediaKeys:l,decryptdata:t}))))),(this.keyIdToKeySessionPromise[s]=r.then(a=>{const l="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(a,l,c,"playlist-key")})).catch(a=>this.handleError(a))),r}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof bs?this.hls.trigger(v.ERROR,e.data):this.hls.trigger(v.ERROR,{type:me.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),s=this.keyIdToKeySessionPromise[t];if(!s){const n=fa(e.keyFormat),r=n?[n]:Or(this.config);return this.attemptKeySystemAccess(r)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=Or(this.config)),e.length===0)throw new bs({type:me.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${tt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(s).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>s.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,s,n){var r;const o=(r=this.config.drmSystems)==null||(r=r[e.keySystem])==null?void 0:r.generateRequest;if(o)try{const d=o.call(this.hls,t,s,e);if(!d)throw new Error("Invalid response from configured generateRequest filter");t=d.initDataType,s=d.initData?d.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(d){var a;if(this.warn(d.message),(a=this.hls)!=null&&a.config.debug)throw d}if(s===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${n}": ${l} (init data type: ${t} length: ${s?s.byteLength:null})`);const c=new nh,u=e._onmessage=d=>{const g=e.mediaKeysSession;if(!g){c.emit("error",new Error("invalid state"));return}const{messageType:m,message:p}=d;this.log(`"${m}" message event for session "${g.sessionId}" message size: ${p.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(e,p).catch(y=>{c.eventNames().length?c.emit("error",y):this.handleError(y)}):m==="license-release"?e.keySystem===lt.FAIRPLAY&&(this.updateKeySession(e,qc("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${m}"`)},h=e._onkeystatuseschange=d=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const m=e.keyStatus;c.emit("keyStatus",m),m==="expired"&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};ps(e.mediaKeysSession,"message",u),ps(e.mediaKeysSession,"keystatuseschange",h);const f=new Promise((d,g)=>{c.on("error",g),c.on("keyStatus",m=>{m.startsWith("usable")?d():m==="output-restricted"?g(new bs({type:me.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):m==="internal-error"?g(new bs({type:me.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${m}"`)):m==="expired"?g(new Error("key expired while generating request")):this.warn(`unhandled key status change "${m}"`)})});return e.mediaKeysSession.generateRequest(t,s).then(()=>{var d;this.log(`Request generated for key-session "${(d=e.mediaKeysSession)==null?void 0:d.sessionId}" keyId: ${l}`)}).catch(d=>{throw new bs({type:me.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_NO_SESSION,error:d,fatal:!1},`Error generating key-session request: ${d}`)}).then(()=>f).catch(d=>{throw c.removeAllListeners(),this.removeSession(e),d}).then(()=>(c.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,s)=>{if(typeof s=="string"&&typeof t=="object"){const n=s;s=t,t=n}this.log(`key status change "${t}" for keyStatuses keyId: ${vi.hexDump("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s))} session keyId: ${vi.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,s=t.loader,n=new s(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:r},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,d,g,m)=>{o(f.data)},onError:(f,d,g,m)=>{a(new bs({type:me.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:Ke({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${r}). Status: ${f.code} (${f.text})`))},onTimeout:(f,d,g)=>{a(new bs({type:me.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(f,d,g)=>{a(new Error("aborted"))}};n.load(l,u,h)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((n,r)=>{e.setServerCertificate(s).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${s==null?void 0:s.byteLength}) on "${t}"`),n(e)}).catch(o=>{r(new bs({type:me.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(n=>{throw new bs({type:me.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:n,fatal:!0},n.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=new DOMParser().parseFromString(s,"application/xml"),r=n.querySelectorAll("HttpHeader");if(r.length>0){let u;for(let h=0,f=r.length;h<f;h++){var o,a;u=r[h];const d=(o=u.querySelector("name"))==null?void 0:o.textContent,g=(a=u.querySelector("value"))==null?void 0:a.textContent;d&&g&&e.setRequestHeader(d,g)}}const l=n.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return qc(atob(c))}setupLicenseXHR(e,t,s,n){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,n)}).catch(o=>{if(!s.decryptdata)throw o;return e.open("POST",t,!0),r.call(this.hls,e,t,s,n)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||n})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((n,r)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,a,o,e)}catch(u){this.error(u)}n(l)}else{const l=s.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||a.status>=400&&a.status<500)r(new bs({type:me.KEY_SYSTEM_ERROR,details:M.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(n,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==lt.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,ps(s,"encrypted",this.onMediaEncrypted),ps(s,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(Is(e,"encrypted",this.onMediaEncrypted),Is(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ml.clearKeyUriToKeyIdMap();const n=s.length;ir.CDMCleanupPromise=Promise.all(s.map(r=>this.removeSession(r)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(r=>{var o;this.log(`Could not clear media keys: ${r}`),(o=this.hls)==null||o.trigger(v.ERROR,{type:me.OTHER_ERROR,details:M.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${r}`)})}))).catch(r=>{var o;this.log(`Could not close sessions and clear media keys: ${r}`),(o=this.hls)==null||o.trigger(v.ERROR,{type:me.OTHER_ERROR,details:M.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${r}`)})}).then(()=>{n&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((n,r)=>(n.indexOf(r.keyFormat)===-1&&n.push(r.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(e);n>-1&&this.mediaKeySessions.splice(n,1);const{drmSystemOptions:r}=this.config;return($S(r)?new Promise((a,l)=>{self.setTimeout(()=>l(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(a)}):Promise.resolve()).catch(a=>{var l;this.log(`Could not remove session: ${a}`),(l=this.hls)==null||l.trigger(v.ERROR,{type:me.OTHER_ERROR,details:M.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${a}`)})}).then(()=>t.close()).catch(a=>{var l;this.log(`Could not close session: ${a}`),(l=this.hls)==null||l.trigger(v.ERROR,{type:me.OTHER_ERROR,details:M.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${a}`)})})}}}ir.CDMCleanupPromise=void 0;class bs extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class sA{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(v.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(v.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const n=performance.now();if(t){if(this.lastTime){const r=n-this.lastTime,o=s-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/r,c=this.hls;if(c.trigger(v.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:s}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(v.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function C0(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function w0(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){Fe.debug(`[texttrack-utils]: ${s}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,i.addCue(n)}catch(n){Fe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}t==="disabled"&&(i.mode=t)}function qn(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let s=i.cues.length;s--;)e&&i.cues[s].removeEventListener("enter",e),i.removeCue(i.cues[s]);t==="disabled"&&(i.mode=t)}function su(i,e,t,s){const n=i.mode;if(n==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const r=nA(i.cues,e,t);for(let o=0;o<r.length;o++)(!s||s(r[o]))&&i.removeCue(r[o])}n==="disabled"&&(i.mode=n)}function iA(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let s=0,n=t,r;for(;s<=n;)if(r=Math.floor((n+s)/2),e<i[r].startTime)n=r-1;else if(e>i[r].startTime&&s<t)s=r+1;else return r;return i[s].startTime-e<e-i[n].startTime?s:n}function nA(i,e,t){const s=[],n=iA(i,e);if(n>-1)for(let r=n,o=i.length;r<o;r++){const a=i[r];if(a.startTime>=e&&a.endTime<=t)s.push(a);else if(a.startTime>t)return s}return s}function pa(i){const e=[];for(let t=0;t<i.length;t++){const s=i[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(i[t])}return e}class rA extends hh{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=pa(this.media.textTracks);for(let r=0;r<s.length;r++)if(s[r].mode==="hidden")t=s[r];else if(s[r].mode==="showing"){t=s[r];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(v.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;pa(s.textTracks).forEach(o=>{qn(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,o=this.tracksInGroup[s];if(!o||o.groupId!==n){this.warn(`Subtitle track with id:${s} and group:${n} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${s} "${o.name}" lang:${o.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||(n==null?void 0:n.length)!==(s==null?void 0:s.length)||s!=null&&s.some(o=>(n==null?void 0:n.indexOf(o))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(u=>!s||s.indexOf(u.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(u=>u.default)&&(this.selectDefaultTrack=!1),o.forEach((u,h)=>{u.id=h});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!r&&a){this.selectDefaultTrack=!1;const u=ii(a,o);if(u>-1)r=o[u];else{const h=ii(a,this.tracks);r=this.tracks[h]}}let l=this.findTrackId(r);l===-1&&r&&(l=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${s==null?void 0:s.join(",")}" group-id`),this.hls.trigger(v.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const r=t[n];if(!(s&&!r.default||!s&&!e)&&(!e||Sn(r,e)))return n}if(e){for(let n=0;n<t.length;n++){const r=t[n];if(po(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const r=t[n];if(po(e.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(Jc(n,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ke.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Sn(e,s))return s;const n=ii(e,this.tracksInGroup);if(n>-1){const r=this.tracksInGroup[n];return this.setSubtitleTrack(n),r}else{if(s)return null;{const r=ii(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(v.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=pa(e.textTracks),s=this.currentTrack;let n;if(s&&(n=t.filter(r=>Jc(s,r))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==n&&(r.mode="disabled")}),n){const r=this.subtitleDisplay?"showing":"hidden";n.mode!==r&&(n.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!oe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(v.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!n.details&&!n.details.live;if(e===this.trackId&&n===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:o,groupId:a="",name:l,type:c,url:u}=n;this.hls.trigger(v.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:u});const h=this.switchParams(n.url,s==null?void 0:s.details,n.details);this.loadPlaylist(h)}}function oA(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?r:r&3|8).toString(16)})}}}function Yr(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const nr=.025;let Va=function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i}({});function aA(i,e,t){return`${i.identifier}-${t+1}-${Yr(e)}`}class lA{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Zl(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=Zl(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=oe(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Zl(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<nr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Va.Range:Va.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return cA(this)}}function Zl(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<nr)?e.start:e.start+e.duration}function D0(i,e,t){const s=new self.URL(i,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function ec(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function cA(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function Kn(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class uA{constructor(e,t,s,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(v.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=n;const o=()=>{this.hasDetails=!0};r.once(v.LEVEL_LOADED,o),r.once(v.AUDIO_TRACK_LOADED,o),r.once(v.SUBTITLE_TRACK_LOADED,o),r.on(v.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(v.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,r.trigger(v.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e&&!e.url){let t=this.assetItem.uri;try{t=D0(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=this._bufferedEosTime||this.duration,n=this.timelineOffset,r=xe.bufferInfo(e,n,0);return this.getAssetTime(r.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=xe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var n;(n=this.hls)==null||n.on(e,t)}once(e,t,s){var n;(n=this.hls)==null||n.once(e,t)}off(e,t,s){var n;(n=this.hls)==null||n.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Kn(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Ud=.033;class hA extends Vs{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(r=n[s])!=null&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let n=0;n<s.length;n++){let r=s[n];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return n}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let n=e;n<=t&&s[n];n++){const r=s[n].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var s;if(((s=t[n].event)==null?void 0:s.identifier)===e)return n}return-1}findAssetIndex(e,t){const s=e.assetList,n=s.length;if(n>1)for(let r=0;r<n;r++){const o=s[r];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||r===n-1))return r}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,n=s[s.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:n}=s,r=this.events,o=this.parseDateRanges(n,{url:s.url},t),a=Object.keys(n),l=r?r.filter(c=>!a.includes(c.identifier)):[];o.length&&o.sort((c,u)=>{const h=c.cue.pre,f=c.cue.post,d=u.cue.pre,g=u.cue.post;if(h&&!d)return-1;if(d&&!h||f&&!g)return 1;if(g&&!f)return-1;if(!h&&!d&&!f&&!g){const m=c.startTime,p=u.startTime;if(m!==p)return m-p}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=o,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[]){const s=this.events||[];if(s.length||t.length||this.length<2){const n=this.items,r=this.parseSchedule(s,e);(t.length||(n==null?void 0:n.length)!==r.length||r.some((a,l)=>Math.abs(a.playout.start-n[l].playout.start)>.005||Math.abs(a.playout.end-n[l].playout.end)>.005))&&(this.items=r,this.onScheduleUpdate(t,n))}}parseDateRanges(e,t,s){const n=[],r=Object.keys(e);for(let o=0;o<r.length;o++){const a=r[o],l=e[a];if(l.isInterstitial){let c=this.eventMap[a];c?c.setDateRange(l):(c=new lA(l,t),this.eventMap[a]=c,s===!1&&(c.appendInPlace=s)),n.push(c)}}return n}parseSchedule(e,t){const s=[],n=t.main.details,r=n.live?1/0:n.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((u,h)=>{const f=u.cue.pre,d=u.cue.post,g=e[h-1]||null,m=u.appendInPlace,p=d?r:u.startOffset,y=u.duration,_=u.timelineOccupancy===Va.Range?y:0,T=u.resumptionOffset,E=(g==null?void 0:g.startTime)===p,S=p+u.cumulativeDuration;let R=m?S+y:p+T;if(f||!d&&p<=0){const L=c;c+=_,u.timelineStart=S;const A=o;o+=y,s.push({event:u,start:S,end:R,playout:{start:A,end:o},integrated:{start:L,end:c}})}else if(p<=r){if(!E){const k=p-l;if(k>Ud){const w=l,P=c;c+=k;const B=o;o+=k;const X={previousEvent:e[h-1]||null,nextEvent:u,start:w,end:w+k,playout:{start:B,end:o},integrated:{start:P,end:c}};s.push(X)}else k>0&&g&&(g.cumulativeDuration+=k,s[s.length-1].end=p)}d&&(R=S),u.timelineStart=S;const L=c;c+=_;const A=o;o+=y,s.push({event:u,start:S,end:R,playout:{start:A,end:o},integrated:{start:L,end:c}})}else return;const x=u.resumeTime;d||x>r?l=r:l=x}),l<r){var a;const u=l,h=c,f=r-l;c+=f;const d=o;o+=f,s.push({previousEvent:((a=s[s.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:u+f,playout:{start:d,end:o},integrated:{start:h,end:c}})}this.setDurations(r,o,c)}else s.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,n=s.live?1/0:s.edge;let r=0,o=-1;e.forEach((a,l)=>{const c=a.cue.pre,u=a.cue.post,h=c?0:u?n:a.startTime;this.updateAssetDurations(a),o===h?a.cumulativeDuration=r:(r=0,o=h),!u&&a.snapOptions.in&&(a.resumeAnchor=wn(null,s.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<Ud&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const d=oe(a.resumeOffset)?a.resumeOffset:a.duration;r+=d})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,n=e.startTime+e.resumptionOffset;return Math.abs(s-n)>nr?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${n}`),!1):t?!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(s>=l)return this.log(`"${e.identifier}" resumption ${s} past ${o} playlist end ${l}`),!1;const c=wn(null,a.fragments,s);if(!c)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const u=o==="audio"?.175:0;return Math.abs(c.start-s)<nr+u||Math.abs(c.end-s)<nr+u?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${o} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${s} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,n=!1,r=!1;e.assetList.forEach((o,a)=>{const l=t+s;o.startOffset=s,o.timelineStart=l,n||(n=o.duration===null),r||(r=!!o.error);const c=o.error?0:o.duration||0;s+=c}),n&&!r?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Di(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class fA{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let n;try{n=D0(s,this.hls.sessionId,e.baseUrl)}catch(f){const d=this.assignAssetListError(e,M.ASSET_LIST_LOAD_ERROR,f,s);this.hls.trigger(v.ERROR,d);return}t&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,o=r.loader,a=new o(r),l={responseType:"json",url:n.href},c=r.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,d,g,m)=>{const p=f.data,y=p==null?void 0:p.ASSETS;if(!Array.isArray(y)){const _=this.assignAssetListError(e,M.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,d,m);this.hls.trigger(v.ERROR,_);return}e.assetListResponse=p,this.hls.trigger(v.ASSET_LIST_LOADED,{event:e,assetListResponse:p,networkDetails:m})},onError:(f,d,g,m)=>{const p=this.assignAssetListError(e,M.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${d.url})`),d.url,m,g);this.hls.trigger(v.ERROR,p)},onTimeout:(f,d,g)=>{const m=this.assignAssetListError(e,M.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${d.url})`),d.url,f,g);this.hls.trigger(v.ERROR,m)}};return a.load(l,u,h),this.hls.trigger(v.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,s,n,r,o){return e.error=s,{type:me.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:s,networkDetails:o,stats:r}}}function Bd(i){i==null||i.play().catch(()=>{})}class dA extends Vs{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const n=s-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const o=n<=-.01;this.timelinePos=s,this.bufferedPos=s;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(s,s-n)&&this.updateSchedule(),this.checkBuffer(),o&&s<a.start||s>=a.end){var l;const f=this.findItemIndex(a);let d=this.schedule.findItemIndexAtTime(s);if(d===-1&&(d=f+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${s} (resolving from ${f} to ${d})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&d>f){const g=this.schedule.findJumpRestrictedIndex(f+1,d);if(g>f){this.setSchedulePosition(g);return}}this.setSchedulePosition(d);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(a)){const f=a.event.assetList[0];f&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,f))}return}const u=c.timelineStart,h=c.duration||0;(o&&s<u||s>=u+h)&&this.setScheduleToAssetAtTime(s,c)},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(s>=n.end){this.timelinePos=n.end;const a=this.findItemIndex(n);this.setSchedulePosition(a+1)}const r=this.playingAsset;if(!r)return;const o=r.timelineStart+(r.duration||0);s>=o&&this.setScheduleToAssetAtTime(s,r)},this.onScheduleUpdate=(s,n)=>{const r=this.schedule;if(!r)return;const o=this.playingItem,a=r.events||[],l=r.items||[],c=r.durations,u=s.map(m=>m.identifier),h=!!(a.length||u.length);(h||n)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(m=>Di(m))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let f=null,d=null;o&&(f=this.updateItem(o,this.timelinePos),this.itemsMatch(o,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const g=this.bufferingItem;if(g&&(d=this.updateItem(g,this.bufferedPos),this.itemsMatch(g,d)?this.bufferingItem=d:g.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(g.event,null))),s.forEach(m=>{m.assetList.forEach(p=>{this.clearAssetPlayer(p.identifier,null)})}),this.playerQueue.forEach(m=>{if(m.interstitial.appendInPlace){const p=m.assetItem.timelineStart,y=m.timelineOffset-p;if(y)try{m.timelineOffset=p}catch(_){Math.abs(y)>nr&&this.warn(`${_} ("${m.assetId}" ${m.timelineOffset}->${p})`)}}}),h||n){if(this.hls.trigger(v.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(o)&&u.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(f,o),g&&this.trimInPlace(d,g),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new fA(e),this.schedule=new hA(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(v.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(v.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(v.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(v.BUFFER_APPENDED,this.onBufferAppended,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(v.MEDIA_ENDED,this.onMediaEnded,this),e.on(v.ERROR,this.onError,this),e.on(v.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(v.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(v.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(v.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.BUFFER_APPENDED,this.onBufferAppended,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(v.MEDIA_ENDED,this.onMediaEnded,this),e.off(v.ERROR,this.onError,this),e.off(v.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Is(e,"play",this.onPlay),Is(e,"pause",this.onPause),Is(e,"seeking",this.onSeeking),Is(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;ps(s,"seeking",this.onSeeking),ps(s,"timeupdate",this.onTimeupdate),ps(s,"play",this.onPlay),ps(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!n){this.clearScheduleState();const r=this.findItemIndex(s);this.setSchedulePosition(r)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(this.media=null,!s&&(n&&this.removeMediaListeners(n),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=h=>h&&e.getAssetPlayer(h.identifier),n=(h,f,d,g,m)=>{if(h){let p=h[f].start;const y=h.event;if(y){if(f==="playout"||y.timelineOccupancy!==Va.Point){const _=s(d);(_==null?void 0:_.interstitial)===y&&(p+=_.assetItem.startOffset+_[m])}}else{const _=g==="bufferedPos"?o():e[g];p+=_-h.start}return p}return 0},r=(h,f)=>{var d;if(h!==0&&f!=="primary"&&(d=e.schedule)!=null&&d.length){var g;const m=e.schedule.findItemIndexAtTime(h),p=(g=e.schedule.items)==null?void 0:g[m];if(p){const y=p[f].start-p.start;return h+y}}return h},o=()=>{const h=e.bufferedPos;return h===Number.MAX_VALUE?a("primary"):Math.max(h,0)},a=h=>{var f,d;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((d=e.schedule)==null?void 0:d.durations[h])||0},l=(h,f)=>{var d,g;const m=e.effectivePlayingItem;if(m!=null&&(d=m.event)!=null&&d.restrictions.skip||!e.schedule)return;e.log(`seek to ${h} "${f}"`);const p=e.effectivePlayingItem,y=e.schedule.findItemIndexAtTime(h,f),_=(g=e.schedule.items)==null?void 0:g[y],T=e.getBufferingPlayer(),E=T==null?void 0:T.interstitial,S=E==null?void 0:E.appendInPlace,R=p&&e.itemsMatch(p,_);if(p&&(S||R)){const x=s(e.playingAsset),L=(x==null?void 0:x.media)||e.primaryMedia;if(L){const A=f==="primary"?L.currentTime:n(p,f,e.playingAsset,"timelinePos","currentTime"),k=h-A,w=(S?A:L.currentTime)+k;if(w>=0&&(!x||S||w<=x.duration)){L.currentTime=w;return}}}if(_){let x=h;if(f!=="primary"){const A=_[f].start,k=h-A;x=_.start+k}const L=!e.isInterstitial(_);if((!e.isInterstitial(p)||p.event.appendInPlace)&&(L||_.event.appendInPlace)){const A=e.media||(S?T==null?void 0:T.media:null);A&&(A.currentTime=x)}else if(p){const A=e.findItemIndex(p);if(y>A){const w=e.schedule.findJumpRestrictedIndex(A+1,y);if(w>A){e.setSchedulePosition(w);return}}let k=0;if(L)e.timelinePos=x,e.checkBuffer();else{const w=_.event.assetList,P=h-(_[f]||_).start;for(let B=w.length;B--;){const X=w[B];if(X.duration&&P>=X.startOffset&&P<X.startOffset+X.duration){k=B;break}}}e.setSchedulePosition(y,k)}}},c=()=>{const h=e.effectivePlayingItem;if(e.isInterstitial(h))return h;const f=t();return e.isInterstitial(f)?f:null},u={get bufferedEnd(){const h=t(),f=e.bufferingItem;if(f&&f===h){var d;return n(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((d=e.bufferingAsset)==null?void 0:d.startOffset)||0}return 0},get currentTime(){const h=c(),f=e.effectivePlayingItem;return f&&f===h?n(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(h){const f=c(),d=e.effectivePlayingItem;d&&d===f&&l(h+d.playout.start,"playout")},get duration(){const h=c();return h?h.playout.end-h.playout.start:0},get assetPlayers(){var h;const f=(h=c())==null?void 0:h.event.assetList;return f?f.map(d=>e.getAssetPlayer(d.identifier)):[]},get playingIndex(){var h;const f=(h=c())==null?void 0:h.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var h;return((h=e.schedule)==null||(h=h.events)==null?void 0:h.slice(0))||[]},get schedule(){var h;return((h=e.schedule)==null||(h=h.items)==null?void 0:h.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const h=t();return e.findItemIndex(h)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const h=e.effectivePlayingItem;return e.findItemIndex(h)},primary:{get bufferedEnd(){return o()},get currentTime(){const h=e.timelinePos;return h>0?h:0},set currentTime(h){l(h,"primary")},get duration(){return a("primary")},get seekableStart(){var h;return((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(h){l(h,"integrated")},get duration(){return a("integrated")},get seekableStart(){var h;return r(((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0,"integrated")}},skip:()=>{const h=e.effectivePlayingItem,f=h==null?void 0:h.event;if(f&&!f.restrictions.skip){const d=e.findItemIndex(h);if(f.appendInPlace){const g=h.playout.start+h.event.duration;l(g+.001,"playout")}else e.advanceAfterAssetEnded(f,d,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let n=this.media;!n&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(n=this.primaryMedia);const r=(t=n)==null?void 0:t.currentTime;if(!(r===void 0||!oe(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,n=e.media;if(s&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n){this.detachedData={media:n};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${tt(r)}`),this.detachedData=r}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var s,n;if(e.media===t)return;let r=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,c=(s=this.detachedData)==null?void 0:s.mediaSource;let u;if(o.media)l&&(r=o.transferMedia(),this.detachedData=r),u="Primary";else if(c){const g=this.getBufferingPlayer();g?(r=g.transferMedia(),u=`${g}`):u="detached MediaSource"}else u="detached media";if(!r){if(c)r=this.detachedData,this.log(`using detachedData: MediaSource ${tt(r)}`);else if(!this.detachedData||o.media===t){const g=this.playerQueue;g.length>1&&g.forEach(m=>{if(a&&m.interstitial.appendInPlace!==l){const p=m.interstitial;this.clearInterstitial(m.interstitial,null),p.appendInPlace=!1,p.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${p}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const h=r&&"mediaSource"in r&&((n=r.mediaSource)==null?void 0:n.readyState)!=="closed",f=h&&r?r:t;this.log(`${h?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const d=this.schedule;if(f===r&&d){const g=a&&e.assetId===d.assetIdAtEnd;f.overrides={duration:d.duration,endOfStream:!a||g,cueRemoval:!a}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,n=this.effectivePlayingItem;if(s===-1){const r=this.hls.startPosition;if(this.timelinePos=r,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(r>=0||!this.primaryLive){const o=this.timelinePos=r>0?r:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(n&&!this.playingItem){const r=e.findItemIndex(n);this.setSchedulePosition(r)}}advanceAssetBuffering(e,t){const s=e.event,n=s.findAssetIndex(t),r=ec(s,n);if(!s.isAssetPastPlayoutLimit(r))this.bufferedToEvent(e,r);else if(this.schedule){var o;const a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,s){const n=ec(e,s);if(e.isAssetPastPlayoutLimit(n)){if(this.schedule){const r=this.schedule.items;if(r){const o=t+1,a=r.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const r=e.assetList[n];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(t,n)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const n=t.parentIdentifier,r=s.getEvent(n);if(r){const o=s.findEventIndex(n),a=s.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,o,a-1)}}setSchedulePosition(e,t){var s;const n=(s=this.schedule)==null?void 0:s.items;if(!n||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const r=e>=0?n[e]:null,o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const u=o.event,h=this.playingAsset,f=h==null?void 0:h.identifier,d=f?this.getAssetPlayer(f):null;if(d&&f&&(!this.eventItemsMatch(o,r)||t!==void 0&&f!==u.assetList[t].identifier)){var l;const g=u.findAssetIndex(h);if(this.log(`INTERSTITIAL_ASSET_ENDED ${g+1}/${u.assetList.length} ${Kn(h)}`),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(v.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:g,event:u,schedule:n.slice(0),scheduleIndex:e,player:d}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),g);return}this.retreiveMediaSource(f,r),d.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&d.detachMedia()}if(!this.eventItemsMatch(o,r)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${Di(o)}`),u.hasPlayed=!0,this.hls.trigger(v.INTERSTITIAL_ENDED,{event:u,schedule:n.slice(0),scheduleIndex:e}),u.cue.once)){var c;this.updateSchedule();const g=(c=this.schedule)==null?void 0:c.items;if(r&&g){const m=this.findItemIndex(r);this.advanceSchedule(m,g,t,o,a)}return}}this.advanceSchedule(e,n,t,o,a)}advanceSchedule(e,t,s,n,r){const o=this.schedule;if(!o)return;const a=e>=0?t[e]:null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(u=>{const h=u.interstitial,f=o.findEventIndex(h.identifier);(f<e||f>e+1)&&this.clearInterstitial(h,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const u=a.event;if(s===void 0){s=o.findAssetIndex(u,this.timelinePos);const g=ec(u,s-1);if(u.isAssetPastPlayoutLimit(g)||u.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(u,e,s);return}s=g}const h=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let f=this.preloadAssets(u,s);if(this.eventItemsMatch(a,h||n)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${Di(a)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(v.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const d=u.assetList[s];if(!d){this.advanceAfterAssetEnded(u,e,s||0);return}if(f||(f=this.getAssetPlayer(d.identifier)),f===null||f.destroyed){const g=u.assetList.length;this.warn(`asset ${s+1}/${g} player destroyed ${u}`),f=this.createAssetPlayer(u,d,s),f.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(d))return;this.startAssetPlayer(f,s,t,e,l),this.shouldPlay&&Bd(f.media)}else a!==null?(this.resumePrimary(a,e,n),this.shouldPlay&&Bd(this.hls.media)):r&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var n,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Di(e)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.timelinePos=a),this.attachPrimary(a,e)}if(!s)return;const o=(r=this.schedule)==null?void 0:r.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Di(e)}`),this.hls.trigger(v.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const n=this.primaryDetails;if(t===0)return this.hls.startPosition;if(n&&(s<n.fragmentStart||s>n.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:xe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,n),s&&this.startLoadingPrimaryAt(e,s)),s||(this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((s=n.mainForwardBufferInfo)==null?void 0:s.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(v.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(v.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level],n=Ke(Ke({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=Ke(Ke({},this.altSelection),{},{audio:s});return}const r=Ke(Ke({},n),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=Ke(Ke({},this.altSelection),{},{subtitles:s});return}const r=Ke(Ke({},n),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=ed(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setAudioOption(t)||n.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=ed(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setSubtitleOption(t)||t.id!==-1&&n.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let n=0;n<t.length;n++){const r=t[n];if(r.cue.post){var s;const o=this.schedule.findEventIndex(r.identifier),a=(s=this.schedule.items)==null?void 0:s[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const n=(s=this.schedule)==null?void 0:s.items;if(e&&n){const r=this.findItemIndex(e,t);return n[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(r.identifier,null)});const s=e.end+.25,n=xe.bufferInfo(this.primaryMedia,s,0);(n.end>s||(n.nextStart||0)>s)&&(this.attachPrimary(s,null),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(){var e;const t=this.mediaSelection;t&&((e=this.schedule)==null||e.updateSchedule(t,[]))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const n=xe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,s,e)}updateBufferedPos(e,t,s){const n=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!n)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const u=this.findItemIndex(r),h=Math.min(u+1,t.length-1),f=t[h];if((l===-1&&r&&e>=r.end||(c=f.event)!=null&&c.appendInPlace&&e+.01>=f.start)&&(l=h),this.isInterstitial(r)){const d=r.event;if(h-a>1&&d.appendInPlace===!1||d.assetList.length===0&&d.assetListLoader)return}if(this.bufferedPos=e,l>u&&l>a)this.bufferedToItem(f);else{const d=this.primaryDetails;this.primaryLive&&d&&e>d.edge-d.targetduration&&f.start<d.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else s&&o&&!this.itemsMatch(o,r)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(n=>{const r=this.getAssetPlayer(n.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:n,events:r}=s;if(!n||!r)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Di(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const c=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((u,h)=>{const f=this.getAssetPlayer(u.identifier);f&&(h===c&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(v.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,n=s.assetList.length===0&&!s.assetListLoader,r=s.cue.once;if(n||!r){const o=this.preloadAssets(s,t);if(o!=null&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){const s=e.assetUrl,n=e.assetList.length,r=n===0&&!e.assetListLoader,o=e.cue.once;if(r){const l=e.timelineStart;if(e.appendInPlace){var a;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(a=f.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const f=u-l;f>0&&(c=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:n} ${e}${c?` live-start: ${u} start-offset: ${c}`:""}`),s)return this.createAsset(e,0,0,l,e.duration,s);const h=this.assetListLoader.loadAssetList(e,c);h&&(e.assetListLoader=h)}else if(!o&&n){for(let c=t;c<n;c++){const u=e.assetList[c],h=this.getAssetPlayerQueueIndex(u.identifier);(h===-1||this.playerQueue[h].destroyed)&&!u.error&&this.createAssetPlayer(e,u,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(n=>{this.hls.trigger(v.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,n,r,o){const a={parentIdentifier:e.identifier,identifier:aA(e,o,t),duration:r,startOffset:s,timelineStart:n,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,s){const n=this.hls,r=n.userConfig;let o=r.videoPreference;const a=n.loadLevelObj||n.levels[n.currentLevel];(o||a)&&(o=ze({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=n.audioTracks[n.audioTrack],c=n.subtitleTracks[n.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const E=this.timelinePos-t.timelineStart;if(E>1){const S=t.duration;S&&E<S&&(u=E)}}const h=t.identifier,f=Ke(Ke({},r),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:h,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||r.audioPreference,subtitlePreference:c||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const d=f.cmcd;d!=null&&d.sessionId&&d.contentId&&(f.cmcd=ze({},d,{contentId:Yr(t.uri)})),this.getAssetPlayer(h)&&this.warn(`Duplicate date range identifier ${e} and asset ${h}`);const g=new uA(this.HlsPlayerClass,f,e,t);this.playerQueue.push(g),e.assetList[s]=t;let m=!0;const p=E=>{if(E.live){var S;const L=new Error(`Interstitials MUST be VOD assets ${e}`),A={fatal:!0,type:me.OTHER_ERROR,details:M.INTERSTITIAL_ASSET_ITEM_ERROR,error:L},k=((S=this.schedule)==null?void 0:S.findEventIndex(e.identifier))||-1;this.handleAssetItemError(A,e,k,s,L.message);return}const R=E.edge-E.fragmentStart,x=t.duration;(m||x===null||R>x)&&(m=!1,this.log(`Interstitial asset "${h}" duration change ${x} > ${R}`),t.duration=R,this.updateSchedule())};g.on(v.LEVEL_UPDATED,(E,{details:S})=>p(S)),g.on(v.LEVEL_PTS_UPDATED,(E,{details:S})=>p(S)),g.on(v.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const y=(E,S)=>{const R=this.getAssetPlayer(h);if(R&&S.tracks){R.off(v.BUFFER_CODECS,y),R.tracks=S.tracks;const x=this.primaryMedia;this.bufferingAsset===R.assetItem&&x&&!R.media&&this.bufferAssetPlayer(R,x)}};g.on(v.BUFFER_CODECS,y);const _=()=>{var E;const S=this.getAssetPlayer(h);if(this.log(`buffered to end of asset ${S}`),!S||!this.schedule)return;const R=this.schedule.findEventIndex(e.identifier),x=(E=this.schedule.items)==null?void 0:E[R];this.isInterstitial(x)&&this.advanceAssetBuffering(x,t)};g.on(v.BUFFERED_TO_END,_);const T=E=>()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;this.shouldPlay=!0;const R=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,R,E)};return g.once(v.MEDIA_ENDED,T(s)),g.once(v.PLAYOUT_LIMIT_REACHED,T(1/0)),g.on(v.ERROR,(E,S)=>{if(!this.schedule)return;const R=this.getAssetPlayer(h);if(S.details===M.BUFFER_STALLED_ERROR){if(R!=null&&R.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(S,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${S.error} ${e}`)}),g.on(v.DESTROYING,()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;const S=new Error(`Asset player destroyed unexpectedly ${h}`),R={fatal:!0,type:me.OTHER_ERROR,details:M.INTERSTITIAL_ASSET_ITEM_ERROR,error:S};this.handleAssetItemError(R,e,this.schedule.findEventIndex(e.identifier),s,S.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Kn(t)}`),this.hls.trigger(v.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:g}),g}clearInterstitial(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){this.log(`clear asset player "${e}" toSegment: ${t&&Di(t)}`);const n=this.playerQueue[s];this.transferMediaFromPlayer(n,t),this.playerQueue.splice(s,1),n.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,n,r){const{interstitial:o,assetItem:a,assetId:l}=e,c=o.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,s[n]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${Kn(a)}`),this.hls.trigger(v.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:s.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,n;if(!this.schedule)return;const{interstitial:r,assetItem:o}=e,a=this.schedule.findEventIndex(r.identifier),l=(s=this.schedule.items)==null?void 0:s[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const u=r.appendInPlace;if(u&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const h=(c==null?void 0:c.tracks)||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(u&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(h&&!_p(h,e.tracks)){const f=new Error(`Asset ${Kn(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),d={fatal:!0,type:me.OTHER_ERROR,details:M.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},g=r.findAssetIndex(o);this.handleAssetItemError(d,r,a,g,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const n=s.currentTime,r=t.findAssetIndex(e,n),o=e.assetList[r];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||n-o.timelineStart,c=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${a} ${e} (media.currentTime: ${n})`),l&&(c/s.playbackRate<.5||a.bufferedInPlaceToEnd(s))&&a.hls){const u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,n,r){if(e.details===M.BUFFER_STALLED_ERROR)return;const o=t.assetList[n]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Kn(o)} ${e.error}`),!this.schedule)return;const a=(o==null?void 0:o.identifier)||"",l=this.getAssetPlayerQueueIndex(a),c=this.playerQueue[l]||null,u=this.schedule.items,h=ze({},e,{fatal:!1,errorAction:ho(!0),asset:o,assetListIndex:n,event:t,schedule:u,scheduleIndex:s,player:c});if(this.hls.trigger(v.INTERSTITIAL_ASSET_ERROR,h),!e.fatal)return;const f=this.playingAsset,d=this.bufferingAsset,g=new Error(r);if(o&&(this.clearAssetPlayer(a,null),o.error=g),!t.assetList.some(m=>!m.error))t.error=g;else{for(let m=n;m<t.assetList.length;m++)this.resetAssetPlayer(t.assetList[m].identifier);this.updateSchedule()}t.error?this.primaryFallback(t):f&&f.identifier===a?this.advanceAfterAssetEnded(t,s,n):d&&d.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,d)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;if(this.updateSchedule(),s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${Di(s)} error: ${e.error}`);let n=this.timelinePos;n===-1&&(n=this.hls.startPosition);const r=this.updateItem(s,n);if(this.itemsMatch(s,r)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const o=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(o)}else this.checkStart()}onAssetListLoaded(e,t){var s,n;const r=t.event,o=r.identifier,a=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(o)))return;const l=r.timelineStart,c=r.duration;let u=0;a.forEach((m,p)=>{const y=parseFloat(m.DURATION);this.createAsset(r,p,u,l+u,y,m.URI),u+=y}),r.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${c}) ${r}`);const h=this.waitingItem,f=(h==null?void 0:h.event.identifier)===o;this.updateSchedule();const d=(n=this.bufferingItem)==null?void 0:n.event;if(f){var g;const m=this.schedule.findEventIndex(o),p=(g=this.schedule.items)==null?void 0:g[m];if(p){if(!this.playingItem&&this.timelinePos>p.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==m){r.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${r}`),this.primaryFallback(r);return}this.setBufferingItem(p)}this.setSchedulePosition(m)}else if((d==null?void 0:d.identifier)===o){const m=r.assetList[0];if(m){const p=this.getAssetPlayer(m.identifier);if(d.appendInPlace){const y=this.primaryMedia;p&&y&&this.bufferAssetPlayer(p,y)}else p&&p.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case M.ASSET_LIST_PARSING_ERROR:case M.ASSET_LIST_LOAD_ERROR:case M.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&this.primaryFallback(s);break}case M.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Gd=500;class gA extends ih{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",de.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(v.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(v.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=V.IDLE,this.setInterval(Gd),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:n}=t;if(this.fragContextChanged(s)||(pt(s)&&(this.fragPrevious=s),this.state=V.IDLE),!n)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let o;const a=s.start;for(let c=0;c<r.length;c++)if(a>=r[c].start&&a<=r[c].end){o=r[c];break}const l=s.start+s.duration;o?o.end=l:(o={start:a,end:l},r.push(o)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:n}=t;if(s===0&&n!==Number.POSITIVE_INFINITY){const r=n-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=r){o.shift();continue}else if(o[a].start<r)o[a].start=r;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(s,r,de.SUBTITLE)}}onError(e,t){const s=t.frag;(s==null?void 0:s.type)===de.SUBTITLE&&(t.details===M.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==V.STOPPED&&(this.state=V.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&y0(this.levels,t)){this.levels=t.map(s=>new uo(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const n=new uo(s);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,de.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==V.STOPPED&&this.setInterval(Gd)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:n,levels:r}=this,{details:o,id:a}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=r[a];if(a>=r.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||(s=l.details)!=null&&s.live){if(o.deltaUpdateFailed)return;const h=this.mainDetails;if(!h){this.startFragRequested=!1;return}const f=h.fragments[0];if(!l.details)o.hasProgramDateTime&&h.hasProgramDateTime?(Ga(o,h),c=o.fragmentStart):f&&(c=f.start,jc(o,c));else{var u;c=this.alignPlaylists(o,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&f&&(c=f.start,jc(o,c))}h&&!this.startFragRequested&&this.setStartPosition(h,c)}l.details=o,this.levelLastLoaded=l,a===n&&(this.hls.trigger(v.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===V.IDLE&&(wn(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,n=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&n!=null&&n.key&&n.iv&&sr(n.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(s),n.key.buffer,n.iv.buffer,th(n.method)).catch(a=>{throw r.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();r.trigger(v.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=V.IDLE})}}doTick(){if(!this.media){this.state=V.IDLE;return}if(this.state===V.IDLE){const{currentTrackId:e,levels:t}=this,s=t==null?void 0:t[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:n}=this,r=this.getLoadPosition(),o=xe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,n.maxBufferHole),{end:a,len:l}=o,c=s.details,u=this.hls.maxBufferLength+c.levelTargetDuration;if(l>u)return;const h=c.fragments,f=h.length,d=c.edge;let g=null;const m=this.fragPrevious;if(a<d){const _=n.maxFragLookUpTolerance,T=a>d-_?0:_;g=wn(m,h,Math.max(h[0].start,a),T),!g&&m&&m.start<h[0].start&&(g=h[0])}else g=h[f-1];if(g=this.filterReplacedPrimary(g,s.details),!g)return;const p=g.sn-c.startSN,y=h[p-1];if(y&&y.cc===g.cc&&this.fragmentTracker.getState(y)===Tt.NOT_LOADED&&(g=y),this.fragmentTracker.getState(g)===Tt.NOT_LOADED){const _=this.mapToInitFragWhenRequired(g);_&&this.loadFragment(_,s,a)}}}loadFragment(e,t,s){pt(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new mA(this.tracksBuffered[this.currentTrackId]||[])}}class mA{constructor(e){this.buffered=void 0;const t=(s,n,r)=>{if(n=n>>>0,n>r-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${r})`);return e[n][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const pA={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},P0=i=>String.fromCharCode(pA[i]||i),Fs=15,mi=100,yA={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},vA={17:2,18:4,21:6,22:8,23:10,19:13,20:15},TA={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},_A={25:2,26:4,29:6,30:8,31:10,27:13,28:15},EA=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class SA{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;Fe.log(`${this.time} [${e}] ${s}`)}}}const an=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class O0{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const n=t[s];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class xA{constructor(){this.uchar=" ",this.penState=new O0}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class bA{constructor(e){this.chars=[],this.pos=0,this.currPenState=new O0,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<mi;t++)this.chars.push(new xA);this.logger=e}equals(e){for(let t=0;t<mi;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<mi;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<mi;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>mi&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=mi)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=P0(e);if(this.pos>=mi){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<mi;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<mi;s++){const n=this.chars[s].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class tc{constructor(e){this.rows=[],this.currRow=Fs-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Fs;t++)this.rows.push(new bA(e));this.logger=e}reset(){for(let e=0;e<Fs;e++)this.rows[e].clear();this.currRow=Fs-1}equals(e){let t=!0;for(let s=0;s<Fs;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Fs;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Fs;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+tt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<Fs;a++)this.rows[a].clear();const r=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[r].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[r+c])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,o=Math.max(r-1,0);s.setCursor(e.indent),e.color=s.chars[o].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+tt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",n=-1;for(let r=0;r<Fs;r++){const o=this.rows[r].getTextString();o&&(n=r+1,e?t.push("Row "+n+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class Hd{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new tc(s),this.nonDisplayedMemory=new tc(s),this.lastOutputScreen=new tc(s),this.currRollUpRow=this.displayedMemory.rows[Fs-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Fs-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[s]}this.logger.log(2,"MIDROW: "+tt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Vd{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=LA(),this.logger=void 0;const n=this.logger=new SA;this.channels=[null,new Hd(e,t,n),new Hd(e+1,s,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const n=t[s]&127,r=t[s+1]&127;let o=!1,a=null;if(n===0&&r===0)continue;this.logger.log(3,()=>"["+an([t[s],t[s+1]])+"] -> ("+an([n,r])+")");const l=this.cmdHistory;if(n>=16&&n<=31){if(AA(n,r,l)){jo(null,null,l),this.logger.log(3,()=>"Repeated command ("+an([n,r])+") is dropped");continue}jo(n,r,this.cmdHistory),o=this.parseCmd(n,r),o||(o=this.parseMidrow(n,r)),o||(o=this.parsePAC(n,r)),o||(o=this.parseBackgroundAttributes(n,r))}else jo(null,null,l);if(!o&&(a=this.parseChars(n,r),a)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+an([n,r])+" orig: "+an([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(s||n))return!1;const r=e===20||e===21||e===23?1:2,o=this.channels[r];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[s];return n?(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+an([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(n||r))return!1;const o=e<=23?1:2;t>=64&&t<=95?s=o===1?yA[e]:TA[e]:s=o===1?vA[e]:_A[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(s,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let s;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,n.underline=(s&1)===1,s<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((s-16)/2)*4,n}parseChars(e,t){let s,n=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let o;r===17?o=t+80:r===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+P0(o)+"' in channel "+s),n=[o]}else e>=32&&e<=127&&(n=t===0?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+an(n).join(",")),n}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=45&&t<=47;if(!(s||n))return!1;let r;const o={};e===16||e===24?(r=Math.floor((t-32)/2),o.background=EA[r],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}jo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function jo(i,e,t){t.a=i,t.b=e}function AA(i,e,t){return t.a===i&&t.b===e}function LA(){return{a:null,b:null}}var mh=function(){if(Ba!=null&&Ba.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const c=l.toLowerCase();return~a.indexOf(c)?c:!1}function s(a){return t(i,a)}function n(a){return t(e,a)}function r(a,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const h in u)a[h]=u[h]}return a}function o(a,l,c){const u=this,h={enumerable:!0};u.hasBeenReset=!1;let f="",d=!1,g=a,m=l,p=c,y=null,_="",T=!0,E="auto",S="start",R=50,x="middle",L=50,A="middle";Object.defineProperty(u,"id",r({},h,{get:function(){return f},set:function(k){f=""+k}})),Object.defineProperty(u,"pauseOnExit",r({},h,{get:function(){return d},set:function(k){d=!!k}})),Object.defineProperty(u,"startTime",r({},h,{get:function(){return g},set:function(k){if(typeof k!="number")throw new TypeError("Start time must be set to a number.");g=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",r({},h,{get:function(){return m},set:function(k){if(typeof k!="number")throw new TypeError("End time must be set to a number.");m=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",r({},h,{get:function(){return p},set:function(k){p=""+k,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",r({},h,{get:function(){return y},set:function(k){y=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",r({},h,{get:function(){return _},set:function(k){const w=s(k);if(w===!1)throw new SyntaxError("An invalid or illegal string was specified.");_=w,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",r({},h,{get:function(){return T},set:function(k){T=!!k,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",r({},h,{get:function(){return E},set:function(k){if(typeof k!="number"&&k!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");E=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",r({},h,{get:function(){return S},set:function(k){const w=n(k);if(!w)throw new SyntaxError("An invalid or illegal string was specified.");S=w,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",r({},h,{get:function(){return R},set:function(k){if(k<0||k>100)throw new Error("Position must be between 0 and 100.");R=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",r({},h,{get:function(){return x},set:function(k){const w=n(k);if(!w)throw new SyntaxError("An invalid or illegal string was specified.");x=w,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",r({},h,{get:function(){return L},set:function(k){if(k<0||k>100)throw new Error("Size must be between 0 and 100.");L=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",r({},h,{get:function(){return A},set:function(k){const w=n(k);if(!w)throw new SyntaxError("An invalid or illegal string was specified.");A=w,this.hasBeenReset=!0}})),u.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class IA{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function M0(i){function e(s,n,r,o){return(s|0)*3600+(n|0)*60+(r|0)+parseFloat(o||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class RA{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let n=0;n<s.length;++n)if(t===s[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function F0(i,e,t,s){const n=s?i.split(s):[i];for(const r in n){if(typeof n[r]!="string")continue;const o=n[r].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const iu=new mh(0,0,""),Xo=iu.align==="middle"?"middle":"center";function kA(i,e,t){const s=i;function n(){const a=M0(i);if(a===null)throw new Error("Malformed timestamp: "+s);return i=i.replace(/^[^\sa-zA-Z-]+/,""),a}function r(a,l){const c=new RA;F0(a,function(f,d){let g;switch(f){case"region":for(let m=t.length-1;m>=0;m--)if(t[m].id===d){c.set(f,t[m].region);break}break;case"vertical":c.alt(f,d,["rl","lr"]);break;case"line":g=d.split(","),c.integer(f,g[0]),c.percent(f,g[0])&&c.set("snapToLines",!1),c.alt(f,g[0],["auto"]),g.length===2&&c.alt("lineAlign",g[1],["start",Xo,"end"]);break;case"position":g=d.split(","),c.percent(f,g[0]),g.length===2&&c.alt("positionAlign",g[1],["start",Xo,"end","line-left","line-right","auto"]);break;case"size":c.percent(f,d);break;case"align":c.alt(f,d,["start",Xo,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&iu.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",Xo);let h=c.get("position","auto");h==="auto"&&iu.position===50&&(h=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=h}function o(){i=i.replace(/^\s+/,"")}if(o(),e.startTime=n(),o(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);i=i.slice(3),o(),e.endTime=n(),o(),r(i,e)}function N0(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class CA{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new IA,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let r=t.buffer,o=0;for(r=N0(r);o<r.length&&r[o]!=="\r"&&r[o]!==`
`;)++o;const a=r.slice(0,o);return r[o]==="\r"&&++o,r[o]===`
`&&++o,t.buffer=r.slice(o),a}function n(r){F0(r,function(o,a){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=s();const a=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:r=s(),t.state){case"HEADER":/:/.test(r)?n(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new mh(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{kA(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=r.indexOf("-->")!==-1;if(!r||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const wA=/\r\n|\n\r|\n|\r/g,sc=function(e,t,s=0){return e.slice(s,s+t.length)===t},DA=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!oe(t)||!oe(s)||!oe(n)||!oe(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*n,t+=60*60*1e3*r,t};function ph(i,e,t){return Yr(i.toString())+Yr(e.toString())+Yr(t)}const PA=function(e,t,s){let n=e[t],r=e[n.prevCC];if(!r||!r.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(o=r)!=null&&o.new;){var o;e.ccOffset+=n.start-r.start,n.new=!1,n=r,r=e[n.prevCC]}e.presentationOffset=s};function OA(i,e,t,s,n,r,o){const a=new CA,l=Ts(new Uint8Array(i)).trim().replace(wA,`
`).split(`
`),c=[],u=e?Gx(e.baseTime,e.timescale):0;let h="00:00.000",f=0,d=0,g,m=!0;a.oncue=function(p){const y=t[s];let _=t.ccOffset;const T=(f-u)/9e4;if(y!=null&&y.new&&(d!==void 0?_=t.ccOffset=y.start:PA(t,s,T)),T){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}_=T-t.presentationOffset}const E=p.endTime-p.startTime,S=Ls((p.startTime+_-d)*9e4,n*9e4)/9e4;p.startTime=Math.max(S,0),p.endTime=Math.max(S+E,0);const R=p.text.trim();p.text=decodeURIComponent(encodeURIComponent(R)),p.id||(p.id=ph(p.startTime,p.endTime,R)),p.endTime>0&&c.push(p)},a.onparsingerror=function(p){g=p},a.onflush=function(){if(g){o(g);return}r(c)},l.forEach(p=>{if(m)if(sc(p,"X-TIMESTAMP-MAP=")){m=!1,p.slice(16).split(",").forEach(y=>{sc(y,"LOCAL:")?h=y.slice(6):sc(y,"MPEGTS:")&&(f=parseInt(y.slice(7)))});try{d=DA(h)/1e3}catch(y){g=y}return}else p===""&&(m=!1);a.parse(p+`
`)}),a.flush()}const ic="stpp.ttml.im1t",$0=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,U0=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,MA={left:"start",center:"center",right:"end",start:"start",end:"end"};function Kd(i,e,t,s){const n=Re(new Uint8Array(i),["mdat"]);if(n.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const r=n.map(a=>Ts(a)),o=Bx(e.baseTime,1,e.timescale);try{r.forEach(a=>t(FA(a,o)))}catch(a){s(a)}}function FA(i,e){const n=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(r).reduce((h,f)=>(h[f]=n.getAttribute(`ttp:${f}`)||r[f],h),{}),a=n.getAttribute("xml:space")!=="preserve",l=zd(nc(n,"styling","style")),c=zd(nc(n,"layout","region")),u=nc(n,"body","[begin]");return[].map.call(u,h=>{const f=B0(h,a);if(!f||!h.hasAttribute("begin"))return null;const d=oc(h.getAttribute("begin"),o),g=oc(h.getAttribute("dur"),o);let m=oc(h.getAttribute("end"),o);if(d===null)throw Wd(h);if(m===null){if(g===null)throw Wd(h);m=d+g}const p=new mh(d-e,m-e,f);p.id=ph(p.startTime,p.endTime,p.text);const y=c[h.getAttribute("region")],_=l[h.getAttribute("style")],T=NA(y,_,l),{textAlign:E}=T;if(E){const S=MA[E];S&&(p.lineAlign=S),p.align=E}return ze(p,T),p}).filter(h=>h!==null)}function nc(i,e,t){const s=i.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function zd(i){return i.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function B0(i,e){return[].slice.call(i.childNodes).reduce((t,s,n)=>{var r;return s.nodeName==="br"&&n?t+`
`:(r=s.childNodes)!=null&&r.length?B0(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function NA(i,e,t){const s="http://www.w3.org/ns/ttml#styling";let n=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(n=t[o]),r.reduce((a,l)=>{const c=rc(e,s,l)||rc(i,s,l)||rc(n,s,l);return c&&(a[l]=c),a},{})}function rc(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function Wd(i){return new Error(`Could not parse ttml timestamp ${i}`)}function oc(i,e){if(!i)return null;let t=M0(i);return t===null&&($0.test(i)?t=$A(i,e):U0.test(i)&&(t=UA(i,e))),t}function $A(i,e){const t=$0.exec(i),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function UA(i,e){const t=U0.exec(i),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class Qo{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class BA{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Yd(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this),e.on(v.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(v.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(v.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this),e.off(v.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(v.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(v.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Qo(this,"textTrack1"),t=new Qo(this,"textTrack2"),s=new Qo(this,"textTrack3"),n=new Qo(this,"textTrack4");this.cea608Parser1=new Vd(1,e,t),this.cea608Parser2=new Vd(3,s,n)}addCues(e,t,s,n,r){let o=!1;for(let a=r.length;a--;){const l=r[a],c=GA(l[0],l[1],t,s);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],s),o=!0,c/(s-t)>.5))return}if(o||r.push([t,s]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,s,n)}else{const a=this.Cues.newCue(null,t,s,n);this.hls.trigger(v.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:r,trackId:o}){const{unparsedVttFrags:a}=this;s===de.MAIN&&(this.initPTS[t.cc]={baseTime:n,timescale:r,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(v.FRAG_LOADED,l):this.hls.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let n=0;n<s.textTracks.length;n++){const r=s.textTracks[n];if(qd(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:n}=this,{label:r,languageCode:o}=t[e],a=this.getExistingTrack(r,o);if(a)s[e]=a,qn(s[e]),C0(s[e],n);else{const l=this.createTextTrack("captions",r,o);l&&(l[e]=!0,s[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,n={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(v.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,s){const n=this.media;if(n)return n.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:n}=this;Object.keys(n).forEach(r=>{qn(n[r]),delete n[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Yd(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)qn(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],n=s.some(r=>r.textCodec===ic);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(y0(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const o=this.media,a=o?pa(o.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(a){let h=null;for(let f=0;f<a.length;f++)if(a[f]&&qd(a[f],l)){h=a[f],a[f]=null;break}h&&(u=h)}if(u)qn(u);else{const h=G0(l);u=this.createTextTrack(h,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),a!=null&&a.length){const l=a.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(v.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const n=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!n)return;const r=`textTrack${n[1]}`,o=this.captionsProperties[r];o&&(o.label=s.name,s.lang&&(o.languageCode=s.lang),o.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===de.MAIN){var s,n;const{cea608Parser1:r,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:c}=t.frag,u=(s=(n=t.part)==null?void 0:n.index)!=null?s:-1;r&&o&&(c!==a+1||c===a&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(r.reset(),o.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:s,payload:n}=t;if(s.type===de.SUBTITLE)if(n.byteLength){const r=s.decryptdata,o="stats"in t;if(r==null||!r.encrypted||o){const a=this.tracks[s.level],l=this.vttCCs;l[s.cc]||(l[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),a&&a.textCodec===ic?this._parseIMSC1(s,n):this._parseVTTs(t)}}else this.hls.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;Kd(t,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),s.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{s.logger.log(`Failed to parse IMSC1: ${n}`),s.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var t;const{frag:s,payload:n}=e,{initPTS:r,unparsedVttFrags:o}=this,a=r.length-1;if(!r[s.cc]&&a===-1){o.push(e);return}const l=this.hls,c=(t=s.initSegment)!=null&&t.data?Os(s.initSegment.data,new Uint8Array(n)).buffer:n;OA(c,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,u=>{this._appendCues(u,s.level),l.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},u=>{const h=u.message==="Missing initPTS for VTT MPEGTS";h?o.push(e):this._fallbackToIMSC1(s,n),l.logger.log(`Failed to parse VTT cue: ${u}`),!(h&&a>s.cc)&&l.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:u})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||Kd(t,this.initPTS[e.cc],()=>{s.textCodec=ic,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(r=>w0(n,r))}else{const n=this.tracks[t];if(!n)return;const r=n.default?"default":"subtitles"+t;s.trigger(v.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===de.SUBTITLE&&this.onFragLoaded(v.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:n}=t;if(!(s.type===de.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let r=0;r<n.length;r++){const o=n[r].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(n[r].pts,a[0]),this.cea608Parser2.addData(n[r].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:n,type:r}){const{media:o}=this;if(!(!o||o.currentTime<s)){if(!r||r==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>su(a[l],t,s))}if(this.config.renderTextTracksNatively&&t===0&&n!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>su(a[l],t,n))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let n=2;for(let r=0;r<s;r++){const o=e[n++],a=127&e[n++],l=127&e[n++];if(a===0&&l===0)continue;if((4&o)!==0){const u=3&o;(u===0||u===1)&&(t[u].push(a),t[u].push(l))}}return t}}function G0(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function qd(i,e){return!!i&&i.kind===G0(e)&&Jc(e,i)}function GA(i,e,t,s){return Math.min(e,s)-Math.max(i,t)}function Yd(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const HA=/\s/,VA={newCue(i,e,t,s){const n=[];let r,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let f=0;f<s.rows.length;f++)if(r=s.rows[f],a=!0,l=0,c="",!r.isEmpty()){var h;for(let m=0;m<r.chars.length;m++)HA.test(r.chars[m].uchar)&&a?l++:(c+=r.chars[m].uchar,a=!1);r.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const d=N0(c.trim()),g=ph(e,t,d);i!=null&&(h=i.cues)!=null&&h.getCueById(g)||(o=new u(e,t,d),o.id=g,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),n.push(o))}return i&&n.length&&(n.sort((f,d)=>f.line==="auto"||d.line==="auto"?0:f.line>8&&d.line>8?d.line-f.line:f.line-d.line),n.forEach(f=>w0(i,f))),n}};function KA(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const zA=/(\d+)-(\d+)\/(\d+)/;class jd{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||jA,this.controller=new self.AbortController,this.stats=new Yu}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const r=WA(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=l&&oe(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout),(mo(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(h=>{var f;this.response=this.loader=h;const d=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},c-(d-n.loading.start)),!h.ok){const{status:m,statusText:p}=h;throw new XA(p||"fetch, bad network response",m,h)}n.loading.first=d,n.total=YA(h.headers)||n.total;const g=(f=this.callbacks)==null?void 0:f.onProgress;return g&&oe(t.highWaterMark)?this.loadProgressively(h,n,e,t.highWaterMark,g):o?h.arrayBuffer():e.responseType==="json"?h.json():h.text()}).then(h=>{var f,d;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const m=h[a];m&&(n.loaded=n.total=m);const p={url:g.url,data:h,code:g.status},y=(f=this.callbacks)==null?void 0:f.onProgress;y&&!oe(t.highWaterMark)&&y(n,e,h,g),(d=this.callbacks)==null||d.onSuccess(p,n,e,g)}).catch(h=>{var f;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const d=h&&h.code||0,g=h?h.message:null;(f=this.callbacks)==null||f.onError({code:d,text:g},e,h?h.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,n=0,r){const o=new Qp,a=e.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&r(t,s,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=c.value,h=u.length;return t.loaded+=h,h<n||o.dataLength?(o.push(u),o.dataLength>=n&&r(t,s,o.flush().buffer,e)):r(t,s,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function WA(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ze({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function qA(i){const e=zA.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function YA(i){const e=i.get("Content-Range");if(e){const s=qA(e);if(oe(s))return s}const t=i.get("Content-Length");if(t)return parseInt(t)}function jA(i,e){return new self.Request(i.url,e)}class XA extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const QA=/^age:\s*[\d.]+\s*$/im;class H0{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Yu,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return r(s,t.url)}).catch(o=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),r(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:s.status,text:o.message},t,s,n)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:o}=s.loadPolicy;if(n)for(const a in n)e.setRequestHeader(a,n[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&oe(r)?r:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const n=t.readyState,r=this.config;if(!s.aborted&&n>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,u=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const g=u??t.response;if(g!=null){var o,a;s.loading.end=Math.max(self.performance.now(),s.loading.first);const m=t.responseType==="arraybuffer"?g.byteLength:g.length;s.loaded=s.total=m,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const p=(o=this.callbacks)==null?void 0:o.onProgress;p&&p(s,e,g,t);const y={url:t.responseURL,data:g,code:c};(a=this.callbacks)==null||a.onSuccess(y,s,e,t);return}}const h=r.loadPolicy.errorRetry,f=s.retry,d={url:e.url,data:void 0,code:c};if(Ua(h,f,!1,d))this.retry(h);else{var l;Fe.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Ua(e,t,!0))this.retry(e);else{var s;Fe.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=Ju(e,s.retry),s.retry++,Fe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&QA.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const JA={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},ZA=Ke(Ke({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:H0,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:hS,bufferController:sb,capLevelController:fh,errorController:pS,fpsController:sA,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Gp,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:JA},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},eL()),{},{subtitleStreamController:gA,subtitleTrackController:rA,timelineController:BA,audioStreamController:Jx,audioTrackController:Zx,emeController:ir,cmcdController:Zb,contentSteeringController:tA,interstitialsController:dA});function eL(){return{cueHandler:VA,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function tL(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=nu(i),n=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,c=[];r.forEach(u=>{const h=`${o}Loading${u}`,f=e[h];if(f!==void 0&&l){c.push(h);const d=s[a].default;switch(e[a]={default:d},u){case"TimeOut":d.maxLoadTimeMs=f,d.maxTimeToFirstByteMs=f;break;case"MaxRetry":d.errorRetry.maxNumRetry=f,d.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":d.errorRetry.retryDelayMs=f,d.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":d.errorRetry.maxRetryDelayMs=f,d.timeoutRetry.maxRetryDelayMs=f;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${a}": ${tt(e[a])}`)}),Ke(Ke({},s),e)}function nu(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(nu):Object.keys(i).reduce((e,t)=>(e[t]=nu(i[t]),e),{}):i}function sL(i,e){const t=i.loader;t!==jd&&t!==H0?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):KA()&&(i.loader=jd,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const ya=2,iL=.1,nL=.05,rL=100;class oL extends $p{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(v.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(rL),this.mediaSource=t.mediaSource;const s=this.media=t.media;ps(s,"playing",this.onMediaPlaying),ps(s,"waiting",this.onMediaWaiting),ps(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(Is(s,"playing",this.onMediaPlaying),Is(s,"waiting",this.onMediaWaiting),Is(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,n;const r=(s=this.hls)==null?void 0:s.config;if(!r)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,c=!this.seeking&&a,u=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(v.MEDIA_ENDED,{stalled:!1}));return}if(!xe.getBuffered(o).length){this.nudgeRetry=0;return}const h=xe.bufferInfo(o,e,0),f=h.nextStart||0,d=this.fragmentTracker;if(a&&d&&this.hls){const R=Xd(this.hls.inFlightFragments,e),x=h.len>ya,L=!f||R||f-e>ya&&!d.getPartialFragment(e);if(x||L)return;this.moved=!1}const g=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&d){if(!(h.len>0)&&!f)return;const x=Math.max(f,h.start||0)-e,A=!!(g!=null&&g.live)?g.targetduration*2:ya,k=Jo(e,d);if(x>0&&(x<=A||k)){o.paused||this._trySkipBufferHole(k);return}}const m=r.detectStallWithCurrentTimeMs,p=self.performance.now(),y=this.waiting;let _=this.stalled;if(_===null)if(y>0&&p-y<m)_=this.stalled=y;else{this.stalled=p;return}const T=p-_;if(!a&&(T>=m||y)&&this.hls){var E;if(((E=this.mediaSource)==null?void 0:E.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(v.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}const S=xe.bufferInfo(o,e,r.maxBufferHole);this._tryFixBufferStall(S,T,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(v.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&n&&n.length>1&&e>n.end(0)){const r=xe.bufferedInfo(xe.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const o=xe.timeRangesToArray(n),a=xe.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=xe.bufferedInfo(o,e,0).bufferedIndex,c=o[a].end,u=o[a+1].start;if((l===-1||l>a)&&u-c<1&&e-c<2){const h=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(h.message),this.media.currentTime+=1e-6;let f=Jo(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const d=xe.bufferInfo(this.media,e,0);this.hls.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:f,buffer:d.len,bufferInfo:d})}}}}}_tryFixBufferStall(e,t,s){var n,r;const{fragmentTracker:o,media:a}=this,l=(n=this.hls)==null?void 0:n.config;if(!a||!o||!l)return;const c=(r=this.hls)==null?void 0:r.latestLevelDetails,u=Jo(s,o);if((u||c!=null&&c.live&&s<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const h=e.buffered,f=this.adjacentTraversal(e,s);(h&&h.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-s<l.maxBufferHole||f))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,n=e.nextStart;if(s&&n){const r=s.getFragAtPos(t,de.MAIN),o=s.getFragAtPos(n,de.MAIN);if(r&&o)return o.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:n,stalled:r}=this;if(!n&&r!==null&&s&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${tt(e)})`);this.warn(o.message),t.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:n}=this,r=(t=this.hls)==null?void 0:t.config;if(!n||!s||!r)return 0;const o=n.currentTime,a=xe.bufferInfo(n,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const u=a.len<=r.maxBufferHole,h=a.len>0&&a.len<1&&n.readyState<3,f=l-o;if(f>0&&(u||h)){if(f>r.maxBufferHole){let g=!1;if(o===0){const m=s.getAppendedFrag(0,de.MAIN);m&&l<m.end&&(g=!0)}if(!g&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||Xd(this.hls.inFlightFragments,l))return 0;let p=!1,y=e.end;for(;y<l;){const _=Jo(y,s);if(_)y+=_.duration;else{p=!0;break}}if(p)return 0}}const d=Math.max(l+nL,o+iL);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${d}`),this.moved=!0,n.currentTime=d,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${d}`),m={type:me.MEDIA_ERROR,details:M.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?m.part=e:m.frag=e),this.hls.trigger(v.ERROR,m)}return d}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:n}=this,r=t==null?void 0:t.config;if(!s||!r)return 0;const o=s.currentTime;if(this.nudgeRetry++,n<r.nudgeMaxRetry){const a=o+(n+1)*r.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),s.currentTime=a,t.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${r.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Xd(i,e){const t=Qd(i.main);if(t&&t.start<=e)return t;const s=Qd(i.audio);return s&&s.start<=e?s:null}function Qd(i){if(!i)return null;switch(i.state){case V.IDLE:case V.STOPPED:case V.ENDED:case V.ERROR:return null}return i.frag}function Jo(i,e){return e.getAppendedFrag(i,de.MAIN)||e.getPartialFragment(i)}const aL=.25;function ru(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function ac(i,e,t,s,n){let r=new i(e,t,"");try{r.value=s,n&&(r.type=n)}catch{r=new i(e,t,tt(n?Ke({type:n},s):s))}return r}const Zo=(()=>{const i=ru();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class lL{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(v.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&qn(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return C0(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:n}=this.hls.config;if(!s&&!n)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=ru();if(o)for(let a=0;a<r.length;a++){const l=r[a].type;if(l===ds.emsg&&!s||!n)continue;const c=n0(r[a].data),u=r[a].pts;let h=u+r[a].duration;h>Zo&&(h=Zo),h-u<=0&&(h=u+aL);for(let d=0;d<c.length;d++){const g=c[d];if(!r0(g)){this.updateId3CueEnds(u,l);const m=ac(o,u,h,g,l);m&&this.id3Track.addCue(m)}}}}updateId3CueEnds(e,t){var s;const n=(s=this.id3Track)==null?void 0:s.cues;if(n)for(let r=n.length;r--;){const o=n[r];o.type===t&&o.startTime<e&&o.endTime===Zo&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:n}){const{id3Track:r,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(r&&(a||l)){let c;n==="audio"?c=u=>u.type===ds.audioId3&&l:n==="video"?c=u=>u.type===ds.emsg&&a:c=u=>u.type===ds.audioId3&&l||u.type===ds.emsg&&a,su(r,t,s,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:n,enableDateRangeMetadataCues:r,interstitialsController:o}=this.hls.config;if(!r)return;const a=ru();if(s&&n&&!o){const{fragmentStart:m,fragmentEnd:p}=e;let y=this.assetCue;y?(y.startTime=m,y.endTime=p):a&&(y=this.assetCue=ac(a,m,p,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),y&&(y.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(y),y.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,u=Object.keys(c);let h=this.dateRangeCuesAppended;if(l&&t){var f;if((f=l.cues)!=null&&f.length){const m=Object.keys(h).filter(p=>!u.includes(p));for(let p=m.length;p--;){var d;const y=m[p],_=(d=h[y])==null?void 0:d.cues;delete h[y],_&&Object.keys(_).forEach(T=>{const E=_[T];if(E){E.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(E)}catch{}}})}}else h=this.dateRangeCuesAppended={}}const g=e.fragments[e.fragments.length-1];if(!(u.length===0||!oe(g==null?void 0:g.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let m=0;m<u.length;m++){const p=u[m],y=c[p],_=y.startTime,T=h[p],E=(T==null?void 0:T.cues)||{};let S=(T==null?void 0:T.durationKnown)||!1,R=Zo;const{duration:x,endDate:L}=y;if(L&&x!==null)R=_+x,S=!0;else if(y.endOnNext&&!S){const k=u.reduce((w,P)=>{if(P!==y.id){const B=c[P];if(B.class===y.class&&B.startDate>y.startDate&&(!w||y.startDate<w.startDate))return B}return w},null);k&&(R=k.startTime,S=!0)}const A=Object.keys(y.attr);for(let k=0;k<A.length;k++){const w=A[k];if(!kS(w))continue;const P=E[w];if(P)S&&!(T!=null&&T.durationKnown)?P.endTime=R:Math.abs(P.startTime-_)>.01&&(P.startTime=_,P.endTime=R);else if(a){let B=y.attr[w];CS(w)&&(B=Ep(B));const q=ac(a,_,R,{key:w,data:B},ds.dateRange);q&&(q.id=p,this.id3Track.addCue(q),E[w]=q,o&&(w==="X-ASSET-LIST"||w==="X-ASSET-URL")&&q.addEventListener("enter",this.onEventCueEnter))}}h[p]={cues:E,dateRange:y,durationKnown:S}}}}}class cL{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:o}=this.config;if(!r||o===1||!s.live)return;const a=this.targetLatency;if(a===null)return;const l=n-a,c=Math.min(this.maxLatency,a+s.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,d=Math.min(h,Math.max(1,f));this.changeMediaPlaybackRate(t,d)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:n}=e,{liveSyncDuration:r,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&s||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=r!==void 0?r:o*n);const u=n;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const n=s.edge,r=e-t-this.edgeStalled,o=n-s.totalduration,a=n-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(o,r),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===M.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,n;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class uL extends hh{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,n=[],r={},o={};let a=!1,l=!1,c=!1;t.levels.forEach(u=>{const h=u.attrs;let{audioCodec:f,videoCodec:d}=u;f&&(u.audioCodec=f=Ma(f,s)||void 0),d&&(d=u.videoCodec=YE(d));const{width:g,height:m,unknownCodecs:p}=u;let y=p?p.length:0;if(p)for(let k=y;k--;){const w=p[k];this.isAudioSupported(w)?(u.audioCodec=f=f?`${f},${w}`:w,y--,cr.audio[f.substring(0,4)]=2):this.isVideoSupported(w)&&(u.videoCodec=d=d?`${d},${w}`:w,y--,cr.video[d.substring(0,4)]=2)}if(a||(a=!!(g&&m)),l||(l=!!d),c||(c=!!f),y||f&&!this.isAudioSupported(f)||d&&!this.isVideoSupported(d)){this.log(`Some or all CODECS not supported "${h.CODECS}"`);return}const{CODECS:_,"FRAME-RATE":T,"HDCP-LEVEL":E,"PATHWAY-ID":S,RESOLUTION:R,"VIDEO-RANGE":x}=h,A=`${`${S||"."}-`}${u.bitrate}-${R}-${T}-${_}-${x}-${E}`;if(r[A])if(r[A].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const k=o[A]+=1;u.attrs["PATHWAY-ID"]=new Array(k+1).join(".");const w=this.createLevel(u);r[A]=w,n.push(w)}else r[A].addGroupId("audio",h.AUDIO),r[A].addGroupId("text",h.SUBTITLES);else{const k=this.createLevel(u);r[A]=k,o[A]=1,n.push(k)}}),this.filterAndSortMediaOptions(n,t,a,l,c)}createLevel(e){const t=new uo(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(n.message),t.supportedResult=Dp(n,[])}return t}isAudioSupported(e){return Vc(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Vc(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,n,r){let o=[],a=[],l=e;if((s||n)&&r&&(l=l.filter(({videoCodec:p,videoRange:y,width:_,height:T})=>(!!p||!!(_&&T))&&sS(y))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let p="no level with compatible codecs found in manifest",y=p;t.levels.length&&(y=`one or more CODECS in variant not supported: ${tt(t.levels.map(T=>T.attrs.CODECS).filter((T,E,S)=>S.indexOf(T)===E))}`,this.warn(y),p+=` (${y})`);const _=new Error(p);this.hls.trigger(v.ERROR,{type:me.MEDIA_ERROR,details:M.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:_,reason:y})}});return}t.audioTracks&&(o=t.audioTracks.filter(p=>!p.audioCodec||this.isAudioSupported(p.audioCodec)),Jd(o)),t.subtitles&&(a=t.subtitles,Jd(a));const c=l.slice(0);l.sort((p,y)=>{if(p.attrs["HDCP-LEVEL"]!==y.attrs["HDCP-LEVEL"])return(p.attrs["HDCP-LEVEL"]||"")>(y.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&p.height!==y.height)return p.height-y.height;if(p.frameRate!==y.frameRate)return p.frameRate-y.frameRate;if(p.videoRange!==y.videoRange)return Fa.indexOf(p.videoRange)-Fa.indexOf(y.videoRange);if(p.videoCodec!==y.videoCodec){const _=Yf(p.videoCodec),T=Yf(y.videoCodec);if(_!==T)return T-_}if(p.uri===y.uri&&p.codecSet!==y.codecSet){const _=Oa(p.codecSet),T=Oa(y.codecSet);if(_!==T)return T-_}return p.averageBitrate!==y.averageBitrate?p.averageBitrate-y.averageBitrate:0});let u=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length)){for(let p=0;p<c.length;p++)if(c[p].pathwayId===l[0].pathwayId){u=c[p];break}}this._levels=l;for(let p=0;p<l.length;p++)if(l[p]===u){var h;this._firstLevel=p;const y=u.bitrate,_=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${y}`),((h=this.hls.userConfig)==null?void 0:h.abrEwmaDefaultEstimate)===void 0){const T=Math.min(y,this.hls.config.abrEwmaDefaultEstimateMax);T>_&&_===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}const f=r&&!n,d=this.hls.config,g=!!(d.audioStreamController&&d.audioTrackController),m={levels:l,audioTracks:o,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:n,altAudio:g&&!f&&o.some(p=>!!p.url)};this.hls.trigger(v.MANIFEST_PARSED,m)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),h=e<0;if(this.hls.trigger(v.ERROR,{type:me.OTHER_ERROR,details:M.LEVEL_SWITCH_ERROR,level:e,fatal:h,error:u,reason:u.message}),h)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,n=this.currentLevel,r=n?n.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,s===e&&n&&r===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${s}${r?" with Pathway "+r:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(v.LEVEL_SWITCHING,l);const c=o.details;if(!c||c.live){const u=this.switchParams(o.uri,n==null?void 0:n.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(n=>t.indexOf(n)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===ke.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===de.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(r=>!!s[r]))return;const n=this._levels[t.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var s;const{level:n,details:r}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${n}`),(a=t.deliveryDirectives)!=null&&a.skip&&(r.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(n,t,l)}else(s=t.deliveryDirectives)!=null&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(v.LEVEL_LOADING,{url:s,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((r,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(a=>a.level=-1)),!1));Yp(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=s.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(v.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(v.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function Jd(i){const e={};i.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function V0(){return self.SourceBuffer||self.WebKitSourceBuffer}function K0(){if(!Yi())return!1;const e=V0();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function hL(){if(!K0())return!1;const i=Yi();return typeof(i==null?void 0:i.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(co(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(co(e,"audio"))))}function fL(){var i;const e=V0();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const dL=100;class gL extends ih{constructor(e,t,s){super(e,t,s,"stream-controller",de.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,r=n?n.currentTime:null;if(r===null||!oe(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const o=this.getFwdBufferInfoAtPos(n,r,de.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:n}=this;if(this.stopLoad(),this.setInterval(dL),this.level=-1,!this.startFragRequested){let r=n.startLevel;r===-1&&(n.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=n.firstAutoLevel),n.nextLoadLevel=r,this.level=n.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=V.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=V.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case V.WAITING_LEVEL:{const{levels:t,level:s}=this,n=t==null?void 0:t[s],r=n==null?void 0:n.details;if(r&&(!r.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(r))break;this.state=V.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=V.IDLE;break}break}case V.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),s=this.retryDate;if(!s||t>=s||(e=this.media)!=null&&e.seeking){const{levels:n,level:r}=this,o=n==null?void 0:n[r];this.resetStartWhenNotLoaded(o||null),this.state=V.IDLE}}break}this.state===V.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:n}=this;if(t===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[r]))return;const o=s[r],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const m={};this.altAudio===2&&(m.type="video"),this.hls.trigger(v.BUFFER_EOS,m),this.state=V.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const c=o.details;if(!c||this.state===V.WAITING_LEVEL||this.waitForLive(o)){this.level=r,this.state=V.WAITING_LEVEL,this.startFragRequested=!1;return}const u=a.len,h=this.getMaxBufferLength(o.maxBitrate);if(u>=h)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let d=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&d&&pt(d)&&this.fragmentTracker.getState(d)!==Tt.OK){var g;const p=((g=this.backtrackFragment)!=null?g:d).sn-c.startSN,y=c.fragments[p-1];y&&d.cc===y.cc&&(d=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(d&&this.isLoopLoading(d,f)){if(!d.gap){const p=this.audioOnly&&!this.altAudio?Xe.AUDIO:Xe.VIDEO,y=(p===Xe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,p,de.MAIN)}d=this.getNextFragmentLoopLoading(d,c,a,de.MAIN,h)}d&&(d.initSegment&&!d.initSegment.data&&!this.bitrateTest&&(d=d.initSegment),this.loadFragment(d,o,f))}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);n===Tt.NOT_LOADED||n===Tt.PARTIAL?pt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,de.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<r.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],c=this.fragLastKbps;c&&this.fragCurrent?s=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:s=0}else s=0;const o=this.getBufferedFrag(t.currentTime+s);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,c=a.duration,u=Math.max(o.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case V.KEY_LOADING:case V.FRAG_LOADING:case V.FRAG_LOADING_WAITING_RETRY:case V.PARSING:case V.PARSED:this.state=V.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;ps(s,"playing",this.onMediaPlaying),ps(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(Is(s,"playing",this.onMediaPlaying),Is(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(v.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,n=!1;t.levels.forEach(r=>{const o=r.audioCodec;o&&(s=s||o.indexOf("mp4a.40.2")!==-1,n=n||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=s&&n&&!fL(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==V.IDLE)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=V.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:n,startFragRequested:r}=this,o=t.level,a=t.details,l=a.totalduration;if(!n){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const c=t.levelInfo,u=this.fragCurrent;u&&(this.state===V.FRAG_LOADING||this.state===V.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let h=0;if(a.live||(s=c.details)!=null&&s.live){var f;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;h=this.alignPlaylists(a,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(c.details=a,this.levelLastLoaded=c,r||this.setStartPosition(a,h),this.hls.trigger(v.LEVEL_UPDATED,{details:a,level:o}),this.state===V.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=V.IDLE}r&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const n=this.hls.liveSyncPosition,r=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=r>=o-t.maxFragLookUpTolerance&&r<=a;if(n!==null&&s.duration>n&&(r<n||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&s.readyState<4||r<a-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),s.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${n.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const h=xe.bufferInfo(s,n,0);if(!(h!=null&&(c=h.buffered)!=null&&c.length)){s.currentTime=n;return}if(h.start<=r){s.currentTime=n;return}const{nextStart:d}=xe.bufferedInfo(h.buffered,r,0);d&&(s.currentTime=d)}else s.currentTime=n}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const a=o[s.level];if(!a){this.warn(`Level ${s.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const c=a.videoCodec,u=l.PTSKnown||!l.live,h=(t=s.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),d=this.transmuxer=this.transmuxer||new p0(this.hls,de.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=n?n.index:-1,m=g!==-1,p=new eh(s.level,s.sn,s.stats.chunkCount,r.byteLength,g,m),y=this.initPTS[s.cc];d.push(r,h,f,c,s,n,l.totalduration,u,p,y)}onAudioTrackSwitching(e,t){const s=this.hls,n=this.altAudio===2;if(Na(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.fragmentTracker.removeAllFragments(),s.once(v.BUFFER_FLUSHED,()=>{var o;(o=this.hls)==null||o.trigger(v.AUDIO_TRACK_SWITCHED,t)}),s.trigger(v.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(v.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Na(t.url,this.hls);if(s){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let n,r,o=!1;for(const a in s){const l=s[a];if(l.id==="main"){if(r=a,n=l,a==="video"){const c=s[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&n?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:n}=t,r=s.type===de.MAIN;if(r){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===V.PARSED&&(this.state=V.IDLE);return}const a=n?n.stats:s.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),pt(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,n)}const o=this.media;o&&(!this._hasEnoughToStart&&xe.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=V.ERROR;return}switch(t.details){case M.FRAG_GAP:case M.FRAG_PARSING_ERROR:case M.FRAG_DECRYPT_ERROR:case M.FRAG_LOAD_ERROR:case M.FRAG_LOAD_TIMEOUT:case M.KEY_LOAD_ERROR:case M.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(de.MAIN,t);break;case M.LEVEL_LOAD_ERROR:case M.LEVEL_LOAD_TIMEOUT:case M.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===V.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===ke.LEVEL&&(this.state=V.IDLE);break;case M.BUFFER_ADD_CODEC_ERROR:case M.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case M.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case M.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=V.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Xe.AUDIO||!this.altAudio){const s=(t===Xe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,de.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const n=this.timelineOffset;n&&s&&(s+=n);const r=this.getLevelDetails(),o=xe.getBuffered(e),a=o.length?o.start(0):0,l=a-s,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*((r==null?void 0:r.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),s+=l,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${a}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:n}=this,r=s==null?void 0:s.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=V.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=r.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),n.trigger(v.FRAG_LOADED,s),r.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const s=this.playlistType,{hls:n}=this,{remuxResult:r,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:u}=a,{video:h,text:f,id3:d,initSegment:g}=r,{details:m}=u,p=this.altAudio?void 0:r.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=V.PARSING,g){if(g!=null&&g.tracks){const E=l.initSegment||l;this._bufferInitSegment(u,g.tracks,E,o),n.trigger(v.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:s,tracks:g.tracks})}const y=g.initPTS,_=g.timescale,T=this.initPTS[l.cc];if(oe(y)&&(!T||T.baseTime!==y||T.timescale!==_)){const E=g.trackId;this.initPTS[l.cc]={baseTime:y,timescale:_,trackId:E},n.trigger(v.INIT_PTS_FOUND,{frag:l,id:s,initPTS:y,timescale:_,trackId:E})}}if(h&&m){p&&h.type==="audiovideo"&&this.logMuxedErr(l);const y=m.fragments[l.sn-1-m.startSN],_=l.sn===m.startSN,T=!y||l.cc>y.cc;if(r.independent!==!1){const{startPTS:E,endPTS:S,startDTS:R,endDTS:x}=h;if(c)c.elementaryStreams[h.type]={startPTS:E,endPTS:S,startDTS:R,endDTS:x};else if(h.firstKeyFrame&&h.independent&&o.id===1&&!T&&(this.couldBacktrack=!0),h.dropped&&h.independent){const L=this.getMainFwdBufferInfo(),A=(L?L.end:this.getLoadPosition())+this.config.maxBufferHole,k=h.firstKeyFramePTS?h.firstKeyFramePTS:E;if(!_&&A<k-this.config.maxBufferHole&&!T){this.backtrack(l);return}else T&&(l.gap=!0);l.setElementaryStreamInfo(h.type,l.start,S,l.start,x,!0)}else _&&E-(m.appliedTimelineOffset||0)>ya&&(l.gap=!0);l.setElementaryStreamInfo(h.type,E,S,R,x),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(h,l,c,o,_||T)}else if(_||T)l.gap=!0;else{this.backtrack(l);return}}if(p){const{startPTS:y,endPTS:_,startDTS:T,endDTS:E}=p;c&&(c.elementaryStreams[Xe.AUDIO]={startPTS:y,endPTS:_,startDTS:T,endDTS:E}),l.setElementaryStreamInfo(Xe.AUDIO,y,_,T,E),this.bufferFragmentData(p,l,c,o)}if(m&&d!=null&&(t=d.samples)!=null&&t.length){const y={id:s,frag:l,details:m,samples:d.samples};n.trigger(v.FRAG_PARSING_METADATA,y)}if(m&&f){const y={id:s,frag:l,details:m,samples:f.samples};n.trigger(v.FRAG_PARSING_USERDATA,y)}}logMuxedErr(e){this.warn(`${pt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,n){if(this.state!==V.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:o,audiovideo:a}=t;if(r){const c=e.audioCodec;let u=ua(r.codec,c);u==="mp4a"&&(u="mp4a.40.5");const h=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const f=r.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&h.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&h.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),r.levelCodec=u,r.id=de.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${r.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=de.MAIN;const c=o.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${o.codec!==c?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(v.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const h=t[c].initSegment;h!=null&&h.byteLength&&this.hls.trigger(v.BUFFER_APPENDING,{type:c,data:h,frag:s,part:null,chunkMeta:n,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,de.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e==null?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=V.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(xe.isBuffered(e,s)?t=this.getAppendedFrag(s):xe.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const n=this.fragPlaying,r=t.level;(!n||t.sn!==n.sn||n.level!==r)&&(this.fragPlaying=t,this.hls.trigger(v.FRAG_CHANGED,{frag:t}),(!n||n.level!==r)&&this.hls.trigger(v.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return oe(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(oe(t)){const s=this.getLevelDetails(),n=this.currentFrag||(s?wn(null,s.fragments,t):null);if(n){const r=n.programDateTime;if(r!==null){const o=r+(t-n.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class mL{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyUriToKeyInfo){const n=this.keyUriToKeyInfo[s].loader;if(n){var t;if(e&&e!==((t=n.context)==null?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=M.KEY_LOAD_ERROR,s,n,r){return new Ti({type:me.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:n})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,r=t.length;n<r;n++){const o=t[n];if(e.cc<=o.cc&&(!pt(e)||!pt(o)||e.sn<o.sn)||!s&&n==r-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=fa(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const n=Or(this.config);if(n.length)return this.emeController.getKeySystemAccess(n)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,n;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,M.KEY_LOAD_ERROR,c))}const o=r.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,M.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=this.keyUriToKeyInfo[o];if((s=a)!=null&&s.decryptdata.key)return r.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});if((n=a)!=null&&n.keyLoadPromise){var l;switch((l=a.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(c=>(r.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:a}))}}switch(a=this.keyUriToKeyInfo[o]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,M.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const n=this.emeController.loadKey(s);if(n)return(e.keyLoadPromise=n.then(r=>(e.mediaKeySessionContext=r,s))).catch(r=>{throw e.keyLoadPromise=null,r})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,n=s.loader,r=new n(s);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=s.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,d,g,m)=>{const{frag:p,keyInfo:y,url:_}=g;if(!p.decryptdata||y!==this.keyUriToKeyInfo[_])return a(this.createKeyLoadError(p,M.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));y.decryptdata.key=p.decryptdata.key=new Uint8Array(f.data),p.keyLoader=null,y.loader=null,o({frag:p,keyInfo:y})},onError:(f,d,g,m)=>{this.resetLoader(d),a(this.createKeyLoadError(t,M.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),g,Ke({url:l.url,data:void 0},f)))},onTimeout:(f,d,g)=>{this.resetLoader(d),a(this.createKeyLoadError(t,M.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(f,d,g)=>{this.resetLoader(d),a(this.createKeyLoadError(t,M.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};r.load(l,u,h)})}resetLoader(e){const{frag:t,keyInfo:s,url:n}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null),delete this.keyUriToKeyInfo[n],r&&r.destroy()}}function Zd(i){const{type:e}=i;switch(e){case ke.AUDIO_TRACK:return de.AUDIO;case ke.SUBTITLE_TRACK:return de.SUBTITLE;default:return de.MAIN}}function lc(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class pL{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(v.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(v.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,n=t.loader,r=s||n,o=new r(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ke.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:n,pathwayId:r,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:s,level:n,pathwayId:r,responseType:"text",type:ke.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:o,track:a}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:ke.AUDIO_TRACK,url:r,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:o,track:a}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:ke.SUBTITLE_TRACK,url:r,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const s=this.loaders[ke.LEVEL];if(s){const n=s.context;n&&!t.levels.some(r=>r===n.levelOrTrack)&&(s.abort(),delete this.loaders[ke.LEVEL])}}load(e){var t;const s=this.hls.config;let n=this.getInternalLoader(e);if(n){const c=this.hls.logger,u=n.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let r;if(e.type===ke.MANIFEST?r=s.manifestLoadPolicy.default:r=ze({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),oe((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===ke.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===ke.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===ke.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,h=c.targetduration;if(u&&h){const f=Math.max(u*3,h*.8)*1e3;r=ze({},r,{maxTimeToFirstByteMs:Math.min(f,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,r.maxTimeToFirstByteMs)})}}}const o=r.errorRetry||r.timeoutRetry||{},a={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(c,u,h,f)=>{const d=this.getInternalLoader(h);this.resetInternalLoader(h.type);const g=c.data;if(g.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,h,new Error("no EXTM3U delimiter"),f||null,u);return}u.parsing.start=performance.now(),ni.isMediaPlaylist(g)||h.type!==ke.MANIFEST?this.handleTrackOrLevelPlaylist(c,u,h,f||null,d):this.handleMasterPlaylist(c,u,h,f)},onError:(c,u,h,f)=>{this.handleNetworkError(u,h,!1,c,f)},onTimeout:(c,u,h)=>{this.handleNetworkError(u,h,!0,void 0,c)}};n.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,n){const r=this.hls,o=e.data,a=lc(e,s),l=ni.parseMasterPlaylist(o,a);if(l.playlistParsingError){this.handleManifestParsingError(e,s,l.playlistParsingError,n,t);return}const{contentSteering:c,levels:u,sessionData:h,sessionKeys:f,startTimeOffset:d,variableList:g}=l;this.variableList=g;const{AUDIO:m=[],SUBTITLES:p,"CLOSED-CAPTIONS":y}=ni.parseMasterPlaylistMedia(o,a,l);m.length&&!m.some(T=>!T.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new nt({}),bitrate:0,url:""})),r.trigger(v.MANIFEST_LOADED,{levels:u,audioTracks:m,subtitles:p,captions:y,contentSteering:c,url:a,stats:t,networkDetails:n,sessionData:h,sessionKeys:f,startTimeOffset:d,variableList:g})}handleTrackOrLevelPlaylist(e,t,s,n,r){const o=this.hls,{id:a,level:l,type:c}=s,u=lc(e,s),h=oe(l)?l:oe(a)?a:0,f=Zd(s),d=ni.parseLevelPlaylist(e.data,u,h,f,0,this.variableList);if(c===ke.MANIFEST){const g={attrs:new nt({}),bitrate:0,details:d,name:"",url:u};d.requestScheduled=t.loading.start+zp(d,0),o.trigger(v.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=d,this.handlePlaylistLoaded(d,e,t,s,n,r)}handleManifestParsingError(e,t,s,n,r){this.hls.trigger(v.ERROR,{type:me.NETWORK_ERROR,details:M.MANIFEST_PARSING_ERROR,fatal:t.type===ke.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:n,stats:r})}handleNetworkError(e,t,s=!1,n,r){let o=`A network ${s?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===ke.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===ke.AUDIO_TRACK||e.type===ke.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=M.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case ke.MANIFEST:l=s?M.MANIFEST_LOAD_TIMEOUT:M.MANIFEST_LOAD_ERROR,c=!0;break;case ke.LEVEL:l=s?M.LEVEL_LOAD_TIMEOUT:M.LEVEL_LOAD_ERROR,c=!1;break;case ke.AUDIO_TRACK:l=s?M.AUDIO_TRACK_LOAD_TIMEOUT:M.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case ke.SUBTITLE_TRACK:l=s?M.SUBTITLE_TRACK_LOAD_TIMEOUT:M.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const h={type:me.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:r};if(n){const f=(t==null?void 0:t.url)||e.url;h.response=Ke({url:f,data:void 0},n)}this.hls.trigger(v.ERROR,h)}handlePlaylistLoaded(e,t,s,n,r,o){const a=this.hls,{type:l,level:c,id:u,groupId:h,deliveryDirectives:f}=n,d=lc(t,n),g=Zd(n),m=typeof n.level=="number"&&g===de.MAIN?c:void 0;if(!e.fragments.length){const y=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(v.ERROR,{type:me.NETWORK_ERROR,details:M.LEVEL_EMPTY_ERROR,fatal:!1,url:d,error:y,reason:y.message,response:t,context:n,level:m,parent:g,networkDetails:r,stats:s});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const p=e.playlistParsingError;if(p){if(this.hls.logger.warn(`${p} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(v.ERROR,{type:me.NETWORK_ERROR,details:M.LEVEL_PARSING_ERROR,fatal:!1,url:d,error:p,reason:p.message,response:t,context:n,level:m,parent:g,networkDetails:r,stats:s});return}e.playlistParsingError=null}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ke.MANIFEST:case ke.LEVEL:a.trigger(v.LEVEL_LOADED,{details:e,levelInfo:n.levelOrTrack||a.levels[0],level:m||0,id:u||0,stats:s,networkDetails:r,deliveryDirectives:f,withoutMultiVariant:l===ke.MANIFEST});break;case ke.AUDIO_TRACK:a.trigger(v.AUDIO_TRACK_LOADED,{details:e,track:n.levelOrTrack,id:u||0,groupId:h||"",stats:s,networkDetails:r,deliveryDirectives:f});break;case ke.SUBTITLE_TRACK:a.trigger(v.SUBTITLE_TRACK_LOADED,{details:e,track:n.levelOrTrack,id:u||0,groupId:h||"",stats:s,networkDetails:r,deliveryDirectives:f});break}}}class Pt{static get version(){return fo}static isMSESupported(){return K0()}static isSupported(){return hL()}static getMediaSource(){return Yi()}static get Events(){return v}static get MetadataSchema(){return ds}static get ErrorTypes(){return me}static get ErrorDetails(){return M}static get DefaultConfig(){return Pt.defaultConfig?Pt.defaultConfig:ZA}static set DefaultConfig(e){Pt.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new nh,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=IE(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=tL(Pt.DefaultConfig,e,t);this.userConfig=e,s.progressive&&sL(s,t);const{abrController:n,bufferController:r,capLevelController:o,errorController:a,fpsController:l}=s,c=new a(this),u=this.abrController=new n(this),h=new yS(this),f=s.interstitialsController,d=f?this.interstitialsController=new f(this,Pt):null,g=this.bufferController=new r(this,h),m=this.capLevelController=new o(this),p=new l(this),y=new pL(this),_=s.contentSteeringController,T=_?new _(this):null,E=this.levelController=new uL(this,T),S=new lL(this),R=new mL(this.config),x=this.streamController=new gL(this,h,R),L=this.gapController=new oL(this,h);m.setStreamController(x),p.setStreamController(x);const A=[y,E,x];d&&A.splice(1,0,d),T&&A.splice(1,0,T),this.networkControllers=A;const k=[u,g,L,m,p,S,h];this.audioTrackController=this.createController(s.audioTrackController,A);const w=s.audioStreamController;w&&A.push(this.audioStreamController=new w(this,h,R)),this.subtitleTrackController=this.createController(s.subtitleTrackController,A);const P=s.subtitleStreamController;P&&A.push(this.subtititleStreamController=new P(this,h,R)),this.createController(s.timelineController,k),R.emeController=this.emeController=this.createController(s.emeController,k),this.cmcdController=this.createController(s.cmcdController,k),this.latencyController=this.createController(cL,k),this.coreComponents=k,A.push(c);const B=c.onErrorOut;typeof B=="function"&&this.on(v.ERROR,B,c),this.on(v.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,n){this._emitter.off(e,t,s,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const n=e===v.ERROR;this.trigger(v.ERROR,{type:me.OTHER_ERROR,details:M.INTERNAL_EXCEPTION,fatal:n,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(v.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(v.ERROR,{type:me.OTHER_ERROR,details:M.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,n=t?e:{media:s};this._media=s,this.trigger(v.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(v.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(v.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,n=this._url=qu.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&s&&(s!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(v.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[de.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[de.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[de.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=oA()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){tS(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let n=0;n<s;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let n;if(t===-1&&e!=null&&e.length?n=e.length-1:n=t,s)for(let r=n;r--;){const o=e[r].attrs["HDCP-LEVEL"];if(o&&o<=s)return r}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=Mp(t);return Pp(e,s,navigator.mediaCapabilities)}}Pt.defaultConfig=void 0;class yL{constructor(){this.audio=null,this.hls=null,this.isPlaying=!1,this.isMuted=!1,this.volume=50,this.currentTrackIndex=0,this.playlist=[],this.playlistInfo=[],this.currentTime=0,this.duration=0,this.progress=0,this.randomMode=!1,this.isHLSSupported=!1,this.streamingBaseUrl="https://hls.wenturc.com",this.playlistLoaded=!1,this.loadingError=null,this.hlsRetryCount=0,this.achievementTriggered=!1,this.completedTracks=new Set,this.musicConnoisseurUnlocked=!1,this.init()}init(){this.audio=new Audio,this.audio.volume=this.volume/100,this.audio.addEventListener("ended",this.handleTrackEnded.bind(this)),this.audio.addEventListener("timeupdate",this.updateProgress.bind(this)),this.audio.addEventListener("loadedmetadata",this.loadMetadata.bind(this)),this.audio.addEventListener("error",e=>{console.error(" :",e),console.error(" :",this.audio.error)}),this.initializeHLS(),this.loadPlaylist(),this.loadCompletedTracks(),this.checkMusicConnoisseurAchievement(),console.log(" ")}initializeHLS(){this.isHLSSupported=Pt.isSupported(),this.isHLSSupported?(this.hls=new Pt({debug:!1,enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,maxBufferLength:300,maxMaxBufferLength:600,liveSyncDurationCount:3,liveMaxLatencyDurationCount:10,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:4,fragLoadingRetryDelay:1e3,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:3,manifestLoadingRetryDelay:1e3}),this.hls.attachMedia(this.audio),this.hls.on(Pt.Events.MEDIA_ATTACHED,()=>{console.log(" HLS ");const e=this.getCurrentTrack();e&&(console.log("  HLS :",e),this.hls.loadSource(e))}),this.hls.on(Pt.Events.MANIFEST_PARSED,(e,t)=>{var r,o,a,l,c;console.log(" HLS ");const s=(o=(r=t.levels[0])==null?void 0:r.details)==null?void 0:o.targetduration,n=(c=(l=(a=t.levels[0])==null?void 0:a.details)==null?void 0:l.fragments)==null?void 0:c.length;if(!s||s===0||!n||n===0){console.error("  HLS "),this.showHLSError("HLS ");return}}),this.hls.on(Pt.Events.ERROR,(e,t)=>{console.warn(" HLS :",t),t.fatal&&this.handleHLSError(t)}),console.log(" HLS ")):(console.error("  HLS"),this.showHLSError(" HLS "))}async loadPlaylist(){try{console.log("  HLS ...");const e=await fetch(`${this.streamingBaseUrl}/playlist.json`);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const t=await e.json();this.playlist=t.tracks||[],this.playlistInfo=this.playlist,this.playlistLoaded=!0,this.playlist.length>0&&(this.currentTrackIndex=Math.floor(Math.random()*this.playlist.length),console.log(`: ${this.getCurrentTrackName()}`)),console.log(`  ${this.playlist.length} `),this.emitStateChange()}catch(e){console.error(" :",e),this.loadingError=e.message,this.playlist=[],this.playlistInfo=[],this.emitStateChange()}}getCurrentTrack(){if(!this.playlistInfo[this.currentTrackIndex])return null;const e=this.playlistInfo[this.currentTrackIndex];return this.isHLSSupported&&e.hasHLS&&e.hlsUrl?`${this.streamingBaseUrl}${e.hlsUrl}`:(e.originalFile&&(console.error("  HLS "),this.showHLSError(" HLS ")),null)}getCurrentTrackName(){const e=this.playlistInfo[this.currentTrackIndex];if(!e)return"";let t=e.title,s=e.artist;if(!t||!s){const r=(e.filename||e.originalFile||"").replace(/\.(flac|mp3|wav)$/i,"");if(r.includes(" - ")){const o=r.split(" - ");s||(s=o[0]),t||(t=o.slice(1).join(" - "))}else t||(t=r),s||(s="")}return`${t} - ${s}`}togglePlay(){if(!this.playlistLoaded){console.warn(" ");return}if(!this.isHLSSupported){this.showHLSError(" HLS ");return}if(this.isPlaying)this.audio.pause(),this.isPlaying=!1,console.log(" ");else{console.log("  HLS :",this.getCurrentTrackName());const e=this.getCurrentTrack();if(!e){this.showHLSError(" HLS ");return}this.hls&&this.audio.src!==e&&(console.log("  HLS ..."),this.hls.loadSource(e)),this.audio.play().then(()=>{this.isPlaying=!0,console.log(" HLS "),this.hlsRetryCount=0,this.achievementTriggered||(Ue.emit("music-played"),this.achievementTriggered=!0)}).catch(t=>{console.error(" HLS :",t),this.showHLSError("HLS : "+t.message)})}this.emitStateChange()}toggleMute(){this.isMuted=!this.isMuted,this.audio.muted=this.isMuted,this.emitStateChange()}setVolume(e){this.volume=e,this.audio.volume=this.volume/100,this.isMuted&&this.volume>0&&(this.isMuted=!1,this.audio.muted=!1),this.emitStateChange()}nextTrack(){if(!this.playlist||this.playlist.length===0){console.warn(" ");return}this.randomMode?this.currentTrackIndex=this.getRandomTrack():this.currentTrackIndex=(this.currentTrackIndex+1)%this.playlist.length,this.reloadAudio()}prevTrack(){if(!this.playlist||this.playlist.length===0){console.warn(" ");return}this.randomMode?this.currentTrackIndex=this.getRandomTrack():this.currentTrackIndex=(this.currentTrackIndex-1+this.playlist.length)%this.playlist.length,this.reloadAudio()}getRandomTrack(){if(!this.playlist||this.playlist.length<=1)return 0;const e=Array.from({length:this.playlist.length},(s,n)=>n).filter(s=>s!==this.currentTrackIndex);return e.length===0?0:e[Math.floor(Math.random()*e.length)]}toggleRandomMode(){this.randomMode=!this.randomMode,this.emitStateChange()}reloadAudio(){const e=this.getCurrentTrack();if(!e){console.warn("  HLS "),this.showHLSError(" HLS ");return}if(!this.isHLSSupported||!this.hls){this.showHLSError("HLS ");return}console.log(`  HLS : ${this.getCurrentTrackName()}`),this.hls.url&&this.hls.stopLoad();try{if(this.hls.loadSource(e),this.isPlaying){const t=()=>{this.audio.play().catch(s=>{console.error(" HLS :",s),this.showHLSError("HLS : "+s.message)})};this.hls.once(Pt.Events.MANIFEST_PARSED,t),this.audio.readyState>=3&&t()}}catch(t){console.error(" HLS :",t),this.showHLSError("HLS : "+t.message)}this.emitStateChange()}seek(e){if(this.audio){const t=e/100*this.duration;this.audio.currentTime=t,this.updateProgress()}}updateProgress(){this.currentTime=this.audio.currentTime,this.progress=this.currentTime/this.duration*100||0,this.emitStateChange()}loadMetadata(){this.audio&&!isNaN(this.audio.duration)?this.duration=this.audio.duration:this.duration=0,this.emitStateChange()}formatTime(e){if(!e||isNaN(e))return"0:00";const t=Math.floor(e/60),s=Math.floor(e%60).toString().padStart(2,"0");return`${t}:${s}`}handleTrackEnded(){this.completedTracks.has(this.currentTrackIndex)||(this.completedTracks.add(this.currentTrackIndex),this.checkMusicConnoisseurAchievement(),this.saveCompletedTracks()),this.nextTrack()}checkMusicConnoisseurAchievement(){this.completedTracks.size>=5&&!this.musicConnoisseurUnlocked&&(this.musicConnoisseurUnlocked=!0,Ue.emit("achievement-unlocked","music-connoisseur"),localStorage.setItem("music-connoisseur-unlocked","true"))}saveCompletedTracks(){localStorage.setItem("music-completed-tracks",JSON.stringify(Array.from(this.completedTracks)))}loadCompletedTracks(){try{const e=localStorage.getItem("music-completed-tracks");if(e){const s=JSON.parse(e);this.completedTracks=new Set(s)}const t=localStorage.getItem("music-connoisseur-unlocked")==="true";this.musicConnoisseurUnlocked=t}catch(e){console.error(":",e)}}showHLSError(e){this.loadingError=e,console.error(" HLS :",e),this.emitStateChange()}handleHLSError(e){switch(console.error(" HLS :",e),e.type){case Pt.ErrorTypes.NETWORK_ERROR:console.log(" ..."),this.retryHLSLoad(e);break;case Pt.ErrorTypes.MEDIA_ERROR:console.log(" ..."),this.recoverHLSMedia(e);break;case Pt.ErrorTypes.MUX_ERROR:console.log(" ..."),this.reinitializeHLS();break;default:console.log(" ..."),this.forceReloadHLS();break}}retryHLSLoad(e){this.hlsRetryCount||(this.hlsRetryCount=0),this.hlsRetryCount<3?(this.hlsRetryCount++,console.log(` HLS  ${this.hlsRetryCount}/3...`),setTimeout(()=>{this.hls&&this.hls.startLoad()},1e3*this.hlsRetryCount)):(console.log(" HLS ..."),this.reinitializeHLS())}recoverHLSMedia(e){if(this.hls)try{this.hls.recoverMediaError(),console.log(" HLS ")}catch(t){console.error(" HLS :",t),this.reinitializeHLS()}}reinitializeHLS(){console.log("  HLS ..."),this.hls&&this.hls.destroy(),this.hlsRetryCount=0,this.initializeHLS(),setTimeout(()=>{this.reloadAudio()},100)}forceReloadHLS(){console.log("  HLS ...");const e=this.getCurrentTrack();this.hls&&e&&(this.hls.stopLoad(),this.hls.detachMedia(),this.hls.attachMedia(this.audio),this.hls.loadSource(e))}getState(){return{isPlaying:this.isPlaying,isMuted:this.isMuted,volume:this.volume,currentTrackIndex:this.currentTrackIndex,currentTime:this.currentTime,duration:this.duration,progress:this.progress,randomMode:this.randomMode,playlistLoaded:this.playlistLoaded,loadingError:this.loadingError,currentTrackName:this.getCurrentTrackName(),currentTrack:this.getCurrentTrack(),playlist:this.playlist}}emitStateChange(){Ue.emit("audio-state-changed",this.getState())}destroy(){this.hls&&(this.hls.destroy(),this.hls=null),this.audio&&(this.audio.pause(),this.audio=null),console.log(" ")}}const Vt=new yL;const bt=(i,e)=>{const t=i.__vccOpts||i;for(const[s,n]of e)t[s]=n;return t},vL={name:"ProfileCard",data(){return{avatar:"https://avatars.githubusercontent.com/u/59095086?v=4&s=240",name:"",bio:"",socialLinks:[{url:"https://github.com/IGCrystal-NEO",title:"GitHub",iconClass:"fab fa-github"},{url:"https://space.bilibili.com/523637242",title:"",iconClass:"fab fa-bilibili"},{url:"mailto:tu4tu23min@outlook.com",title:"",iconClass:"far fa-envelope"}],backgroundLoaded:!1,backgroundError:!1,backgroundUrl:"https://api.wenturc.com/",loadingProgress:0,loadingTimer:null,navBarHeight:60,musicPlayed:!1}},computed:{imageBackground(){return{backgroundImage:`url(${this.backgroundUrl})`,backgroundSize:"cover",backgroundPosition:"center center"}}},methods:{handleBackgroundLoad(){this.loadingProgress=100,setTimeout(()=>{this.backgroundLoaded=!0,this.backgroundError=!1,this.loadingTimer&&(clearInterval(this.loadingTimer),this.loadingTimer=null)},300)},handleBackgroundError(){this.backgroundLoaded=!1,this.backgroundError=!0,ns.error(""),console.error(""),this.loadingTimer&&(clearInterval(this.loadingTimer),this.loadingTimer=null)},scrollToBottom(){const i=this.$el,e=i.offsetTop+i.offsetHeight;window.scrollTo({top:e-this.navBarHeight,behavior:"smooth"})},handleCardClick(i){i.target.closest(".social-links a")||(this.createPaperScatterEffect(i),!this.musicPlayed&&this.tryPlayMusic())},createPaperScatterEffect(i){const e=i.clientX,t=i.clientY,s=getComputedStyle(document.documentElement),n=getComputedStyle(this.$refs.profileCard),r=[s.getPropertyValue("--icon-primary").trim()||"#5e60ce",s.getPropertyValue("--icon-accent").trim()||"#6930c3",n.getPropertyValue("--border-gradient").trim()||"#dcbff8",s.getPropertyValue("--text-color").trim()||"#333","#dcbff8","#d1ecf9","#c6e2ff","#f9d1dc","#e8f5e8"].filter(c=>c),o=document.createElement("div");o.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: 9999;
        overflow: hidden;
      `,document.body.appendChild(o);const a=25,l=["","","","","",""];for(let c=0;c<a;c++){const u=document.createElement("div"),h=Math.random()*12+8,f=r[Math.floor(Math.random()*r.length)],d=l[Math.floor(Math.random()*l.length)],g=c/a*Math.PI*2+(Math.random()-.5)*.5,m=200+Math.random()*300,p=100+Math.random()*200,y=e+Math.cos(g)*m,_=t+Math.sin(g)*m+p;u.style.cssText=`
          position: absolute;
          left: ${e-h/2}px;
          top: ${t-h/2}px;
          width: ${h}px;
          height: ${h}px;
          color: ${f};
          font-size: ${h}px;
          font-weight: bold;
          line-height: 1;
          text-align: center;
          opacity: 1;
          transform: rotate(0deg);
          transition: all 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
          z-index: 10000;
        `,u.innerHTML=d,o.appendChild(u),setTimeout(()=>{u.parentNode&&(u.style.transform=`translate(${y-e}px, ${_-t}px) rotate(${Math.random()*720-360}deg) scale(0.3)`,u.style.opacity="0")},Math.random()*100)}setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},3e3)},tryPlayMusic(){try{Vt&&!Vt.getState().isPlaying&&(Vt.togglePlay(),this.musicPlayed=!0,ns.info(""))}catch(i){console.warn(" :",i),this.musicPlayed=!0}},simulateLoadingProgress(){this.loadingTimer=setInterval(()=>{if(this.loadingProgress<90){const i=Math.max(.5,10-this.loadingProgress/10);this.loadingProgress+=i}},200)},preloadAvatar(){const i=new Image;i.src=this.avatar,i.onload=()=>{console.log(" ")},i.onerror=()=>{console.warn(" ")}}},created(){this.preloadAvatar()},mounted(){this.simulateLoadingProgress();const i=document.querySelector(".logo-banner");i&&(this.navBarHeight=i.offsetHeight);const e=new Image;e.onload=this.handleBackgroundLoad,e.onerror=this.handleBackgroundError,e.src=this.backgroundUrl}},TL={key:0,class:"github-progress-container"},_L=["src","alt"],EL={class:"name"},SL={class:"bio"},xL={class:"social-links"},bL=["href","title","aria-label"];function AL(i,e,t,s,n,r){return ne(),ce("div",{class:$e(["profile-container",{"image-loaded":n.backgroundLoaded}])},[!n.backgroundLoaded&&!n.backgroundError?(ne(),ce("div",TL,[b("div",{class:"github-progress-bar",style:Yt({width:n.loadingProgress+"%"})},null,4)])):yt("",!0),e[3]||(e[3]=b("div",{class:"background-layer gradient-bg"},null,-1)),b("div",{class:"background-layer image-bg",style:Yt(r.imageBackground)},null,4),b("div",{class:"profile-card",onClick:e[0]||(e[0]=(...o)=>r.handleCardClick&&r.handleCardClick(...o)),ref:"profileCard"},[b("img",{src:n.avatar,alt:` ${n.name} `,class:"avatar",fetchpriority:"high",loading:"eager",width:"120",height:"120",decoding:"sync"},null,8,_L),b("h2",EL,Le(n.name),1),b("p",SL,Le(n.bio),1),b("div",xL,[(ne(!0),ce(et,null,vs(n.socialLinks,(o,a)=>(ne(),ce("a",{key:a,href:o.url,target:"_blank",rel:"noopener noreferrer",title:o.title,"aria-label":o.title},[b("i",{class:$e(o.iconClass)},null,2)],8,bL))),128))])],512),b("div",{class:"arrow-down",onClick:e[1]||(e[1]=(...o)=>r.scrollToBottom&&r.scrollToBottom(...o))},e[2]||(e[2]=[b("i",{class:"fas fa-chevron-down"},null,-1)]))],2)}const z0=bt(vL,[["render",AL],["__scopeId","data-v-824e0dac"]]);const LL={name:"TabNavigation",data(){return{isMobile:!1,navigationItems:[{to:"/",label:"",icon:"fas fa-home",external:!1},{to:"/message-board",label:"",icon:"fas fa-comments",external:!1},{to:"/friend-links",label:"",icon:"fas fa-link",external:!1},{href:"https://docs.wenturc.com",label:"",icon:"fas fa-external-link-alt",external:!0}]}},mounted(){this.checkScreenSize(),window.addEventListener("resize",this.checkScreenSize)},beforeUnmount(){window.removeEventListener("resize",this.checkScreenSize)},methods:{checkScreenSize(){this.isMobile=window.innerWidth<=768},handleTabClick(i){console.log("Tab clicked:",i)}}},IL={class:"tab-navigation-container"},RL={class:"tab-navigation"},kL={class:"tab-content"},CL={class:"tab-label"},wL=["href"],DL={class:"tab-content"},PL={class:"tab-label"};function OL(i,e,t,s,n,r){const o=It("router-link");return ne(),ce("div",IL,[b("nav",RL,[b("div",{class:$e(["tab-list",{mobile:n.isMobile}])},[(ne(!0),ce(et,null,vs(n.navigationItems,(a,l)=>(ne(),ce(et,{key:l},[a.external?(ne(),ce("a",{key:1,href:a.href,target:"_blank",rel:"noopener noreferrer",class:"tab-item external",onContextmenu:e[2]||(e[2]=vn(()=>{},["prevent"])),draggable:"false",onDragstart:e[3]||(e[3]=vn(()=>{},["prevent"]))},[b("div",DL,[b("i",{class:$e([a.icon,"tab-icon"])},null,2),b("span",PL,Le(a.label),1)]),e[5]||(e[5]=b("div",{class:"tab-indicator"},null,-1))],40,wL)):(ne(),Ro(o,{key:0,to:a.to,class:$e(["tab-item",{active:i.$route.path===a.to}]),onClick:c=>r.handleTabClick(a),onContextmenu:e[0]||(e[0]=vn(()=>{},["prevent"])),draggable:"false",onDragstart:e[1]||(e[1]=vn(()=>{},["prevent"]))},{default:kn(()=>[b("div",kL,[b("i",{class:$e([a.icon,"tab-icon"])},null,2),b("span",CL,Le(a.label),1)]),e[4]||(e[4]=b("div",{class:"tab-indicator"},null,-1))]),_:2},1032,["to","class","onClick"]))],64))),128))],2)])])}const ML=bt(LL,[["render",OL],["__scopeId","data-v-28002b83"]]);const FL={name:"Footer"},NL={class:"app-footer"};function $L(i,e,t,s,n,r){return ne(),ce("footer",NL,e[0]||(e[0]=[b("div",{class:"footer-content"},[b("p",null,[ss("  2024 - present "),b("span",{class:"gradient-text"},"IGCrystal. ")]),b("p",{class:"gradient-text"},"All Rights Reserved.")],-1)]))}const UL=bt(FL,[["render",$L],["__scopeId","data-v-4f931d12"]]),BL="modulepreload",GL=function(i,e){return new URL(i,e).href},eg={},pn=function(e,t,s){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(r=>{if(r=GL(r,s),r in eg)return;eg[r]=!0;const o=r.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!s)for(let u=n.length-1;u>=0;u--){const h=n[u];if(h.href===r&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":BL,o||(c.as="script",c.crossOrigin=""),c.href=r,document.head.appendChild(c),o)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e()).catch(r=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r})};class HL{constructor(){this.isMuted=!1,this.startTime=null,this.accumulatedTime=0,this.achievementUnlocked=!1,this.ACHIEVEMENT_TIME=10*60*1e3,this.intervalId=null,this.lastActiveTime=Date.now(),this.checkIntervalMs=5e3,this.initialized=!1}initialize(){this.initialized||(this.initialized=!0,this.loadState(),document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)),this.intervalId=setInterval(()=>{this.checkActivity(),this.updateTracking()},this.checkIntervalMs),["mousemove","keydown","click","scroll"].forEach(e=>{window.addEventListener(e,()=>{this.lastActiveTime=Date.now()})}),document.addEventListener("visibilitychange",()=>{document.hidden||(this.lastActiveTime=Date.now())}))}loadState(){const e=localStorage.getItem("silent-browsing-state");if(e)try{const s=JSON.parse(e);this.accumulatedTime=s.accumulatedTime||0,this.achievementUnlocked=s.achievementUnlocked||!1}catch(s){console.error("",s),this.accumulatedTime=0,this.achievementUnlocked=!1}const t=localStorage.getItem("wenturc-achievements");if(t)try{const s=JSON.parse(t);s["silent-browsing"]&&s["silent-browsing"].unlocked&&(this.achievementUnlocked=!0)}catch(s){console.error("",s)}}saveState(){const e={accumulatedTime:this.accumulatedTime,achievementUnlocked:this.achievementUnlocked};localStorage.setItem("silent-browsing-state",JSON.stringify(e))}handleVisibilityChange(){document.hidden?this.pauseTracking():(this.lastActiveTime=Date.now(),this.isMuted&&this.startTracking())}checkActivity(){Date.now()-this.lastActiveTime>2*60*1e3&&this.pauseTracking()}setMuteStatus(e){e!==this.isMuted&&(this.isMuted=e,this.isMuted?this.startTracking():this.pauseTracking())}startTracking(){!this.startTime&&this.isMuted&&!this.achievementUnlocked&&!document.hidden&&(this.startTime=Date.now())}pauseTracking(){if(this.startTime){const e=Date.now()-this.startTime;this.accumulatedTime+=e,this.startTime=null,this.saveState()}}updateTracking(){if(this.achievementUnlocked)return;let e=this.accumulatedTime;this.startTime&&(e+=Date.now()-this.startTime),e>=this.ACHIEVEMENT_TIME&&this.unlockAchievement()}unlockAchievement(){this.achievementUnlocked||(this.achievementUnlocked=!0,this.saveState(),Ue.emit("achievement-unlocked","silent-browsing"))}cleanup(){this.intervalId&&clearInterval(this.intervalId),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.startTime&&this.pauseTracking(),this.initialized=!1}}const yn=new HL;const VL={name:"BackgroundMusic",data(){return{isCollapsed:!1,isHovered:!1,visualizerData:Array(12).fill(0),audioState:Vt.getState(),audioStateHandler:null}},computed:{isPlaying(){return this.audioState.isPlaying},isMuted(){return this.audioState.isMuted},volume:{get(){return this.audioState.volume},set(i){Vt.setVolume(i)}},currentTrackName(){return this.audioState.currentTrackName},currentTrack(){return this.audioState.currentTrack},currentTime(){return this.audioState.currentTime},duration(){return this.audioState.duration},progress(){return this.audioState.progress},randomMode(){return this.audioState.randomMode},playlistLoaded(){return this.audioState.playlistLoaded},loadingError(){return this.audioState.loadingError}},mounted(){this.audioStateHandler=i=>{this.audioState=i},Ue.on("audio-state-changed",this.audioStateHandler),this.$nextTick(()=>{this.initVolumeControl()}),setInterval(()=>{this.updateVisualizer()},100),yn.initialize(),yn.setMuteStatus(this.audioState.isMuted)},methods:{initVolumeControl(){const i=this.$el.querySelector('.volume-control input[type="range"]');i&&i.addEventListener("touchmove",e=>{e.stopPropagation()},{passive:!1})},togglePlay(){Vt.togglePlay()},toggleMute(){Vt.toggleMute(),yn.setMuteStatus(Vt.getState().isMuted)},changeVolume(){this.audioState.isMuted&&this.audioState.volume>0&&(Vt.toggleMute(),yn.setMuteStatus(!1))},nextTrack(){Vt.nextTrack()},prevTrack(){Vt.prevTrack()},toggleRandomMode(){Vt.toggleRandomMode(),typeof window<"u"&&window.navigator&&window.navigator.vibrate&&window.navigator.vibrate(50)},toggleCollapse(){this.isCollapsed=!this.isCollapsed,this.isCollapsed||this.$nextTick(()=>{this.initVolumeControl()})},formatTime(i){return Vt.formatTime(i)},seek(i){const t=i.currentTarget.getBoundingClientRect(),n=(i.clientX-t.left)/t.width*100;Vt.seek(n)},getVisualizerHeight(i){if(this.audioState.isPlaying)return Math.floor(Math.random()*30)+5;{const e=[8,12,10,15,9,13,7,16,10,14,8,11];return e[i%e.length]}},getRandomHeight(){return this.getVisualizerHeight(0)},updateVisualizer(){this.audioState.isPlaying&&(this.visualizerData=Array(12).fill().map(()=>Math.floor(Math.random()*30)+5))}},beforeDestroy(){this.audioStateHandler&&Ue.off("audio-state-changed",this.audioStateHandler),yn.cleanup()}},KL={class:"content"},zL={class:"header-row"},WL={key:0,class:"expanded-content"},qL={class:"music-control-row"},YL={class:"track-info"},jL={class:"now-playing"},XL={key:0,class:"now-playing-indicator"},QL={key:1,class:"not-playing"},JL={class:"track-name"},ZL={class:"progress-container"},eI={class:"progress-info"},tI={class:"play-mode-text"},sI={class:"time"},iI={class:"volume-control"},nI={class:"primary-controls"},rI={key:1,class:"visualizer"},oI=["src"];function aI(i,e,t,s,n,r){return ne(),ce("div",{class:$e(["background-music",{collapsed:n.isCollapsed}]),onMouseenter:e[12]||(e[12]=o=>n.isHovered=!0),onMouseleave:e[13]||(e[13]=o=>n.isHovered=!1)},[b("div",KL,[b("div",zL,[e[14]||(e[14]=b("div",{class:"card-title"},"",-1)),b("button",{class:"collapse-btn",onClick:e[0]||(e[0]=(...o)=>r.toggleCollapse&&r.toggleCollapse(...o))},[b("i",{class:$e(n.isCollapsed?"fas fa-chevron-down":"fas fa-chevron-up")},null,2)])]),n.isCollapsed?yt("",!0):(ne(),ce("div",WL,[b("div",qL,[b("div",YL,[b("div",jL,[r.isPlaying?(ne(),ce("div",XL,e[15]||(e[15]=[b("div",{class:"now-playing-bar"},null,-1),b("div",{class:"now-playing-bar"},null,-1),b("div",{class:"now-playing-bar"},null,-1),b("div",{class:"now-playing-bar"},null,-1)]))):(ne(),ce("span",QL,"")),b("div",JL,Le(r.currentTrackName||""),1)]),b("div",ZL,[b("div",{class:"progress-bar",onClick:e[1]||(e[1]=(...o)=>r.seek&&r.seek(...o))},[b("div",{class:"progress",style:Yt({width:`${r.progress}%`})},null,4),b("div",{class:"progress-thumb",style:Yt({left:`${r.progress}%`})},null,4)]),b("div",eI,[b("div",{class:"play-mode",onClick:e[2]||(e[2]=(...o)=>r.toggleRandomMode&&r.toggleRandomMode(...o))},[b("i",{class:$e(["play-mode-icon",r.randomMode?"fas fa-random":"fas fa-list"])},null,2),b("span",tI,Le(r.randomMode?"":""),1)]),b("div",sI,Le(r.formatTime(r.currentTime))+" / "+Le(r.formatTime(r.duration)),1)])])])]),b("div",iI,[b("i",{class:$e([r.isMuted||r.volume===0?"fas fa-volume-mute":"fas fa-volume-up","volume-icon"]),onClick:e[3]||(e[3]=(...o)=>r.toggleMute&&r.toggleMute(...o))},null,2),Cm(b("input",{type:"range",min:"0",max:"100","onUpdate:modelValue":e[4]||(e[4]=o=>r.volume=o),onInput:e[5]||(e[5]=(...o)=>r.changeVolume&&r.changeVolume(...o))},null,544),[[tE,r.volume]])])])),b("div",{class:$e(["media-controls",{"collapsed-controls":n.isCollapsed,"expanded-controls":!n.isCollapsed}])},[b("div",nI,[b("button",{onClick:e[6]||(e[6]=(...o)=>r.prevTrack&&r.prevTrack(...o)),class:"control-btn"},e[16]||(e[16]=[b("i",{class:"fas fa-step-backward"},null,-1)])),b("button",{onClick:e[7]||(e[7]=(...o)=>r.togglePlay&&r.togglePlay(...o)),class:"play-btn"},[b("i",{class:$e(r.isPlaying?"fas fa-pause":"fas fa-play")},null,2)]),b("button",{onClick:e[8]||(e[8]=(...o)=>r.nextTrack&&r.nextTrack(...o)),class:"control-btn"},e[17]||(e[17]=[b("i",{class:"fas fa-step-forward"},null,-1)]))])],2),n.isCollapsed?yt("",!0):(ne(),ce("div",rI,[(ne(),ce(et,null,vs(12,(o,a)=>b("div",{class:$e(["visualizer-bar",{animated:r.isPlaying}]),key:a,style:Yt({height:`${r.getVisualizerHeight(a)}px`})},null,6)),64))])),b("audio",{ref:"bgMusic",onEnded:e[9]||(e[9]=(...o)=>i.handleTrackEnded&&i.handleTrackEnded(...o)),onTimeupdate:e[10]||(e[10]=(...o)=>i.updateProgress&&i.updateProgress(...o)),onLoadedmetadata:e[11]||(e[11]=(...o)=>i.loadMetadata&&i.loadMetadata(...o))},[b("source",{src:r.currentTrack,type:"audio/mp3"},null,8,oI),e[18]||(e[18]=ss(" Your browser does not support the audio element. "))],544)])],34)}const lI=bt(VL,[["render",aI],["__scopeId","data-v-02e1037a"]]);const cI={name:"TimeWidget",data(){return{currentTime:"00:00:00",currentDate:"",dayOfWeek:"",timer:null,isHovered:!1,hourAngle:0,minuteAngle:0,secondAngle:0}},computed:{hourRotation(){return{transform:`rotate(${this.hourAngle}deg)`}},minuteRotation(){return{transform:`rotate(${this.minuteAngle}deg)`}},secondRotation(){return{transform:`rotate(${this.secondAngle}deg)`}}},methods:{updateTime(){const i=new Date;this.secondAngle=i.getSeconds()*6,this.minuteAngle=i.getMinutes()*6+i.getSeconds()*.1,this.hourAngle=i.getHours()%12*30+i.getMinutes()*.5,this.currentTime=i.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),this.currentDate=i.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"});const e=["","","","","","",""];this.dayOfWeek=e[i.getDay()]}},mounted(){this.updateTime(),this.timer=setInterval(this.updateTime,1e3)},beforeDestroy(){clearInterval(this.timer)}},uI={class:"time-display"},hI={class:"current-time"},fI={class:"date-container"},dI={class:"current-date"},gI={class:"day-of-week"},mI={class:"clock-hands"};function pI(i,e,t,s,n,r){return ne(),ce("div",{class:"time-widget",onMouseenter:e[0]||(e[0]=o=>n.isHovered=!0),onMouseleave:e[1]||(e[1]=o=>n.isHovered=!1)},[b("div",{class:$e(["time-card",{hovered:n.isHovered}])},[e[3]||(e[3]=b("div",{class:"header-row"},[b("div",{class:"card-title"},""),b("div",{class:"time-icon"},[b("i",{class:"fas fa-clock"})])],-1)),b("div",uI,[b("div",hI,Le(n.currentTime),1),b("div",fI,[b("div",dI,Le(n.currentDate),1),b("div",gI,Le(n.dayOfWeek),1)])]),b("div",mI,[b("div",{class:"hand hour-hand",style:Yt(r.hourRotation)},null,4),b("div",{class:"hand minute-hand",style:Yt(r.minuteRotation)},null,4),b("div",{class:"hand second-hand",style:Yt(r.secondRotation)},null,4),e[2]||(e[2]=b("div",{class:"center-point"},null,-1))])],2)],32)}const yI=bt(cI,[["render",pI],["__scopeId","data-v-9e39055c"]]);function vI(){const i=localStorage.getItem("theme-mode");i&&document.documentElement.setAttribute("data-theme",i);const e=localStorage.getItem("color-scheme");e&&(e!=="default"&&document.documentElement.setAttribute("data-color-scheme",e),jr(i||"light",e))}function jr(i,e){const t={default:{primary:"linear-gradient(45deg, #73c2fb, #1e90ff)",light:{bg:"#ffffff",text:"#333333",border:"#cfefff, #d6f3ff, #bfe4ff, #e0f7ff"},dark:{bg:"#212121",text:"#f1f1f1",border:"#4aa3e0, #73c2fb, #4da3ff, #5aa9f6"}},pink:{primary:"linear-gradient(45deg, #ff6b6b, #d471d4)",light:{bg:"#ffffff",text:"#333333",border:"#ffcece, #ffc2f9, #ffb3ef, #ffb8d9"},dark:{bg:"#212121",text:"#f1f1f1",border:"#d76d6d, #c160c1, #db6aba, #d66d9e"}},green:{primary:"linear-gradient(45deg, #69db7c, #38d9a9)",light:{bg:"#ffffff",text:"#333333",border:"#c2f9cc, #b3efd1, #a9e9c8, #bef7d8"},dark:{bg:"#212121",text:"#f1f1f1",border:"#5cba6a, #35b288, #36b283, #4aba78"}}},s=t[e]||t.default,n=document.documentElement;n.style.setProperty("--primary-gradient",s.primary),n.style.setProperty("--background-color",s[i].bg),n.style.setProperty("--text-color",s[i].text),n.style.setProperty("--border-gradient",s[i].border)}const TI={name:"BlackLightWidget",data(){return{isHovered:!1,isDarkMode:!1,currentScheme:"default",achievementUnlocked:!1,initialLoad:!0,colorSchemes:[{id:"default",name:"",primary:"linear-gradient(45deg, #73c2fb, #1e90ff)",light:{bg:"#ffffff",text:"#333333",border:"#cfefff, #d6f3ff, #bfe4ff, #e0f7ff"},dark:{bg:"#212121",text:"#f1f1f1",border:"#4aa3e0, #73c2fb, #4da3ff, #5aa9f6"}},{id:"pink",name:"",primary:"linear-gradient(45deg, #ff6b6b, #d471d4)",light:{bg:"#ffffff",text:"#333333",border:"#ffcece, #ffc2f9, #ffb3ef, #ffb8d9"},dark:{bg:"#212121",text:"#f1f1f1",border:"#d76d6d, #c160c1, #db6aba, #d66d9e"}},{id:"green",name:"",primary:"linear-gradient(45deg, #69db7c, #38d9a9)",light:{bg:"#ffffff",text:"#333333",border:"#c2f9cc, #b3efd1, #a9e9c8, #bef7d8"},dark:{bg:"#212121",text:"#f1f1f1",border:"#5cba6a, #35b288, #36b283, #4aba78"}}]}},created(){this.loadThemeSettings(),this.checkAchievementStatus(),this.$nextTick(()=>{this.initialLoad=!1})},methods:{toggleTheme(){document.documentElement.setAttribute("data-theme",this.isDarkMode?"dark":"light"),this.saveThemeSettings(),this.setColorScheme(this.currentScheme,!0),this.$emit("theme-changed",{isDarkMode:this.isDarkMode,scheme:this.currentScheme}),this.triggerAchievement()},setColorScheme(i,e=!1){if(this.currentScheme===i&&!e){this.currentScheme=i;return}const t=this.currentScheme;if(this.currentScheme=i,!this.colorSchemes.find(o=>o.id===i))return;const n=document.documentElement;i==="default"?n.removeAttribute("data-color-scheme"):n.setAttribute("data-color-scheme",i);const r=this.isDarkMode?"dark":"light";jr(r,i),this.saveThemeSettings(),(e||t!==i)&&!this.initialLoad&&(this.$emit("theme-changed",{isDarkMode:this.isDarkMode,scheme:this.currentScheme}),this.triggerAchievement())},loadThemeSettings(){const i=localStorage.getItem("theme-mode");i&&(this.isDarkMode=i==="dark",document.documentElement.setAttribute("data-theme",this.isDarkMode?"dark":"light")),this.currentScheme;const e=localStorage.getItem("color-scheme");if(e){if(this.currentScheme=e,!this.colorSchemes.find(r=>r.id===e))return;const s=document.documentElement;e==="default"?s.removeAttribute("data-color-scheme"):s.setAttribute("data-color-scheme",e);const n=this.isDarkMode?"dark":"light";jr(n,e)}else{this.currentScheme="default",document.documentElement.removeAttribute("data-color-scheme");const t=this.isDarkMode?"dark":"light";jr(t,"default")}},saveThemeSettings(){localStorage.setItem("theme-mode",this.isDarkMode?"dark":"light"),localStorage.setItem("color-scheme",this.currentScheme)},triggerAchievement(){Ue.emit("theme-changed"),this.achievementUnlocked=!0,localStorage.setItem("theme-achievement-unlocked","true")},checkAchievementStatus(){const i=localStorage.getItem("theme-achievement-unlocked")==="true";this.achievementUnlocked=i;const e=localStorage.getItem("wenturc-achievements");if(e)try{const t=JSON.parse(e);t["theme-changer"]&&t["theme-changer"].unlocked&&(this.achievementUnlocked=!0)}catch(t){console.error("",t)}}}},_I={class:"header-row"},EI={class:"theme-icon"},SI={class:"theme-content"},xI={class:"mode-switch"},bI={class:"switch"},AI={class:"color-schemes"},LI={class:"scheme-options"},II=["onClick"],RI={class:"scheme-name"},kI={key:0,class:"achievement-hint"};function CI(i,e,t,s,n,r){return ne(),ce("div",{class:"theme-widget",onMouseenter:e[2]||(e[2]=o=>n.isHovered=!0),onMouseleave:e[3]||(e[3]=o=>n.isHovered=!1)},[b("div",{class:$e(["theme-card",{hovered:n.isHovered}])},[b("div",_I,[e[4]||(e[4]=b("div",{class:"card-title"},"",-1)),b("div",EI,[b("i",{class:$e(n.isDarkMode?"fas fa-moon":"fas fa-sun")},null,2)])]),b("div",SI,[b("div",xI,[e[6]||(e[6]=b("div",{class:"mode-label"},[b("i",{class:"fas fa-sun"}),b("span",null,"")],-1)),b("label",bI,[Cm(b("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=o=>n.isDarkMode=o),onChange:e[1]||(e[1]=(...o)=>r.toggleTheme&&r.toggleTheme(...o))},null,544),[[sE,n.isDarkMode]]),e[5]||(e[5]=b("span",{class:"slider"},null,-1))]),e[7]||(e[7]=b("div",{class:"mode-label"},[b("i",{class:"fas fa-moon"}),b("span",null,"")],-1))]),b("div",{class:$e(["theme-preview",{dark:n.isDarkMode}])},e[8]||(e[8]=[g_('<div class="preview-card" data-v-6b7ab04d><div class="preview-header" data-v-6b7ab04d></div><div class="preview-content" data-v-6b7ab04d><div class="preview-line" data-v-6b7ab04d></div><div class="preview-line" data-v-6b7ab04d></div></div></div>',1)]),2),b("div",AI,[e[9]||(e[9]=b("h4",null,"",-1)),b("div",LI,[(ne(!0),ce(et,null,vs(n.colorSchemes,o=>(ne(),ce("button",{key:o.id,class:$e(["scheme-btn",{active:n.currentScheme===o.id}]),onClick:a=>r.setColorScheme(o.id)},[b("span",{class:"color-dot",style:Yt({background:o.primary})},null,4),b("span",RI,Le(o.name),1)],10,II))),128))])]),n.achievementUnlocked?yt("",!0):(ne(),ce("div",kI,e[10]||(e[10]=[b("i",{class:"fas fa-trophy hint-icon"},null,-1),b("span",null,"",-1)])))])],2)],32)}const wI=bt(TI,[["render",CI],["__scopeId","data-v-6b7ab04d"]]),DI=[{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""},{text:"",author:""}];const PI={name:"InspireWidget",data(){return{isHovered:!1,currentQuote:{text:"",author:""},quotes:DI,favorites:[],showFavorites:!1,isCurrentFavorite:!1,showAchievementHint:!1,quoteStats:{refreshCount:0,favoriteCount:0,copyCount:0,shareCount:0,viewedCount:0},achievementsUnlocked:{quoteFavorite:!1,quoteCollector:!1,quoteMaster:!1,quoteExplorer:!1}}},mounted(){this.setRandomQuote(),this.loadFavorites(),this.loadStats(),this.$nextTick(()=>{this.checkShowAchievementHint()})},methods:{setRandomQuote(){const i=Math.floor(Math.random()*this.quotes.length);this.currentQuote=this.quotes[i],this.checkIfFavorite(),this.quoteStats.viewedCount++,this.updateStats(),this.checkAchievements()},refreshQuote(){this.quoteStats.refreshCount++,this.setRandomQuote(),this.updateStats(),this.quoteStats.refreshCount>=10&&!this.achievementsUnlocked.quoteExplorer&&(this.achievementsUnlocked.quoteExplorer=!0,this.unlockAchievement("quote-explorer"))},toggleFavorite(){const i=this.favorites.findIndex(e=>e.text===this.currentQuote.text&&e.author===this.currentQuote.author);i===-1?(this.favorites.push({...this.currentQuote}),this.isCurrentFavorite=!0,this.quoteStats.favoriteCount++,this.updateStats(),this.favorites.length>=5&&!this.achievementsUnlocked.quoteCollector&&(this.achievementsUnlocked.quoteCollector=!0,this.unlockAchievement("quote-collector"))):(this.favorites.splice(i,1),this.isCurrentFavorite=!1),this.saveFavorites()},copyQuote(){const i=`"${this.currentQuote.text}"  ${this.currentQuote.author}`;navigator.clipboard.writeText(i).then(()=>{ns.configPresets.copySuccess(),this.quoteStats.copyCount++,this.updateStats(),this.quoteStats.copyCount>=3&&!this.achievementsUnlocked.quoteMaster&&(this.achievementsUnlocked.quoteMaster=!0,this.unlockAchievement("quote-sharer"))})},shareQuote(){const i=`"${this.currentQuote.text}"  ${this.currentQuote.author}`;this.quoteStats.shareCount++,this.updateStats(),navigator.share?navigator.share({title:"",text:i}).catch(e=>console.log("",e)):this.copyQuote(),this.achievementsUnlocked.quoteSharing||(this.achievementsUnlocked.quoteSharing=!0,this.unlockAchievement("quote-sharer"))},setQuote(i){this.currentQuote=i,this.showFavorites=!1,this.isCurrentFavorite=!0},removeFavorite(i){this.favorites.splice(i,1),this.saveFavorites(),this.checkIfFavorite()},saveFavorites(){localStorage.setItem("inspire-favorites",JSON.stringify(this.favorites))},loadFavorites(){const i=localStorage.getItem("inspire-favorites");if(i)try{this.favorites=JSON.parse(i),this.checkIfFavorite(),this.favorites.length>=5&&!this.achievementsUnlocked.quoteCollector&&(this.achievementsUnlocked.quoteCollector=!0,this.unlockAchievement("quote-collector"))}catch(e){console.error("",e),this.favorites=[]}},checkIfFavorite(){this.isCurrentFavorite=this.favorites.some(i=>i.text===this.currentQuote.text&&i.author===this.currentQuote.author)},unlockAchievement(i){Ue.emit("achievement-unlocked",i),this.showAchievementHint=!1,this.saveAchievementStatus()},loadStats(){const i=localStorage.getItem("inspire-stats");if(i)try{this.quoteStats=JSON.parse(i)}catch(t){console.error("",t),this.quoteStats={refreshCount:0,favoriteCount:0,copyCount:0,shareCount:0,viewedCount:0}}const e=localStorage.getItem("inspire-achievements");if(e)try{this.achievementsUnlocked=JSON.parse(e)}catch(t){console.error("",t)}},updateStats(){localStorage.setItem("inspire-stats",JSON.stringify(this.quoteStats)),this.checkAchievements()},saveAchievementStatus(){localStorage.setItem("inspire-achievements",JSON.stringify(this.achievementsUnlocked))},checkAchievements(){!Object.values(this.achievementsUnlocked).every(e=>e===!0)&&this.quoteStats.viewedCount>=3&&(this.showAchievementHint=!0)},checkShowAchievementHint(){const i=localStorage.getItem("wenturc-achievements");if(i)try{const e=JSON.parse(i),t=e["quote-collector"]&&e["quote-collector"].unlocked&&e["quote-sharer"]&&e["quote-sharer"].unlocked&&e["quote-explorer"]&&e["quote-explorer"].unlocked;this.showAchievementHint=!t}catch(e){console.error("",e)}else this.showAchievementHint=!0}}},OI={class:"quote-container"},MI={class:"quote-content"},FI={class:"quote-text"},NI={class:"quote-author"},$I={class:"quote-actions"},UI={key:0,class:"favorites-section"},BI={class:"favorites-header"},GI={key:0,class:"favorites-list"},HI={class:"fav-text"},VI={class:"fav-actions"},KI=["onClick"],zI=["onClick"],WI={key:1,class:"no-favorites"},qI={key:1,class:"view-favorites"},YI={key:2,class:"achievement-hint"};function jI(i,e,t,s,n,r){return ne(),ce("div",{class:"inspire-widget",onMouseenter:e[6]||(e[6]=o=>n.isHovered=!0),onMouseleave:e[7]||(e[7]=o=>n.isHovered=!1)},[b("div",{class:$e(["inspire-card",{hovered:n.isHovered}])},[e[20]||(e[20]=b("div",{class:"header-row"},[b("div",{class:"card-title"},""),b("div",{class:"inspire-icon"},[b("i",{class:"fas fa-lightbulb"})])],-1)),b("div",OI,[e[8]||(e[8]=b("div",{class:"quote-decorator left"},[b("i",{class:"fas fa-quote-left"})],-1)),b("div",MI,[b("p",FI,Le(n.currentQuote.text),1),b("p",NI," "+Le(n.currentQuote.author),1)]),e[9]||(e[9]=b("div",{class:"quote-decorator right"},[b("i",{class:"fas fa-quote-right"})],-1))]),b("div",$I,[b("button",{class:"action-btn refresh-btn",onClick:e[0]||(e[0]=(...o)=>r.refreshQuote&&r.refreshQuote(...o)),title:""},e[10]||(e[10]=[b("i",{class:"fas fa-sync-alt"},null,-1)])),b("button",{class:$e(["action-btn like-btn",{active:n.isCurrentFavorite}]),onClick:e[1]||(e[1]=(...o)=>r.toggleFavorite&&r.toggleFavorite(...o))},e[11]||(e[11]=[b("i",{class:"fas fa-heart"},null,-1)]),2),b("button",{class:"action-btn copy-btn",onClick:e[2]||(e[2]=(...o)=>r.copyQuote&&r.copyQuote(...o)),title:""},e[12]||(e[12]=[b("i",{class:"fas fa-copy"},null,-1)])),b("button",{class:"action-btn share-btn",onClick:e[3]||(e[3]=(...o)=>r.shareQuote&&r.shareQuote(...o)),title:""},e[13]||(e[13]=[b("i",{class:"fas fa-share-alt"},null,-1)]))]),n.showFavorites?(ne(),ce("div",UI,[b("div",BI,[e[15]||(e[15]=b("h4",null,"",-1)),b("button",{class:"close-favorites",onClick:e[4]||(e[4]=o=>n.showFavorites=!1)},e[14]||(e[14]=[b("i",{class:"fas fa-times"},null,-1)]))]),n.favorites.length>0?(ne(),ce("div",GI,[(ne(!0),ce(et,null,vs(n.favorites,(o,a)=>(ne(),ce("div",{class:"favorite-item",key:a},[b("p",HI,Le(o.text),1),b("div",VI,[b("button",{onClick:l=>r.setQuote(o),title:""},e[16]||(e[16]=[b("i",{class:"fas fa-eye"},null,-1)]),8,KI),b("button",{onClick:l=>r.removeFavorite(a),title:""},e[17]||(e[17]=[b("i",{class:"fas fa-trash-alt"},null,-1)]),8,zI)])]))),128))])):(ne(),ce("div",WI,e[18]||(e[18]=[b("i",{class:"far fa-heart"},null,-1),b("p",null,"",-1)])))])):yt("",!0),!n.showFavorites&&n.favorites.length>0?(ne(),ce("div",qI,[b("button",{class:"view-favorites-btn",onClick:e[5]||(e[5]=o=>n.showFavorites=!0)},"  "+Le(n.favorites.length)+"  ",1)])):yt("",!0),n.showAchievementHint?(ne(),ce("div",YI,e[19]||(e[19]=[b("i",{class:"fas fa-trophy hint-icon"},null,-1),b("span",null,"",-1)]))):yt("",!0)],2)],32)}const XI=bt(PI,[["render",jI],["__scopeId","data-v-bcda674d"]]);class QI{constructor(){this.clickCount=0,this.clickTimeout=null,this.logoRef=null,this.isGameActive=!1,this.gameStarted=!1,this.handleLogoClick=this.handleLogoClick.bind(this)}initialize(e={}){const{element:t,vueComponent:s}=e;if(t)this.logoRef={element:t},console.log("LogoDOM");else if(s&&s.$refs&&s.$refs.logoImg)this.logoRef={element:s.$refs.logoImg},console.log("LogoVue Options API");else if(s&&s.value)this.logoRef={element:s.value},console.log("LogoVue Composition API");else return console.warn("Logo"),!1;return console.log("Logo:",this.logoRef),!0}handleLogoClick(e){if(e.stopPropagation(),this.clickCount++,this.clickTimeout&&clearTimeout(this.clickTimeout),this.clickCount>=5&&!this.gameStarted){this.startGame();return}this.clickTimeout=setTimeout(()=>{this.clickCount=0},2e3)}handleClick(e){return e>=5?(this.startGame(),!0):!1}startGame(){if(!this.logoRef||!this.logoRef.element){console.warn("Logo");return}this.gameStarted=!0,this.isGameActive=!0,this.logoRef.element.classList.add("game-active"),setTimeout(()=>{this.logoRef&&this.logoRef.element&&this.logoRef.element.classList.remove("game-active"),this.isGameActive=!1,Ue.emit("achievement-unlocked","logo-game"),setTimeout(()=>{this.gameStarted=!1,this.clickCount=0},5e3)},2e3)}cleanup(){this.clickTimeout&&clearTimeout(this.clickTimeout),this.logoRef=null,this.isGameActive=!1,this.clickCount=0}}const tg=new QI,JI=""+new URL("../favicon.webp",import.meta.url).href;const ZI={name:"Logo",components:{BackgroundMusic:lI,TimeWidget:yI,BlackLightWidget:wI,NeoLife:XI},data(){return{isAtTop:!0,musicSidebarVisible:!1,scrollPosition:0,isDarkMode:!1,currentScheme:"default",logoLastClickTime:0,logoClickCount:0,CLICK_TIMEOUT:2e3,isMobile:!1,sidebarWidth:350,isResizing:!1,minSidebarWidth:300,maxSidebarWidth:600}},mounted(){window.addEventListener("scroll",this.onScroll),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("resize",this.onResize),this.loadThemeSettings(),this.checkScreenSize(),this.loadSidebarWidth(),tg.initialize({vueComponent:this,element:this.$refs.logoImg})},beforeUnmount(){window.removeEventListener("scroll",this.onScroll),window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("resize",this.onResize),tg.cleanup(),document.body.style.overflow="",document.body.style.position="",document.body.style.top="",document.body.style.width="",document.removeEventListener("mousemove",this.handleResize),document.removeEventListener("mouseup",this.stopResize),document.removeEventListener("touchmove",this.handleResize),document.removeEventListener("touchend",this.stopResize)},methods:{handleLogoClick(i){i.preventDefault(),i.stopPropagation();const e=Date.now();return e-this.logoLastClickTime<this.CLICK_TIMEOUT?(this.logoClickCount++,this.logoClickCount>=5&&(this.$refs.logoImg&&(this.$refs.logoImg.classList.add("game-active"),setTimeout(()=>{this.$refs.logoImg.classList.remove("game-active")},2e3)),pn(()=>Promise.resolve().then(()=>gE),void 0,import.meta.url).then(t=>{t.default.emit("achievement-unlocked","logo-game")}),setTimeout(()=>{this.logoClickCount=0},2e3))):(this.logoClickCount=1,setTimeout(()=>{this.logoClickCount===1&&this.goHome()},300)),this.logoLastClickTime=e,!1},goHome(){window.location.pathname==="/"?window.location.reload():window.location.href="/"},onScroll(){const i=window.pageYOffset;this.isAtTop=i===0},onResize(){this.checkScreenSize()},checkScreenSize(){this.isMobile=window.innerWidth<=425},toggleTheme(){this.isDarkMode=!this.isDarkMode,document.documentElement.setAttribute("data-theme",this.isDarkMode?"dark":"light");const i=localStorage.getItem("color-scheme")||this.currentScheme;this.currentScheme=i,this.$refs.blackLight&&(this.$refs.blackLight.isDarkMode=this.isDarkMode);const e=this.isDarkMode?"dark":"light";jr(e,this.currentScheme),this.saveThemeSettings()},onThemeChanged(i){this.isDarkMode=i.isDarkMode,this.currentScheme=i.scheme},loadThemeSettings(){const i=localStorage.getItem("theme-mode");i&&(this.isDarkMode=i==="dark",document.documentElement.setAttribute("data-theme",this.isDarkMode?"dark":"light"));const e=localStorage.getItem("color-scheme");e&&(this.currentScheme=e)},saveThemeSettings(){localStorage.setItem("theme-mode",this.isDarkMode?"dark":"light"),localStorage.setItem("color-scheme",this.currentScheme)},toggleMusicSidebar(){this.musicSidebarVisible=!this.musicSidebarVisible,this.toggleBodyScroll()},closeSidebar(){this.musicSidebarVisible=!1,this.enableScroll(),this.syncThemeFromStorage()},syncThemeFromStorage(){const i=localStorage.getItem("theme-mode");i&&(this.isDarkMode=i==="dark");const e=localStorage.getItem("color-scheme");e&&(this.currentScheme=e)},handleKeyDown(i){i.key==="Escape"&&this.musicSidebarVisible&&this.closeSidebar()},toggleBodyScroll(){this.musicSidebarVisible?this.disableScroll():this.enableScroll()},disableScroll(){this.scrollPosition=window.pageYOffset,document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${this.scrollPosition}px`,document.body.style.width="100%"},enableScroll(){document.body.style.overflow="",document.body.style.position="",document.body.style.top="",document.body.style.width="",window.scrollTo(0,this.scrollPosition)},loadSidebarWidth(){const i=localStorage.getItem("sidebar-width");if(i){const e=parseInt(i);e>=this.minSidebarWidth&&e<=this.maxSidebarWidth&&(this.sidebarWidth=e)}},saveSidebarWidth(){localStorage.setItem("sidebar-width",this.sidebarWidth.toString())},startResize(i){if(this.isMobile)return;this.isResizing=!0,i.type==="touchstart"?(document.addEventListener("touchmove",this.handleResize,{passive:!1}),document.addEventListener("touchend",this.stopResize)):(document.addEventListener("mousemove",this.handleResize),document.addEventListener("mouseup",this.stopResize),document.body.style.cursor="ew-resize"),document.body.style.userSelect="none",i.preventDefault()},handleResize(i){if(!this.isResizing)return;const e=i.touches?i.touches[0].clientX:i.clientX,t=window.innerWidth-e;t>=this.minSidebarWidth&&t<=this.maxSidebarWidth&&(this.sidebarWidth=t),i.touches&&i.preventDefault()},stopResize(){this.isResizing=!1,document.removeEventListener("mousemove",this.handleResize),document.removeEventListener("mouseup",this.stopResize),document.removeEventListener("touchmove",this.handleResize),document.removeEventListener("touchend",this.stopResize),document.body.style.cursor="",document.body.style.userSelect="",this.saveSidebarWidth()}},watch:{musicSidebarVisible(i){i||this.syncThemeFromStorage()}}},eR={class:"theme-toggle"},tR={class:"music-control"},sR={class:"sidebar-layout"},iR={class:"sidebar-header"},nR={class:"sidebar-content"};function rR(i,e,t,s,n,r){const o=It("TimeWidget"),a=It("BackgroundMusic"),l=It("BlackLightWidget"),c=It("NeoLife");return ne(),ce("div",{class:$e(["logo-banner",{scrolled:!n.isAtTop}])},[b("a",{href:"/",onClick:e[1]||(e[1]=vn((...u)=>r.handleLogoClick&&r.handleLogoClick(...u),["prevent"])),class:"logo-link"},[b("img",{ref:"logoImg",src:JI,alt:"Logo",draggable:"false",onContextmenu:e[0]||(e[0]=vn(()=>{},["prevent"]))},null,544),e[8]||(e[8]=b("span",{class:"logo-text"},"IGCrystal",-1))]),b("div",eR,[b("button",{class:"theme-toggle-btn",onClick:e[2]||(e[2]=(...u)=>r.toggleTheme&&r.toggleTheme(...u))},[b("i",{class:$e(n.isDarkMode?"fas fa-sun":"fas fa-moon")},null,2)])]),b("div",tR,[b("div",{class:"sidebar-button",onClick:e[3]||(e[3]=(...u)=>r.toggleMusicSidebar&&r.toggleMusicSidebar(...u))},e[9]||(e[9]=[b("div",{class:"button-inner"},[b("i",{class:"fas fa-bars"})],-1)]))]),Oe(wa,{name:"fade"},{default:kn(()=>[n.musicSidebarVisible?(ne(),ce("div",{key:0,class:"sidebar-overlay",onClick:e[4]||(e[4]=(...u)=>r.closeSidebar&&r.closeSidebar(...u))})):yt("",!0)]),_:1}),Oe(wa,{name:"slide-fade"},{default:kn(()=>[n.musicSidebarVisible?(ne(),ce("div",{key:0,class:"right-sidebar",style:Yt({width:n.sidebarWidth+"px"})},[n.isMobile?yt("",!0):(ne(),ce("div",{key:0,class:"resize-handle",onMousedown:e[5]||(e[5]=(...u)=>r.startResize&&r.startResize(...u)),onTouchstart:e[6]||(e[6]=(...u)=>r.startResize&&r.startResize(...u))},null,32)),b("div",sR,[b("div",iR,[e[11]||(e[11]=b("h2",null," ",-1)),b("button",{class:"close-btn",onClick:e[7]||(e[7]=(...u)=>r.closeSidebar&&r.closeSidebar(...u))},e[10]||(e[10]=[b("i",{class:"fas fa-times"},null,-1)]))]),b("div",nR,[Oe(o),Oe(a),Oe(l,{ref:"blackLight",onThemeChanged:r.onThemeChanged},null,8,["onThemeChanged"]),Oe(c),e[12]||(e[12]=b("div",{class:"bottom-spacer"},null,-1))])])],4)):yt("",!0)]),_:1})],2)}const oR=bt(ZI,[["render",rR],["__scopeId","data-v-705cf5dd"]]);const aR={name:"KonamiCode",props:{active:{type:Boolean,required:!0},isUnlocked:{type:Boolean,default:!1}},data(){return{konamiSequence:["","","","","","","","","B","A"]}},methods:{close(){this.$emit("close")}}},lR={key:0,class:"konami-container"},cR={class:"secret-message konami-style"},uR={class:"konami-header"},hR={key:0},fR={key:1},dR={class:"konami-animation"},gR={class:"key-sequence"};function mR(i,e,t,s,n,r){return t.active?(ne(),ce("div",lR,[b("div",cR,[b("div",uR,[e[2]||(e[2]=b("div",{class:"konami-badge"},"KONAMI",-1)),t.isUnlocked?(ne(),ce("h3",fR,"")):(ne(),ce("h3",hR,""))]),b("div",dR,[b("div",gR,[(ne(!0),ce(et,null,vs(n.konamiSequence,(o,a)=>(ne(),ce("div",{class:"key",key:a,style:Yt(`--i: ${a}`)},Le(o),5))),128))]),e[3]||(e[3]=b("div",{class:"konami-character"},"",-1))]),e[5]||(e[5]=b("div",{class:"konami-info"},[b("p",null,[b("span",{class:"highlight"},"Konami"),ss("")]),b("p",null,"1986"),b("p",{class:"easter-egg-hint"},"")],-1)),b("button",{class:"konami-button",onClick:e[0]||(e[0]=(...o)=>r.close&&r.close(...o))},Le(t.isUnlocked?"":""),1),b("button",{class:"close-button",onClick:e[1]||(e[1]=(...o)=>r.close&&r.close(...o))},e[4]||(e[4]=[b("i",{class:"fas fa-times"},null,-1)]))])])):yt("",!0)}const pR=bt(aR,[["render",mR],["__scopeId","data-v-760eb2e6"]]);const yR={name:"EasterEgg",components:{KonamiCode:pR},data(){return{showEasterEgg:!1,activeEasterEgg:null,gameScore:0,gameTime:10,gameTimer:null,gameEnded:!1,highScore:0,isNewHighScore:!1,clickSequences:{logo:{element:".logo-link",maxClicks:5,currentClicks:0,timeout:2e3,timer:null,easterEgg:"logo-game"}},keySequences:{konami:{sequence:["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"],current:0,easterEgg:"konami-code"}},scrollPosition:0}},mounted(){this.initClickListeners(),this.initKeyListeners(),this.loadHighScore()},beforeDestroy(){this.removeClickListeners(),this.removeKeyListeners(),this.gameTimer&&clearInterval(this.gameTimer),this.enableScroll()},methods:{isAchievementUnlocked(i){try{const e=JSON.parse(localStorage.getItem("wenturc-achievements")||"{}");return e[i]&&e[i].unlocked}catch(e){return console.error("",e),!1}},disableScroll(){this.scrollPosition=window.pageYOffset||document.documentElement.scrollTop,document.body.style.position="fixed",document.body.style.top=`-${this.scrollPosition}px`,document.body.style.width="100%",document.body.style.overflowY="hidden",document.body.classList.add("easter-egg-active")},enableScroll(){document.body.style.position="",document.body.style.top="",document.body.style.width="",document.body.style.overflowY="",window.scrollTo(0,this.scrollPosition),document.body.classList.remove("easter-egg-active")},initClickListeners(){Object.keys(this.clickSequences).forEach(i=>{const e=this.clickSequences[i];setTimeout(()=>{const t=document.querySelector(e.element);if(t){const s=this.handleElementClick.bind(this,i);t.addEventListener("click",s),e.handler=s}},1e3)})},removeClickListeners(){Object.keys(this.clickSequences).forEach(i=>{const e=this.clickSequences[i];if(e.handler){const t=document.querySelector(e.element);t&&t.removeEventListener("click",e.handler)}e.timer&&clearTimeout(e.timer)})},initKeyListeners(){document.addEventListener("keydown",this.handleKeyPress)},removeKeyListeners(){document.removeEventListener("keydown",this.handleKeyPress)},handleElementClick(i){const e=this.clickSequences[i];e.timer&&clearTimeout(e.timer),e.currentClicks++,e.timer=setTimeout(()=>{e.currentClicks=0},e.timeout),e.currentClicks>=e.maxClicks&&(this.triggerEasterEgg(e.easterEgg),e.currentClicks=0)},handleKeyPress(i){Object.keys(this.keySequences).forEach(e=>{const t=this.keySequences[e],s=t.sequence[t.current];i.key.toLowerCase()===s.toLowerCase()?(t.current++,t.current>=t.sequence.length&&(this.triggerEasterEgg(t.easterEgg),t.current=0)):t.current=0})},triggerEasterEgg(i){this.showEasterEgg=!0,this.activeEasterEgg=i,this.disableScroll(),i==="logo-game"&&(this.loadHighScore(),this.startGame()),this.isAchievementUnlocked(i)||this.unlockAchievement(i)},hideEasterEgg(){this.showEasterEgg=!1,this.activeEasterEgg=null,this.gameEnded=!1,this.enableScroll(),this.gameTimer&&(clearInterval(this.gameTimer),this.gameTimer=null)},startGame(){this.gameScore=0,this.gameTime=10,this.gameEnded=!1,this.isNewHighScore=!1,this.gameTimer=setInterval(()=>{this.gameTime--,this.gameTime<=0&&(clearInterval(this.gameTimer),this.gameTimer=null,this.endGame())},1e3)},endGame(){this.gameEnded=!0,this.saveHighScore()},incrementScore(){this.gameTimer&&!this.gameEnded&&this.gameScore++},loadHighScore(){const i=localStorage.getItem("wenturc-game-scores")||"{}";try{const e=JSON.parse(i);this.highScore=e["logo-game"]||0}catch{console.error(""),this.highScore=0}},saveHighScore(){const i=localStorage.getItem("wenturc-game-scores")||"{}";let e={};try{e=JSON.parse(i)}catch{console.error("")}this.gameScore>=20&&this.unlockAchievement("game-master"),(!e["logo-game"]||this.gameScore>e["logo-game"])&&(e["logo-game"]=this.gameScore,localStorage.setItem("wenturc-game-scores",JSON.stringify(e)),this.highScore=this.gameScore,this.isNewHighScore=!0)},unlockAchievement(i){const e=localStorage.getItem("wenturc-achievements")||"{}";let t={};try{t=JSON.parse(e)}catch{console.error("")}t[i]||(t[i]={unlocked:!0,timestamp:new Date().toISOString(),isNew:!0},localStorage.setItem("wenturc-achievements",JSON.stringify(t)),Ue.emit("achievement-unlocked",i),setTimeout(()=>{pn(()=>Promise.resolve().then(()=>q0),void 0,import.meta.url).then(s=>{s.default&&typeof s.default.checkAndUnlockImmediately=="function"&&s.default.checkAndUnlockImmediately()}).catch(s=>{console.error(":",s)})},300))}}},vR={key:0,class:"easter-egg-container"},TR={key:0,class:"mini-game"},_R={key:0,class:"game-content"},ER={class:"game-score"},SR={class:"game-timer"},xR={key:1,class:"game-results"},bR={class:"result-score"},AR={key:0,class:"high-score-info"},LR={key:1,class:"high-score-display"};function IR(i,e,t,s,n,r){const o=It("konami-code");return n.showEasterEgg?(ne(),ce("div",vR,[n.activeEasterEgg!=="konami-code"?(ne(),ce("div",{key:0,class:$e(["easter-egg-content",n.activeEasterEgg])},[n.activeEasterEgg==="logo-game"?(ne(),ce("div",TR,[e[10]||(e[10]=b("h3",null,"",-1)),n.gameEnded?(ne(),ce("div",xR,[e[8]||(e[8]=b("div",{class:"result-icon"},"",-1)),e[9]||(e[9]=b("h4",{class:"result-title"},"",-1)),b("div",bR,[e[4]||(e[4]=ss(": ")),b("span",null,Le(n.gameScore),1)]),n.isNewHighScore?(ne(),ce("div",AR,e[5]||(e[5]=[b("div",{class:"new-record-badge"},"!",-1),b("div",{class:"confetti"},"",-1)]))):(ne(),ce("div",LR,[e[6]||(e[6]=ss(" : ")),b("span",null,Le(n.highScore),1)])),b("button",{class:"restart-button",onClick:e[1]||(e[1]=(...a)=>r.startGame&&r.startGame(...a))},e[7]||(e[7]=[b("i",{class:"fas fa-redo"},null,-1),ss("  ")]))])):(ne(),ce("div",_R,[b("div",ER,": "+Le(n.gameScore),1),b("div",{class:"game-character",onClick:e[0]||(e[0]=(...a)=>r.incrementScore&&r.incrementScore(...a))},""),e[3]||(e[3]=b("div",{class:"game-instructions"},[ss(" "),b("br"),ss(" 10 ")],-1)),b("div",SR,": "+Le(n.gameTime)+"",1)]))])):yt("",!0),b("button",{class:"close-button",onClick:e[2]||(e[2]=(...a)=>r.hideEasterEgg&&r.hideEasterEgg(...a))},e[11]||(e[11]=[b("i",{class:"fas fa-times"},null,-1)]))],2)):yt("",!0),n.activeEasterEgg==="konami-code"?(ne(),Ro(o,{key:1,active:!0,isUnlocked:r.isAchievementUnlocked("konami-code"),onClose:r.hideEasterEgg},null,8,["isUnlocked","onClose"])):yt("",!0)])):yt("",!0)}const RR=bt(yR,[["render",IR],["__scopeId","data-v-c23ce8fb"]]),W0={"logo-game":{name:"",description:"Logo",icon:"fas fa-gamepad",secret:!1},"konami-code":{name:"",description:"Konami",icon:"fas fa-keyboard",secret:!1},"game-master":{name:"",description:"20",icon:"fas fa-trophy",secret:!1},"night-owl":{name:"",description:"(0-5)",icon:"fas fa-moon",secret:!0},"early-bird":{name:"",description:"(5-8)",icon:"fas fa-sun",secret:!0},"weekend-warrior":{name:"",description:"",icon:"fas fa-calendar",secret:!0},"theme-changer":{name:"",description:"",icon:"fas fa-paint-brush",secret:!1},"music-lover":{name:"",description:"",icon:"fas fa-music",secret:!1},"quote-collector":{name:"",description:"",icon:"fas fa-quote-right",secret:!1},"loyal-fan":{name:"",description:"5",icon:"fas fa-star",secret:!1},"scroll-champion":{name:"",description:"5000",icon:"fas fa-mouse",secret:!0},"click-addict":{name:"",description:"100",icon:"fas fa-hand-pointer",secret:!0},"easter-egg-hunter":{name:"",description:"",icon:"fas fa-egg",secret:!0},"quote-explorer":{name:"",description:"10",icon:"fas fa-lightbulb",secret:!1},"dev-tools-explorer":{name:"",description:"",icon:"fas fa-code",secret:!0},"four-seasons":{name:"",description:"",icon:"fas fa-leaf",secret:!1},"music-connoisseur":{name:"",description:"5",icon:"fas fa-headphones",secret:!1},"silent-browsing":{name:"",description:"10",icon:"fas fa-volume-mute",secret:!0},"new-year-joy":{name:"",description:"",icon:"fas fa-glass-cheers",secret:!0},"midnight-thinker":{name:"",description:"12",icon:"fas fa-moon",secret:!0},"achievement-hunter":{name:"",description:"10",icon:"fas fa-medal",secret:!1},"achievement-master":{name:"",description:"",icon:"fas fa-crown",secret:!1}};class kR{constructor(){this.prefix="wenturc-",this.achievementsKey=`${this.prefix}achievements`}loadAchievements(){const e=this.getObject(this.achievementsKey,{});return console.log(":",e),e}saveAchievements(e){console.log(":",e),this.setObject(this.achievementsKey,e)}saveAchievement(e,t){const s=this.loadAchievements();s[e]=t,this.saveAchievements(s)}setValue(e,t){localStorage.setItem(`${this.prefix}${e}`,String(t))}getValue(e,t=null){const s=localStorage.getItem(`${this.prefix}${e}`);return s!==null?s:t}getBoolean(e,t=!1){const s=localStorage.getItem(`${this.prefix}${e}`);return s===null?t:s==="true"}getNumber(e,t=0){try{const s=localStorage.getItem(`${this.prefix}${e}`);return s?parseInt(s,10):t}catch(s){return console.error(` ${e} :`,s),t}}setNumber(e,t){try{return localStorage.setItem(`${this.prefix}${e}`,t.toString()),!0}catch(s){return console.error(` ${e} :`,s),!1}}getObject(e,t={}){const s=localStorage.getItem(e);if(s===null)return t;try{return JSON.parse(s)}catch(n){return console.error(`: ${e}`,n),t}}setObject(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(s){console.error(`: ${e}`,s)}}getArray(e){try{const t=localStorage.getItem(`${this.prefix}${e}`);return t?JSON.parse(t):[]}catch(t){return console.error(` ${e} :`,t),[]}}setArray(e,t){try{return localStorage.setItem(`${this.prefix}${e}`,JSON.stringify(t)),!0}catch(s){return console.error(` ${e} :`,s),!1}}hasKey(e){return localStorage.getItem(`${this.prefix}${e}`)!==null}remove(e){localStorage.removeItem(`${this.prefix}${e}`)}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.prefix)).forEach(e=>localStorage.removeItem(e))}}class CR{constructor(){this.notification={show:!1,name:"",icon:"",timer:null},this.currentNotification=null}showNotification(e){this.clearTimer(),e&&(this.notification={show:!1,name:"",icon:"",timer:null},setTimeout(()=>{this.notification={show:!0,name:e.name||"",icon:e.icon||"fas fa-award",timer:null},this.currentNotification=ns.achievement("",e.name||"",{duration:4e3,muteSound:!0,achievementId:e.id||e.name,onClick:()=>{Ue.emit("open-achievements-panel")}}),this.notification.timer=setTimeout(()=>{this.hideNotification()},4e3)},0))}hideNotification(){this.notification={...this.notification,show:!1},this.currentNotification&&(this.currentNotification.close(),this.currentNotification=null)}clearTimer(){this.notification.timer&&(clearTimeout(this.notification.timer),this.notification.timer=null),this.currentNotification&&(this.currentNotification.close(),this.currentNotification=null)}cleanup(){this.clearTimer()}}class wR{constructor(){this.achievements=W0,this.storage=new kR,this.notifications=new CR,this.userAchievements={},this.hasNewAchievements=!1,this.trackers=[],this.eventHandlers={},this.recentlyUnlocked=new Set}async initialize(){this.userAchievements=this.storage.loadAchievements(),this.hasNewAchievements=this.checkForNewAchievements(),await this._initTrackers(),this.setupEventListeners()}async _initTrackers(){var e;try{const[{default:t},{default:s},{default:n},{default:r}]=await Promise.all([pn(()=>import("./ActivityTracker-69565302.js"),[],import.meta.url),pn(()=>import("./TimeTracker-7c51d308.js"),[],import.meta.url),pn(()=>import("./VisitTracker-baf3ba6b.js"),[],import.meta.url),pn(()=>import("./EasterEggManager-ae6ee0c5.js"),[],import.meta.url)]);this.trackers=[new t(this),new s(this),new n(this),new r(this)];for(const o of this.trackers)await((e=o.initialize)==null?void 0:e.call(o))}catch(t){console.error(":",t)}}setupEventListeners(){this.eventHandlers={"achievement-unlocked":this.handleAchievementUnlock.bind(this),"theme-changed":()=>this.unlockAchievement("theme-changer"),"music-played":()=>this.unlockAchievement("music-lover"),"quote-favorited":()=>this.unlockAchievement("quote-collector")},Object.entries(this.eventHandlers).forEach(([e,t])=>{Ue.on(e,t)})}cleanup(){var e;Object.entries(this.eventHandlers).forEach(([t,s])=>{Ue.off(t,s)});for(const t of this.trackers)(e=t.cleanup)==null||e.call(t);this.trackers=[],this.notifications.cleanup()}checkForNewAchievements(){return Object.values(this.userAchievements).some(e=>e.isNew)}unlockAchievement(e){if(this.recentlyUnlocked&&this.recentlyUnlocked.has(e))return!1;if(this.recentlyUnlocked||(this.recentlyUnlocked=new Set),this.recentlyUnlocked.add(e),setTimeout(()=>{this.recentlyUnlocked&&this.recentlyUnlocked.delete(e)},5e3),!this.achievements[e])return console.error(`ID: ${e}`),!1;if(this.isAchievementUnlocked(e))return!1;const t={unlocked:!0,timestamp:new Date().toISOString(),isNew:!0};this.userAchievements={...this.userAchievements,[e]:t},this.storage.saveAchievements(this.userAchievements),this.hasNewAchievements=!0;const s=this.achievements[e];return s&&(Ue.emit("show-achievement-notification",{...s,id:e}),this.notifications.showNotification({...s,id:e})),Ue.emit("achievements-updated",this.unlockedCount),this.checkAchievementHunter(),!0}checkAchievementHunter(){setTimeout(()=>{pn(()=>Promise.resolve().then(()=>q0),void 0,import.meta.url).then(e=>{e.default&&typeof e.default.checkAndUnlockImmediately=="function"&&e.default.checkAndUnlockImmediately()}).catch(e=>{console.error(":",e)})},300)}handleAchievementUnlock(e){this.unlockAchievement(e)}acknowledgeAchievement(e){if(this.isAchievementNew(e)){const t={...this.userAchievements[e],isNew:!1};this.userAchievements={...this.userAchievements,[e]:t},this.storage.saveAchievements(this.userAchievements),this.hasNewAchievements=this.checkForNewAchievements()}}onPanelOpen(){const e={...this.userAchievements};let t=!1;Object.keys(e).forEach(s=>{var n;(n=e[s])!=null&&n.isNew&&(e[s].isNew=!1,t=!0)}),t&&(this.userAchievements=e,this.storage.saveAchievements(this.userAchievements),this.hasNewAchievements=!1)}isAchievementUnlocked(e){var t;return((t=this.userAchievements[e])==null?void 0:t.unlocked)||!1}isAchievementNew(e){var t;return((t=this.userAchievements[e])==null?void 0:t.isNew)||!1}isSecretAchievement(e){var t;return((t=this.achievements[e])==null?void 0:t.secret)&&!this.isAchievementUnlocked(e)}getAchievementIcon(e){var t;return this.isSecretAchievement(e)?"fas fa-question":(t=this.achievements[e])==null?void 0:t.icon}getAchievementName(e){var t;return this.isSecretAchievement(e)?"???":(t=this.achievements[e])==null?void 0:t.name}getAchievementDescription(e){var t;return this.isSecretAchievement(e)?"":(t=this.achievements[e])==null?void 0:t.description}formatDate(e){var s;const t=(s=this.userAchievements[e])==null?void 0:s.timestamp;if(!t)return"";try{return new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(n){return console.error(":",n),t}}get unlockedCount(){return Object.keys(this.userAchievements).filter(e=>{var t;return(t=this.userAchievements[e])==null?void 0:t.unlocked}).length}get totalAchievements(){return Object.keys(this.achievements).length}get unlockedPercentage(){return this.totalAchievements===0?0:Math.round(this.unlockedCount/this.totalAchievements*100)}get notification(){return{...this.notifications.notification}}resetAllAchievements(){return this.userAchievements={},this.storage.saveAchievements({}),this.hasNewAchievements=!1,!0}}const DR=new wR;const PR={class:"achievement-count"},OR={class:"panel-stats"},MR={class:"stats-item"},FR={class:"stats-value"},NR={class:"stats-item"},$R={class:"stats-value"},UR={class:"stats-item"},BR={class:"stats-value"},GR={class:"panel-content"},HR=["onClick"],VR={class:"achievement-icon"},KR={class:"achievement-info"},zR={class:"achievement-name"},WR={class:"achievement-description"},qR={key:0,class:"achievement-date"},YR={class:"achievement-status"},jR={__name:"Achievements",setup(i){const e=ra(!1),t=DR,s="achievements-component-"+Date.now(),n=ra(0),r=ra(!1),o=zt(()=>n.value),a=zt(()=>t.totalAchievements),l=zt(()=>t.unlockedPercentage),c=zt(()=>r.value);function u(S){return t.isAchievementUnlocked(S)}function h(S){return t.isAchievementNew(S)}function f(S){return t.isSecretAchievement(S)}function d(S){return t.getAchievementIcon(S)}function g(S){return t.getAchievementName(S)}function m(S){return t.getAchievementDescription(S)}function p(S){return t.formatDate(S)}function y(S){t.acknowledgeAchievement(S)}Gu(()=>{_(),Ue.register(s,"achievements-updated",S=>{n.value=S,_()}),Ue.register(s,"notification:shown",S=>{S.type}),t.initialize().then(()=>{_()})}),Hu(()=>{Ue.unregisterComponent(s),t.cleanup()});function _(){n.value=t.unlockedCount,r.value=t.hasNewAchievements}function T(){e.value=!e.value,e.value&&(t.onPanelOpen(),_())}function E(){e.value=!1,_()}return Vr(()=>t.unlockedCount,S=>{n.value=S}),(S,R)=>(ne(),ce("div",null,[b("button",{class:$e(["achievements-button",{"has-new":c.value}]),onClick:T},[R[1]||(R[1]=b("i",{class:"fas fa-trophy"},null,-1)),b("span",PR,Le(o.value),1)],2),Oe(wa,{name:"panel"},{default:kn(()=>[e.value?(ne(),ce("div",{key:0,class:"achievements-overlay",onClick:E},[b("div",{class:"achievements-panel",onClick:R[0]||(R[0]=vn(()=>{},["stop"]))},[b("div",{class:"panel-header"},[R[3]||(R[3]=b("h2",null,[b("i",{class:"fas fa-trophy"}),ss("  ")],-1)),b("button",{class:"close-button",onClick:E},R[2]||(R[2]=[b("i",{class:"fas fa-times"},null,-1)]))]),b("div",OR,[b("div",MR,[b("span",FR,Le(o.value),1),R[4]||(R[4]=b("span",{class:"stats-label"},"",-1))]),b("div",NR,[b("span",$R,Le(a.value),1),R[5]||(R[5]=b("span",{class:"stats-label"},"",-1))]),b("div",UR,[b("span",BR,Le(l.value)+"%",1),R[6]||(R[6]=b("span",{class:"stats-label"},"",-1))])]),b("div",GR,[Oe(j_,{name:"achievement-list",tag:"div",class:"achievement-items-container"},{default:kn(()=>[(ne(!0),ce(et,null,vs(En(t).achievements,(x,L)=>(ne(),ce("div",{key:L,class:$e(["achievement-item",{unlocked:u(L),new:h(L),secret:f(L)}]),onClick:A=>y(L)},[b("div",VR,[b("i",{class:$e(d(L))},null,2)]),b("div",KR,[b("h3",zR,Le(g(L)),1),b("p",WR,Le(m(L)),1),u(L)?(ne(),ce("p",qR,Le(p(L)),1)):yt("",!0)]),b("div",YR,[b("i",{class:$e(u(L)?"fas fa-check-circle":"fas fa-lock")},null,2)])],10,HR))),128))]),_:1})]),R[7]||(R[7]=b("div",{class:"panel-footer"},[b("p",{class:"secret-hint"},"")],-1))])])):yt("",!0)]),_:1})]))}},XR=bt(jR,[["__scopeId","data-v-3cd91a4b"]]);const QR={name:"BackToTop",data(){return{showBackToTop:!1,scrollThreshold:300,navbarHeight:0}},methods:{handleScroll(){const i=window.pageYOffset||document.documentElement.scrollTop;this.showBackToTop=i>this.scrollThreshold},scrollToTop(){const i=this.navbarHeight;"scrollBehavior"in document.documentElement.style?window.scrollTo({top:i,behavior:"smooth"}):this.smoothScrollTo(i)},smoothScrollTo(i){const e=window.pageYOffset,t=i-e,s=600;let n=null;const r=o=>{n===null&&(n=o);const a=o-n,l=Math.min(a/s,1),c=this.easeInOutCubic(l);window.scrollTo(0,e+t*c),a<s&&requestAnimationFrame(r)};requestAnimationFrame(r)},easeInOutCubic(i){return i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1}},mounted(){window.addEventListener("scroll",this.handleScroll),this.handleScroll()},beforeDestroy(){window.removeEventListener("scroll",this.handleScroll)}};function JR(i,e,t,s,n,r){return ne(),Ro(wa,{name:"back-to-top-fade"},{default:kn(()=>[n.showBackToTop?(ne(),ce("div",{key:0,class:"back-to-top-btn",onClick:e[0]||(e[0]=(...o)=>r.scrollToTop&&r.scrollToTop(...o)),title:""},e[1]||(e[1]=[b("i",{class:"fas fa-chevron-up"},null,-1)]))):yt("",!0)]),_:1})}const ZR=bt(QR,[["render",JR],["__scopeId","data-v-6779bab3"]]);class ek{constructor(){this.initialized=!1,this.achievementUnlocked=!1}initialize(){this.initialized||(this.initialized=!0,this.loadState(),this.achievementUnlocked||this.checkNewYear())}loadState(){const e=localStorage.getItem("wenturc-achievements");if(e)try{const t=JSON.parse(e);t["new-year-joy"]&&t["new-year-joy"].unlocked&&(this.achievementUnlocked=!0)}catch(t){console.error("",t)}}checkNewYear(){const e=new Date;e.getMonth()===0&&e.getDate()===1&&this.unlockAchievement()}forceUnlock(){this.unlockAchievement()}unlockAchievement(){this.achievementUnlocked||(this.achievementUnlocked=!0,Ue.emit("achievement-unlocked","new-year-joy"))}cleanup(){this.initialized=!1}}const tk=new ek;class sk{constructor(){this.initialized=!1,this.achievementUnlocked=!1,this.midnightCheckInterval=null}initialize(){this.initialized||(this.initialized=!0,this.loadState(),this.achievementUnlocked||(this.checkMidnight(),this.midnightCheckInterval=setInterval(()=>{this.checkMidnight()},3e4)))}loadState(){const e=localStorage.getItem("wenturc-achievements");if(e)try{const t=JSON.parse(e);t["midnight-thinker"]&&t["midnight-thinker"].unlocked&&(this.achievementUnlocked=!0)}catch(t){console.error("",t)}}checkMidnight(){if(this.achievementUnlocked)return;const e=new Date,t=e.getHours(),s=e.getMinutes();t===0&&s>=0&&s<=5&&this.unlockAchievement()}forceUnlock(){this.unlockAchievement()}unlockAchievement(){this.achievementUnlocked||(this.achievementUnlocked=!0,Ue.emit("achievement-unlocked","midnight-thinker"),this.midnightCheckInterval&&(clearInterval(this.midnightCheckInterval),this.midnightCheckInterval=null))}cleanup(){this.midnightCheckInterval&&(clearInterval(this.midnightCheckInterval),this.midnightCheckInterval=null),this.initialized=!1}}const sg=new sk;class ik{constructor(){this.initialized=!1,this.achievementUnlocked=!1,this.unlockedCount=0,this.targetCount=10,this.eventHandler=null,this.pendingCheck=!1}initialize(){this.initialized||(this.initialized=!0,this.loadAchievementsState(),this.unlockedCount>=this.targetCount&&!this.achievementUnlocked&&this.unlockAchievement(),this.eventHandler=e=>{e!=="achievement-hunter"&&this.scheduleCheck()},Ue.on("achievement-unlocked",this.eventHandler),setTimeout(()=>{this.loadAchievementsState(),this.unlockedCount>=this.targetCount&&!this.achievementUnlocked&&this.unlockAchievement()},1e3))}loadAchievementsState(){try{const e=localStorage.getItem("wenturc-achievements");if(e){const t=JSON.parse(e);this.unlockedCount=0;for(const s in t)s!=="achievement-hunter"&&t[s]&&t[s].unlocked===!0&&this.unlockedCount++;this.achievementUnlocked=t["achievement-hunter"]&&t["achievement-hunter"].unlocked===!0}}catch(e){console.error("",e),this.unlockedCount=0,this.achievementUnlocked=!1}}scheduleCheck(){this.pendingCheck||(this.pendingCheck=!0,setTimeout(()=>{this.pendingCheck=!1,this.onAchievementUnlocked()},500))}onAchievementUnlocked(){this.loadAchievementsState(),this.unlockedCount>=this.targetCount&&!this.achievementUnlocked&&this.unlockAchievement()}forceUnlock(){this.unlockAchievement()}unlockAchievement(){this.achievementUnlocked||(this.achievementUnlocked=!0,Ue.emit("achievement-unlocked","achievement-hunter"))}checkAndUnlockImmediately(){return this.loadAchievementsState(),this.unlockedCount>=this.targetCount&&!this.achievementUnlocked?(this.unlockAchievement(),!0):!1}cleanup(){this.eventHandler&&(Ue.off("achievement-unlocked",this.eventHandler),this.eventHandler=null),this.initialized=!1}}const va=new ik,q0=Object.freeze(Object.defineProperty({__proto__:null,default:va},Symbol.toStringTag,{value:"Module"}));class nk{constructor(){this.initialized=!1,this.achievementUnlocked=!1,this.totalAchievements=0,this.eventHandler=null,this.pendingCheck=!1,this.countTotalAchievements()}countTotalAchievements(){this.totalAchievements=Object.keys(W0).filter(e=>e!=="achievement-master").length}initialize(){this.initialized||(this.initialized=!0,this.loadAchievementsState(),this.unlockedCount>=this.totalAchievements&&!this.achievementUnlocked&&this.unlockAchievement(),this.eventHandler=e=>{e!=="achievement-master"&&this.scheduleCheck()},Ue.on("achievement-unlocked",this.eventHandler),setTimeout(()=>{this.loadAchievementsState(),this.unlockedCount>=this.totalAchievements&&!this.achievementUnlocked&&this.unlockAchievement()},1500))}loadAchievementsState(){try{const e=localStorage.getItem("wenturc-achievements");if(e){const t=JSON.parse(e);this.unlockedCount=Object.entries(t).filter(([s,n])=>s!=="achievement-master"&&n&&n.unlocked===!0).length,this.achievementUnlocked=t["achievement-master"]&&t["achievement-master"].unlocked===!0}}catch(e){console.error("[] ",e),this.unlockedCount=0,this.achievementUnlocked=!1}}scheduleCheck(){this.pendingCheck||(this.pendingCheck=!0,setTimeout(()=>{this.pendingCheck=!1,this.onAchievementUnlocked()},500))}onAchievementUnlocked(){this.loadAchievementsState(),this.unlockedCount>=this.totalAchievements&&!this.achievementUnlocked&&this.unlockAchievement()}forceUnlock(){this.unlockAchievement()}unlockAchievement(){this.achievementUnlocked||(this.achievementUnlocked=!0,Ue.emit("achievement-unlocked","achievement-master"))}checkAndUnlockImmediately(){return this.loadAchievementsState(),this.unlockedCount>=this.totalAchievements&&!this.achievementUnlocked?(this.unlockAchievement(),!0):!1}cleanup(){this.eventHandler&&(Ue.off("achievement-unlocked",this.eventHandler),this.eventHandler=null),this.initialized=!1}}const cc=new nk;/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const zn=typeof document<"u";function Y0(i){return typeof i=="object"||"displayName"in i||"props"in i||"__vccOpts"in i}function rk(i){return i.__esModule||i[Symbol.toStringTag]==="Module"||i.default&&Y0(i.default)}const Be=Object.assign;function uc(i,e){const t={};for(const s in e){const n=e[s];t[s]=Hs(n)?n.map(i):i(n)}return t}const Xr=()=>{},Hs=Array.isArray,j0=/#/g,ok=/&/g,ak=/\//g,lk=/=/g,ck=/\?/g,X0=/\+/g,uk=/%5B/g,hk=/%5D/g,Q0=/%5E/g,fk=/%60/g,J0=/%7B/g,dk=/%7C/g,Z0=/%7D/g,gk=/%20/g;function yh(i){return encodeURI(""+i).replace(dk,"|").replace(uk,"[").replace(hk,"]")}function mk(i){return yh(i).replace(J0,"{").replace(Z0,"}").replace(Q0,"^")}function ou(i){return yh(i).replace(X0,"%2B").replace(gk,"+").replace(j0,"%23").replace(ok,"%26").replace(fk,"`").replace(J0,"{").replace(Z0,"}").replace(Q0,"^")}function pk(i){return ou(i).replace(lk,"%3D")}function yk(i){return yh(i).replace(j0,"%23").replace(ck,"%3F")}function vk(i){return i==null?"":yk(i).replace(ak,"%2F")}function yo(i){try{return decodeURIComponent(""+i)}catch{}return""+i}const Tk=/\/$/,_k=i=>i.replace(Tk,"");function hc(i,e,t="/"){let s,n={},r="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(s=e.slice(0,l),r=e.slice(l+1,a>-1?a:e.length),n=i(r)),a>-1&&(s=s||e.slice(0,a),o=e.slice(a,e.length)),s=bk(s??e,t),{fullPath:s+(r&&"?")+r+o,path:s,query:n,hash:yo(o)}}function Ek(i,e){const t=e.query?i(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function ig(i,e){return!e||!i.toLowerCase().startsWith(e.toLowerCase())?i:i.slice(e.length)||"/"}function Sk(i,e,t){const s=e.matched.length-1,n=t.matched.length-1;return s>-1&&s===n&&hr(e.matched[s],t.matched[n])&&ey(e.params,t.params)&&i(e.query)===i(t.query)&&e.hash===t.hash}function hr(i,e){return(i.aliasOf||i)===(e.aliasOf||e)}function ey(i,e){if(Object.keys(i).length!==Object.keys(e).length)return!1;for(const t in i)if(!xk(i[t],e[t]))return!1;return!0}function xk(i,e){return Hs(i)?ng(i,e):Hs(e)?ng(e,i):i===e}function ng(i,e){return Hs(e)?i.length===e.length&&i.every((t,s)=>t===e[s]):i.length===1&&i[0]===e}function bk(i,e){if(i.startsWith("/"))return i;if(!i)return e;const t=e.split("/"),s=i.split("/"),n=s[s.length-1];(n===".."||n===".")&&s.push("");let r=t.length-1,o,a;for(o=0;o<s.length;o++)if(a=s[o],a!==".")if(a==="..")r>1&&r--;else break;return t.slice(0,r).join("/")+"/"+s.slice(o).join("/")}const Pi={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var vo;(function(i){i.pop="pop",i.push="push"})(vo||(vo={}));var Qr;(function(i){i.back="back",i.forward="forward",i.unknown=""})(Qr||(Qr={}));function Ak(i){if(!i)if(zn){const e=document.querySelector("base");i=e&&e.getAttribute("href")||"/",i=i.replace(/^\w+:\/\/[^\/]+/,"")}else i="/";return i[0]!=="/"&&i[0]!=="#"&&(i="/"+i),_k(i)}const Lk=/^[^#]+#/;function Ik(i,e){return i.replace(Lk,"#")+e}function Rk(i,e){const t=document.documentElement.getBoundingClientRect(),s=i.getBoundingClientRect();return{behavior:e.behavior,left:s.left-t.left-(e.left||0),top:s.top-t.top-(e.top||0)}}const vl=()=>({left:window.scrollX,top:window.scrollY});function kk(i){let e;if("el"in i){const t=i.el,s=typeof t=="string"&&t.startsWith("#"),n=typeof t=="string"?s?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!n)return;e=Rk(n,i)}else e=i;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function rg(i,e){return(history.state?history.state.position-e:-1)+i}const au=new Map;function Ck(i,e){au.set(i,e)}function wk(i){const e=au.get(i);return au.delete(i),e}let Dk=()=>location.protocol+"//"+location.host;function ty(i,e){const{pathname:t,search:s,hash:n}=e,r=i.indexOf("#");if(r>-1){let a=n.includes(i.slice(r))?i.slice(r).length:1,l=n.slice(a);return l[0]!=="/"&&(l="/"+l),ig(l,"")}return ig(t,i)+s+n}function Pk(i,e,t,s){let n=[],r=[],o=null;const a=({state:f})=>{const d=ty(i,location),g=t.value,m=e.value;let p=0;if(f){if(t.value=d,e.value=f,o&&o===g){o=null;return}p=m?f.position-m.position:0}else s(d);n.forEach(y=>{y(t.value,g,{delta:p,type:vo.pop,direction:p?p>0?Qr.forward:Qr.back:Qr.unknown})})};function l(){o=t.value}function c(f){n.push(f);const d=()=>{const g=n.indexOf(f);g>-1&&n.splice(g,1)};return r.push(d),d}function u(){const{history:f}=window;f.state&&f.replaceState(Be({},f.state,{scroll:vl()}),"")}function h(){for(const f of r)f();r=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",u)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",u,{passive:!0}),{pauseListeners:l,listen:c,destroy:h}}function og(i,e,t,s=!1,n=!1){return{back:i,current:e,forward:t,replaced:s,position:window.history.length,scroll:n?vl():null}}function Ok(i){const{history:e,location:t}=window,s={value:ty(i,t)},n={value:e.state};n.value||r(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function r(l,c,u){const h=i.indexOf("#"),f=h>-1?(t.host&&document.querySelector("base")?i:i.slice(h))+l:Dk()+i+l;try{e[u?"replaceState":"pushState"](c,"",f),n.value=c}catch(d){console.error(d),t[u?"replace":"assign"](f)}}function o(l,c){const u=Be({},e.state,og(n.value.back,l,n.value.forward,!0),c,{position:n.value.position});r(l,u,!0),s.value=l}function a(l,c){const u=Be({},n.value,e.state,{forward:l,scroll:vl()});r(u.current,u,!0);const h=Be({},og(s.value,l,null),{position:u.position+1},c);r(l,h,!1),s.value=l}return{location:s,state:n,push:a,replace:o}}function Mk(i){i=Ak(i);const e=Ok(i),t=Pk(i,e.state,e.location,e.replace);function s(r,o=!0){o||t.pauseListeners(),history.go(r)}const n=Be({location:"",base:i,go:s,createHref:Ik.bind(null,i)},e,t);return Object.defineProperty(n,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(n,"state",{enumerable:!0,get:()=>e.state.value}),n}function Fk(i){return i=location.host?i||location.pathname+location.search:"",i.includes("#")||(i+="#"),Mk(i)}function Nk(i){return typeof i=="string"||i&&typeof i=="object"}function sy(i){return typeof i=="string"||typeof i=="symbol"}const iy=Symbol("");var ag;(function(i){i[i.aborted=4]="aborted",i[i.cancelled=8]="cancelled",i[i.duplicated=16]="duplicated"})(ag||(ag={}));function fr(i,e){return Be(new Error,{type:i,[iy]:!0},e)}function pi(i,e){return i instanceof Error&&iy in i&&(e==null||!!(i.type&e))}const lg="[^/]+?",$k={sensitive:!1,strict:!1,start:!0,end:!0},Uk=/[.+*?^${}()[\]/\\]/g;function Bk(i,e){const t=Be({},$k,e),s=[];let n=t.start?"^":"";const r=[];for(const c of i){const u=c.length?[]:[90];t.strict&&!c.length&&(n+="/");for(let h=0;h<c.length;h++){const f=c[h];let d=40+(t.sensitive?.25:0);if(f.type===0)h||(n+="/"),n+=f.value.replace(Uk,"\\$&"),d+=40;else if(f.type===1){const{value:g,repeatable:m,optional:p,regexp:y}=f;r.push({name:g,repeatable:m,optional:p});const _=y||lg;if(_!==lg){d+=10;try{new RegExp(`(${_})`)}catch(E){throw new Error(`Invalid custom RegExp for param "${g}" (${_}): `+E.message)}}let T=m?`((?:${_})(?:/(?:${_}))*)`:`(${_})`;h||(T=p&&c.length<2?`(?:/${T})`:"/"+T),p&&(T+="?"),n+=T,d+=20,p&&(d+=-8),m&&(d+=-20),_===".*"&&(d+=-50)}u.push(d)}s.push(u)}if(t.strict&&t.end){const c=s.length-1;s[c][s[c].length-1]+=.7000000000000001}t.strict||(n+="/?"),t.end?n+="$":t.strict&&!n.endsWith("/")&&(n+="(?:/|$)");const o=new RegExp(n,t.sensitive?"":"i");function a(c){const u=c.match(o),h={};if(!u)return null;for(let f=1;f<u.length;f++){const d=u[f]||"",g=r[f-1];h[g.name]=d&&g.repeatable?d.split("/"):d}return h}function l(c){let u="",h=!1;for(const f of i){(!h||!u.endsWith("/"))&&(u+="/"),h=!1;for(const d of f)if(d.type===0)u+=d.value;else if(d.type===1){const{value:g,repeatable:m,optional:p}=d,y=g in c?c[g]:"";if(Hs(y)&&!m)throw new Error(`Provided param "${g}" is an array but it is not repeatable (* or + modifiers)`);const _=Hs(y)?y.join("/"):y;if(!_)if(p)f.length<2&&(u.endsWith("/")?u=u.slice(0,-1):h=!0);else throw new Error(`Missing required param "${g}"`);u+=_}}return u||"/"}return{re:o,score:s,keys:r,parse:a,stringify:l}}function Gk(i,e){let t=0;for(;t<i.length&&t<e.length;){const s=e[t]-i[t];if(s)return s;t++}return i.length<e.length?i.length===1&&i[0]===40+40?-1:1:i.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function ny(i,e){let t=0;const s=i.score,n=e.score;for(;t<s.length&&t<n.length;){const r=Gk(s[t],n[t]);if(r)return r;t++}if(Math.abs(n.length-s.length)===1){if(cg(s))return 1;if(cg(n))return-1}return n.length-s.length}function cg(i){const e=i[i.length-1];return i.length>0&&e[e.length-1]<0}const Hk={type:0,value:""},Vk=/[a-zA-Z0-9_]/;function Kk(i){if(!i)return[[]];if(i==="/")return[[Hk]];if(!i.startsWith("/"))throw new Error(`Invalid path "${i}"`);function e(d){throw new Error(`ERR (${t})/"${c}": ${d}`)}let t=0,s=t;const n=[];let r;function o(){r&&n.push(r),r=[]}let a=0,l,c="",u="";function h(){c&&(t===0?r.push({type:0,value:c}):t===1||t===2||t===3?(r.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:c,regexp:u,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function f(){c+=l}for(;a<i.length;){if(l=i[a++],l==="\\"&&t!==2){s=t,t=4;continue}switch(t){case 0:l==="/"?(c&&h(),o()):l===":"?(h(),t=1):f();break;case 4:f(),t=s;break;case 1:l==="("?t=2:Vk.test(l)?f():(h(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?u[u.length-1]=="\\"?u=u.slice(0,-1)+l:t=3:u+=l;break;case 3:h(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,u="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),h(),o(),n}function zk(i,e,t){const s=Bk(Kk(i.path),t),n=Be(s,{record:i,parent:e,children:[],alias:[]});return e&&!n.record.aliasOf==!e.record.aliasOf&&e.children.push(n),n}function Wk(i,e){const t=[],s=new Map;e=dg({strict:!1,end:!0,sensitive:!1},e);function n(h){return s.get(h)}function r(h,f,d){const g=!d,m=hg(h);m.aliasOf=d&&d.record;const p=dg(e,h),y=[m];if("alias"in h){const E=typeof h.alias=="string"?[h.alias]:h.alias;for(const S of E)y.push(hg(Be({},m,{components:d?d.record.components:m.components,path:S,aliasOf:d?d.record:m})))}let _,T;for(const E of y){const{path:S}=E;if(f&&S[0]!=="/"){const R=f.record.path,x=R[R.length-1]==="/"?"":"/";E.path=f.record.path+(S&&x+S)}if(_=zk(E,f,p),d?d.alias.push(_):(T=T||_,T!==_&&T.alias.push(_),g&&h.name&&!fg(_)&&o(h.name)),ry(_)&&l(_),m.children){const R=m.children;for(let x=0;x<R.length;x++)r(R[x],_,d&&d.children[x])}d=d||_}return T?()=>{o(T)}:Xr}function o(h){if(sy(h)){const f=s.get(h);f&&(s.delete(h),t.splice(t.indexOf(f),1),f.children.forEach(o),f.alias.forEach(o))}else{const f=t.indexOf(h);f>-1&&(t.splice(f,1),h.record.name&&s.delete(h.record.name),h.children.forEach(o),h.alias.forEach(o))}}function a(){return t}function l(h){const f=jk(h,t);t.splice(f,0,h),h.record.name&&!fg(h)&&s.set(h.record.name,h)}function c(h,f){let d,g={},m,p;if("name"in h&&h.name){if(d=s.get(h.name),!d)throw fr(1,{location:h});p=d.record.name,g=Be(ug(f.params,d.keys.filter(T=>!T.optional).concat(d.parent?d.parent.keys.filter(T=>T.optional):[]).map(T=>T.name)),h.params&&ug(h.params,d.keys.map(T=>T.name))),m=d.stringify(g)}else if(h.path!=null)m=h.path,d=t.find(T=>T.re.test(m)),d&&(g=d.parse(m),p=d.record.name);else{if(d=f.name?s.get(f.name):t.find(T=>T.re.test(f.path)),!d)throw fr(1,{location:h,currentLocation:f});p=d.record.name,g=Be({},f.params,h.params),m=d.stringify(g)}const y=[];let _=d;for(;_;)y.unshift(_.record),_=_.parent;return{name:p,path:m,params:g,matched:y,meta:Yk(y)}}i.forEach(h=>r(h));function u(){t.length=0,s.clear()}return{addRoute:r,resolve:c,removeRoute:o,clearRoutes:u,getRoutes:a,getRecordMatcher:n}}function ug(i,e){const t={};for(const s of e)s in i&&(t[s]=i[s]);return t}function hg(i){const e={path:i.path,redirect:i.redirect,name:i.name,meta:i.meta||{},aliasOf:i.aliasOf,beforeEnter:i.beforeEnter,props:qk(i),children:i.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in i?i.components||null:i.component&&{default:i.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function qk(i){const e={},t=i.props||!1;if("component"in i)e.default=t;else for(const s in i.components)e[s]=typeof t=="object"?t[s]:t;return e}function fg(i){for(;i;){if(i.record.aliasOf)return!0;i=i.parent}return!1}function Yk(i){return i.reduce((e,t)=>Be(e,t.meta),{})}function dg(i,e){const t={};for(const s in i)t[s]=s in e?e[s]:i[s];return t}function jk(i,e){let t=0,s=e.length;for(;t!==s;){const r=t+s>>1;ny(i,e[r])<0?s=r:t=r+1}const n=Xk(i);return n&&(s=e.lastIndexOf(n,s-1)),s}function Xk(i){let e=i;for(;e=e.parent;)if(ry(e)&&ny(i,e)===0)return e}function ry({record:i}){return!!(i.name||i.components&&Object.keys(i.components).length||i.redirect)}function Qk(i){const e={};if(i===""||i==="?")return e;const s=(i[0]==="?"?i.slice(1):i).split("&");for(let n=0;n<s.length;++n){const r=s[n].replace(X0," "),o=r.indexOf("="),a=yo(o<0?r:r.slice(0,o)),l=o<0?null:yo(r.slice(o+1));if(a in e){let c=e[a];Hs(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function gg(i){let e="";for(let t in i){const s=i[t];if(t=pk(t),s==null){s!==void 0&&(e+=(e.length?"&":"")+t);continue}(Hs(s)?s.map(r=>r&&ou(r)):[s&&ou(s)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}function Jk(i){const e={};for(const t in i){const s=i[t];s!==void 0&&(e[t]=Hs(s)?s.map(n=>n==null?null:""+n):s==null?s:""+s)}return e}const Zk=Symbol(""),mg=Symbol(""),vh=Symbol(""),oy=Symbol(""),lu=Symbol("");function br(){let i=[];function e(s){return i.push(s),()=>{const n=i.indexOf(s);n>-1&&i.splice(n,1)}}function t(){i=[]}return{add:e,list:()=>i.slice(),reset:t}}function Bi(i,e,t,s,n,r=o=>o()){const o=s&&(s.enterCallbacks[n]=s.enterCallbacks[n]||[]);return()=>new Promise((a,l)=>{const c=f=>{f===!1?l(fr(4,{from:t,to:e})):f instanceof Error?l(f):Nk(f)?l(fr(2,{from:e,to:f})):(o&&s.enterCallbacks[n]===o&&typeof f=="function"&&o.push(f),a())},u=r(()=>i.call(s&&s.instances[n],e,t,c));let h=Promise.resolve(u);i.length<3&&(h=h.then(c)),h.catch(f=>l(f))})}function fc(i,e,t,s,n=r=>r()){const r=[];for(const o of i)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(Y0(l)){const u=(l.__vccOpts||l)[e];u&&r.push(Bi(u,t,s,o,a,n))}else{let c=l();r.push(()=>c.then(u=>{if(!u)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const h=rk(u)?u.default:u;o.mods[a]=u,o.components[a]=h;const d=(h.__vccOpts||h)[e];return d&&Bi(d,t,s,o,a,n)()}))}}return r}function pg(i){const e=Ai(vh),t=Ai(oy),s=zt(()=>{const l=En(i.to);return e.resolve(l)}),n=zt(()=>{const{matched:l}=s.value,{length:c}=l,u=l[c-1],h=t.matched;if(!u||!h.length)return-1;const f=h.findIndex(hr.bind(null,u));if(f>-1)return f;const d=yg(l[c-2]);return c>1&&yg(u)===d&&h[h.length-1].path!==d?h.findIndex(hr.bind(null,l[c-2])):f}),r=zt(()=>n.value>-1&&n1(t.params,s.value.params)),o=zt(()=>n.value>-1&&n.value===t.matched.length-1&&ey(t.params,s.value.params));function a(l={}){if(i1(l)){const c=e[En(i.replace)?"replace":"push"](En(i.to)).catch(Xr);return i.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:s,href:zt(()=>s.value.href),isActive:r,isExactActive:o,navigate:a}}function e1(i){return i.length===1?i[0]:i}const t1=Nm({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:pg,setup(i,{slots:e}){const t=al(pg(i)),{options:s}=Ai(vh),n=zt(()=>({[vg(i.activeClass,s.linkActiveClass,"router-link-active")]:t.isActive,[vg(i.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const r=e.default&&e1(e.default(t));return i.custom?r:Wu("a",{"aria-current":t.isExactActive?i.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:n.value},r)}}}),s1=t1;function i1(i){if(!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)&&!i.defaultPrevented&&!(i.button!==void 0&&i.button!==0)){if(i.currentTarget&&i.currentTarget.getAttribute){const e=i.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return i.preventDefault&&i.preventDefault(),!0}}function n1(i,e){for(const t in e){const s=e[t],n=i[t];if(typeof s=="string"){if(s!==n)return!1}else if(!Hs(n)||n.length!==s.length||s.some((r,o)=>r!==n[o]))return!1}return!0}function yg(i){return i?i.aliasOf?i.aliasOf.path:i.path:""}const vg=(i,e,t)=>i??e??t,r1=Nm({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(i,{attrs:e,slots:t}){const s=Ai(lu),n=zt(()=>i.route||s.value),r=Ai(mg,0),o=zt(()=>{let c=En(r);const{matched:u}=n.value;let h;for(;(h=u[c])&&!h.components;)c++;return c}),a=zt(()=>n.value.matched[o.value]);oa(mg,zt(()=>o.value+1)),oa(Zk,a),oa(lu,n);const l=ra();return Vr(()=>[l.value,a.value,i.name],([c,u,h],[f,d,g])=>{u&&(u.instances[h]=c,d&&d!==u&&c&&c===f&&(u.leaveGuards.size||(u.leaveGuards=d.leaveGuards),u.updateGuards.size||(u.updateGuards=d.updateGuards))),c&&u&&(!d||!hr(u,d)||!f)&&(u.enterCallbacks[h]||[]).forEach(m=>m(c))},{flush:"post"}),()=>{const c=n.value,u=i.name,h=a.value,f=h&&h.components[u];if(!f)return Tg(t.default,{Component:f,route:c});const d=h.props[u],g=d?d===!0?c.params:typeof d=="function"?d(c):d:null,p=Wu(f,Be({},g,e,{onVnodeUnmounted:y=>{y.component.isUnmounted&&(h.instances[u]=null)},ref:l}));return Tg(t.default,{Component:p,route:c})||p}}});function Tg(i,e){if(!i)return null;const t=i(e);return t.length===1?t[0]:t}const o1=r1;function a1(i){const e=Wk(i.routes,i),t=i.parseQuery||Qk,s=i.stringifyQuery||gg,n=i.history,r=br(),o=br(),a=br(),l=dT(Pi);let c=Pi;zn&&i.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const u=uc.bind(null,U=>""+U),h=uc.bind(null,vk),f=uc.bind(null,yo);function d(U,te){let Z,le;return sy(U)?(Z=e.getRecordMatcher(U),le=te):le=U,e.addRoute(le,Z)}function g(U){const te=e.getRecordMatcher(U);te&&e.removeRoute(te)}function m(){return e.getRoutes().map(U=>U.record)}function p(U){return!!e.getRecordMatcher(U)}function y(U,te){if(te=Be({},te||l.value),typeof U=="string"){const C=hc(t,U,te.path),F=e.resolve({path:C.path},te),$=n.createHref(C.fullPath);return Be(C,F,{params:f(F.params),hash:yo(C.hash),redirectedFrom:void 0,href:$})}let Z;if(U.path!=null)Z=Be({},U,{path:hc(t,U.path,te.path).path});else{const C=Be({},U.params);for(const F in C)C[F]==null&&delete C[F];Z=Be({},U,{params:h(C)}),te.params=h(te.params)}const le=e.resolve(Z,te),Ae=U.hash||"";le.params=u(f(le.params));const Pe=Ek(s,Be({},U,{hash:mk(Ae),path:le.path})),I=n.createHref(Pe);return Be({fullPath:Pe,hash:Ae,query:s===gg?Jk(U.query):U.query||{}},le,{redirectedFrom:void 0,href:I})}function _(U){return typeof U=="string"?hc(t,U,l.value.path):Be({},U)}function T(U,te){if(c!==U)return fr(8,{from:te,to:U})}function E(U){return x(U)}function S(U){return E(Be(_(U),{replace:!0}))}function R(U){const te=U.matched[U.matched.length-1];if(te&&te.redirect){const{redirect:Z}=te;let le=typeof Z=="function"?Z(U):Z;return typeof le=="string"&&(le=le.includes("?")||le.includes("#")?le=_(le):{path:le},le.params={}),Be({query:U.query,hash:U.hash,params:le.path!=null?{}:U.params},le)}}function x(U,te){const Z=c=y(U),le=l.value,Ae=U.state,Pe=U.force,I=U.replace===!0,C=R(Z);if(C)return x(Be(_(C),{state:typeof C=="object"?Be({},Ae,C.state):Ae,force:Pe,replace:I}),te||Z);const F=Z;F.redirectedFrom=te;let $;return!Pe&&Sk(s,le,Z)&&($=fr(16,{to:F,from:le}),z(le,le,!0,!1)),($?Promise.resolve($):k(F,le)).catch(N=>pi(N)?pi(N,2)?N:fe(N):K(N,F,le)).then(N=>{if(N){if(pi(N,2))return x(Be({replace:I},_(N.to),{state:typeof N.to=="object"?Be({},Ae,N.to.state):Ae,force:Pe}),te||F)}else N=P(F,le,!0,I,Ae);return w(F,le,N),N})}function L(U,te){const Z=T(U,te);return Z?Promise.reject(Z):Promise.resolve()}function A(U){const te=Ee.values().next().value;return te&&typeof te.runWithContext=="function"?te.runWithContext(U):U()}function k(U,te){let Z;const[le,Ae,Pe]=l1(U,te);Z=fc(le.reverse(),"beforeRouteLeave",U,te);for(const C of le)C.leaveGuards.forEach(F=>{Z.push(Bi(F,U,te))});const I=L.bind(null,U,te);return Z.push(I),Te(Z).then(()=>{Z=[];for(const C of r.list())Z.push(Bi(C,U,te));return Z.push(I),Te(Z)}).then(()=>{Z=fc(Ae,"beforeRouteUpdate",U,te);for(const C of Ae)C.updateGuards.forEach(F=>{Z.push(Bi(F,U,te))});return Z.push(I),Te(Z)}).then(()=>{Z=[];for(const C of Pe)if(C.beforeEnter)if(Hs(C.beforeEnter))for(const F of C.beforeEnter)Z.push(Bi(F,U,te));else Z.push(Bi(C.beforeEnter,U,te));return Z.push(I),Te(Z)}).then(()=>(U.matched.forEach(C=>C.enterCallbacks={}),Z=fc(Pe,"beforeRouteEnter",U,te,A),Z.push(I),Te(Z))).then(()=>{Z=[];for(const C of o.list())Z.push(Bi(C,U,te));return Z.push(I),Te(Z)}).catch(C=>pi(C,8)?C:Promise.reject(C))}function w(U,te,Z){a.list().forEach(le=>A(()=>le(U,te,Z)))}function P(U,te,Z,le,Ae){const Pe=T(U,te);if(Pe)return Pe;const I=te===Pi,C=zn?history.state:{};Z&&(le||I?n.replace(U.fullPath,Be({scroll:I&&C&&C.scroll},Ae)):n.push(U.fullPath,Ae)),l.value=U,z(U,te,Z,I),fe()}let B;function X(){B||(B=n.listen((U,te,Z)=>{if(!re.listening)return;const le=y(U),Ae=R(le);if(Ae){x(Be(Ae,{replace:!0,force:!0}),le).catch(Xr);return}c=le;const Pe=l.value;zn&&Ck(rg(Pe.fullPath,Z.delta),vl()),k(le,Pe).catch(I=>pi(I,12)?I:pi(I,2)?(x(Be(_(I.to),{force:!0}),le).then(C=>{pi(C,20)&&!Z.delta&&Z.type===vo.pop&&n.go(-1,!1)}).catch(Xr),Promise.reject()):(Z.delta&&n.go(-Z.delta,!1),K(I,le,Pe))).then(I=>{I=I||P(le,Pe,!1),I&&(Z.delta&&!pi(I,8)?n.go(-Z.delta,!1):Z.type===vo.pop&&pi(I,20)&&n.go(-1,!1)),w(le,Pe,I)}).catch(Xr)}))}let q=br(),G=br(),H;function K(U,te,Z){fe(U);const le=G.list();return le.length?le.forEach(Ae=>Ae(U,te,Z)):console.error(U),Promise.reject(U)}function ae(){return H&&l.value!==Pi?Promise.resolve():new Promise((U,te)=>{q.add([U,te])})}function fe(U){return H||(H=!U,X(),q.list().forEach(([te,Z])=>U?Z(U):te()),q.reset()),U}function z(U,te,Z,le){const{scrollBehavior:Ae}=i;if(!zn||!Ae)return Promise.resolve();const Pe=!Z&&wk(rg(U.fullPath,0))||(le||!Z)&&history.state&&history.state.scroll||null;return Am().then(()=>Ae(U,te,Pe)).then(I=>I&&kk(I)).catch(I=>K(I,U,te))}const Y=U=>n.go(U);let ue;const Ee=new Set,re={currentRoute:l,listening:!0,addRoute:d,removeRoute:g,clearRoutes:e.clearRoutes,hasRoute:p,getRoutes:m,resolve:y,options:i,push:E,replace:S,go:Y,back:()=>Y(-1),forward:()=>Y(1),beforeEach:r.add,beforeResolve:o.add,afterEach:a.add,onError:G.add,isReady:ae,install(U){const te=this;U.component("RouterLink",s1),U.component("RouterView",o1),U.config.globalProperties.$router=te,Object.defineProperty(U.config.globalProperties,"$route",{enumerable:!0,get:()=>En(l)}),zn&&!ue&&l.value===Pi&&(ue=!0,E(n.location).catch(Ae=>{}));const Z={};for(const Ae in Pi)Object.defineProperty(Z,Ae,{get:()=>l.value[Ae],enumerable:!0});U.provide(vh,te),U.provide(oy,_m(Z)),U.provide(lu,l);const le=U.unmount;Ee.add(U),U.unmount=function(){Ee.delete(U),Ee.size<1&&(c=Pi,B&&B(),B=null,l.value=Pi,ue=!1,H=!1),le()}}};function Te(U){return U.reduce((te,Z)=>te.then(()=>A(Z)),Promise.resolve())}return re}function l1(i,e){const t=[],s=[],n=[],r=Math.max(e.matched.length,i.matched.length);for(let o=0;o<r;o++){const a=e.matched[o];a&&(i.matched.find(c=>hr(c,a))?s.push(a):t.push(a));const l=i.matched[o];l&&(e.matched.find(c=>hr(c,l))||n.push(l))}return[t,s,n]}const c1={name:"App",components:{ProfileCard:z0,TabNavigation:ML,Footer:UL,Logo:oR,EasterEgg:RR,Achievements:XR,BackToTop:ZR},mounted(){tk.initialize(),sg.initialize(),va.initialize(),cc.initialize(),setTimeout(()=>{va.checkAndUnlockImmediately(),cc.checkAndUnlockImmediately()},2e3)},beforeDestroy(){sg.cleanup(),va.cleanup(),cc.cleanup()}},u1={id:"app"},h1={class:"app-layout"},f1={class:"content-container"};function d1(i,e,t,s,n,r){const o=It("ProfileCard"),a=It("TabNavigation"),l=It("router-view"),c=It("Footer"),u=It("Logo"),h=It("EasterEgg"),f=It("Achievements"),d=It("BackToTop"),g=It("Analytics"),m=It("SpeedInsights");return ne(),ce("div",u1,[Oe(o),b("div",h1,[Oe(a),b("div",f1,[Oe(l)])]),Oe(c),Oe(u),Oe(h),Oe(f),Oe(d),Oe(g),Oe(m)])}const g1=bt(c1,[["render",d1]]),m1=[{id:1,name:"",description:"",image:new URL(""+new URL("swordsman-96888d63.webp",import.meta.url).href,self.location).href,route:"https://docs.wenturc.com/"},{id:2,name:"",description:"~ ",image:new URL(""+new URL("mage-dc522268.webp",import.meta.url).href,self.location).href,route:"https://chat.wenturc.com/"},{id:3,name:"",description:"~ ",image:new URL(""+new URL("rogue-a62d4eba.webp",import.meta.url).href,self.location).href,route:"https://note.wenturc.com/"}],p1={:[" ","",""],:["",""," (*/*)"],:["","",""]};function Ei(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function ay(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e}/*!
 * GSAP 3.12.7
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _s={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},dr={duration:.5,overwrite:!1,delay:0},Th,kt,it,Rs=1e8,Ye=1/Rs,cu=Math.PI*2,y1=cu/4,v1=0,ly=Math.sqrt,T1=Math.cos,_1=Math.sin,xt=function(e){return typeof e=="string"},ct=function(e){return typeof e=="function"},Li=function(e){return typeof e=="number"},_h=function(e){return typeof e>"u"},ui=function(e){return typeof e=="object"},rs=function(e){return e!==!1},Eh=function(){return typeof window<"u"},ea=function(e){return ct(e)||xt(e)},cy=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},$t=Array.isArray,uu=/(?:-?\.?\d|\.)+/gi,uy=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Yn=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,dc=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,hy=/[+-]=-?[.\d]+/,fy=/[^,'"\[\]\s]+/gi,E1=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,rt,Zs,hu,Sh,Es={},Ka={},dy,gy=function(e){return(Ka=gr(e,Es))&&cs},xh=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},To=function(e,t){return!t&&console.warn(e)},my=function(e,t){return e&&(Es[e]=t)&&Ka&&(Ka[e]=t)||Es},_o=function(){return 0},S1={suppressEvents:!0,isStart:!0,kill:!1},Ta={suppressEvents:!0,kill:!1},x1={suppressEvents:!0},bh={},zi=[],fu={},py,fs={},gc={},_g=30,_a=[],Ah="",Lh=function(e){var t=e[0],s,n;if(ui(t)||ct(t)||(e=[e]),!(s=(t._gsap||{}).harness)){for(n=_a.length;n--&&!_a[n].targetTest(t););s=_a[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new By(e[n],s)))||e.splice(n,1);return e},xn=function(e){return e._gsap||Lh(ks(e))[0]._gsap},yy=function(e,t,s){return(s=e[t])&&ct(s)?e[t]():_h(s)&&e.getAttribute&&e.getAttribute(t)||s},os=function(e,t){return(e=e.split(",")).forEach(t)||e},ut=function(e){return Math.round(e*1e5)/1e5||0},mt=function(e){return Math.round(e*1e7)/1e7||0},rr=function(e,t){var s=t.charAt(0),n=parseFloat(t.substr(2));return e=parseFloat(e),s==="+"?e+n:s==="-"?e-n:s==="*"?e*n:e/n},b1=function(e,t){for(var s=t.length,n=0;e.indexOf(t[n])<0&&++n<s;);return n<s},za=function(){var e=zi.length,t=zi.slice(0),s,n;for(fu={},zi.length=0,s=0;s<e;s++)n=t[s],n&&n._lazy&&(n.render(n._lazy[0],n._lazy[1],!0)._lazy=0)},vy=function(e,t,s,n){zi.length&&!kt&&za(),e.render(t,s,n||kt&&t<0&&(e._initted||e._startAt)),zi.length&&!kt&&za()},Ty=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(fy).length<2?t:xt(e)?e.trim():e},_y=function(e){return e},Ss=function(e,t){for(var s in t)s in e||(e[s]=t[s]);return e},A1=function(e){return function(t,s){for(var n in s)n in t||n==="duration"&&e||n==="ease"||(t[n]=s[n])}},gr=function(e,t){for(var s in t)e[s]=t[s];return e},Eg=function i(e,t){for(var s in t)s!=="__proto__"&&s!=="constructor"&&s!=="prototype"&&(e[s]=ui(t[s])?i(e[s]||(e[s]={}),t[s]):t[s]);return e},Wa=function(e,t){var s={},n;for(n in e)n in t||(s[n]=e[n]);return s},Jr=function(e){var t=e.parent||rt,s=e.keyframes?A1($t(e.keyframes)):Ss;if(rs(e.inherit))for(;t;)s(e,t.vars.defaults),t=t.parent||t._dp;return e},L1=function(e,t){for(var s=e.length,n=s===t.length;n&&s--&&e[s]===t[s];);return s<0},Ey=function(e,t,s,n,r){s===void 0&&(s="_first"),n===void 0&&(n="_last");var o=e[n],a;if(r)for(a=t[r];o&&o[r]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[s],e[s]=t),t._next?t._next._prev=t:e[n]=t,t._prev=o,t.parent=t._dp=e,t},Tl=function(e,t,s,n){s===void 0&&(s="_first"),n===void 0&&(n="_last");var r=t._prev,o=t._next;r?r._next=o:e[s]===t&&(e[s]=o),o?o._prev=r:e[n]===t&&(e[n]=r),t._next=t._prev=t.parent=null},Xi=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},bn=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var s=e;s;)s._dirty=1,s=s.parent;return e},I1=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},du=function(e,t,s,n){return e._startAt&&(kt?e._startAt.revert(Ta):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,n))},R1=function i(e){return!e||e._ts&&i(e.parent)},Sg=function(e){return e._repeat?mr(e._tTime,e=e.duration()+e._rDelay)*e:0},mr=function(e,t){var s=Math.floor(e=mt(e/t));return e&&s===e?s-1:s},qa=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},_l=function(e){return e._end=mt(e._start+(e._tDur/Math.abs(e._ts||e._rts||Ye)||0))},El=function(e,t){var s=e._dp;return s&&s.smoothChildTiming&&e._ts&&(e._start=mt(s._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),_l(e),s._dirty||bn(s,e)),e},Sy=function(e,t){var s;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(s=qa(e.rawTime(),t),(!t._dur||Co(0,t.totalDuration(),s)-t._tTime>Ye)&&t.render(s,!0)),bn(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(s=e;s._dp;)s.rawTime()>=0&&s.totalTime(s._tTime),s=s._dp;e._zTime=-Ye}},si=function(e,t,s,n){return t.parent&&Xi(t),t._start=mt((Li(s)?s:s||e!==rt?As(e,s,t):e._time)+t._delay),t._end=mt(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),Ey(e,t,"_first","_last",e._sort?"_start":0),gu(t)||(e._recent=t),n||Sy(e,t),e._ts<0&&El(e,e._tTime),e},xy=function(e,t){return(Es.ScrollTrigger||xh("scrollTrigger",t))&&Es.ScrollTrigger.create(t,e)},by=function(e,t,s,n,r){if(Rh(e,t,r),!e._initted)return 1;if(!s&&e._pt&&!kt&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&py!==gs.frame)return zi.push(e),e._lazy=[r,n],1},k1=function i(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||i(t))},gu=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},C1=function(e,t,s,n){var r=e.ratio,o=t<0||!t&&(!e._start&&k1(e)&&!(!e._initted&&gu(e))||(e._ts<0||e._dp._ts<0)&&!gu(e))?0:1,a=e._rDelay,l=0,c,u,h;if(a&&e._repeat&&(l=Co(0,e._tDur,t),u=mr(l,a),e._yoyo&&u&1&&(o=1-o),u!==mr(e._tTime,a)&&(r=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==r||kt||n||e._zTime===Ye||!t&&e._zTime){if(!e._initted&&by(e,t,n,s,l))return;for(h=e._zTime,e._zTime=t||(s?Ye:0),s||(s=t&&!h),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=l,c=e._pt;c;)c.r(o,c.d),c=c._next;t<0&&du(e,t,s,!0),e._onUpdate&&!s&&ys(e,"onUpdate"),l&&e._repeat&&!s&&e.parent&&ys(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&Xi(e,1),!s&&!kt&&(ys(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},w1=function(e,t,s){var n;if(s>t)for(n=e._first;n&&n._start<=s;){if(n.data==="isPause"&&n._start>t)return n;n=n._next}else for(n=e._last;n&&n._start>=s;){if(n.data==="isPause"&&n._start<t)return n;n=n._prev}},pr=function(e,t,s,n){var r=e._repeat,o=mt(t)||0,a=e._tTime/e._tDur;return a&&!n&&(e._time*=o/e._dur),e._dur=o,e._tDur=r?r<0?1e10:mt(o*(r+1)+e._rDelay*r):o,a>0&&!n&&El(e,e._tTime=e._tDur*a),e.parent&&_l(e),s||bn(e.parent,e),e},xg=function(e){return e instanceof Wt?bn(e):pr(e,e._dur)},D1={_start:0,endTime:_o,totalDuration:_o},As=function i(e,t,s){var n=e.labels,r=e._recent||D1,o=e.duration()>=Rs?r.endTime(!1):e._dur,a,l,c;return xt(t)&&(isNaN(t)||t in n)?(l=t.charAt(0),c=t.substr(-1)==="%",a=t.indexOf("="),l==="<"||l===">"?(a>=0&&(t=t.replace(/=/,"")),(l==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(a<0?r:s).totalDuration()/100:1)):a<0?(t in n||(n[t]=o),n[t]):(l=parseFloat(t.charAt(a-1)+t.substr(a+1)),c&&s&&(l=l/100*($t(s)?s[0]:s).totalDuration()),a>1?i(e,t.substr(0,a-1),s)+l:o+l)):t==null?o:+t},Zr=function(e,t,s){var n=Li(t[1]),r=(n?2:1)+(e<2?0:1),o=t[r],a,l;if(n&&(o.duration=t[1]),o.parent=s,e){for(a=o,l=s;l&&!("immediateRender"in a);)a=l.vars.defaults||{},l=rs(l.vars.inherit)&&l.parent;o.immediateRender=rs(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[r-1]}return new gt(t[0],o,t[r+1])},tn=function(e,t){return e||e===0?t(e):t},Co=function(e,t,s){return s<e?e:s>t?t:s},Ft=function(e,t){return!xt(e)||!(t=E1.exec(e))?"":t[1]},P1=function(e,t,s){return tn(s,function(n){return Co(e,t,n)})},mu=[].slice,Ay=function(e,t){return e&&ui(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&ui(e[0]))&&!e.nodeType&&e!==Zs},O1=function(e,t,s){return s===void 0&&(s=[]),e.forEach(function(n){var r;return xt(n)&&!t||Ay(n,1)?(r=s).push.apply(r,ks(n)):s.push(n)})||s},ks=function(e,t,s){return it&&!t&&it.selector?it.selector(e):xt(e)&&!s&&(hu||!yr())?mu.call((t||Sh).querySelectorAll(e),0):$t(e)?O1(e,s):Ay(e)?mu.call(e,0):e?[e]:[]},pu=function(e){return e=ks(e)[0]||To("Invalid scope")||{},function(t){var s=e.current||e.nativeElement||e;return ks(t,s.querySelectorAll?s:s===e?To("Invalid scope")||Sh.createElement("div"):e)}},Ly=function(e){return e.sort(function(){return .5-Math.random()})},Iy=function(e){if(ct(e))return e;var t=ui(e)?e:{each:e},s=An(t.ease),n=t.from||0,r=parseFloat(t.base)||0,o={},a=n>0&&n<1,l=isNaN(n)||a,c=t.axis,u=n,h=n;return xt(n)?u=h={center:.5,edges:.5,end:1}[n]||0:!a&&l&&(u=n[0],h=n[1]),function(f,d,g){var m=(g||t).length,p=o[m],y,_,T,E,S,R,x,L,A;if(!p){if(A=t.grid==="auto"?0:(t.grid||[1,Rs])[1],!A){for(x=-Rs;x<(x=g[A++].getBoundingClientRect().left)&&A<m;);A<m&&A--}for(p=o[m]=[],y=l?Math.min(A,m)*u-.5:n%A,_=A===Rs?0:l?m*h/A-.5:n/A|0,x=0,L=Rs,R=0;R<m;R++)T=R%A-y,E=_-(R/A|0),p[R]=S=c?Math.abs(c==="y"?E:T):ly(T*T+E*E),S>x&&(x=S),S<L&&(L=S);n==="random"&&Ly(p),p.max=x-L,p.min=L,p.v=m=(parseFloat(t.amount)||parseFloat(t.each)*(A>m?m-1:c?c==="y"?m/A:A:Math.max(A,m/A))||0)*(n==="edges"?-1:1),p.b=m<0?r-m:r,p.u=Ft(t.amount||t.each)||0,s=s&&m<0?Ny(s):s}return m=(p[f]-p.min)/p.max||0,mt(p.b+(s?s(m):m)*p.v)+p.u}},yu=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(s){var n=mt(Math.round(parseFloat(s)/e)*e*t);return(n-n%1)/t+(Li(s)?0:Ft(s))}},Ry=function(e,t){var s=$t(e),n,r;return!s&&ui(e)&&(n=s=e.radius||Rs,e.values?(e=ks(e.values),(r=!Li(e[0]))&&(n*=n)):e=yu(e.increment)),tn(t,s?ct(e)?function(o){return r=e(o),Math.abs(r-o)<=n?r:o}:function(o){for(var a=parseFloat(r?o.x:o),l=parseFloat(r?o.y:0),c=Rs,u=0,h=e.length,f,d;h--;)r?(f=e[h].x-a,d=e[h].y-l,f=f*f+d*d):f=Math.abs(e[h]-a),f<c&&(c=f,u=h);return u=!n||c<=n?e[u]:o,r||u===o||Li(o)?u:u+Ft(o)}:yu(e))},ky=function(e,t,s,n){return tn($t(e)?!t:s===!0?!!(s=0):!n,function(){return $t(e)?e[~~(Math.random()*e.length)]:(s=s||1e-5)&&(n=s<1?Math.pow(10,(s+"").length-2):1)&&Math.floor(Math.round((e-s/2+Math.random()*(t-e+s*.99))/s)*s*n)/n})},M1=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(n){return t.reduce(function(r,o){return o(r)},n)}},F1=function(e,t){return function(s){return e(parseFloat(s))+(t||Ft(s))}},N1=function(e,t,s){return wy(e,t,0,1,s)},Cy=function(e,t,s){return tn(s,function(n){return e[~~t(n)]})},$1=function i(e,t,s){var n=t-e;return $t(e)?Cy(e,i(0,e.length),t):tn(s,function(r){return(n+(r-e)%n)%n+e})},U1=function i(e,t,s){var n=t-e,r=n*2;return $t(e)?Cy(e,i(0,e.length-1),t):tn(s,function(o){return o=(r+(o-e)%r)%r||0,e+(o>n?r-o:o)})},Eo=function(e){for(var t=0,s="",n,r,o,a;~(n=e.indexOf("random(",t));)o=e.indexOf(")",n),a=e.charAt(n+7)==="[",r=e.substr(n+7,o-n-7).match(a?fy:uu),s+=e.substr(t,n-t)+ky(a?r:+r[0],a?0:+r[1],+r[2]||1e-5),t=o+1;return s+e.substr(t,e.length-t)},wy=function(e,t,s,n,r){var o=t-e,a=n-s;return tn(r,function(l){return s+((l-e)/o*a||0)})},B1=function i(e,t,s,n){var r=isNaN(e+t)?0:function(d){return(1-d)*e+d*t};if(!r){var o=xt(e),a={},l,c,u,h,f;if(s===!0&&(n=1)&&(s=null),o)e={p:e},t={p:t};else if($t(e)&&!$t(t)){for(u=[],h=e.length,f=h-2,c=1;c<h;c++)u.push(i(e[c-1],e[c]));h--,r=function(g){g*=h;var m=Math.min(f,~~g);return u[m](g-m)},s=t}else n||(e=gr($t(e)?[]:{},e));if(!u){for(l in t)Ih.call(a,e,l,"get",t[l]);r=function(g){return wh(g,a)||(o?e.p:e)}}}return tn(s,r)},bg=function(e,t,s){var n=e.labels,r=Rs,o,a,l;for(o in n)a=n[o]-t,a<0==!!s&&a&&r>(a=Math.abs(a))&&(l=o,r=a);return l},ys=function(e,t,s){var n=e.vars,r=n[t],o=it,a=e._ctx,l,c,u;if(r)return l=n[t+"Params"],c=n.callbackScope||e,s&&zi.length&&za(),a&&(it=a),u=l?r.apply(c,l):r.call(c),it=o,u},Mr=function(e){return Xi(e),e.scrollTrigger&&e.scrollTrigger.kill(!!kt),e.progress()<1&&ys(e,"onInterrupt"),e},jn,Dy=[],Py=function(e){if(e)if(e=!e.name&&e.default||e,Eh()||e.headless){var t=e.name,s=ct(e),n=t&&!s&&e.init?function(){this._props=[]}:e,r={init:_o,render:wh,add:Ih,kill:sC,modifier:tC,rawVars:0},o={targetTest:0,get:0,getSetter:Ch,aliases:{},register:0};if(yr(),e!==n){if(fs[t])return;Ss(n,Ss(Wa(e,r),o)),gr(n.prototype,gr(r,Wa(e,o))),fs[n.prop=t]=n,e.targetTest&&(_a.push(n),bh[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}my(t,n),e.register&&e.register(cs,n,as)}else Dy.push(e)},qe=255,Fr={aqua:[0,qe,qe],lime:[0,qe,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,qe],navy:[0,0,128],white:[qe,qe,qe],olive:[128,128,0],yellow:[qe,qe,0],orange:[qe,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[qe,0,0],pink:[qe,192,203],cyan:[0,qe,qe],transparent:[qe,qe,qe,0]},mc=function(e,t,s){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(s-t)*e*6:e<.5?s:e*3<2?t+(s-t)*(2/3-e)*6:t)*qe+.5|0},Oy=function(e,t,s){var n=e?Li(e)?[e>>16,e>>8&qe,e&qe]:0:Fr.black,r,o,a,l,c,u,h,f,d,g;if(!n){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Fr[e])n=Fr[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+r+r+o+o+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return n=parseInt(e.substr(1,6),16),[n>>16,n>>8&qe,n&qe,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),n=[e>>16,e>>8&qe,e&qe]}else if(e.substr(0,3)==="hsl"){if(n=g=e.match(uu),!t)l=+n[0]%360/360,c=+n[1]/100,u=+n[2]/100,o=u<=.5?u*(c+1):u+c-u*c,r=u*2-o,n.length>3&&(n[3]*=1),n[0]=mc(l+1/3,r,o),n[1]=mc(l,r,o),n[2]=mc(l-1/3,r,o);else if(~e.indexOf("="))return n=e.match(uy),s&&n.length<4&&(n[3]=1),n}else n=e.match(uu)||Fr.transparent;n=n.map(Number)}return t&&!g&&(r=n[0]/qe,o=n[1]/qe,a=n[2]/qe,h=Math.max(r,o,a),f=Math.min(r,o,a),u=(h+f)/2,h===f?l=c=0:(d=h-f,c=u>.5?d/(2-h-f):d/(h+f),l=h===r?(o-a)/d+(o<a?6:0):h===o?(a-r)/d+2:(r-o)/d+4,l*=60),n[0]=~~(l+.5),n[1]=~~(c*100+.5),n[2]=~~(u*100+.5)),s&&n.length<4&&(n[3]=1),n},My=function(e){var t=[],s=[],n=-1;return e.split(Wi).forEach(function(r){var o=r.match(Yn)||[];t.push.apply(t,o),s.push(n+=o.length+1)}),t.c=s,t},Ag=function(e,t,s){var n="",r=(e+n).match(Wi),o=t?"hsla(":"rgba(",a=0,l,c,u,h;if(!r)return e;if(r=r.map(function(f){return(f=Oy(f,t,1))&&o+(t?f[0]+","+f[1]+"%,"+f[2]+"%,"+f[3]:f.join(","))+")"}),s&&(u=My(e),l=s.c,l.join(n)!==u.c.join(n)))for(c=e.replace(Wi,"1").split(Yn),h=c.length-1;a<h;a++)n+=c[a]+(~l.indexOf(a)?r.shift()||o+"0,0,0,0)":(u.length?u:r.length?r:s).shift());if(!c)for(c=e.split(Wi),h=c.length-1;a<h;a++)n+=c[a]+r[a];return n+c[h]},Wi=function(){var i="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Fr)i+="|"+e+"\\b";return new RegExp(i+")","gi")}(),G1=/hsl[a]?\(/,Fy=function(e){var t=e.join(" "),s;if(Wi.lastIndex=0,Wi.test(t))return s=G1.test(t),e[1]=Ag(e[1],s),e[0]=Ag(e[0],s,My(e[1])),!0},So,gs=function(){var i=Date.now,e=500,t=33,s=i(),n=s,r=1e3/240,o=r,a=[],l,c,u,h,f,d,g=function m(p){var y=i()-n,_=p===!0,T,E,S,R;if((y>e||y<0)&&(s+=y-t),n+=y,S=n-s,T=S-o,(T>0||_)&&(R=++h.frame,f=S-h.time*1e3,h.time=S=S/1e3,o+=T+(T>=r?4:r-T),E=1),_||(l=c(m)),E)for(d=0;d<a.length;d++)a[d](S,f,R,p)};return h={time:0,frame:0,tick:function(){g(!0)},deltaRatio:function(p){return f/(1e3/(p||60))},wake:function(){dy&&(!hu&&Eh()&&(Zs=hu=window,Sh=Zs.document||{},Es.gsap=cs,(Zs.gsapVersions||(Zs.gsapVersions=[])).push(cs.version),gy(Ka||Zs.GreenSockGlobals||!Zs.gsap&&Zs||{}),Dy.forEach(Py)),u=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&h.sleep(),c=u||function(p){return setTimeout(p,o-h.time*1e3+1|0)},So=1,g(2))},sleep:function(){(u?cancelAnimationFrame:clearTimeout)(l),So=0,c=_o},lagSmoothing:function(p,y){e=p||1/0,t=Math.min(y||33,e)},fps:function(p){r=1e3/(p||240),o=h.time*1e3+r},add:function(p,y,_){var T=y?function(E,S,R,x){p(E,S,R,x),h.remove(T)}:p;return h.remove(p),a[_?"unshift":"push"](T),yr(),T},remove:function(p,y){~(y=a.indexOf(p))&&a.splice(y,1)&&d>=y&&d--},_listeners:a},h}(),yr=function(){return!So&&gs.wake()},De={},H1=/^[\d.\-M][\d.\-,\s]/,V1=/["']/g,K1=function(e){for(var t={},s=e.substr(1,e.length-3).split(":"),n=s[0],r=1,o=s.length,a,l,c;r<o;r++)l=s[r],a=r!==o-1?l.lastIndexOf(","):l.length,c=l.substr(0,a),t[n]=isNaN(c)?c.replace(V1,"").trim():+c,n=l.substr(a+1).trim();return t},z1=function(e){var t=e.indexOf("(")+1,s=e.indexOf(")"),n=e.indexOf("(",t);return e.substring(t,~n&&n<s?e.indexOf(")",s+1):s)},W1=function(e){var t=(e+"").split("("),s=De[t[0]];return s&&t.length>1&&s.config?s.config.apply(null,~e.indexOf("{")?[K1(t[1])]:z1(e).split(",").map(Ty)):De._CE&&H1.test(e)?De._CE("",e):s},Ny=function(e){return function(t){return 1-e(1-t)}},$y=function i(e,t){for(var s=e._first,n;s;)s instanceof Wt?i(s,t):s.vars.yoyoEase&&(!s._yoyo||!s._repeat)&&s._yoyo!==t&&(s.timeline?i(s.timeline,t):(n=s._ease,s._ease=s._yEase,s._yEase=n,s._yoyo=t)),s=s._next},An=function(e,t){return e&&(ct(e)?e:De[e]||W1(e))||t},On=function(e,t,s,n){s===void 0&&(s=function(l){return 1-t(1-l)}),n===void 0&&(n=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var r={easeIn:t,easeOut:s,easeInOut:n},o;return os(e,function(a){De[a]=Es[a]=r,De[o=a.toLowerCase()]=s;for(var l in r)De[o+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=De[a+"."+l]=r[l]}),r},Uy=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},pc=function i(e,t,s){var n=t>=1?t:1,r=(s||(e?.3:.45))/(t<1?t:1),o=r/cu*(Math.asin(1/n)||0),a=function(u){return u===1?1:n*Math.pow(2,-10*u)*_1((u-o)*r)+1},l=e==="out"?a:e==="in"?function(c){return 1-a(1-c)}:Uy(a);return r=cu/r,l.config=function(c,u){return i(e,c,u)},l},yc=function i(e,t){t===void 0&&(t=1.70158);var s=function(o){return o?--o*o*((t+1)*o+t)+1:0},n=e==="out"?s:e==="in"?function(r){return 1-s(1-r)}:Uy(s);return n.config=function(r){return i(e,r)},n};os("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,e){var t=e<5?e+1:e;On(i+",Power"+(t-1),e?function(s){return Math.pow(s,t)}:function(s){return s},function(s){return 1-Math.pow(1-s,t)},function(s){return s<.5?Math.pow(s*2,t)/2:1-Math.pow((1-s)*2,t)/2})});De.Linear.easeNone=De.none=De.Linear.easeIn;On("Elastic",pc("in"),pc("out"),pc());(function(i,e){var t=1/e,s=2*t,n=2.5*t,r=function(a){return a<t?i*a*a:a<s?i*Math.pow(a-1.5/e,2)+.75:a<n?i*(a-=2.25/e)*a+.9375:i*Math.pow(a-2.625/e,2)+.984375};On("Bounce",function(o){return 1-r(1-o)},r)})(7.5625,2.75);On("Expo",function(i){return Math.pow(2,10*(i-1))*i+i*i*i*i*i*i*(1-i)});On("Circ",function(i){return-(ly(1-i*i)-1)});On("Sine",function(i){return i===1?1:-T1(i*y1)+1});On("Back",yc("in"),yc("out"),yc());De.SteppedEase=De.steps=Es.SteppedEase={config:function(e,t){e===void 0&&(e=1);var s=1/e,n=e+(t?0:1),r=t?1:0,o=1-Ye;return function(a){return((n*Co(0,o,a)|0)+r)*s}}};dr.ease=De["quad.out"];os("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return Ah+=i+","+i+"Params,"});var By=function(e,t){this.id=v1++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:yy,this.set=t?t.getSetter:Ch},xo=function(){function i(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,pr(this,+t.duration,1,1),this.data=t.data,it&&(this._ctx=it,it.data.push(this)),So||gs.wake()}var e=i.prototype;return e.delay=function(s){return s||s===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+s-this._delay),this._delay=s,this):this._delay},e.duration=function(s){return arguments.length?this.totalDuration(this._repeat>0?s+(s+this._rDelay)*this._repeat:s):this.totalDuration()&&this._dur},e.totalDuration=function(s){return arguments.length?(this._dirty=0,pr(this,this._repeat<0?s:(s-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(s,n){if(yr(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(El(this,s),!r._dp||r.parent||Sy(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&s<this._tDur||this._ts<0&&s>0||!this._tDur&&!s)&&si(this._dp,this,this._start-this._delay)}return(this._tTime!==s||!this._dur&&!n||this._initted&&Math.abs(this._zTime)===Ye||!s&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=s),vy(this,s,n)),this},e.time=function(s,n){return arguments.length?this.totalTime(Math.min(this.totalDuration(),s+Sg(this))%(this._dur+this._rDelay)||(s?this._dur:0),n):this._time},e.totalProgress=function(s,n){return arguments.length?this.totalTime(this.totalDuration()*s,n):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(s,n){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-s:s)+Sg(this),n):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(s,n){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(s-1)*r,n):this._repeat?mr(this._tTime,r)+1:1},e.timeScale=function(s,n){if(!arguments.length)return this._rts===-Ye?0:this._rts;if(this._rts===s)return this;var r=this.parent&&this._ts?qa(this.parent._time,this):this._tTime;return this._rts=+s||0,this._ts=this._ps||s===-Ye?0:this._rts,this.totalTime(Co(-Math.abs(this._delay),this._tDur,r),n!==!1),_l(this),I1(this)},e.paused=function(s){return arguments.length?(this._ps!==s&&(this._ps=s,s?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(yr(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Ye&&(this._tTime-=Ye)))),this):this._ps},e.startTime=function(s){if(arguments.length){this._start=s;var n=this.parent||this._dp;return n&&(n._sort||!this.parent)&&si(n,this,s-this._delay),this}return this._start},e.endTime=function(s){return this._start+(rs(s)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(s){var n=this.parent||this._dp;return n?s&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?qa(n.rawTime(s),this):this._tTime:this._tTime},e.revert=function(s){s===void 0&&(s=x1);var n=kt;return kt=s,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(s),this.totalTime(-.01,s.suppressEvents)),this.data!=="nested"&&s.kill!==!1&&this.kill(),kt=n,this},e.globalTime=function(s){for(var n=this,r=arguments.length?s:n.rawTime();n;)r=n._start+r/(Math.abs(n._ts)||1),n=n._dp;return!this.parent&&this._sat?this._sat.globalTime(s):r},e.repeat=function(s){return arguments.length?(this._repeat=s===1/0?-2:s,xg(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(s){if(arguments.length){var n=this._time;return this._rDelay=s,xg(this),n?this.time(n):this}return this._rDelay},e.yoyo=function(s){return arguments.length?(this._yoyo=s,this):this._yoyo},e.seek=function(s,n){return this.totalTime(As(this,s),rs(n))},e.restart=function(s,n){return this.play().totalTime(s?-this._delay:0,rs(n)),this._dur||(this._zTime=-Ye),this},e.play=function(s,n){return s!=null&&this.seek(s,n),this.reversed(!1).paused(!1)},e.reverse=function(s,n){return s!=null&&this.seek(s||this.totalDuration(),n),this.reversed(!0).paused(!1)},e.pause=function(s,n){return s!=null&&this.seek(s,n),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(s){return arguments.length?(!!s!==this.reversed()&&this.timeScale(-this._rts||(s?-Ye:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Ye,this},e.isActive=function(){var s=this.parent||this._dp,n=this._start,r;return!!(!s||this._ts&&this._initted&&s.isActive()&&(r=s.rawTime(!0))>=n&&r<this.endTime(!0)-Ye)},e.eventCallback=function(s,n,r){var o=this.vars;return arguments.length>1?(n?(o[s]=n,r&&(o[s+"Params"]=r),s==="onUpdate"&&(this._onUpdate=n)):delete o[s],this):o[s]},e.then=function(s){var n=this;return new Promise(function(r){var o=ct(s)?s:_y,a=function(){var c=n.then;n.then=null,ct(o)&&(o=o(n))&&(o.then||o===n)&&(n.then=c),r(o),n.then=c};n._initted&&n.totalProgress()===1&&n._ts>=0||!n._tTime&&n._ts<0?a():n._prom=a})},e.kill=function(){Mr(this)},i}();Ss(xo.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Ye,_prom:0,_ps:!1,_rts:1});var Wt=function(i){ay(e,i);function e(s,n){var r;return s===void 0&&(s={}),r=i.call(this,s)||this,r.labels={},r.smoothChildTiming=!!s.smoothChildTiming,r.autoRemoveChildren=!!s.autoRemoveChildren,r._sort=rs(s.sortChildren),rt&&si(s.parent||rt,Ei(r),n),s.reversed&&r.reverse(),s.paused&&r.paused(!0),s.scrollTrigger&&xy(Ei(r),s.scrollTrigger),r}var t=e.prototype;return t.to=function(n,r,o){return Zr(0,arguments,this),this},t.from=function(n,r,o){return Zr(1,arguments,this),this},t.fromTo=function(n,r,o,a){return Zr(2,arguments,this),this},t.set=function(n,r,o){return r.duration=0,r.parent=this,Jr(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new gt(n,r,As(this,o),1),this},t.call=function(n,r,o){return si(this,gt.delayedCall(0,n,r),o)},t.staggerTo=function(n,r,o,a,l,c,u){return o.duration=r,o.stagger=o.stagger||a,o.onComplete=c,o.onCompleteParams=u,o.parent=this,new gt(n,o,As(this,l)),this},t.staggerFrom=function(n,r,o,a,l,c,u){return o.runBackwards=1,Jr(o).immediateRender=rs(o.immediateRender),this.staggerTo(n,r,o,a,l,c,u)},t.staggerFromTo=function(n,r,o,a,l,c,u,h){return a.startAt=o,Jr(a).immediateRender=rs(a.immediateRender),this.staggerTo(n,r,a,l,c,u,h)},t.render=function(n,r,o){var a=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,u=n<=0?0:mt(n),h=this._zTime<0!=n<0&&(this._initted||!c),f,d,g,m,p,y,_,T,E,S,R,x;if(this!==rt&&u>l&&n>=0&&(u=l),u!==this._tTime||o||h){if(a!==this._time&&c&&(u+=this._time-a,n+=this._time-a),f=u,E=this._start,T=this._ts,y=!T,h&&(c||(a=this._zTime),(n||!r)&&(this._zTime=n)),this._repeat){if(R=this._yoyo,p=c+this._rDelay,this._repeat<-1&&n<0)return this.totalTime(p*100+n,r,o);if(f=mt(u%p),u===l?(m=this._repeat,f=c):(S=mt(u/p),m=~~S,m&&m===S&&(f=c,m--),f>c&&(f=c)),S=mr(this._tTime,p),!a&&this._tTime&&S!==m&&this._tTime-S*p-this._dur<=0&&(S=m),R&&m&1&&(f=c-f,x=1),m!==S&&!this._lock){var L=R&&S&1,A=L===(R&&m&1);if(m<S&&(L=!L),a=L?0:u%c?c:u,this._lock=1,this.render(a||(x?0:mt(m*p)),r,!c)._lock=0,this._tTime=u,!r&&this.parent&&ys(this,"onRepeat"),this.vars.repeatRefresh&&!x&&(this.invalidate()._lock=1),a&&a!==this._time||y!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,A&&(this._lock=2,a=L?c:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!x&&this.invalidate()),this._lock=0,!this._ts&&!y)return this;$y(this,x)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(_=w1(this,mt(a),mt(f)),_&&(u-=f-(f=_._start))),this._tTime=u,this._time=f,this._act=!T,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=n,a=0),!a&&f&&!r&&!m&&(ys(this,"onStart"),this._tTime!==u))return this;if(f>=a&&n>=0)for(d=this._first;d;){if(g=d._next,(d._act||f>=d._start)&&d._ts&&_!==d){if(d.parent!==this)return this.render(n,r,o);if(d.render(d._ts>0?(f-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(f-d._start)*d._ts,r,o),f!==this._time||!this._ts&&!y){_=0,g&&(u+=this._zTime=-Ye);break}}d=g}else{d=this._last;for(var k=n<0?n:f;d;){if(g=d._prev,(d._act||k<=d._end)&&d._ts&&_!==d){if(d.parent!==this)return this.render(n,r,o);if(d.render(d._ts>0?(k-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(k-d._start)*d._ts,r,o||kt&&(d._initted||d._startAt)),f!==this._time||!this._ts&&!y){_=0,g&&(u+=this._zTime=k?-Ye:Ye);break}}d=g}}if(_&&!r&&(this.pause(),_.render(f>=a?0:-Ye)._zTime=f>=a?1:-1,this._ts))return this._start=E,_l(this),this.render(n,r,o);this._onUpdate&&!r&&ys(this,"onUpdate",!0),(u===l&&this._tTime>=this.totalDuration()||!u&&a)&&(E===this._start||Math.abs(T)!==Math.abs(this._ts))&&(this._lock||((n||!c)&&(u===l&&this._ts>0||!u&&this._ts<0)&&Xi(this,1),!r&&!(n<0&&!a)&&(u||a||!l)&&(ys(this,u===l&&n>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(n,r){var o=this;if(Li(r)||(r=As(this,r,n)),!(n instanceof xo)){if($t(n))return n.forEach(function(a){return o.add(a,r)}),this;if(xt(n))return this.addLabel(n,r);if(ct(n))n=gt.delayedCall(0,n);else return this}return this!==n?si(this,n,r):this},t.getChildren=function(n,r,o,a){n===void 0&&(n=!0),r===void 0&&(r=!0),o===void 0&&(o=!0),a===void 0&&(a=-Rs);for(var l=[],c=this._first;c;)c._start>=a&&(c instanceof gt?r&&l.push(c):(o&&l.push(c),n&&l.push.apply(l,c.getChildren(!0,r,o)))),c=c._next;return l},t.getById=function(n){for(var r=this.getChildren(1,1,1),o=r.length;o--;)if(r[o].vars.id===n)return r[o]},t.remove=function(n){return xt(n)?this.removeLabel(n):ct(n)?this.killTweensOf(n):(n.parent===this&&Tl(this,n),n===this._recent&&(this._recent=this._last),bn(this))},t.totalTime=function(n,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=mt(gs.time-(this._ts>0?n/this._ts:(this.totalDuration()-n)/-this._ts))),i.prototype.totalTime.call(this,n,r),this._forcing=0,this):this._tTime},t.addLabel=function(n,r){return this.labels[n]=As(this,r),this},t.removeLabel=function(n){return delete this.labels[n],this},t.addPause=function(n,r,o){var a=gt.delayedCall(0,r||_o,o);return a.data="isPause",this._hasPause=1,si(this,a,As(this,n))},t.removePause=function(n){var r=this._first;for(n=As(this,n);r;)r._start===n&&r.data==="isPause"&&Xi(r),r=r._next},t.killTweensOf=function(n,r,o){for(var a=this.getTweensOf(n,o),l=a.length;l--;)Gi!==a[l]&&a[l].kill(n,r);return this},t.getTweensOf=function(n,r){for(var o=[],a=ks(n),l=this._first,c=Li(r),u;l;)l instanceof gt?b1(l._targets,a)&&(c?(!Gi||l._initted&&l._ts)&&l.globalTime(0)<=r&&l.globalTime(l.totalDuration())>r:!r||l.isActive())&&o.push(l):(u=l.getTweensOf(a,r)).length&&o.push.apply(o,u),l=l._next;return o},t.tweenTo=function(n,r){r=r||{};var o=this,a=As(o,n),l=r,c=l.startAt,u=l.onStart,h=l.onStartParams,f=l.immediateRender,d,g=gt.to(o,Ss({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:r.duration||Math.abs((a-(c&&"time"in c?c.time:o._time))/o.timeScale())||Ye,onStart:function(){if(o.pause(),!d){var p=r.duration||Math.abs((a-(c&&"time"in c?c.time:o._time))/o.timeScale());g._dur!==p&&pr(g,p,0,1).render(g._time,!0,!0),d=1}u&&u.apply(g,h||[])}},r));return f?g.render(0):g},t.tweenFromTo=function(n,r,o){return this.tweenTo(r,Ss({startAt:{time:As(this,n)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(n){return n===void 0&&(n=this._time),bg(this,As(this,n))},t.previousLabel=function(n){return n===void 0&&(n=this._time),bg(this,As(this,n),1)},t.currentLabel=function(n){return arguments.length?this.seek(n,!0):this.previousLabel(this._time+Ye)},t.shiftChildren=function(n,r,o){o===void 0&&(o=0);for(var a=this._first,l=this.labels,c;a;)a._start>=o&&(a._start+=n,a._end+=n),a=a._next;if(r)for(c in l)l[c]>=o&&(l[c]+=n);return bn(this)},t.invalidate=function(n){var r=this._first;for(this._lock=0;r;)r.invalidate(n),r=r._next;return i.prototype.invalidate.call(this,n)},t.clear=function(n){n===void 0&&(n=!0);for(var r=this._first,o;r;)o=r._next,this.remove(r),r=o;return this._dp&&(this._time=this._tTime=this._pTime=0),n&&(this.labels={}),bn(this)},t.totalDuration=function(n){var r=0,o=this,a=o._last,l=Rs,c,u,h;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-n:n));if(o._dirty){for(h=o.parent;a;)c=a._prev,a._dirty&&a.totalDuration(),u=a._start,u>l&&o._sort&&a._ts&&!o._lock?(o._lock=1,si(o,a,u-a._delay,1)._lock=0):l=u,u<0&&a._ts&&(r-=u,(!h&&!o._dp||h&&h.smoothChildTiming)&&(o._start+=u/o._ts,o._time-=u,o._tTime-=u),o.shiftChildren(-u,!1,-1/0),l=0),a._end>r&&a._ts&&(r=a._end),a=c;pr(o,o===rt&&o._time>r?o._time:r,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(n){if(rt._ts&&(vy(rt,qa(n,rt)),py=gs.frame),gs.frame>=_g){_g+=_s.autoSleep||120;var r=rt._first;if((!r||!r._ts)&&_s.autoSleep&&gs._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||gs.sleep()}}},e}(xo);Ss(Wt.prototype,{_lock:0,_hasPause:0,_forcing:0});var q1=function(e,t,s,n,r,o,a){var l=new as(this._pt,e,t,0,1,Wy,null,r),c=0,u=0,h,f,d,g,m,p,y,_;for(l.b=s,l.e=n,s+="",n+="",(y=~n.indexOf("random("))&&(n=Eo(n)),o&&(_=[s,n],o(_,e,t),s=_[0],n=_[1]),f=s.match(dc)||[];h=dc.exec(n);)g=h[0],m=n.substring(c,h.index),d?d=(d+1)%5:m.substr(-5)==="rgba("&&(d=1),g!==f[u++]&&(p=parseFloat(f[u-1])||0,l._pt={_next:l._pt,p:m||u===1?m:",",s:p,c:g.charAt(1)==="="?rr(p,g)-p:parseFloat(g)-p,m:d&&d<4?Math.round:0},c=dc.lastIndex);return l.c=c<n.length?n.substring(c,n.length):"",l.fp=a,(hy.test(n)||y)&&(l.e=0),this._pt=l,l},Ih=function(e,t,s,n,r,o,a,l,c,u){ct(n)&&(n=n(r||0,e,o));var h=e[t],f=s!=="get"?s:ct(h)?c?e[t.indexOf("set")||!ct(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():h,d=ct(h)?c?J1:Ky:kh,g;if(xt(n)&&(~n.indexOf("random(")&&(n=Eo(n)),n.charAt(1)==="="&&(g=rr(f,n)+(Ft(f)||0),(g||g===0)&&(n=g))),!u||f!==n||vu)return!isNaN(f*n)&&n!==""?(g=new as(this._pt,e,t,+f||0,n-(f||0),typeof h=="boolean"?eC:zy,0,d),c&&(g.fp=c),a&&g.modifier(a,this,e),this._pt=g):(!h&&!(t in e)&&xh(t,n),q1.call(this,e,t,f,n,d,l||_s.stringFilter,c))},Y1=function(e,t,s,n,r){if(ct(e)&&(e=eo(e,r,t,s,n)),!ui(e)||e.style&&e.nodeType||$t(e)||cy(e))return xt(e)?eo(e,r,t,s,n):e;var o={},a;for(a in e)o[a]=eo(e[a],r,t,s,n);return o},Gy=function(e,t,s,n,r,o){var a,l,c,u;if(fs[e]&&(a=new fs[e]).init(r,a.rawVars?t[e]:Y1(t[e],n,r,o,s),s,n,o)!==!1&&(s._pt=l=new as(s._pt,r,e,0,1,a.render,a,0,a.priority),s!==jn))for(c=s._ptLookup[s._targets.indexOf(r)],u=a._props.length;u--;)c[a._props[u]]=l;return a},Gi,vu,Rh=function i(e,t,s){var n=e.vars,r=n.ease,o=n.startAt,a=n.immediateRender,l=n.lazy,c=n.onUpdate,u=n.runBackwards,h=n.yoyoEase,f=n.keyframes,d=n.autoRevert,g=e._dur,m=e._startAt,p=e._targets,y=e.parent,_=y&&y.data==="nested"?y.vars.targets:p,T=e._overwrite==="auto"&&!Th,E=e.timeline,S,R,x,L,A,k,w,P,B,X,q,G,H;if(E&&(!f||!r)&&(r="none"),e._ease=An(r,dr.ease),e._yEase=h?Ny(An(h===!0?r:h,dr.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!E&&!!n.runBackwards,!E||f&&!n.stagger){if(P=p[0]?xn(p[0]).harness:0,G=P&&n[P.prop],S=Wa(n,bh),m&&(m._zTime<0&&m.progress(1),t<0&&u&&a&&!d?m.render(-1,!0):m.revert(u&&g?Ta:S1),m._lazy=0),o){if(Xi(e._startAt=gt.set(p,Ss({data:"isStart",overwrite:!1,parent:y,immediateRender:!0,lazy:!m&&rs(l),startAt:null,delay:0,onUpdate:c&&function(){return ys(e,"onUpdate")},stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(kt||!a&&!d)&&e._startAt.revert(Ta),a&&g&&t<=0&&s<=0){t&&(e._zTime=t);return}}else if(u&&g&&!m){if(t&&(a=!1),x=Ss({overwrite:!1,data:"isFromStart",lazy:a&&!m&&rs(l),immediateRender:a,stagger:0,parent:y},S),G&&(x[P.prop]=G),Xi(e._startAt=gt.set(p,x)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(kt?e._startAt.revert(Ta):e._startAt.render(-1,!0)),e._zTime=t,!a)i(e._startAt,Ye,Ye);else if(!t)return}for(e._pt=e._ptCache=0,l=g&&rs(l)||l&&!g,R=0;R<p.length;R++){if(A=p[R],w=A._gsap||Lh(p)[R]._gsap,e._ptLookup[R]=X={},fu[w.id]&&zi.length&&za(),q=_===p?R:_.indexOf(A),P&&(B=new P).init(A,G||S,e,q,_)!==!1&&(e._pt=L=new as(e._pt,A,B.name,0,1,B.render,B,0,B.priority),B._props.forEach(function(K){X[K]=L}),B.priority&&(k=1)),!P||G)for(x in S)fs[x]&&(B=Gy(x,S,e,q,A,_))?B.priority&&(k=1):X[x]=L=Ih.call(e,A,x,"get",S[x],q,_,0,n.stringFilter);e._op&&e._op[R]&&e.kill(A,e._op[R]),T&&e._pt&&(Gi=e,rt.killTweensOf(A,X,e.globalTime(t)),H=!e.parent,Gi=0),e._pt&&l&&(fu[w.id]=1)}k&&qy(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!H,f&&t<=0&&E.render(Rs,!0,!0)},j1=function(e,t,s,n,r,o,a,l){var c=(e._pt&&e._ptCache||(e._ptCache={}))[t],u,h,f,d;if(!c)for(c=e._ptCache[t]=[],f=e._ptLookup,d=e._targets.length;d--;){if(u=f[d][t],u&&u.d&&u.d._pt)for(u=u.d._pt;u&&u.p!==t&&u.fp!==t;)u=u._next;if(!u)return vu=1,e.vars[t]="+=0",Rh(e,a),vu=0,l?To(t+" not eligible for reset"):1;c.push(u)}for(d=c.length;d--;)h=c[d],u=h._pt||h,u.s=(n||n===0)&&!r?n:u.s+(n||0)+o*u.c,u.c=s-u.s,h.e&&(h.e=ut(s)+Ft(h.e)),h.b&&(h.b=u.s+Ft(h.b))},X1=function(e,t){var s=e[0]?xn(e[0]).harness:0,n=s&&s.aliases,r,o,a,l;if(!n)return t;r=gr({},t);for(o in n)if(o in r)for(l=n[o].split(","),a=l.length;a--;)r[l[a]]=r[o];return r},Q1=function(e,t,s,n){var r=t.ease||n||"power1.inOut",o,a;if($t(t))a=s[e]||(s[e]=[]),t.forEach(function(l,c){return a.push({t:c/(t.length-1)*100,v:l,e:r})});else for(o in t)a=s[o]||(s[o]=[]),o==="ease"||a.push({t:parseFloat(e),v:t[o],e:r})},eo=function(e,t,s,n,r){return ct(e)?e.call(t,s,n,r):xt(e)&&~e.indexOf("random(")?Eo(e):e},Hy=Ah+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Vy={};os(Hy+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return Vy[i]=1});var gt=function(i){ay(e,i);function e(s,n,r,o){var a;typeof n=="number"&&(r.duration=n,n=r,r=null),a=i.call(this,o?n:Jr(n))||this;var l=a.vars,c=l.duration,u=l.delay,h=l.immediateRender,f=l.stagger,d=l.overwrite,g=l.keyframes,m=l.defaults,p=l.scrollTrigger,y=l.yoyoEase,_=n.parent||rt,T=($t(s)||cy(s)?Li(s[0]):"length"in n)?[s]:ks(s),E,S,R,x,L,A,k,w;if(a._targets=T.length?Lh(T):To("GSAP target "+s+" not found. https://gsap.com",!_s.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=d,g||f||ea(c)||ea(u)){if(n=a.vars,E=a.timeline=new Wt({data:"nested",defaults:m||{},targets:_&&_.data==="nested"?_.vars.targets:T}),E.kill(),E.parent=E._dp=Ei(a),E._start=0,f||ea(c)||ea(u)){if(x=T.length,k=f&&Iy(f),ui(f))for(L in f)~Hy.indexOf(L)&&(w||(w={}),w[L]=f[L]);for(S=0;S<x;S++)R=Wa(n,Vy),R.stagger=0,y&&(R.yoyoEase=y),w&&gr(R,w),A=T[S],R.duration=+eo(c,Ei(a),S,A,T),R.delay=(+eo(u,Ei(a),S,A,T)||0)-a._delay,!f&&x===1&&R.delay&&(a._delay=u=R.delay,a._start+=u,R.delay=0),E.to(A,R,k?k(S,A,T):0),E._ease=De.none;E.duration()?c=u=0:a.timeline=0}else if(g){Jr(Ss(E.vars.defaults,{ease:"none"})),E._ease=An(g.ease||n.ease||"none");var P=0,B,X,q;if($t(g))g.forEach(function(G){return E.to(T,G,">")}),E.duration();else{R={};for(L in g)L==="ease"||L==="easeEach"||Q1(L,g[L],R,g.easeEach);for(L in R)for(B=R[L].sort(function(G,H){return G.t-H.t}),P=0,S=0;S<B.length;S++)X=B[S],q={ease:X.e,duration:(X.t-(S?B[S-1].t:0))/100*c},q[L]=X.v,E.to(T,q,P),P+=q.duration;E.duration()<c&&E.to({},{duration:c-E.duration()})}}c||a.duration(c=E.duration())}else a.timeline=0;return d===!0&&!Th&&(Gi=Ei(a),rt.killTweensOf(T),Gi=0),si(_,Ei(a),r),n.reversed&&a.reverse(),n.paused&&a.paused(!0),(h||!c&&!g&&a._start===mt(_._time)&&rs(h)&&R1(Ei(a))&&_.data!=="nested")&&(a._tTime=-Ye,a.render(Math.max(0,-u)||0)),p&&xy(Ei(a),p),a}var t=e.prototype;return t.render=function(n,r,o){var a=this._time,l=this._tDur,c=this._dur,u=n<0,h=n>l-Ye&&!u?l:n<Ye?0:n,f,d,g,m,p,y,_,T,E;if(!c)C1(this,n,r,o);else if(h!==this._tTime||!n||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==u||this._lazy){if(f=h,T=this.timeline,this._repeat){if(m=c+this._rDelay,this._repeat<-1&&u)return this.totalTime(m*100+n,r,o);if(f=mt(h%m),h===l?(g=this._repeat,f=c):(p=mt(h/m),g=~~p,g&&g===p?(f=c,g--):f>c&&(f=c)),y=this._yoyo&&g&1,y&&(E=this._yEase,f=c-f),p=mr(this._tTime,m),f===a&&!o&&this._initted&&g===p)return this._tTime=h,this;g!==p&&(T&&this._yEase&&$y(T,y),this.vars.repeatRefresh&&!y&&!this._lock&&f!==m&&this._initted&&(this._lock=o=1,this.render(mt(m*g),!0).invalidate()._lock=0))}if(!this._initted){if(by(this,u?n:f,o,r,h))return this._tTime=0,this;if(a!==this._time&&!(o&&this.vars.repeatRefresh&&g!==p))return this;if(c!==this._dur)return this.render(n,r,o)}if(this._tTime=h,this._time=f,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=_=(E||this._ease)(f/c),this._from&&(this.ratio=_=1-_),f&&!a&&!r&&!g&&(ys(this,"onStart"),this._tTime!==h))return this;for(d=this._pt;d;)d.r(_,d.d),d=d._next;T&&T.render(n<0?n:T._dur*T._ease(f/this._dur),r,o)||this._startAt&&(this._zTime=n),this._onUpdate&&!r&&(u&&du(this,n,r,o),ys(this,"onUpdate")),this._repeat&&g!==p&&this.vars.onRepeat&&!r&&this.parent&&ys(this,"onRepeat"),(h===this._tDur||!h)&&this._tTime===h&&(u&&!this._onUpdate&&du(this,n,!0,!0),(n||!c)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&Xi(this,1),!r&&!(u&&!a)&&(h||a||y)&&(ys(this,h===l?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(n){return(!n||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(n),i.prototype.invalidate.call(this,n)},t.resetTo=function(n,r,o,a,l){So||gs.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),u;return this._initted||Rh(this,c),u=this._ease(c/this._dur),j1(this,n,r,o,a,u,c,l)?this.resetTo(n,r,o,a,1):(El(this,0),this.parent||Ey(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(n,r){if(r===void 0&&(r="all"),!n&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?Mr(this):this.scrollTrigger&&this.scrollTrigger.kill(!!kt),this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(n,r,Gi&&Gi.vars.overwrite!==!0)._first||Mr(this),this.parent&&o!==this.timeline.totalDuration()&&pr(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,l=n?ks(n):a,c=this._ptLookup,u=this._pt,h,f,d,g,m,p,y;if((!r||r==="all")&&L1(a,l))return r==="all"&&(this._pt=0),Mr(this);for(h=this._op=this._op||[],r!=="all"&&(xt(r)&&(m={},os(r,function(_){return m[_]=1}),r=m),r=X1(a,r)),y=a.length;y--;)if(~l.indexOf(a[y])){f=c[y],r==="all"?(h[y]=r,g=f,d={}):(d=h[y]=h[y]||{},g=r);for(m in g)p=f&&f[m],p&&((!("kill"in p.d)||p.d.kill(m)===!0)&&Tl(this,p,"_pt"),delete f[m]),d!=="all"&&(d[m]=1)}return this._initted&&!this._pt&&u&&Mr(this),this},e.to=function(n,r){return new e(n,r,arguments[2])},e.from=function(n,r){return Zr(1,arguments)},e.delayedCall=function(n,r,o,a){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:n,onComplete:r,onReverseComplete:r,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(n,r,o){return Zr(2,arguments)},e.set=function(n,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(n,r)},e.killTweensOf=function(n,r,o){return rt.killTweensOf(n,r,o)},e}(xo);Ss(gt.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});os("staggerTo,staggerFrom,staggerFromTo",function(i){gt[i]=function(){var e=new Wt,t=mu.call(arguments,0);return t.splice(i==="staggerFromTo"?5:4,0,0),e[i].apply(e,t)}});var kh=function(e,t,s){return e[t]=s},Ky=function(e,t,s){return e[t](s)},J1=function(e,t,s,n){return e[t](n.fp,s)},Z1=function(e,t,s){return e.setAttribute(t,s)},Ch=function(e,t){return ct(e[t])?Ky:_h(e[t])&&e.setAttribute?Z1:kh},zy=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},eC=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Wy=function(e,t){var s=t._pt,n="";if(!e&&t.b)n=t.b;else if(e===1&&t.e)n=t.e;else{for(;s;)n=s.p+(s.m?s.m(s.s+s.c*e):Math.round((s.s+s.c*e)*1e4)/1e4)+n,s=s._next;n+=t.c}t.set(t.t,t.p,n,t)},wh=function(e,t){for(var s=t._pt;s;)s.r(e,s.d),s=s._next},tC=function(e,t,s,n){for(var r=this._pt,o;r;)o=r._next,r.p===n&&r.modifier(e,t,s),r=o},sC=function(e){for(var t=this._pt,s,n;t;)n=t._next,t.p===e&&!t.op||t.op===e?Tl(this,t,"_pt"):t.dep||(s=1),t=n;return!s},iC=function(e,t,s,n){n.mSet(e,t,n.m.call(n.tween,s,n.mt),n)},qy=function(e){for(var t=e._pt,s,n,r,o;t;){for(s=t._next,n=r;n&&n.pr>t.pr;)n=n._next;(t._prev=n?n._prev:o)?t._prev._next=t:r=t,(t._next=n)?n._prev=t:o=t,t=s}e._pt=r},as=function(){function i(t,s,n,r,o,a,l,c,u){this.t=s,this.s=r,this.c=o,this.p=n,this.r=a||zy,this.d=l||this,this.set=c||kh,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=i.prototype;return e.modifier=function(s,n,r){this.mSet=this.mSet||this.set,this.set=iC,this.m=s,this.mt=r,this.tween=n},i}();os(Ah+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return bh[i]=1});Es.TweenMax=Es.TweenLite=gt;Es.TimelineLite=Es.TimelineMax=Wt;rt=new Wt({sortChildren:!1,defaults:dr,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});_s.stringFilter=Fy;var Ln=[],Ea={},nC=[],Lg=0,rC=0,vc=function(e){return(Ea[e]||nC).map(function(t){return t()})},Tu=function(){var e=Date.now(),t=[];e-Lg>2&&(vc("matchMediaInit"),Ln.forEach(function(s){var n=s.queries,r=s.conditions,o,a,l,c;for(a in n)o=Zs.matchMedia(n[a]).matches,o&&(l=1),o!==r[a]&&(r[a]=o,c=1);c&&(s.revert(),l&&t.push(s))}),vc("matchMediaRevert"),t.forEach(function(s){return s.onMatch(s,function(n){return s.add(null,n)})}),Lg=e,vc("matchMedia"))},Yy=function(){function i(t,s){this.selector=s&&pu(s),this.data=[],this._r=[],this.isReverted=!1,this.id=rC++,t&&this.add(t)}var e=i.prototype;return e.add=function(s,n,r){ct(s)&&(r=n,n=s,s=ct);var o=this,a=function(){var c=it,u=o.selector,h;return c&&c!==o&&c.data.push(o),r&&(o.selector=pu(r)),it=o,h=n.apply(o,arguments),ct(h)&&o._r.push(h),it=c,o.selector=u,o.isReverted=!1,h};return o.last=a,s===ct?a(o,function(l){return o.add(null,l)}):s?o[s]=a:a},e.ignore=function(s){var n=it;it=null,s(this),it=n},e.getTweens=function(){var s=[];return this.data.forEach(function(n){return n instanceof i?s.push.apply(s,n.getTweens()):n instanceof gt&&!(n.parent&&n.parent.data==="nested")&&s.push(n)}),s},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(s,n){var r=this;if(s?function(){for(var a=r.getTweens(),l=r.data.length,c;l--;)c=r.data[l],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(u){return a.splice(a.indexOf(u),1)}));for(a.map(function(u){return{g:u._dur||u._delay||u._sat&&!u._sat.vars.immediateRender?u.globalTime(0):-1/0,t:u}}).sort(function(u,h){return h.g-u.g||-1/0}).forEach(function(u){return u.t.revert(s)}),l=r.data.length;l--;)c=r.data[l],c instanceof Wt?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof gt)&&c.revert&&c.revert(s);r._r.forEach(function(u){return u(s,r)}),r.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),n)for(var o=Ln.length;o--;)Ln[o].id===this.id&&Ln.splice(o,1)},e.revert=function(s){this.kill(s||{})},i}(),oC=function(){function i(t){this.contexts=[],this.scope=t,it&&it.data.push(this)}var e=i.prototype;return e.add=function(s,n,r){ui(s)||(s={matches:s});var o=new Yy(0,r||this.scope),a=o.conditions={},l,c,u;it&&!o.selector&&(o.selector=it.selector),this.contexts.push(o),n=o.add("onMatch",n),o.queries=s;for(c in s)c==="all"?u=1:(l=Zs.matchMedia(s[c]),l&&(Ln.indexOf(o)<0&&Ln.push(o),(a[c]=l.matches)&&(u=1),l.addListener?l.addListener(Tu):l.addEventListener("change",Tu)));return u&&n(o,function(h){return o.add(null,h)}),this},e.revert=function(s){this.kill(s||{})},e.kill=function(s){this.contexts.forEach(function(n){return n.kill(s,!0)})},i}(),Ya={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t.forEach(function(n){return Py(n)})},timeline:function(e){return new Wt(e)},getTweensOf:function(e,t){return rt.getTweensOf(e,t)},getProperty:function(e,t,s,n){xt(e)&&(e=ks(e)[0]);var r=xn(e||{}).get,o=s?_y:Ty;return s==="native"&&(s=""),e&&(t?o((fs[t]&&fs[t].get||r)(e,t,s,n)):function(a,l,c){return o((fs[a]&&fs[a].get||r)(e,a,l,c))})},quickSetter:function(e,t,s){if(e=ks(e),e.length>1){var n=e.map(function(u){return cs.quickSetter(u,t,s)}),r=n.length;return function(u){for(var h=r;h--;)n[h](u)}}e=e[0]||{};var o=fs[t],a=xn(e),l=a.harness&&(a.harness.aliases||{})[t]||t,c=o?function(u){var h=new o;jn._pt=0,h.init(e,s?u+s:u,jn,0,[e]),h.render(1,h),jn._pt&&wh(1,jn)}:a.set(e,l);return o?c:function(u){return c(e,l,s?u+s:u,a,1)}},quickTo:function(e,t,s){var n,r=cs.to(e,Ss((n={},n[t]="+=0.1",n.paused=!0,n.stagger=0,n),s||{})),o=function(l,c,u){return r.resetTo(t,l,c,u)};return o.tween=r,o},isTweening:function(e){return rt.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=An(e.ease,dr.ease)),Eg(dr,e||{})},config:function(e){return Eg(_s,e||{})},registerEffect:function(e){var t=e.name,s=e.effect,n=e.plugins,r=e.defaults,o=e.extendTimeline;(n||"").split(",").forEach(function(a){return a&&!fs[a]&&!Es[a]&&To(t+" effect requires "+a+" plugin.")}),gc[t]=function(a,l,c){return s(ks(a),Ss(l||{},r),c)},o&&(Wt.prototype[t]=function(a,l,c){return this.add(gc[t](a,ui(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){De[e]=An(t)},parseEase:function(e,t){return arguments.length?An(e,t):De},getById:function(e){return rt.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var s=new Wt(e),n,r;for(s.smoothChildTiming=rs(e.smoothChildTiming),rt.remove(s),s._dp=0,s._time=s._tTime=rt._time,n=rt._first;n;)r=n._next,(t||!(!n._dur&&n instanceof gt&&n.vars.onComplete===n._targets[0]))&&si(s,n,n._start-n._delay),n=r;return si(rt,s,0),s},context:function(e,t){return e?new Yy(e,t):it},matchMedia:function(e){return new oC(e)},matchMediaRefresh:function(){return Ln.forEach(function(e){var t=e.conditions,s,n;for(n in t)t[n]&&(t[n]=!1,s=1);s&&e.revert()})||Tu()},addEventListener:function(e,t){var s=Ea[e]||(Ea[e]=[]);~s.indexOf(t)||s.push(t)},removeEventListener:function(e,t){var s=Ea[e],n=s&&s.indexOf(t);n>=0&&s.splice(n,1)},utils:{wrap:$1,wrapYoyo:U1,distribute:Iy,random:ky,snap:Ry,normalize:N1,getUnit:Ft,clamp:P1,splitColor:Oy,toArray:ks,selector:pu,mapRange:wy,pipe:M1,unitize:F1,interpolate:B1,shuffle:Ly},install:gy,effects:gc,ticker:gs,updateRoot:Wt.updateRoot,plugins:fs,globalTimeline:rt,core:{PropTween:as,globals:my,Tween:gt,Timeline:Wt,Animation:xo,getCache:xn,_removeLinkedListItem:Tl,reverting:function(){return kt},context:function(e){return e&&it&&(it.data.push(e),e._ctx=it),it},suppressOverwrites:function(e){return Th=e}}};os("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return Ya[i]=gt[i]});gs.add(Wt.updateRoot);jn=Ya.to({},{duration:0});var aC=function(e,t){for(var s=e._pt;s&&s.p!==t&&s.op!==t&&s.fp!==t;)s=s._next;return s},lC=function(e,t){var s=e._targets,n,r,o;for(n in t)for(r=s.length;r--;)o=e._ptLookup[r][n],o&&(o=o.d)&&(o._pt&&(o=aC(o,n)),o&&o.modifier&&o.modifier(t[n],e,s[r],n))},Tc=function(e,t){return{name:e,rawVars:1,init:function(n,r,o){o._onInit=function(a){var l,c;if(xt(r)&&(l={},os(r,function(u){return l[u]=1}),r=l),t){l={};for(c in r)l[c]=t(r[c]);r=l}lC(a,r)}}}},cs=Ya.registerPlugin({name:"attr",init:function(e,t,s,n,r){var o,a,l;this.tween=s;for(o in t)l=e.getAttribute(o)||"",a=this.add(e,"setAttribute",(l||0)+"",t[o],n,r,0,0,o),a.op=o,a.b=l,this._props.push(o)},render:function(e,t){for(var s=t._pt;s;)kt?s.set(s.t,s.p,s.b,s):s.r(e,s.d),s=s._next}},{name:"endArray",init:function(e,t){for(var s=t.length;s--;)this.add(e,s,e[s]||0,t[s],0,0,0,0,0,1)}},Tc("roundProps",yu),Tc("modifiers"),Tc("snap",Ry))||Ya;gt.version=Wt.version=cs.version="3.12.7";dy=1;Eh()&&yr();De.Power0;De.Power1;De.Power2;De.Power3;De.Power4;De.Linear;De.Quad;De.Cubic;De.Quart;De.Quint;De.Strong;De.Elastic;De.Back;De.SteppedEase;De.Bounce;De.Sine;De.Expo;De.Circ;/*!
 * CSSPlugin 3.12.7
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Ig,Hi,or,Dh,Tn,Rg,Ph,cC=function(){return typeof window<"u"},Ii={},fn=180/Math.PI,ar=Math.PI/180,Hn=Math.atan2,kg=1e8,Oh=/([A-Z])/g,uC=/(left|right|width|margin|padding|x)/i,hC=/[\s,\(]\S/,ri={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},_u=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},fC=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},dC=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},gC=function(e,t){var s=t.s+t.c*e;t.set(t.t,t.p,~~(s+(s<0?-.5:.5))+t.u,t)},jy=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Xy=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},mC=function(e,t,s){return e.style[t]=s},pC=function(e,t,s){return e.style.setProperty(t,s)},yC=function(e,t,s){return e._gsap[t]=s},vC=function(e,t,s){return e._gsap.scaleX=e._gsap.scaleY=s},TC=function(e,t,s,n,r){var o=e._gsap;o.scaleX=o.scaleY=s,o.renderTransform(r,o)},_C=function(e,t,s,n,r){var o=e._gsap;o[t]=s,o.renderTransform(r,o)},ot="transform",ls=ot+"Origin",EC=function i(e,t){var s=this,n=this.target,r=n.style,o=n._gsap;if(e in Ii&&r){if(this.tfm=this.tfm||{},e!=="transform")e=ri[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return s.tfm[a]=Si(n,a)}):this.tfm[e]=o.x?o[e]:Si(n,e),e===ls&&(this.tfm.zOrigin=o.zOrigin);else return ri.transform.split(",").forEach(function(a){return i.call(s,a,t)});if(this.props.indexOf(ot)>=0)return;o.svg&&(this.svgo=n.getAttribute("data-svg-origin"),this.props.push(ls,t,"")),e=ot}(r||t)&&this.props.push(e,t,r[e])},Qy=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},SC=function(){var e=this.props,t=this.target,s=t.style,n=t._gsap,r,o;for(r=0;r<e.length;r+=3)e[r+1]?e[r+1]===2?t[e[r]](e[r+2]):t[e[r]]=e[r+2]:e[r+2]?s[e[r]]=e[r+2]:s.removeProperty(e[r].substr(0,2)==="--"?e[r]:e[r].replace(Oh,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)n[o]=this.tfm[o];n.svg&&(n.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),r=Ph(),(!r||!r.isStart)&&!s[ot]&&(Qy(s),n.zOrigin&&s[ls]&&(s[ls]+=" "+n.zOrigin+"px",n.zOrigin=0,n.renderTransform()),n.uncache=1)}},Jy=function(e,t){var s={target:e,props:[],revert:SC,save:EC};return e._gsap||cs.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(n){return s.save(n)}),s},Zy,Eu=function(e,t){var s=Hi.createElementNS?Hi.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Hi.createElement(e);return s&&s.style?s:Hi.createElement(e)},oi=function i(e,t,s){var n=getComputedStyle(e);return n[t]||n.getPropertyValue(t.replace(Oh,"-$1").toLowerCase())||n.getPropertyValue(t)||!s&&i(e,vr(t)||t,1)||""},Cg="O,Moz,ms,Ms,Webkit".split(","),vr=function(e,t,s){var n=t||Tn,r=n.style,o=5;if(e in r&&!s)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(Cg[o]+e in r););return o<0?null:(o===3?"ms":o>=0?Cg[o]:"")+e},Su=function(){cC()&&window.document&&(Ig=window,Hi=Ig.document,or=Hi.documentElement,Tn=Eu("div")||{style:{}},Eu("div"),ot=vr(ot),ls=ot+"Origin",Tn.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Zy=!!vr("perspective"),Ph=cs.core.reverting,Dh=1)},wg=function(e){var t=e.ownerSVGElement,s=Eu("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),n=e.cloneNode(!0),r;n.style.display="block",s.appendChild(n),or.appendChild(s);try{r=n.getBBox()}catch{}return s.removeChild(n),or.removeChild(s),r},Dg=function(e,t){for(var s=t.length;s--;)if(e.hasAttribute(t[s]))return e.getAttribute(t[s])},ev=function(e){var t,s;try{t=e.getBBox()}catch{t=wg(e),s=1}return t&&(t.width||t.height)||s||(t=wg(e)),t&&!t.width&&!t.x&&!t.y?{x:+Dg(e,["x","cx","x1"])||0,y:+Dg(e,["y","cy","y1"])||0,width:0,height:0}:t},tv=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&ev(e))},Dn=function(e,t){if(t){var s=e.style,n;t in Ii&&t!==ls&&(t=ot),s.removeProperty?(n=t.substr(0,2),(n==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),s.removeProperty(n==="--"?t:t.replace(Oh,"-$1").toLowerCase())):s.removeAttribute(t)}},Vi=function(e,t,s,n,r,o){var a=new as(e._pt,t,s,0,1,o?Xy:jy);return e._pt=a,a.b=n,a.e=r,e._props.push(s),a},Pg={deg:1,rad:1,turn:1},xC={grid:1,flex:1},Qi=function i(e,t,s,n){var r=parseFloat(s)||0,o=(s+"").trim().substr((r+"").length)||"px",a=Tn.style,l=uC.test(t),c=e.tagName.toLowerCase()==="svg",u=(c?"client":"offset")+(l?"Width":"Height"),h=100,f=n==="px",d=n==="%",g,m,p,y;if(n===o||!r||Pg[n]||Pg[o])return r;if(o!=="px"&&!f&&(r=i(e,t,s,"px")),y=e.getCTM&&tv(e),(d||o==="%")&&(Ii[t]||~t.indexOf("adius")))return g=y?e.getBBox()[l?"width":"height"]:e[u],ut(d?r/g*h:r/100*g);if(a[l?"width":"height"]=h+(f?o:n),m=n!=="rem"&&~t.indexOf("adius")||n==="em"&&e.appendChild&&!c?e:e.parentNode,y&&(m=(e.ownerSVGElement||{}).parentNode),(!m||m===Hi||!m.appendChild)&&(m=Hi.body),p=m._gsap,p&&d&&p.width&&l&&p.time===gs.time&&!p.uncache)return ut(r/p.width*h);if(d&&(t==="height"||t==="width")){var _=e.style[t];e.style[t]=h+n,g=e[u],_?e.style[t]=_:Dn(e,t)}else(d||o==="%")&&!xC[oi(m,"display")]&&(a.position=oi(e,"position")),m===e&&(a.position="static"),m.appendChild(Tn),g=Tn[u],m.removeChild(Tn),a.position="absolute";return l&&d&&(p=xn(m),p.time=gs.time,p.width=m[u]),ut(f?g*r/h:g&&r?h/g*r:0)},Si=function(e,t,s,n){var r;return Dh||Su(),t in ri&&t!=="transform"&&(t=ri[t],~t.indexOf(",")&&(t=t.split(",")[0])),Ii[t]&&t!=="transform"?(r=Ao(e,n),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:Xa(oi(e,ls))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||n||~(r+"").indexOf("calc("))&&(r=ja[t]&&ja[t](e,t,s)||oi(e,t)||yy(e,t)||(t==="opacity"?1:0))),s&&!~(r+"").trim().indexOf(" ")?Qi(e,t,r,s)+s:r},bC=function(e,t,s,n){if(!s||s==="none"){var r=vr(t,e,1),o=r&&oi(e,r,1);o&&o!==s?(t=r,s=o):t==="borderColor"&&(s=oi(e,"borderTopColor"))}var a=new as(this._pt,e.style,t,0,1,Wy),l=0,c=0,u,h,f,d,g,m,p,y,_,T,E,S;if(a.b=s,a.e=n,s+="",n+="",n==="auto"&&(m=e.style[t],e.style[t]=n,n=oi(e,t)||n,m?e.style[t]=m:Dn(e,t)),u=[s,n],Fy(u),s=u[0],n=u[1],f=s.match(Yn)||[],S=n.match(Yn)||[],S.length){for(;h=Yn.exec(n);)p=h[0],_=n.substring(l,h.index),g?g=(g+1)%5:(_.substr(-5)==="rgba("||_.substr(-5)==="hsla(")&&(g=1),p!==(m=f[c++]||"")&&(d=parseFloat(m)||0,E=m.substr((d+"").length),p.charAt(1)==="="&&(p=rr(d,p)+E),y=parseFloat(p),T=p.substr((y+"").length),l=Yn.lastIndex-T.length,T||(T=T||_s.units[t]||E,l===n.length&&(n+=T,a.e+=T)),E!==T&&(d=Qi(e,t,m,T)||0),a._pt={_next:a._pt,p:_||c===1?_:",",s:d,c:y-d,m:g&&g<4||t==="zIndex"?Math.round:0});a.c=l<n.length?n.substring(l,n.length):""}else a.r=t==="display"&&n==="none"?Xy:jy;return hy.test(n)&&(a.e=0),this._pt=a,a},Og={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},AC=function(e){var t=e.split(" "),s=t[0],n=t[1]||"50%";return(s==="top"||s==="bottom"||n==="left"||n==="right")&&(e=s,s=n,n=e),t[0]=Og[s]||s,t[1]=Og[n]||n,t.join(" ")},LC=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var s=t.t,n=s.style,r=t.u,o=s._gsap,a,l,c;if(r==="all"||r===!0)n.cssText="",l=1;else for(r=r.split(","),c=r.length;--c>-1;)a=r[c],Ii[a]&&(l=1,a=a==="transformOrigin"?ls:ot),Dn(s,a);l&&(Dn(s,ot),o&&(o.svg&&s.removeAttribute("transform"),n.scale=n.rotate=n.translate="none",Ao(s,1),o.uncache=1,Qy(n)))}},ja={clearProps:function(e,t,s,n,r){if(r.data!=="isFromStart"){var o=e._pt=new as(e._pt,t,s,0,0,LC);return o.u=n,o.pr=-10,o.tween=r,e._props.push(s),1}}},bo=[1,0,0,1,0,0],sv={},iv=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Mg=function(e){var t=oi(e,ot);return iv(t)?bo:t.substr(7).match(uy).map(ut)},Mh=function(e,t){var s=e._gsap||xn(e),n=e.style,r=Mg(e),o,a,l,c;return s.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,r=[l.a,l.b,l.c,l.d,l.e,l.f],r.join(",")==="1,0,0,1,0,0"?bo:r):(r===bo&&!e.offsetParent&&e!==or&&!s.svg&&(l=n.display,n.display="block",o=e.parentNode,(!o||!e.offsetParent&&!e.getBoundingClientRect().width)&&(c=1,a=e.nextElementSibling,or.appendChild(e)),r=Mg(e),l?n.display=l:Dn(e,"display"),c&&(a?o.insertBefore(e,a):o?o.appendChild(e):or.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},xu=function(e,t,s,n,r,o){var a=e._gsap,l=r||Mh(e,!0),c=a.xOrigin||0,u=a.yOrigin||0,h=a.xOffset||0,f=a.yOffset||0,d=l[0],g=l[1],m=l[2],p=l[3],y=l[4],_=l[5],T=t.split(" "),E=parseFloat(T[0])||0,S=parseFloat(T[1])||0,R,x,L,A;s?l!==bo&&(x=d*p-g*m)&&(L=E*(p/x)+S*(-m/x)+(m*_-p*y)/x,A=E*(-g/x)+S*(d/x)-(d*_-g*y)/x,E=L,S=A):(R=ev(e),E=R.x+(~T[0].indexOf("%")?E/100*R.width:E),S=R.y+(~(T[1]||T[0]).indexOf("%")?S/100*R.height:S)),n||n!==!1&&a.smooth?(y=E-c,_=S-u,a.xOffset=h+(y*d+_*m)-y,a.yOffset=f+(y*g+_*p)-_):a.xOffset=a.yOffset=0,a.xOrigin=E,a.yOrigin=S,a.smooth=!!n,a.origin=t,a.originIsAbsolute=!!s,e.style[ls]="0px 0px",o&&(Vi(o,a,"xOrigin",c,E),Vi(o,a,"yOrigin",u,S),Vi(o,a,"xOffset",h,a.xOffset),Vi(o,a,"yOffset",f,a.yOffset)),e.setAttribute("data-svg-origin",E+" "+S)},Ao=function(e,t){var s=e._gsap||new By(e);if("x"in s&&!t&&!s.uncache)return s;var n=e.style,r=s.scaleX<0,o="px",a="deg",l=getComputedStyle(e),c=oi(e,ls)||"0",u,h,f,d,g,m,p,y,_,T,E,S,R,x,L,A,k,w,P,B,X,q,G,H,K,ae,fe,z,Y,ue,Ee,re;return u=h=f=m=p=y=_=T=E=0,d=g=1,s.svg=!!(e.getCTM&&tv(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(n[ot]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[ot]!=="none"?l[ot]:"")),n.scale=n.rotate=n.translate="none"),x=Mh(e,s.svg),s.svg&&(s.uncache?(K=e.getBBox(),c=s.xOrigin-K.x+"px "+(s.yOrigin-K.y)+"px",H=""):H=!t&&e.getAttribute("data-svg-origin"),xu(e,H||c,!!H||s.originIsAbsolute,s.smooth!==!1,x)),S=s.xOrigin||0,R=s.yOrigin||0,x!==bo&&(w=x[0],P=x[1],B=x[2],X=x[3],u=q=x[4],h=G=x[5],x.length===6?(d=Math.sqrt(w*w+P*P),g=Math.sqrt(X*X+B*B),m=w||P?Hn(P,w)*fn:0,_=B||X?Hn(B,X)*fn+m:0,_&&(g*=Math.abs(Math.cos(_*ar))),s.svg&&(u-=S-(S*w+R*B),h-=R-(S*P+R*X))):(re=x[6],ue=x[7],fe=x[8],z=x[9],Y=x[10],Ee=x[11],u=x[12],h=x[13],f=x[14],L=Hn(re,Y),p=L*fn,L&&(A=Math.cos(-L),k=Math.sin(-L),H=q*A+fe*k,K=G*A+z*k,ae=re*A+Y*k,fe=q*-k+fe*A,z=G*-k+z*A,Y=re*-k+Y*A,Ee=ue*-k+Ee*A,q=H,G=K,re=ae),L=Hn(-B,Y),y=L*fn,L&&(A=Math.cos(-L),k=Math.sin(-L),H=w*A-fe*k,K=P*A-z*k,ae=B*A-Y*k,Ee=X*k+Ee*A,w=H,P=K,B=ae),L=Hn(P,w),m=L*fn,L&&(A=Math.cos(L),k=Math.sin(L),H=w*A+P*k,K=q*A+G*k,P=P*A-w*k,G=G*A-q*k,w=H,q=K),p&&Math.abs(p)+Math.abs(m)>359.9&&(p=m=0,y=180-y),d=ut(Math.sqrt(w*w+P*P+B*B)),g=ut(Math.sqrt(G*G+re*re)),L=Hn(q,G),_=Math.abs(L)>2e-4?L*fn:0,E=Ee?1/(Ee<0?-Ee:Ee):0),s.svg&&(H=e.getAttribute("transform"),s.forceCSS=e.setAttribute("transform","")||!iv(oi(e,ot)),H&&e.setAttribute("transform",H))),Math.abs(_)>90&&Math.abs(_)<270&&(r?(d*=-1,_+=m<=0?180:-180,m+=m<=0?180:-180):(g*=-1,_+=_<=0?180:-180)),t=t||s.uncache,s.x=u-((s.xPercent=u&&(!t&&s.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-u)?-50:0)))?e.offsetWidth*s.xPercent/100:0)+o,s.y=h-((s.yPercent=h&&(!t&&s.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-h)?-50:0)))?e.offsetHeight*s.yPercent/100:0)+o,s.z=f+o,s.scaleX=ut(d),s.scaleY=ut(g),s.rotation=ut(m)+a,s.rotationX=ut(p)+a,s.rotationY=ut(y)+a,s.skewX=_+a,s.skewY=T+a,s.transformPerspective=E+o,(s.zOrigin=parseFloat(c.split(" ")[2])||!t&&s.zOrigin||0)&&(n[ls]=Xa(c)),s.xOffset=s.yOffset=0,s.force3D=_s.force3D,s.renderTransform=s.svg?RC:Zy?nv:IC,s.uncache=0,s},Xa=function(e){return(e=e.split(" "))[0]+" "+e[1]},_c=function(e,t,s){var n=Ft(t);return ut(parseFloat(t)+parseFloat(Qi(e,"x",s+"px",n)))+n},IC=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,nv(e,t)},ln="0deg",Ar="0px",cn=") ",nv=function(e,t){var s=t||this,n=s.xPercent,r=s.yPercent,o=s.x,a=s.y,l=s.z,c=s.rotation,u=s.rotationY,h=s.rotationX,f=s.skewX,d=s.skewY,g=s.scaleX,m=s.scaleY,p=s.transformPerspective,y=s.force3D,_=s.target,T=s.zOrigin,E="",S=y==="auto"&&e&&e!==1||y===!0;if(T&&(h!==ln||u!==ln)){var R=parseFloat(u)*ar,x=Math.sin(R),L=Math.cos(R),A;R=parseFloat(h)*ar,A=Math.cos(R),o=_c(_,o,x*A*-T),a=_c(_,a,-Math.sin(R)*-T),l=_c(_,l,L*A*-T+T)}p!==Ar&&(E+="perspective("+p+cn),(n||r)&&(E+="translate("+n+"%, "+r+"%) "),(S||o!==Ar||a!==Ar||l!==Ar)&&(E+=l!==Ar||S?"translate3d("+o+", "+a+", "+l+") ":"translate("+o+", "+a+cn),c!==ln&&(E+="rotate("+c+cn),u!==ln&&(E+="rotateY("+u+cn),h!==ln&&(E+="rotateX("+h+cn),(f!==ln||d!==ln)&&(E+="skew("+f+", "+d+cn),(g!==1||m!==1)&&(E+="scale("+g+", "+m+cn),_.style[ot]=E||"translate(0, 0)"},RC=function(e,t){var s=t||this,n=s.xPercent,r=s.yPercent,o=s.x,a=s.y,l=s.rotation,c=s.skewX,u=s.skewY,h=s.scaleX,f=s.scaleY,d=s.target,g=s.xOrigin,m=s.yOrigin,p=s.xOffset,y=s.yOffset,_=s.forceCSS,T=parseFloat(o),E=parseFloat(a),S,R,x,L,A;l=parseFloat(l),c=parseFloat(c),u=parseFloat(u),u&&(u=parseFloat(u),c+=u,l+=u),l||c?(l*=ar,c*=ar,S=Math.cos(l)*h,R=Math.sin(l)*h,x=Math.sin(l-c)*-f,L=Math.cos(l-c)*f,c&&(u*=ar,A=Math.tan(c-u),A=Math.sqrt(1+A*A),x*=A,L*=A,u&&(A=Math.tan(u),A=Math.sqrt(1+A*A),S*=A,R*=A)),S=ut(S),R=ut(R),x=ut(x),L=ut(L)):(S=h,L=f,R=x=0),(T&&!~(o+"").indexOf("px")||E&&!~(a+"").indexOf("px"))&&(T=Qi(d,"x",o,"px"),E=Qi(d,"y",a,"px")),(g||m||p||y)&&(T=ut(T+g-(g*S+m*x)+p),E=ut(E+m-(g*R+m*L)+y)),(n||r)&&(A=d.getBBox(),T=ut(T+n/100*A.width),E=ut(E+r/100*A.height)),A="matrix("+S+","+R+","+x+","+L+","+T+","+E+")",d.setAttribute("transform",A),_&&(d.style[ot]=A)},kC=function(e,t,s,n,r){var o=360,a=xt(r),l=parseFloat(r)*(a&&~r.indexOf("rad")?fn:1),c=l-n,u=n+c+"deg",h,f;return a&&(h=r.split("_")[1],h==="short"&&(c%=o,c!==c%(o/2)&&(c+=c<0?o:-o)),h==="cw"&&c<0?c=(c+o*kg)%o-~~(c/o)*o:h==="ccw"&&c>0&&(c=(c-o*kg)%o-~~(c/o)*o)),e._pt=f=new as(e._pt,t,s,n,c,fC),f.e=u,f.u="deg",e._props.push(s),f},Fg=function(e,t){for(var s in t)e[s]=t[s];return e},CC=function(e,t,s){var n=Fg({},s._gsap),r="perspective,force3D,transformOrigin,svgOrigin",o=s.style,a,l,c,u,h,f,d,g;n.svg?(c=s.getAttribute("transform"),s.setAttribute("transform",""),o[ot]=t,a=Ao(s,1),Dn(s,ot),s.setAttribute("transform",c)):(c=getComputedStyle(s)[ot],o[ot]=t,a=Ao(s,1),o[ot]=c);for(l in Ii)c=n[l],u=a[l],c!==u&&r.indexOf(l)<0&&(d=Ft(c),g=Ft(u),h=d!==g?Qi(s,l,c,g):parseFloat(c),f=parseFloat(u),e._pt=new as(e._pt,a,l,h,f-h,_u),e._pt.u=g||0,e._props.push(l));Fg(a,n)};os("padding,margin,Width,Radius",function(i,e){var t="Top",s="Right",n="Bottom",r="Left",o=(e<3?[t,s,n,r]:[t+r,t+s,n+s,n+r]).map(function(a){return e<2?i+a:"border"+a+i});ja[e>1?"border"+i:i]=function(a,l,c,u,h){var f,d;if(arguments.length<4)return f=o.map(function(g){return Si(a,g,c)}),d=f.join(" "),d.split(f[0]).length===5?f[0]:d;f=(u+"").split(" "),d={},o.forEach(function(g,m){return d[g]=f[m]=f[m]||f[(m-1)/2|0]}),a.init(l,d,h)}});var rv={name:"css",register:Su,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,s,n,r){var o=this._props,a=e.style,l=s.vars.startAt,c,u,h,f,d,g,m,p,y,_,T,E,S,R,x,L;Dh||Su(),this.styles=this.styles||Jy(e),L=this.styles.props,this.tween=s;for(m in t)if(m!=="autoRound"&&(u=t[m],!(fs[m]&&Gy(m,t,s,n,e,r)))){if(d=typeof u,g=ja[m],d==="function"&&(u=u.call(s,n,e,r),d=typeof u),d==="string"&&~u.indexOf("random(")&&(u=Eo(u)),g)g(this,e,m,u,s)&&(x=1);else if(m.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(m)+"").trim(),u+="",Wi.lastIndex=0,Wi.test(c)||(p=Ft(c),y=Ft(u)),y?p!==y&&(c=Qi(e,m,c,y)+y):p&&(u+=p),this.add(a,"setProperty",c,u,n,r,0,0,m),o.push(m),L.push(m,0,a[m]);else if(d!=="undefined"){if(l&&m in l?(c=typeof l[m]=="function"?l[m].call(s,n,e,r):l[m],xt(c)&&~c.indexOf("random(")&&(c=Eo(c)),Ft(c+"")||c==="auto"||(c+=_s.units[m]||Ft(Si(e,m))||""),(c+"").charAt(1)==="="&&(c=Si(e,m))):c=Si(e,m),f=parseFloat(c),_=d==="string"&&u.charAt(1)==="="&&u.substr(0,2),_&&(u=u.substr(2)),h=parseFloat(u),m in ri&&(m==="autoAlpha"&&(f===1&&Si(e,"visibility")==="hidden"&&h&&(f=0),L.push("visibility",0,a.visibility),Vi(this,a,"visibility",f?"inherit":"hidden",h?"inherit":"hidden",!h)),m!=="scale"&&m!=="transform"&&(m=ri[m],~m.indexOf(",")&&(m=m.split(",")[0]))),T=m in Ii,T){if(this.styles.save(m),E||(S=e._gsap,S.renderTransform&&!t.parseTransform||Ao(e,t.parseTransform),R=t.smoothOrigin!==!1&&S.smooth,E=this._pt=new as(this._pt,a,ot,0,1,S.renderTransform,S,0,-1),E.dep=1),m==="scale")this._pt=new as(this._pt,S,"scaleY",S.scaleY,(_?rr(S.scaleY,_+h):h)-S.scaleY||0,_u),this._pt.u=0,o.push("scaleY",m),m+="X";else if(m==="transformOrigin"){L.push(ls,0,a[ls]),u=AC(u),S.svg?xu(e,u,0,R,0,this):(y=parseFloat(u.split(" ")[2])||0,y!==S.zOrigin&&Vi(this,S,"zOrigin",S.zOrigin,y),Vi(this,a,m,Xa(c),Xa(u)));continue}else if(m==="svgOrigin"){xu(e,u,1,R,0,this);continue}else if(m in sv){kC(this,S,m,f,_?rr(f,_+u):u);continue}else if(m==="smoothOrigin"){Vi(this,S,"smooth",S.smooth,u);continue}else if(m==="force3D"){S[m]=u;continue}else if(m==="transform"){CC(this,u,e);continue}}else m in a||(m=vr(m)||m);if(T||(h||h===0)&&(f||f===0)&&!hC.test(u)&&m in a)p=(c+"").substr((f+"").length),h||(h=0),y=Ft(u)||(m in _s.units?_s.units[m]:p),p!==y&&(f=Qi(e,m,c,y)),this._pt=new as(this._pt,T?S:a,m,f,(_?rr(f,_+h):h)-f,!T&&(y==="px"||m==="zIndex")&&t.autoRound!==!1?gC:_u),this._pt.u=y||0,p!==y&&y!=="%"&&(this._pt.b=c,this._pt.r=dC);else if(m in a)bC.call(this,e,m,c,_?_+u:u);else if(m in e)this.add(e,m,c||e[m],_?_+u:u,n,r);else if(m!=="parseTransform"){xh(m,u);continue}T||(m in a?L.push(m,0,a[m]):typeof e[m]=="function"?L.push(m,2,e[m]()):L.push(m,1,c||e[m])),o.push(m)}}x&&qy(this)},render:function(e,t){if(t.tween._time||!Ph())for(var s=t._pt;s;)s.r(e,s.d),s=s._next;else t.styles.revert()},get:Si,aliases:ri,getSetter:function(e,t,s){var n=ri[t];return n&&n.indexOf(",")<0&&(t=n),t in Ii&&t!==ls&&(e._gsap.x||Si(e,"x"))?s&&Rg===s?t==="scale"?vC:yC:(Rg=s||{})&&(t==="scale"?TC:_C):e.style&&!_h(e.style[t])?mC:~t.indexOf("-")?pC:Ch(e,t)},core:{_removeProperty:Dn,_getMatrix:Mh}};cs.utils.checkPrefix=vr;cs.core.getStyleSaver=Jy;(function(i,e,t,s){var n=os(i+","+e+","+t,function(r){Ii[r]=1});os(e,function(r){_s.units[r]="deg",sv[r]=1}),ri[n[13]]=i+","+e,os(s,function(r){var o=r.split(":");ri[o[1]]=n[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");os("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){_s.units[i]="px"});cs.registerPlugin(rv);var In=cs.registerPlugin(rv)||cs;In.core.Tween;const wC={name:"RoleCard",props:{role:{type:Object,required:!0}},data(){return{isVisible:!1,imageLoaded:!1}},mounted(){const i=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting&&(this.isVisible=!0,i.disconnect())})},{threshold:.1});i.observe(this.$el)},methods:{handleImageLoad(i){this.imageLoaded=!0,i.target.classList.add("loaded"),this.$emit("image-load",i)}}},DC={class:"card-inner"},PC={class:"role-content"},OC={class:"image-container"},MC={key:0},FC=["srcset"],NC=["srcset"],$C=["srcset"],UC=["srcset"],BC=["src","alt"],GC={key:1,class:"image-placeholder"},HC={class:"role-info"};function VC(i,e,t,s,n,r){return ne(),ce("div",{class:"role-card",onClick:e[2]||(e[2]=o=>i.$emit("select",t.role)),tabindex:"0",onKeydown:e[3]||(e[3]=aE(o=>i.$emit("select",t.role),["enter"]))},[b("div",DC,[b("div",PC,[b("div",OC,[n.isVisible?(ne(),ce("picture",MC,[t.role.imageWebp?(ne(),ce("source",{key:0,srcset:t.role.imageWebp,type:"image/webp"},null,8,FC)):yt("",!0),b("source",{srcset:t.role.image||t.role.imageJpeg,type:"image/jpeg"},null,8,NC),b("source",{srcset:t.role.image||t.role.imageJpeg,type:"image/png"},null,8,$C),b("source",{srcset:t.role.image||t.role.imageJpeg,type:"image/svg+xml"},null,8,UC),b("img",{src:t.role.image||t.role.imageJpeg,alt:`${t.role.name}`,class:"role-image",onLoad:e[0]||(e[0]=(...o)=>r.handleImageLoad&&r.handleImageLoad(...o)),onError:e[1]||(e[1]=o=>i.$emit("image-error",o)),loading:"lazy"},null,40,BC)])):(ne(),ce("div",GC,e[4]||(e[4]=[b("div",{class:"shimmer"},null,-1)])))]),b("div",HC,[b("h2",null,Le(t.role.name),1),b("p",null,Le(t.role.description),1)]),e[5]||(e[5]=b("div",{class:"card-indicator"},[b("span",{class:"indicator-dot"}),b("span",{class:"indicator-text"},"")],-1))])])],32)}const KC=bt(wC,[["render",VC],["__scopeId","data-v-1c8c04f8"]]);const zC={name:"RoleSelection",components:{ProfileCard:z0,RoleCard:KC},data(){return{roles:[...m1]}},mounted(){this.$nextTick(()=>{In.set(".role-card",{pointerEvents:"none"}),In.from(".role-card",{duration:1,y:50,opacity:0,stagger:.2,ease:"power2.out",onComplete:()=>{In.set(".role-card",{pointerEvents:"auto"})}}),this.preloadImages()})},methods:{selectRole(i){try{const e={id:i.id,name:i.name,description:i.description,image:i.image||i.imageJpeg,route:i.route};localStorage.setItem("selectedRole",JSON.stringify(e)),this.$router.push({name:"Dialogue"})}catch(e){console.error(":",e),alert("")}},handleImageError(i){const e="/images/avatar-placeholder.png";i.target.src=e,i.target.onerror=null,i.target.classList.add("broken-image")},handleImageLoad(i){i.target.classList.add("loaded")},preloadImages(){Object.values(Object.assign({})).forEach(e=>{const t=new Image;t.src=e.default})}}},WC={class:"role-selection"},qC={class:"roles"},YC={class:"roles-grid"};function jC(i,e,t,s,n,r){const o=It("RoleCard");return ne(),ce("div",WC,[b("div",qC,[b("div",YC,[(ne(!0),ce(et,null,vs(n.roles,a=>(ne(),Ro(o,{key:a.id,role:a,onSelect:r.selectRole,onImageLoad:r.handleImageLoad,onImageError:r.handleImageError},null,8,["role","onSelect","onImageLoad","onImageError"]))),128))])])])}const XC=bt(zC,[["render",jC],["__scopeId","data-v-9cb23f2c"]]);const QC={name:"Dialogue",data(){return{role:{},script:[]}},computed:{fontSizes(){return["10rem","6rem","12rem","14rem","8rem"]},durations(){return["5s","4s","6s","5s","7s"]}},created(){const i=localStorage.getItem("selectedRole");if(i){const e=JSON.parse(i);this.role={...e,route:e.route||this.getRoleRoute(e.name)},this.script=p1[this.role.name]||[""]}else this.$router.push({name:"Home"})},mounted(){In.from(this.$el.querySelector(".dialogue-box"),{opacity:0,y:20,duration:1,ease:"power2.out"})},methods:{proceed(){this.role.route?window.location.href=this.role.route:(console.error(" route"),alert(""))},goBack(){this.$router.push({name:"Home"})}}},JC={class:"dialogue-container"},ZC={class:"background-words"},ew={class:"dialogue-box"},tw={class:"dialogue-title"},sw={class:"dialogue-content"},iw={class:"dialogue-buttons"};function nw(i,e,t,s,n,r){return ne(),ce("div",JC,[b("div",ZC,[(ne(),ce(et,null,vs(5,(o,a)=>b("div",{key:a,class:$e(a%2===0?"row-left":"row-right"),style:Yt({animationDelay:a*.5+"s",fontSize:r.fontSizes[a],animationDuration:r.durations[a]})},[(ne(),ce(et,null,vs(10,l=>b("span",{key:l},Le("ViaLonga Somniviva"))),64))],6)),64))]),b("div",ew,[b("h1",tw,Le(n.role.name)+"",1),b("div",sw,[(ne(!0),ce(et,null,vs(n.script,(o,a)=>(ne(),ce("p",{key:a,class:"dialogue-line"},Le(o),1))),128))]),b("div",iw,[b("button",{class:"dialogue-button adventure",onClick:e[0]||(e[0]=(...o)=>r.proceed&&r.proceed(...o))},e[2]||(e[2]=[b("i",{class:"fas fa-compass"},null,-1),b("span",null,"",-1)])),b("button",{class:"dialogue-button back",onClick:e[1]||(e[1]=(...o)=>r.goBack&&r.goBack(...o))},e[3]||(e[3]=[b("i",{class:"fas fa-arrow-left"},null,-1),b("span",null,"",-1)]))])])])}const rw=bt(QC,[["render",nw],["__scopeId","data-v-29d99b85"]]);function Fh(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let Mn=Fh();function ov(i){Mn=i}const to={exec:()=>null};function Ve(i,e=""){let t=typeof i=="string"?i:i.source;const s={replace:(n,r)=>{let o=typeof r=="string"?r:r.source;return o=o.replace(qt.caret,"$1"),t=t.replace(n,o),s},getRegex:()=>new RegExp(t,e)};return s}const qt={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:i=>new RegExp(`^( {0,3}${i})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:i=>new RegExp(`^ {0,${Math.min(3,i-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:i=>new RegExp(`^ {0,${Math.min(3,i-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:i=>new RegExp(`^ {0,${Math.min(3,i-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:i=>new RegExp(`^ {0,${Math.min(3,i-1)}}#`),htmlBeginRegex:i=>new RegExp(`^ {0,${Math.min(3,i-1)}}<(?:[a-z].*>|!--)`,"i")},ow=/^(?:[ \t]*(?:\n|$))+/,aw=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,lw=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,wo=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,cw=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Nh=/(?:[*+-]|\d{1,9}[.)])/,av=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,lv=Ve(av).replace(/bull/g,Nh).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),uw=Ve(av).replace(/bull/g,Nh).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),$h=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,hw=/^[^\n]+/,Uh=/(?!\s*\])(?:\\.|[^\[\]\\])+/,fw=Ve(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Uh).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),dw=Ve(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Nh).getRegex(),Sl="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Bh=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,gw=Ve("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Bh).replace("tag",Sl).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),cv=Ve($h).replace("hr",wo).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Sl).getRegex(),mw=Ve(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",cv).getRegex(),Gh={blockquote:mw,code:aw,def:fw,fences:lw,heading:cw,hr:wo,html:gw,lheading:lv,list:dw,newline:ow,paragraph:cv,table:to,text:hw},Ng=Ve("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",wo).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Sl).getRegex(),pw={...Gh,lheading:uw,table:Ng,paragraph:Ve($h).replace("hr",wo).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ng).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Sl).getRegex()},yw={...Gh,html:Ve(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Bh).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:to,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Ve($h).replace("hr",wo).replace("heading",` *#{1,6} *[^
]`).replace("lheading",lv).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},vw=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Tw=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,uv=/^( {2,}|\\)\n(?!\s*$)/,_w=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,xl=/[\p{P}\p{S}]/u,Hh=/[\s\p{P}\p{S}]/u,hv=/[^\s\p{P}\p{S}]/u,Ew=Ve(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Hh).getRegex(),fv=/(?!~)[\p{P}\p{S}]/u,Sw=/(?!~)[\s\p{P}\p{S}]/u,xw=/(?:[^\s\p{P}\p{S}]|~)/u,bw=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,dv=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Aw=Ve(dv,"u").replace(/punct/g,xl).getRegex(),Lw=Ve(dv,"u").replace(/punct/g,fv).getRegex(),gv="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Iw=Ve(gv,"gu").replace(/notPunctSpace/g,hv).replace(/punctSpace/g,Hh).replace(/punct/g,xl).getRegex(),Rw=Ve(gv,"gu").replace(/notPunctSpace/g,xw).replace(/punctSpace/g,Sw).replace(/punct/g,fv).getRegex(),kw=Ve("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,hv).replace(/punctSpace/g,Hh).replace(/punct/g,xl).getRegex(),Cw=Ve(/\\(punct)/,"gu").replace(/punct/g,xl).getRegex(),ww=Ve(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Dw=Ve(Bh).replace("(?:-->|$)","-->").getRegex(),Pw=Ve("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Dw).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Qa=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Ow=Ve(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Qa).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),mv=Ve(/^!?\[(label)\]\[(ref)\]/).replace("label",Qa).replace("ref",Uh).getRegex(),pv=Ve(/^!?\[(ref)\](?:\[\])?/).replace("ref",Uh).getRegex(),Mw=Ve("reflink|nolink(?!\\()","g").replace("reflink",mv).replace("nolink",pv).getRegex(),Vh={_backpedal:to,anyPunctuation:Cw,autolink:ww,blockSkip:bw,br:uv,code:Tw,del:to,emStrongLDelim:Aw,emStrongRDelimAst:Iw,emStrongRDelimUnd:kw,escape:vw,link:Ow,nolink:pv,punctuation:Ew,reflink:mv,reflinkSearch:Mw,tag:Pw,text:_w,url:to},Fw={...Vh,link:Ve(/^!?\[(label)\]\((.*?)\)/).replace("label",Qa).getRegex(),reflink:Ve(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Qa).getRegex()},bu={...Vh,emStrongRDelimAst:Rw,emStrongLDelim:Lw,url:Ve(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Nw={...bu,br:Ve(uv).replace("{2,}","*").getRegex(),text:Ve(bu.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ta={normal:Gh,gfm:pw,pedantic:yw},Lr={normal:Vh,gfm:bu,breaks:Nw,pedantic:Fw},$w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$g=i=>$w[i];function Xs(i,e){if(e){if(qt.escapeTest.test(i))return i.replace(qt.escapeReplace,$g)}else if(qt.escapeTestNoEncode.test(i))return i.replace(qt.escapeReplaceNoEncode,$g);return i}function Ug(i){try{i=encodeURI(i).replace(qt.percentDecode,"%")}catch{return null}return i}function Bg(i,e){var r;const t=i.replace(qt.findPipe,(o,a,l)=>{let c=!1,u=a;for(;--u>=0&&l[u]==="\\";)c=!c;return c?"|":" |"}),s=t.split(qt.splitPipe);let n=0;if(s[0].trim()||s.shift(),s.length>0&&!((r=s.at(-1))!=null&&r.trim())&&s.pop(),e)if(s.length>e)s.splice(e);else for(;s.length<e;)s.push("");for(;n<s.length;n++)s[n]=s[n].trim().replace(qt.slashPipe,"|");return s}function Ir(i,e,t){const s=i.length;if(s===0)return"";let n=0;for(;n<s&&i.charAt(s-n-1)===e;)n++;return i.slice(0,s-n)}function Uw(i,e){if(i.indexOf(e[1])===-1)return-1;let t=0;for(let s=0;s<i.length;s++)if(i[s]==="\\")s++;else if(i[s]===e[0])t++;else if(i[s]===e[1]&&(t--,t<0))return s;return t>0?-2:-1}function Gg(i,e,t,s,n){const r=e.href,o=e.title||null,a=i[1].replace(n.other.outputLinkReplace,"$1");s.state.inLink=!0;const l={type:i[0].charAt(0)==="!"?"image":"link",raw:t,href:r,title:o,text:a,tokens:s.inlineTokens(a)};return s.state.inLink=!1,l}function Bw(i,e,t){const s=i.match(t.other.indentCodeCompensation);if(s===null)return e;const n=s[1];return e.split(`
`).map(r=>{const o=r.match(t.other.beginningSpace);if(o===null)return r;const[a]=o;return a.length>=n.length?r.slice(n.length):r}).join(`
`)}class Ja{constructor(e){We(this,"options");We(this,"rules");We(this,"lexer");this.options=e||Mn}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const s=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?s:Ir(s,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const s=t[0],n=Bw(s,t[3]||"",this.rules);return{type:"code",raw:s,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let s=t[2].trim();if(this.rules.other.endingHash.test(s)){const n=Ir(s,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(s=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:Ir(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let s=Ir(t[0],`
`).split(`
`),n="",r="";const o=[];for(;s.length>0;){let a=!1;const l=[];let c;for(c=0;c<s.length;c++)if(this.rules.other.blockquoteStart.test(s[c]))l.push(s[c]),a=!0;else if(!a)l.push(s[c]);else break;s=s.slice(c);const u=l.join(`
`),h=u.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${u}`:u,r=r?`${r}
${h}`:h;const f=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(h,o,!0),this.lexer.state.top=f,s.length===0)break;const d=o.at(-1);if((d==null?void 0:d.type)==="code")break;if((d==null?void 0:d.type)==="blockquote"){const g=d,m=g.raw+`
`+s.join(`
`),p=this.blockquote(m);o[o.length-1]=p,n=n.substring(0,n.length-g.raw.length)+p.raw,r=r.substring(0,r.length-g.text.length)+p.text;break}else if((d==null?void 0:d.type)==="list"){const g=d,m=g.raw+`
`+s.join(`
`),p=this.list(m);o[o.length-1]=p,n=n.substring(0,n.length-d.raw.length)+p.raw,r=r.substring(0,r.length-g.raw.length)+p.raw,s=m.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:o,text:r}}}list(e){let t=this.rules.block.list.exec(e);if(t){let s=t[1].trim();const n=s.length>1,r={type:"list",raw:"",ordered:n,start:n?+s.slice(0,-1):"",loose:!1,items:[]};s=n?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=n?s:"[*+-]");const o=this.rules.other.listItemRegex(s);let a=!1;for(;e;){let c=!1,u="",h="";if(!(t=o.exec(e))||this.rules.block.hr.test(e))break;u=t[0],e=e.substring(u.length);let f=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,_=>" ".repeat(3*_.length)),d=e.split(`
`,1)[0],g=!f.trim(),m=0;if(this.options.pedantic?(m=2,h=f.trimStart()):g?m=t[1].length+1:(m=t[2].search(this.rules.other.nonSpaceChar),m=m>4?1:m,h=f.slice(m),m+=t[1].length),g&&this.rules.other.blankLine.test(d)&&(u+=d+`
`,e=e.substring(d.length+1),c=!0),!c){const _=this.rules.other.nextBulletRegex(m),T=this.rules.other.hrRegex(m),E=this.rules.other.fencesBeginRegex(m),S=this.rules.other.headingBeginRegex(m),R=this.rules.other.htmlBeginRegex(m);for(;e;){const x=e.split(`
`,1)[0];let L;if(d=x,this.options.pedantic?(d=d.replace(this.rules.other.listReplaceNesting,"  "),L=d):L=d.replace(this.rules.other.tabCharGlobal,"    "),E.test(d)||S.test(d)||R.test(d)||_.test(d)||T.test(d))break;if(L.search(this.rules.other.nonSpaceChar)>=m||!d.trim())h+=`
`+L.slice(m);else{if(g||f.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||E.test(f)||S.test(f)||T.test(f))break;h+=`
`+d}!g&&!d.trim()&&(g=!0),u+=x+`
`,e=e.substring(x.length+1),f=L.slice(m)}}r.loose||(a?r.loose=!0:this.rules.other.doubleBlankLine.test(u)&&(a=!0));let p=null,y;this.options.gfm&&(p=this.rules.other.listIsTask.exec(h),p&&(y=p[0]!=="[ ] ",h=h.replace(this.rules.other.listReplaceTask,""))),r.items.push({type:"list_item",raw:u,task:!!p,checked:y,loose:!1,text:h,tokens:[]}),r.raw+=u}const l=r.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;r.raw=r.raw.trimEnd();for(let c=0;c<r.items.length;c++)if(this.lexer.state.top=!1,r.items[c].tokens=this.lexer.blockTokens(r.items[c].text,[]),!r.loose){const u=r.items[c].tokens.filter(f=>f.type==="space"),h=u.length>0&&u.some(f=>this.rules.other.anyLine.test(f.raw));r.loose=h}if(r.loose)for(let c=0;c<r.items.length;c++)r.items[c].loose=!0;return r}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const s=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:s,raw:t[0],href:n,title:r}}}table(e){var a;const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const s=Bg(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),r=(a=t[3])!=null&&a.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(s.length===n.length){for(const l of n)this.rules.other.tableAlignRight.test(l)?o.align.push("right"):this.rules.other.tableAlignCenter.test(l)?o.align.push("center"):this.rules.other.tableAlignLeft.test(l)?o.align.push("left"):o.align.push(null);for(let l=0;l<s.length;l++)o.header.push({text:s[l],tokens:this.lexer.inline(s[l]),header:!0,align:o.align[l]});for(const l of r)o.rows.push(Bg(l,o.header.length).map((c,u)=>({text:c,tokens:this.lexer.inline(c),header:!1,align:o.align[u]})));return o}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const s=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:s,tokens:this.lexer.inline(s)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const s=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(s)){if(!this.rules.other.endAngleBracket.test(s))return;const o=Ir(s.slice(0,-1),"\\");if((s.length-o.length)%2===0)return}else{const o=Uw(t[2],"()");if(o===-2)return;if(o>-1){const l=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let n=t[2],r="";if(this.options.pedantic){const o=this.rules.other.pedanticHrefTitle.exec(n);o&&(n=o[1],r=o[3])}else r=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(s)?n=n.slice(1):n=n.slice(1,-1)),Gg(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:r&&r.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let s;if((s=this.rules.inline.reflink.exec(e))||(s=this.rules.inline.nolink.exec(e))){const n=(s[2]||s[1]).replace(this.rules.other.multipleSpaceGlobal," "),r=t[n.toLowerCase()];if(!r){const o=s[0].charAt(0);return{type:"text",raw:o,text:o}}return Gg(s,r,s[0],this.lexer,this.rules)}}emStrong(e,t,s=""){let n=this.rules.inline.emStrongLDelim.exec(e);if(!n||n[3]&&s.match(this.rules.other.unicodeAlphaNumeric))return;if(!(n[1]||n[2]||"")||!s||this.rules.inline.punctuation.exec(s)){const o=[...n[0]].length-1;let a,l,c=o,u=0;const h=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,t=t.slice(-1*e.length+o);(n=h.exec(t))!=null;){if(a=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!a)continue;if(l=[...a].length,n[3]||n[4]){c+=l;continue}else if((n[5]||n[6])&&o%3&&!((o+l)%3)){u+=l;continue}if(c-=l,c>0)continue;l=Math.min(l,l+c+u);const f=[...n[0]][0].length,d=e.slice(0,o+n.index+f+l);if(Math.min(o,l)%2){const m=d.slice(1,-1);return{type:"em",raw:d,text:m,tokens:this.lexer.inlineTokens(m)}}const g=d.slice(2,-2);return{type:"strong",raw:d,text:g,tokens:this.lexer.inlineTokens(g)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let s=t[2].replace(this.rules.other.newLineCharGlobal," ");const n=this.rules.other.nonSpaceChar.test(s),r=this.rules.other.startingSpaceChar.test(s)&&this.rules.other.endingSpaceChar.test(s);return n&&r&&(s=s.substring(1,s.length-1)),{type:"codespan",raw:t[0],text:s}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let s,n;return t[2]==="@"?(s=t[1],n="mailto:"+s):(s=t[1],n=s),{type:"link",raw:t[0],text:s,href:n,tokens:[{type:"text",raw:s,text:s}]}}}url(e){var s;let t;if(t=this.rules.inline.url.exec(e)){let n,r;if(t[2]==="@")n=t[0],r="mailto:"+n;else{let o;do o=t[0],t[0]=((s=this.rules.inline._backpedal.exec(t[0]))==null?void 0:s[0])??"";while(o!==t[0]);n=t[0],t[1]==="www."?r="http://"+t[0]:r=t[0]}return{type:"link",raw:t[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const s=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:s}}}}class Cs{constructor(e){We(this,"tokens");We(this,"options");We(this,"state");We(this,"tokenizer");We(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Mn,this.options.tokenizer=this.options.tokenizer||new Ja,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:qt,block:ta.normal,inline:Lr.normal};this.options.pedantic?(t.block=ta.pedantic,t.inline=Lr.pedantic):this.options.gfm&&(t.block=ta.gfm,this.options.breaks?t.inline=Lr.breaks:t.inline=Lr.gfm),this.tokenizer.rules=t}static get rules(){return{block:ta,inline:Lr}}static lex(e,t){return new Cs(t).lex(e)}static lexInline(e,t){return new Cs(t).inlineTokens(e)}lex(e){e=e.replace(qt.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const s=this.inlineQueue[t];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],s=!1){var n,r,o;for(this.options.pedantic&&(e=e.replace(qt.tabCharGlobal,"    ").replace(qt.spaceLine,""));e;){let a;if((r=(n=this.options.extensions)==null?void 0:n.block)!=null&&r.some(c=>(a=c.call({lexer:this},e,t))?(e=e.substring(a.raw.length),t.push(a),!0):!1))continue;if(a=this.tokenizer.space(e)){e=e.substring(a.raw.length);const c=t.at(-1);a.raw.length===1&&c!==void 0?c.raw+=`
`:t.push(a);continue}if(a=this.tokenizer.code(e)){e=e.substring(a.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+a.raw,c.text+=`
`+a.text,this.inlineQueue.at(-1).src=c.text):t.push(a);continue}if(a=this.tokenizer.fences(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.heading(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.hr(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.blockquote(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.list(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.html(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.def(e)){e=e.substring(a.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+a.raw,c.text+=`
`+a.raw,this.inlineQueue.at(-1).src=c.text):this.tokens.links[a.tag]||(this.tokens.links[a.tag]={href:a.href,title:a.title});continue}if(a=this.tokenizer.table(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.lheading(e)){e=e.substring(a.raw.length),t.push(a);continue}let l=e;if((o=this.options.extensions)!=null&&o.startBlock){let c=1/0;const u=e.slice(1);let h;this.options.extensions.startBlock.forEach(f=>{h=f.call({lexer:this},u),typeof h=="number"&&h>=0&&(c=Math.min(c,h))}),c<1/0&&c>=0&&(l=e.substring(0,c+1))}if(this.state.top&&(a=this.tokenizer.paragraph(l))){const c=t.at(-1);s&&(c==null?void 0:c.type)==="paragraph"?(c.raw+=`
`+a.raw,c.text+=`
`+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(a),s=l.length!==e.length,e=e.substring(a.raw.length);continue}if(a=this.tokenizer.text(e)){e=e.substring(a.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="text"?(c.raw+=`
`+a.raw,c.text+=`
`+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(a);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var a,l,c;let s=e,n=null;if(this.tokens.links){const u=Object.keys(this.tokens.links);if(u.length>0)for(;(n=this.tokenizer.rules.inline.reflinkSearch.exec(s))!=null;)u.includes(n[0].slice(n[0].lastIndexOf("[")+1,-1))&&(s=s.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(n=this.tokenizer.rules.inline.anyPunctuation.exec(s))!=null;)s=s.slice(0,n.index)+"++"+s.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(n=this.tokenizer.rules.inline.blockSkip.exec(s))!=null;)s=s.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let r=!1,o="";for(;e;){r||(o=""),r=!1;let u;if((l=(a=this.options.extensions)==null?void 0:a.inline)!=null&&l.some(f=>(u=f.call({lexer:this},e,t))?(e=e.substring(u.raw.length),t.push(u),!0):!1))continue;if(u=this.tokenizer.escape(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.tag(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.link(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(u.raw.length);const f=t.at(-1);u.type==="text"&&(f==null?void 0:f.type)==="text"?(f.raw+=u.raw,f.text+=u.text):t.push(u);continue}if(u=this.tokenizer.emStrong(e,s,o)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.codespan(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.br(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.del(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.autolink(e)){e=e.substring(u.raw.length),t.push(u);continue}if(!this.state.inLink&&(u=this.tokenizer.url(e))){e=e.substring(u.raw.length),t.push(u);continue}let h=e;if((c=this.options.extensions)!=null&&c.startInline){let f=1/0;const d=e.slice(1);let g;this.options.extensions.startInline.forEach(m=>{g=m.call({lexer:this},d),typeof g=="number"&&g>=0&&(f=Math.min(f,g))}),f<1/0&&f>=0&&(h=e.substring(0,f+1))}if(u=this.tokenizer.inlineText(h)){e=e.substring(u.raw.length),u.raw.slice(-1)!=="_"&&(o=u.raw.slice(-1)),r=!0;const f=t.at(-1);(f==null?void 0:f.type)==="text"?(f.raw+=u.raw,f.text+=u.text):t.push(u);continue}if(e){const f="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return t}}class Za{constructor(e){We(this,"options");We(this,"parser");this.options=e||Mn}space(e){return""}code({text:e,lang:t,escaped:s}){var o;const n=(o=(t||"").match(qt.notSpaceStart))==null?void 0:o[0],r=e.replace(qt.endingNewline,"")+`
`;return n?'<pre><code class="language-'+Xs(n)+'">'+(s?r:Xs(r,!0))+`</code></pre>
`:"<pre><code>"+(s?r:Xs(r,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,s=e.start;let n="";for(let a=0;a<e.items.length;a++){const l=e.items[a];n+=this.listitem(l)}const r=t?"ol":"ul",o=t&&s!==1?' start="'+s+'"':"";return"<"+r+o+`>
`+n+"</"+r+`>
`}listitem(e){var s;let t="";if(e.task){const n=this.checkbox({checked:!!e.checked});e.loose?((s=e.tokens[0])==null?void 0:s.type)==="paragraph"?(e.tokens[0].text=n+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=n+" "+Xs(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):t+=n+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",s="";for(let r=0;r<e.header.length;r++)s+=this.tablecell(e.header[r]);t+=this.tablerow({text:s});let n="";for(let r=0;r<e.rows.length;r++){const o=e.rows[r];s="";for(let a=0;a<o.length;a++)s+=this.tablecell(o[a]);n+=this.tablerow({text:s})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),s=e.header?"th":"td";return(e.align?`<${s} align="${e.align}">`:`<${s}>`)+t+`</${s}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${Xs(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:s}){const n=this.parser.parseInline(s),r=Ug(e);if(r===null)return n;e=r;let o='<a href="'+e+'"';return t&&(o+=' title="'+Xs(t)+'"'),o+=">"+n+"</a>",o}image({href:e,title:t,text:s,tokens:n}){n&&(s=this.parser.parseInline(n,this.parser.textRenderer));const r=Ug(e);if(r===null)return Xs(s);e=r;let o=`<img src="${e}" alt="${s}"`;return t&&(o+=` title="${Xs(t)}"`),o+=">",o}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:Xs(e.text)}}class Kh{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class ws{constructor(e){We(this,"options");We(this,"renderer");We(this,"textRenderer");this.options=e||Mn,this.options.renderer=this.options.renderer||new Za,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Kh}static parse(e,t){return new ws(t).parse(e)}static parseInline(e,t){return new ws(t).parseInline(e)}parse(e,t=!0){var n,r;let s="";for(let o=0;o<e.length;o++){const a=e[o];if((r=(n=this.options.extensions)==null?void 0:n.renderers)!=null&&r[a.type]){const c=a,u=this.options.extensions.renderers[c.type].call({parser:this},c);if(u!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(c.type)){s+=u||"";continue}}const l=a;switch(l.type){case"space":{s+=this.renderer.space(l);continue}case"hr":{s+=this.renderer.hr(l);continue}case"heading":{s+=this.renderer.heading(l);continue}case"code":{s+=this.renderer.code(l);continue}case"table":{s+=this.renderer.table(l);continue}case"blockquote":{s+=this.renderer.blockquote(l);continue}case"list":{s+=this.renderer.list(l);continue}case"html":{s+=this.renderer.html(l);continue}case"paragraph":{s+=this.renderer.paragraph(l);continue}case"text":{let c=l,u=this.renderer.text(c);for(;o+1<e.length&&e[o+1].type==="text";)c=e[++o],u+=`
`+this.renderer.text(c);t?s+=this.renderer.paragraph({type:"paragraph",raw:u,text:u,tokens:[{type:"text",raw:u,text:u,escaped:!0}]}):s+=u;continue}default:{const c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return s}parseInline(e,t=this.renderer){var n,r;let s="";for(let o=0;o<e.length;o++){const a=e[o];if((r=(n=this.options.extensions)==null?void 0:n.renderers)!=null&&r[a.type]){const c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(a.type)){s+=c||"";continue}}const l=a;switch(l.type){case"escape":{s+=t.text(l);break}case"html":{s+=t.html(l);break}case"link":{s+=t.link(l);break}case"image":{s+=t.image(l);break}case"strong":{s+=t.strong(l);break}case"em":{s+=t.em(l);break}case"codespan":{s+=t.codespan(l);break}case"br":{s+=t.br(l);break}case"del":{s+=t.del(l);break}case"text":{s+=t.text(l);break}default:{const c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return s}}class so{constructor(e){We(this,"options");We(this,"block");this.options=e||Mn}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?Cs.lex:Cs.lexInline}provideParser(){return this.block?ws.parse:ws.parseInline}}We(so,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class Gw{constructor(...e){We(this,"defaults",Fh());We(this,"options",this.setOptions);We(this,"parse",this.parseMarkdown(!0));We(this,"parseInline",this.parseMarkdown(!1));We(this,"Parser",ws);We(this,"Renderer",Za);We(this,"TextRenderer",Kh);We(this,"Lexer",Cs);We(this,"Tokenizer",Ja);We(this,"Hooks",so);this.use(...e)}walkTokens(e,t){var n,r;let s=[];for(const o of e)switch(s=s.concat(t.call(this,o)),o.type){case"table":{const a=o;for(const l of a.header)s=s.concat(this.walkTokens(l.tokens,t));for(const l of a.rows)for(const c of l)s=s.concat(this.walkTokens(c.tokens,t));break}case"list":{const a=o;s=s.concat(this.walkTokens(a.items,t));break}default:{const a=o;(r=(n=this.defaults.extensions)==null?void 0:n.childTokens)!=null&&r[a.type]?this.defaults.extensions.childTokens[a.type].forEach(l=>{const c=a[l].flat(1/0);s=s.concat(this.walkTokens(c,t))}):a.tokens&&(s=s.concat(this.walkTokens(a.tokens,t)))}}return s}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(s=>{const n={...s};if(n.async=this.defaults.async||n.async||!1,s.extensions&&(s.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if("renderer"in r){const o=t.renderers[r.name];o?t.renderers[r.name]=function(...a){let l=r.renderer.apply(this,a);return l===!1&&(l=o.apply(this,a)),l}:t.renderers[r.name]=r.renderer}if("tokenizer"in r){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const o=t[r.level];o?o.unshift(r.tokenizer):t[r.level]=[r.tokenizer],r.start&&(r.level==="block"?t.startBlock?t.startBlock.push(r.start):t.startBlock=[r.start]:r.level==="inline"&&(t.startInline?t.startInline.push(r.start):t.startInline=[r.start]))}"childTokens"in r&&r.childTokens&&(t.childTokens[r.name]=r.childTokens)}),n.extensions=t),s.renderer){const r=this.defaults.renderer||new Za(this.defaults);for(const o in s.renderer){if(!(o in r))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;const a=o,l=s.renderer[a],c=r[a];r[a]=(...u)=>{let h=l.apply(r,u);return h===!1&&(h=c.apply(r,u)),h||""}}n.renderer=r}if(s.tokenizer){const r=this.defaults.tokenizer||new Ja(this.defaults);for(const o in s.tokenizer){if(!(o in r))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;const a=o,l=s.tokenizer[a],c=r[a];r[a]=(...u)=>{let h=l.apply(r,u);return h===!1&&(h=c.apply(r,u)),h}}n.tokenizer=r}if(s.hooks){const r=this.defaults.hooks||new so;for(const o in s.hooks){if(!(o in r))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;const a=o,l=s.hooks[a],c=r[a];so.passThroughHooks.has(o)?r[a]=u=>{if(this.defaults.async)return Promise.resolve(l.call(r,u)).then(f=>c.call(r,f));const h=l.call(r,u);return c.call(r,h)}:r[a]=(...u)=>{let h=l.apply(r,u);return h===!1&&(h=c.apply(r,u)),h}}n.hooks=r}if(s.walkTokens){const r=this.defaults.walkTokens,o=s.walkTokens;n.walkTokens=function(a){let l=[];return l.push(o.call(this,a)),r&&(l=l.concat(r.call(this,a))),l}}this.defaults={...this.defaults,...n}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return Cs.lex(e,t??this.defaults)}parser(e,t){return ws.parse(e,t??this.defaults)}parseMarkdown(e){return(s,n)=>{const r={...n},o={...this.defaults,...r},a=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&r.async===!1)return a(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof s>"u"||s===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof s!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(s)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=e);const l=o.hooks?o.hooks.provideLexer():e?Cs.lex:Cs.lexInline,c=o.hooks?o.hooks.provideParser():e?ws.parse:ws.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(s):s).then(u=>l(u,o)).then(u=>o.hooks?o.hooks.processAllTokens(u):u).then(u=>o.walkTokens?Promise.all(this.walkTokens(u,o.walkTokens)).then(()=>u):u).then(u=>c(u,o)).then(u=>o.hooks?o.hooks.postprocess(u):u).catch(a);try{o.hooks&&(s=o.hooks.preprocess(s));let u=l(s,o);o.hooks&&(u=o.hooks.processAllTokens(u)),o.walkTokens&&this.walkTokens(u,o.walkTokens);let h=c(u,o);return o.hooks&&(h=o.hooks.postprocess(h)),h}catch(u){return a(u)}}}onError(e,t){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const n="<p>An error occurred:</p><pre>"+Xs(s.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(s);throw s}}}const Pn=new Gw;function He(i,e){return Pn.parse(i,e)}He.options=He.setOptions=function(i){return Pn.setOptions(i),He.defaults=Pn.defaults,ov(He.defaults),He};He.getDefaults=Fh;He.defaults=Mn;He.use=function(...i){return Pn.use(...i),He.defaults=Pn.defaults,ov(He.defaults),He};He.walkTokens=function(i,e){return Pn.walkTokens(i,e)};He.parseInline=Pn.parseInline;He.Parser=ws;He.parser=ws.parse;He.Renderer=Za;He.TextRenderer=Kh;He.Lexer=Cs;He.lexer=Cs.lex;He.Tokenizer=Ja;He.Hooks=so;He.parse=He;He.options;He.setOptions;He.use;He.walkTokens;He.parseInline;ws.parse;Cs.lex;/*! @license DOMPurify 3.2.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.5/LICENSE */const{entries:yv,setPrototypeOf:Hg,isFrozen:Hw,getPrototypeOf:Vw,getOwnPropertyDescriptor:Kw}=Object;let{freeze:jt,seal:Ms,create:vv}=Object,{apply:Au,construct:Lu}=typeof Reflect<"u"&&Reflect;jt||(jt=function(e){return e});Ms||(Ms=function(e){return e});Au||(Au=function(e,t,s){return e.apply(t,s)});Lu||(Lu=function(e,t){return new e(...t)});const sa=Xt(Array.prototype.forEach),zw=Xt(Array.prototype.lastIndexOf),Vg=Xt(Array.prototype.pop),Rr=Xt(Array.prototype.push),Ww=Xt(Array.prototype.splice),Sa=Xt(String.prototype.toLowerCase),Ec=Xt(String.prototype.toString),Kg=Xt(String.prototype.match),kr=Xt(String.prototype.replace),qw=Xt(String.prototype.indexOf),Yw=Xt(String.prototype.trim),Ns=Xt(Object.prototype.hasOwnProperty),Gt=Xt(RegExp.prototype.test),Cr=jw(TypeError);function Xt(i){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];return Au(i,e,s)}}function jw(i){return function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Lu(i,t)}}function Ce(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Sa;Hg&&Hg(i,null);let s=e.length;for(;s--;){let n=e[s];if(typeof n=="string"){const r=t(n);r!==n&&(Hw(e)||(e[s]=r),n=r)}i[n]=!0}return i}function Xw(i){for(let e=0;e<i.length;e++)Ns(i,e)||(i[e]=null);return i}function dn(i){const e=vv(null);for(const[t,s]of yv(i))Ns(i,t)&&(Array.isArray(s)?e[t]=Xw(s):s&&typeof s=="object"&&s.constructor===Object?e[t]=dn(s):e[t]=s);return e}function wr(i,e){for(;i!==null;){const s=Kw(i,e);if(s){if(s.get)return Xt(s.get);if(typeof s.value=="function")return Xt(s.value)}i=Vw(i)}function t(){return null}return t}const zg=jt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Sc=jt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),xc=jt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Qw=jt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),bc=jt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Jw=jt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Wg=jt(["#text"]),qg=jt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Ac=jt(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Yg=jt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ia=jt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Zw=Ms(/\{\{[\w\W]*|[\w\W]*\}\}/gm),eD=Ms(/<%[\w\W]*|[\w\W]*%>/gm),tD=Ms(/\$\{[\w\W]*/gm),sD=Ms(/^data-[\-\w.\u00B7-\uFFFF]+$/),iD=Ms(/^aria-[\-\w]+$/),Tv=Ms(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),nD=Ms(/^(?:\w+script|data):/i),rD=Ms(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),_v=Ms(/^html$/i),oD=Ms(/^[a-z][.\w]*(-[.\w]+)+$/i);var jg=Object.freeze({__proto__:null,ARIA_ATTR:iD,ATTR_WHITESPACE:rD,CUSTOM_ELEMENT:oD,DATA_ATTR:sD,DOCTYPE_NAME:_v,ERB_EXPR:eD,IS_ALLOWED_URI:Tv,IS_SCRIPT_OR_DATA:nD,MUSTACHE_EXPR:Zw,TMPLIT_EXPR:tD});const Dr={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},aD=function(){return typeof window>"u"?null:window},lD=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let s=null;const n="data-tt-policy-suffix";t&&t.hasAttribute(n)&&(s=t.getAttribute(n));const r="dompurify"+(s?"#"+s:"");try{return e.createPolicy(r,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+r+" could not be created."),null}},Xg=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Ev(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:aD();const e=ve=>Ev(ve);if(e.version="3.2.5",e.removed=[],!i||!i.document||i.document.nodeType!==Dr.document||!i.Element)return e.isSupported=!1,e;let{document:t}=i;const s=t,n=s.currentScript,{DocumentFragment:r,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:c,NamedNodeMap:u=i.NamedNodeMap||i.MozNamedAttrMap,HTMLFormElement:h,DOMParser:f,trustedTypes:d}=i,g=l.prototype,m=wr(g,"cloneNode"),p=wr(g,"remove"),y=wr(g,"nextSibling"),_=wr(g,"childNodes"),T=wr(g,"parentNode");if(typeof o=="function"){const ve=t.createElement("template");ve.content&&ve.content.ownerDocument&&(t=ve.content.ownerDocument)}let E,S="";const{implementation:R,createNodeIterator:x,createDocumentFragment:L,getElementsByTagName:A}=t,{importNode:k}=s;let w=Xg();e.isSupported=typeof yv=="function"&&typeof T=="function"&&R&&R.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:P,ERB_EXPR:B,TMPLIT_EXPR:X,DATA_ATTR:q,ARIA_ATTR:G,IS_SCRIPT_OR_DATA:H,ATTR_WHITESPACE:K,CUSTOM_ELEMENT:ae}=jg;let{IS_ALLOWED_URI:fe}=jg,z=null;const Y=Ce({},[...zg,...Sc,...xc,...bc,...Wg]);let ue=null;const Ee=Ce({},[...qg,...Ac,...Yg,...ia]);let re=Object.seal(vv(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Te=null,U=null,te=!0,Z=!0,le=!1,Ae=!0,Pe=!1,I=!0,C=!1,F=!1,$=!1,N=!1,W=!1,se=!1,Q=!0,J=!1;const j="user-content-";let ye=!0,ie=!1,he={},pe=null;const Ie=Ce({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ne=null;const we=Ce({},["audio","video","img","source","image","track"]);let dt=null;const Ze=Ce({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ct="http://www.w3.org/1998/Math/MathML",_t="http://www.w3.org/2000/svg",Ut="http://www.w3.org/1999/xhtml";let hi=Ut,At=!1,Qt=null;const Do=Ce({},[Ct,_t,Ut],Ec);let Po=Ce({},["mi","mo","mn","ms","mtext"]),Oo=Ce({},["annotation-xml"]);const Av=Ce({},["title","style","font","a","script"]);let Tr=null;const Lv=["application/xhtml+xml","text/html"],Iv="text/html";let Et=null,Fn=null;const Rv=t.createElement("form"),zh=function(D){return D instanceof RegExp||D instanceof Function},bl=function(){let D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Fn&&Fn===D)){if((!D||typeof D!="object")&&(D={}),D=dn(D),Tr=Lv.indexOf(D.PARSER_MEDIA_TYPE)===-1?Iv:D.PARSER_MEDIA_TYPE,Et=Tr==="application/xhtml+xml"?Ec:Sa,z=Ns(D,"ALLOWED_TAGS")?Ce({},D.ALLOWED_TAGS,Et):Y,ue=Ns(D,"ALLOWED_ATTR")?Ce({},D.ALLOWED_ATTR,Et):Ee,Qt=Ns(D,"ALLOWED_NAMESPACES")?Ce({},D.ALLOWED_NAMESPACES,Ec):Do,dt=Ns(D,"ADD_URI_SAFE_ATTR")?Ce(dn(Ze),D.ADD_URI_SAFE_ATTR,Et):Ze,Ne=Ns(D,"ADD_DATA_URI_TAGS")?Ce(dn(we),D.ADD_DATA_URI_TAGS,Et):we,pe=Ns(D,"FORBID_CONTENTS")?Ce({},D.FORBID_CONTENTS,Et):Ie,Te=Ns(D,"FORBID_TAGS")?Ce({},D.FORBID_TAGS,Et):{},U=Ns(D,"FORBID_ATTR")?Ce({},D.FORBID_ATTR,Et):{},he=Ns(D,"USE_PROFILES")?D.USE_PROFILES:!1,te=D.ALLOW_ARIA_ATTR!==!1,Z=D.ALLOW_DATA_ATTR!==!1,le=D.ALLOW_UNKNOWN_PROTOCOLS||!1,Ae=D.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Pe=D.SAFE_FOR_TEMPLATES||!1,I=D.SAFE_FOR_XML!==!1,C=D.WHOLE_DOCUMENT||!1,N=D.RETURN_DOM||!1,W=D.RETURN_DOM_FRAGMENT||!1,se=D.RETURN_TRUSTED_TYPE||!1,$=D.FORCE_BODY||!1,Q=D.SANITIZE_DOM!==!1,J=D.SANITIZE_NAMED_PROPS||!1,ye=D.KEEP_CONTENT!==!1,ie=D.IN_PLACE||!1,fe=D.ALLOWED_URI_REGEXP||Tv,hi=D.NAMESPACE||Ut,Po=D.MATHML_TEXT_INTEGRATION_POINTS||Po,Oo=D.HTML_INTEGRATION_POINTS||Oo,re=D.CUSTOM_ELEMENT_HANDLING||{},D.CUSTOM_ELEMENT_HANDLING&&zh(D.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(re.tagNameCheck=D.CUSTOM_ELEMENT_HANDLING.tagNameCheck),D.CUSTOM_ELEMENT_HANDLING&&zh(D.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(re.attributeNameCheck=D.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),D.CUSTOM_ELEMENT_HANDLING&&typeof D.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(re.allowCustomizedBuiltInElements=D.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Pe&&(Z=!1),W&&(N=!0),he&&(z=Ce({},Wg),ue=[],he.html===!0&&(Ce(z,zg),Ce(ue,qg)),he.svg===!0&&(Ce(z,Sc),Ce(ue,Ac),Ce(ue,ia)),he.svgFilters===!0&&(Ce(z,xc),Ce(ue,Ac),Ce(ue,ia)),he.mathMl===!0&&(Ce(z,bc),Ce(ue,Yg),Ce(ue,ia))),D.ADD_TAGS&&(z===Y&&(z=dn(z)),Ce(z,D.ADD_TAGS,Et)),D.ADD_ATTR&&(ue===Ee&&(ue=dn(ue)),Ce(ue,D.ADD_ATTR,Et)),D.ADD_URI_SAFE_ATTR&&Ce(dt,D.ADD_URI_SAFE_ATTR,Et),D.FORBID_CONTENTS&&(pe===Ie&&(pe=dn(pe)),Ce(pe,D.FORBID_CONTENTS,Et)),ye&&(z["#text"]=!0),C&&Ce(z,["html","head","body"]),z.table&&(Ce(z,["tbody"]),delete Te.tbody),D.TRUSTED_TYPES_POLICY){if(typeof D.TRUSTED_TYPES_POLICY.createHTML!="function")throw Cr('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof D.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Cr('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');E=D.TRUSTED_TYPES_POLICY,S=E.createHTML("")}else E===void 0&&(E=lD(d,n)),E!==null&&typeof S=="string"&&(S=E.createHTML(""));jt&&jt(D),Fn=D}},Wh=Ce({},[...Sc,...xc,...Qw]),qh=Ce({},[...bc,...Jw]),kv=function(D){let ee=T(D);(!ee||!ee.tagName)&&(ee={namespaceURI:hi,tagName:"template"});const ge=Sa(D.tagName),st=Sa(ee.tagName);return Qt[D.namespaceURI]?D.namespaceURI===_t?ee.namespaceURI===Ut?ge==="svg":ee.namespaceURI===Ct?ge==="svg"&&(st==="annotation-xml"||Po[st]):!!Wh[ge]:D.namespaceURI===Ct?ee.namespaceURI===Ut?ge==="math":ee.namespaceURI===_t?ge==="math"&&Oo[st]:!!qh[ge]:D.namespaceURI===Ut?ee.namespaceURI===_t&&!Oo[st]||ee.namespaceURI===Ct&&!Po[st]?!1:!qh[ge]&&(Av[ge]||!Wh[ge]):!!(Tr==="application/xhtml+xml"&&Qt[D.namespaceURI]):!1},Ks=function(D){Rr(e.removed,{element:D});try{T(D).removeChild(D)}catch{p(D)}},Mo=function(D,ee){try{Rr(e.removed,{attribute:ee.getAttributeNode(D),from:ee})}catch{Rr(e.removed,{attribute:null,from:ee})}if(ee.removeAttribute(D),D==="is")if(N||W)try{Ks(ee)}catch{}else try{ee.setAttribute(D,"")}catch{}},Yh=function(D){let ee=null,ge=null;if($)D="<remove></remove>"+D;else{const Lt=Kg(D,/^[\r\n\t ]+/);ge=Lt&&Lt[0]}Tr==="application/xhtml+xml"&&hi===Ut&&(D='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+D+"</body></html>");const st=E?E.createHTML(D):D;if(hi===Ut)try{ee=new f().parseFromString(st,Tr)}catch{}if(!ee||!ee.documentElement){ee=R.createDocument(hi,"template",null);try{ee.documentElement.innerHTML=At?S:st}catch{}}const wt=ee.body||ee.documentElement;return D&&ge&&wt.insertBefore(t.createTextNode(ge),wt.childNodes[0]||null),hi===Ut?A.call(ee,C?"html":"body")[0]:C?ee.documentElement:wt},jh=function(D){return x.call(D.ownerDocument||D,D,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},Al=function(D){return D instanceof h&&(typeof D.nodeName!="string"||typeof D.textContent!="string"||typeof D.removeChild!="function"||!(D.attributes instanceof u)||typeof D.removeAttribute!="function"||typeof D.setAttribute!="function"||typeof D.namespaceURI!="string"||typeof D.insertBefore!="function"||typeof D.hasChildNodes!="function")},Xh=function(D){return typeof a=="function"&&D instanceof a};function fi(ve,D,ee){sa(ve,ge=>{ge.call(e,D,ee,Fn)})}const Qh=function(D){let ee=null;if(fi(w.beforeSanitizeElements,D,null),Al(D))return Ks(D),!0;const ge=Et(D.nodeName);if(fi(w.uponSanitizeElement,D,{tagName:ge,allowedTags:z}),D.hasChildNodes()&&!Xh(D.firstElementChild)&&Gt(/<[/\w!]/g,D.innerHTML)&&Gt(/<[/\w!]/g,D.textContent)||D.nodeType===Dr.progressingInstruction||I&&D.nodeType===Dr.comment&&Gt(/<[/\w]/g,D.data))return Ks(D),!0;if(!z[ge]||Te[ge]){if(!Te[ge]&&Zh(ge)&&(re.tagNameCheck instanceof RegExp&&Gt(re.tagNameCheck,ge)||re.tagNameCheck instanceof Function&&re.tagNameCheck(ge)))return!1;if(ye&&!pe[ge]){const st=T(D)||D.parentNode,wt=_(D)||D.childNodes;if(wt&&st){const Lt=wt.length;for(let Jt=Lt-1;Jt>=0;--Jt){const zs=m(wt[Jt],!0);zs.__removalCount=(D.__removalCount||0)+1,st.insertBefore(zs,y(D))}}}return Ks(D),!0}return D instanceof l&&!kv(D)||(ge==="noscript"||ge==="noembed"||ge==="noframes")&&Gt(/<\/no(script|embed|frames)/i,D.innerHTML)?(Ks(D),!0):(Pe&&D.nodeType===Dr.text&&(ee=D.textContent,sa([P,B,X],st=>{ee=kr(ee,st," ")}),D.textContent!==ee&&(Rr(e.removed,{element:D.cloneNode()}),D.textContent=ee)),fi(w.afterSanitizeElements,D,null),!1)},Jh=function(D,ee,ge){if(Q&&(ee==="id"||ee==="name")&&(ge in t||ge in Rv))return!1;if(!(Z&&!U[ee]&&Gt(q,ee))){if(!(te&&Gt(G,ee))){if(!ue[ee]||U[ee]){if(!(Zh(D)&&(re.tagNameCheck instanceof RegExp&&Gt(re.tagNameCheck,D)||re.tagNameCheck instanceof Function&&re.tagNameCheck(D))&&(re.attributeNameCheck instanceof RegExp&&Gt(re.attributeNameCheck,ee)||re.attributeNameCheck instanceof Function&&re.attributeNameCheck(ee))||ee==="is"&&re.allowCustomizedBuiltInElements&&(re.tagNameCheck instanceof RegExp&&Gt(re.tagNameCheck,ge)||re.tagNameCheck instanceof Function&&re.tagNameCheck(ge))))return!1}else if(!dt[ee]){if(!Gt(fe,kr(ge,K,""))){if(!((ee==="src"||ee==="xlink:href"||ee==="href")&&D!=="script"&&qw(ge,"data:")===0&&Ne[D])){if(!(le&&!Gt(H,kr(ge,K,"")))){if(ge)return!1}}}}}}return!0},Zh=function(D){return D!=="annotation-xml"&&Kg(D,ae)},ef=function(D){fi(w.beforeSanitizeAttributes,D,null);const{attributes:ee}=D;if(!ee||Al(D))return;const ge={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ue,forceKeepAttr:void 0};let st=ee.length;for(;st--;){const wt=ee[st],{name:Lt,namespaceURI:Jt,value:zs}=wt,_r=Et(Lt);let Bt=Lt==="value"?zs:Yw(zs);if(ge.attrName=_r,ge.attrValue=Bt,ge.keepAttr=!0,ge.forceKeepAttr=void 0,fi(w.uponSanitizeAttribute,D,ge),Bt=ge.attrValue,J&&(_r==="id"||_r==="name")&&(Mo(Lt,D),Bt=j+Bt),I&&Gt(/((--!?|])>)|<\/(style|title)/i,Bt)){Mo(Lt,D);continue}if(ge.forceKeepAttr||(Mo(Lt,D),!ge.keepAttr))continue;if(!Ae&&Gt(/\/>/i,Bt)){Mo(Lt,D);continue}Pe&&sa([P,B,X],sf=>{Bt=kr(Bt,sf," ")});const tf=Et(D.nodeName);if(Jh(tf,_r,Bt)){if(E&&typeof d=="object"&&typeof d.getAttributeType=="function"&&!Jt)switch(d.getAttributeType(tf,_r)){case"TrustedHTML":{Bt=E.createHTML(Bt);break}case"TrustedScriptURL":{Bt=E.createScriptURL(Bt);break}}try{Jt?D.setAttributeNS(Jt,Lt,Bt):D.setAttribute(Lt,Bt),Al(D)?Ks(D):Vg(e.removed)}catch{}}}fi(w.afterSanitizeAttributes,D,null)},Cv=function ve(D){let ee=null;const ge=jh(D);for(fi(w.beforeSanitizeShadowDOM,D,null);ee=ge.nextNode();)fi(w.uponSanitizeShadowNode,ee,null),Qh(ee),ef(ee),ee.content instanceof r&&ve(ee.content);fi(w.afterSanitizeShadowDOM,D,null)};return e.sanitize=function(ve){let D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ee=null,ge=null,st=null,wt=null;if(At=!ve,At&&(ve="<!-->"),typeof ve!="string"&&!Xh(ve))if(typeof ve.toString=="function"){if(ve=ve.toString(),typeof ve!="string")throw Cr("dirty is not a string, aborting")}else throw Cr("toString is not a function");if(!e.isSupported)return ve;if(F||bl(D),e.removed=[],typeof ve=="string"&&(ie=!1),ie){if(ve.nodeName){const zs=Et(ve.nodeName);if(!z[zs]||Te[zs])throw Cr("root node is forbidden and cannot be sanitized in-place")}}else if(ve instanceof a)ee=Yh("<!---->"),ge=ee.ownerDocument.importNode(ve,!0),ge.nodeType===Dr.element&&ge.nodeName==="BODY"||ge.nodeName==="HTML"?ee=ge:ee.appendChild(ge);else{if(!N&&!Pe&&!C&&ve.indexOf("<")===-1)return E&&se?E.createHTML(ve):ve;if(ee=Yh(ve),!ee)return N?null:se?S:""}ee&&$&&Ks(ee.firstChild);const Lt=jh(ie?ve:ee);for(;st=Lt.nextNode();)Qh(st),ef(st),st.content instanceof r&&Cv(st.content);if(ie)return ve;if(N){if(W)for(wt=L.call(ee.ownerDocument);ee.firstChild;)wt.appendChild(ee.firstChild);else wt=ee;return(ue.shadowroot||ue.shadowrootmode)&&(wt=k.call(s,wt,!0)),wt}let Jt=C?ee.outerHTML:ee.innerHTML;return C&&z["!doctype"]&&ee.ownerDocument&&ee.ownerDocument.doctype&&ee.ownerDocument.doctype.name&&Gt(_v,ee.ownerDocument.doctype.name)&&(Jt="<!DOCTYPE "+ee.ownerDocument.doctype.name+`>
`+Jt),Pe&&sa([P,B,X],zs=>{Jt=kr(Jt,zs," ")}),E&&se?E.createHTML(Jt):Jt},e.setConfig=function(){let ve=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};bl(ve),F=!0},e.clearConfig=function(){Fn=null,F=!1},e.isValidAttribute=function(ve,D,ee){Fn||bl({});const ge=Et(ve),st=Et(D);return Jh(ge,st,ee)},e.addHook=function(ve,D){typeof D=="function"&&Rr(w[ve],D)},e.removeHook=function(ve,D){if(D!==void 0){const ee=zw(w[ve],D);return ee===-1?void 0:Ww(w[ve],ee,1)[0]}return Vg(w[ve])},e.removeHooks=function(ve){w[ve]=[]},e.removeAllHooks=function(){w=Xg()},e}var Qg=Ev();const cD={name:"MessageBoardPage",data(){return{issues:[],isLoadingIssues:!1,issuesError:null,issuesCacheTime:0,issuesCacheDuration:5*60*1e3,repoOwner:"Wenturc",repoName:"WentUrc-v2-site"}},computed:{repoBaseUrl(){return`https://github.com/${this.repoOwner}/${this.repoName}`},repoIssuesUrl(){return`${this.repoBaseUrl}/issues`},createIssueUrl(){return`${this.repoBaseUrl}/issues/new?template=message_board.yml`}},methods:{formatDate(i){const e=new Date(i),s=new Date-e,n=Math.floor(s/(1e3*60*60*24));return n===0?"":n===1?"":n<7?`${n}`:`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`},formatIssueBody(i){if(!i)return"";const e=this.parseMessageTemplate(i);if(e)return e;let t=i;i.length>200&&(t=i.substring(0,200)+"...");const s=He(t);return Qg.sanitize(s)},parseMessageTemplate(i){const e=i.includes("###  ")||i.includes("###  "),t=i.includes("** **")||i.includes("** **");if(!e&&!t)return null;try{let s="",n;e?n=i.match(/###  \s*\n([\s\S]*?)(?:### |$)/):n=i.match(/\*\* \*\*([\s\S]*?)(?:\*\*|---|$)/),n&&n[1]&&(s=n[1].trim(),t&&(s=s.replace(//,"").replace(/^[\s\n]+/,"")));let r=null;i.includes("- [x] ")||i.includes("- [X] ")?r=!0:(i.includes("- [x] ")||i.includes("- [X] "))&&(r=!1);let o='<div class="message-content">';if(s&&s.trim()&&(t&&(s=s.replace(/^-\s*\[\s*[xX\s]?\s*\].*$/gm,"").replace(/^\s*\*\*.*?\*\*\s*$/gm,"").replace(/^---.*$/gm,"")),s.trim())){const a=He(s);o+=`<div class="message-text">${Qg.sanitize(a)}</div>`}return r!==null&&(o+=`<div class="reply-tag ${r?"reply-wanted":"no-reply-needed"}">${r?'<i class="fas fa-comment-dots"></i> ~':'<i class="fas fa-check-circle"></i> ~'}</div>`),o+="</div>",o.includes('<div class="message-text">')?o:null}catch(s){return console.error(":",s),null}},getAuthHeaders(){const i={Accept:"application/vnd.github.v3+json","User-Agent":"WentUrc-App"},e=localStorage.getItem("github-token");return e&&(i.Authorization=`token ${e}`),i},async loadIssues(){const i=Date.now();if(!(this.issues.length>0&&i-this.issuesCacheTime<this.issuesCacheDuration)){this.isLoadingIssues=!0,this.issuesError=null;try{const e=await fetch(`https://api.github.com/repos/${this.repoOwner}/${this.repoName}/issues?labels=&sort=created&direction=desc&per_page=10`,{headers:this.getAuthHeaders()});if(!e.ok){const s=e.headers.get("X-RateLimit-Remaining"),n=e.headers.get("X-RateLimit-Reset");if(e.status===403){const r=n?new Date(n*1e3).toLocaleTimeString():"";throw new Error(`GitHub API  : ${s}, : ${r}`)}else{if(e.status===401)throw new Error("GitHub Token   Token ");if(e.status===404)throw new Error("")}throw new Error(`HTTP ${e.status}: ${e.statusText}`)}const t=await e.json();this.issues=t,this.issuesCacheTime=i,console.log(" GitHub API :",{count:this.issues.length,issues:this.issues.map(s=>({id:s.id,title:s.title,hasBody:!!s.body,bodyLength:s.body?s.body.length:0,user:s.user.login}))}),this.issues.length>0?console.log(`  ${this.issues.length} `):console.log(" ")}catch(e){console.error(" :",e),this.issuesError=e.message;const t=this.getFriendlyErrorMessage(e);ns.error(`${t}`)}finally{this.isLoadingIssues=!1}}},getFriendlyErrorMessage(i){return i.message.includes("403")?"GitHub API ":i.message.includes("404")?"Issues":i.message.includes("Network")?"":""}},async mounted(){this.$nextTick(()=>{In.from(this.$el.querySelector(".message-board-inner"),{duration:.4,y:50,opacity:0,ease:"power2.out"})}),await this.loadIssues()}},uD={class:"message-board-page"},hD={class:"message-board-inner"},fD={class:"message-board-content"},dD={key:0,class:"loading-issues"},gD={key:1,class:"issues-container"},mD={class:"issue-header"},pD=["src","alt"],yD={class:"issue-meta"},vD={class:"issue-author"},TD={class:"issue-date"},_D=["innerHTML"],ED=["href"],SD={key:2,class:"no-issues"},xD={class:"message-actions"},bD=["href"],AD=["href"];function LD(i,e,t,s,n,r){return ne(),ce("div",uD,[b("div",hD,[e[5]||(e[5]=b("div",{class:"section-header"},[b("h1",{class:"section-title"},[b("i",{class:"fas fa-comments"}),ss("  ")]),b("p",{class:"section-subtitle"},"")],-1)),b("div",fD,[n.isLoadingIssues?(ne(),ce("div",dD,e[0]||(e[0]=[b("i",{class:"fas fa-spinner fa-spin"},null,-1),b("span",null,"",-1)]))):n.issues.length>0?(ne(),ce("div",gD,[(ne(!0),ce(et,null,vs(n.issues,o=>(ne(),ce("div",{key:o.id,class:"issue-item"},[b("div",mD,[b("img",{src:o.user.avatar_url,alt:o.user.login,class:"issue-avatar"},null,8,pD),b("div",yD,[b("span",vD,Le(o.user.login),1),b("span",TD,Le(r.formatDate(o.created_at)),1)])]),b("div",{class:"issue-body",innerHTML:r.formatIssueBody(o.body)},null,8,_D),b("a",{href:o.html_url,target:"_blank",rel:"noopener noreferrer",class:"issue-link"},e[1]||(e[1]=[ss("  "),b("i",{class:"fas fa-external-link-alt"},null,-1)]),8,ED)]))),128))])):(ne(),ce("div",SD,[b("p",null,Le(n.issuesError?"":""),1)])),b("div",xD,[b("a",{href:r.createIssueUrl,target:"_blank",rel:"noopener noreferrer",class:"message-board-link"},[e[2]||(e[2]=b("i",{class:"fas fa-comments"},null,-1)),b("span",null,Le(n.issues.length>0?"":""),1)],8,bD),n.issues.length>0?(ne(),ce("a",{key:0,href:r.repoIssuesUrl,target:"_blank",rel:"noopener noreferrer",class:"view-all-link"},e[3]||(e[3]=[ss("  "),b("i",{class:"fas fa-arrow-right"},null,-1)]),8,AD)):yt("",!0)]),e[4]||(e[4]=b("p",{class:"message-tip"}," GitHub ",-1))])])])}const ID=bt(cD,[["render",LD],["__scopeId","data-v-1693f63e"]]),RD=[{name:"Mlikiowa Home Village",url:"https://10snow.com/",avatar:"https://avatars.githubusercontent.com/u/61873808?u=c0bda4b4ddc8a9835cf9d57e28fbacfec804db03&v=4&size=80",description:""},{name:"Larch-Cat",url:"https://docs.wenturc.com/",avatar:"https://avatars.githubusercontent.com/u/186082640?u=164c8f93b21f439d6e0796c7ffa93987e24832f4&v=4&size=80",description:""}];const kD={name:"FriendLinksPage",data(){return{friendLinks:RD}},mounted(){this.$nextTick(()=>{In.from(this.$el.querySelector(".friend-links-inner"),{duration:.4,y:50,opacity:0,ease:"power2.out"})})}},CD={class:"friend-links-page"},wD={class:"friend-links-inner"},DD={class:"friend-links-content"},PD={class:"friends-grid"},OD=["href"],MD=["src","alt"],FD={class:"friend-info"},ND={class:"friend-name"},$D={class:"friend-desc"};function UD(i,e,t,s,n,r){return ne(),ce("div",CD,[b("div",wD,[e[1]||(e[1]=b("div",{class:"section-header"},[b("h1",{class:"section-title"},[b("i",{class:"fas fa-link"}),ss("  ")]),b("p",{class:"section-subtitle"},"")],-1)),b("div",DD,[b("div",PD,[(ne(!0),ce(et,null,vs(n.friendLinks,(o,a)=>(ne(),ce("a",{key:a,href:o.url,target:"_blank",rel:"noopener noreferrer",class:"friend-link"},[b("img",{src:o.avatar,alt:`${o.name}`,class:"friend-avatar"},null,8,MD),b("div",FD,[b("span",ND,Le(o.name),1),b("span",$D,Le(o.description),1)])],8,OD))),128))]),e[0]||(e[0]=b("div",{class:"exchange-note"},[b("p",null,"")],-1))])])])}const BD=bt(kD,[["render",UD],["__scopeId","data-v-f5df4c43"]]),GD=[{path:"/",name:"Home",component:XC},{path:"/dialogue",name:"Dialogue",component:rw},{path:"/message-board",name:"MessageBoard",component:ID,meta:{title:""}},{path:"/friend-links",name:"FriendLinks",component:BD,meta:{title:""}}],HD=a1({history:Fk(),routes:GD});const Sv={full:`      ___          ___          ___          
     /__/\\        /  /\\        /__/\\         
    _\\_ \\:\\      /  /:/_       \\  \\:\\       
   /__/\\ \\:\\    /  /:/ /\\       \\  \\:\\     
  _\\_ \\:\\ \\:\\  /  /:/ /:/_  _____\\__\\:\\   
 /__/\\ \\:\\ \\:\\/__/:/ /:/ /\\/__/::::::::\\ 
 \\  \\:\\ \\:\\/:/\\  \\:\\/:/ /:/\\  \\:\\~~\\~~\\/
  \\  \\:\\ \\::/  \\  \\::/ /:/  \\  \\:\\  ~~~ 
   \\  \\:\\/:/    \\  \\:\\/:/    \\  \\:\\      
    \\  \\::/      \\  \\::/      \\  \\:\\      
     \\__\\/        \\__\\/        \\__\\/      `,simple:` __      __          _    _   _          
 \\ \\    / /___  _ _ | |_ | | | | _ _  __ 
  \\ \\/\\/ // -_)| ' \\|  _|| |_| || '_|/ _|
   \\_/\\_/ \\___||_||_|\\__| \\___/ |_|  \\__|
                                         `,mini:"W E N T U R C",mono:` _       __              __   __  __           
| |     / /___   ____   / /_ / / / /_____ _____
| | /| / // _ \\ / __ \\ / __// / / // ___// ___/
| |/ |/ //  __// / / // /_ / /_/ // /   / /__  
|__/|__/ \\___//_/ /_/ \\__/ \\____//_/    \\___/  
                                               `},VD={full:"/ascii/wenturc-full.txt",simple:"/ascii/wenturc-simple.txt",mini:"/ascii/wenturc-mini.txt",mono:"/ascii/wenturc-mono.txt"},xa={};async function Nr(i="simple"){if(xa[i])return xa[i];const e=["full","simple","mini","mono"].includes(i)?i:"simple";try{const t=await fetch(VD[e]);if(!t.ok)throw new Error(`: ${t.status} ${t.statusText}`);const s=await t.text();return xa[e]=s,s}catch(t){return console.warn(`: ${t.message}`),Sv[e]}}function KD(i="simple"){return xa[i]||Sv[i]}function xv(){typeof window<"u"&&Promise.all([Nr("full"),Nr("simple"),Nr("mini"),Nr("mono")]).catch(i=>{console.warn(":",i)})}typeof window<"u"&&window.addEventListener("load",xv);class zD{constructor(){this.achievementId="dev-tools-explorer",this.hasAchievement=!1,typeof window<"u"&&xv()}initialize(){this.checkExistingAchievement(),this.hasAchievement||(this.exposeUnlockCommand(),this.showConsoleMessage())}async showConsoleMessage(){console.log("%c...","font-size: 14px; color: #38d9a9;");try{const e=await Nr("mono");console.clear(),console.log(`%c${e}

%c ! %c

%c  %c

""

%c  %c
:
%c> unlockDevToolsAchievement()%c

%c  %c
 
 
 

%c Happy Coding! `,"color: #1e90ff; font-family: monospace; font-size: 14px; font-weight: bold; text-shadow: 0 1px 0 #38d9a9;","background: linear-gradient(90deg, #73c2fb, #1e90ff); color: white; font-size: 16px; font-weight: bold; padding: 8px; border-radius: 8px; text-shadow: 0 1px 0 rgba(0,0,0,0.3);","","background: #38d9a9; color: white; font-size: 14px; font-weight: bold; padding: 6px 12px; border-radius: 25px 25px 25px 5px; margin: 6px 0;","color: #333; font-size: 14px;","background: #f1b944; color: white; font-size: 14px; font-weight: bold; padding: 6px 12px; border-radius: 25px 25px 25px 5px; margin: 6px 0;","color: #333; font-size: 14px;","background: #242424; color: #38d9a9; padding: 8px 16px; border-radius: 4px; font-family: monospace; font-weight: bold; font-size: 16px; letter-spacing: 1px; box-shadow: 0 2px 0 rgba(0,0,0,0.2);","","background: #ff6b6b; color: white; font-size: 14px; font-weight: bold; padding: 6px 12px; border-radius: 25px 25px 25px 5px; margin: 6px 0;","color: #333; font-size: 14px; line-height: 1.5;","color: #1e90ff; font-size: 18px; font-weight: bold; background: linear-gradient(45deg, #73c2fb, #ff6b6b, #38d9a9); -webkit-background-clip: text; -webkit-text-fill-color: transparent; padding: 10px 0; text-shadow: 0 1px 2px rgba(0,0,0,0.1);")}catch{console.clear();const t=KD("simple");console.log(`%c${t}

%c ! %c

"":
%c> unlockDevToolsAchievement()`,"color: #1e90ff; font-family: monospace; font-size: 14px;","color: #38d9a9; font-size: 16px; font-weight: bold;","color: #333;","background: #242424; color: #38d9a9; padding: 4px 8px; border-radius: 4px; font-family: monospace;")}}checkExistingAchievement(){try{const e=localStorage.getItem("achievements");if(e){const t=JSON.parse(e);this.hasAchievement=t.includes(this.achievementId)}}catch{this.hasAchievement=!1}}exposeUnlockCommand(){window.unlockDevToolsAchievement=()=>this.hasAchievement?"":(this.hasAchievement=!0,Ue.emit("achievement-unlocked",this.achievementId)," ")}enable(){return this}disable(){return this}stopChecking(){return this}reset(){return this}}const Iu=new zD;typeof window<"u"&&(document.readyState==="complete"?Iu.initialize():window.addEventListener("load",()=>{Iu.initialize()}));class WD{constructor(){this.storageKey="wenturc-seasons-visited",this.seasons={spring:!1,summer:!1,autumn:!1,winter:!1},this.achievementId="four-seasons",this.achievementTriggered=!1}enable(){this.loadSeasonsData(),this.checkCurrentSeason()}loadSeasonsData(){try{const e=localStorage.getItem(this.storageKey);e&&(this.seasons=JSON.parse(e))}catch(e){console.error("",e)}this.checkAchievementStatus()}saveSeasonsData(){localStorage.setItem(this.storageKey,JSON.stringify(this.seasons))}checkCurrentSeason(){const e=this.getCurrentSeason();this.seasons[e]||(this.seasons[e]=!0,this.saveSeasonsData(),this.checkAllSeasonsCompleted())}getCurrentSeason(){const t=new Date().getMonth()+1;return t>=3&&t<=5?"spring":t>=6&&t<=8?"summer":t>=9&&t<=11?"autumn":"winter"}checkAllSeasonsCompleted(){if(this.achievementTriggered)return;Object.values(this.seasons).every(t=>t)&&(this.achievementTriggered=!0,Ue.emit("achievement-unlocked",this.achievementId))}checkAchievementStatus(){var e;try{const t=localStorage.getItem("wenturc-achievements");t&&(e=JSON.parse(t)[this.achievementId])!=null&&e.unlocked&&(this.achievementTriggered=!0)}catch(t){console.error("",t)}}getProgress(){const e=Object.values(this.seasons).filter(t=>t).length;return{spring:this.seasons.spring,summer:this.seasons.summer,autumn:this.seasons.autumn,winter:this.seasons.winter,count:e,total:4,percentage:Math.round(e/4*100)}}devSetSeasonVisited(e,t=!0){return!1}devCompleteAllSeasons(){return!1}reset(){this.seasons={spring:!1,summer:!1,autumn:!1,winter:!1},this.achievementTriggered=!1,this.saveSeasonsData()}}const qD=new WD;vI();Iu.enable();qD.enable();yn.initialize();Vt.init();window.addEventListener("beforeunload",()=>{yn.cleanup()});const bv=uE(g1);bv.config.globalProperties.$notify=ns;bv.use(HD).mount("#app");export{q0 as A,pn as _,Ue as e};
