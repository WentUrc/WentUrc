name: Clean Git History
on:
  workflow_dispatch:
jobs:
  clean:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout full repo history
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Install git-filter-repo
        run: |
          pip install git-filter-repo
          
      - name: Remove MP3s from history
        run: |
          git filter-repo --path-glob '*.mp3' --invert-paths
          
      - name: Re-add origin remote and force push cleaned history
        run: |
          git remote add origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git
          git push origin --force --all
          git push origin --force --tags
